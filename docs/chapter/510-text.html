<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Minimalist Data Wrangling with Python" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2023" name="citation_date" />
<meta content="2023" name="citation_publication_date" />
<meta content="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf" name="citation_pdf_url" />
<meta content="https://datawranglingpy.gagolewski.com/" name="citation_public_url" />
<meta content="10.5281/zenodo.6451068" name="citation_doi" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Minimalist Data Wrangling with Python" name="twitter:title" />
<meta content="Minimalist Data Wrangling with Python" name="og:title" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="twitter:description" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="og:description" />
<meta content="gagolews/datawranglingpy" name="og:site_name" />
<meta content="https://datawranglingpy.gagolewski.com/" name="og:url" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://datawranglingpy.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571912" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="15. Missing, censored, and questionable data" href="520-missingness.html" /><link rel="prev" title="13. Accessing databases" href="440-sql.html" />
        <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/510-text.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 7.2.5 and Furo 2023.08.19 -->
        <title>14. Text data - Minimalist Data Wrangling with Python</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=3f409c7f" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Minimalist Data Wrangling with Python</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Minimalist Data Wrangling with Python</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com' style="display: contents">Marek Gagolewski</a><br />
v1.0.3.9005
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.amazon.com/dp/0645571911">Order a printed copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/">Deep R programming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar types and control structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and other types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional numeric data and their empirical distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing unidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous probability distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. Multidimensional numeric data at a glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing multidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring relationships between variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="410-data-frame.html">10. Introducing data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">11. Handling categorical data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing data in groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">13. Accessing databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other data types</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">14. Text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-missingness.html">15. Missing, censored, and questionable data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/datawranglingpy/issues/" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="text-data">
<span id="chap-text"></span><h1><span class="section-number">14. </span>Text data<a class="headerlink" href="#text-data" title="Link to this heading">#</a></h1>
<blockquote>
<div><p><em>The open-access textbook</em> Minimalist Data Wrangling with Python <em>by
<a class="reference external" href="https://www.gagolewski.com/">Marek Gagolewski</a>
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>;
a printed version can be ordered from
<a class="reference external" href="https://www.amazon.com/dp/0645571911">Amazon</a>:
<a class="reference external" href="https://amazon.com.au/dp/0645571911">AU</a>
<a class="reference external" href="https://amazon.ca/dp/0645571911">CA</a>
<a class="reference external" href="https://amazon.de/dp/0645571911">DE</a>
<a class="reference external" href="https://amazon.es/dp/0645571911">ES</a>
<a class="reference external" href="https://amazon.fr/dp/0645571911">FR</a>
<a class="reference external" href="https://amazon.it/dp/0645571911">IT</a>
<a class="reference external" href="https://amazon.co.jp/dp/0645571911">JP</a>
<a class="reference external" href="https://amazon.nl/dp/0645571911">NL</a>
<a class="reference external" href="https://amazon.pl/dp/0645571911">PL</a>
<a class="reference external" href="https://amazon.se/dp/0645571911">SE</a>
<a class="reference external" href="https://amazon.co.uk/dp/0645571911">UK</a>
<a class="reference external" href="https://amazon.com/dp/0645571911">US</a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy/issues">bug/typo reports/fixes</a>
are appreciated. Make sure to check out the author’s other book,
<a class="reference external" href="https://deepr.gagolewski.com/"><em>Deep R Programming</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id2" title="Gagolewski, M. (2023).  Deep R Programming. Zenodo. URL: https://deepr.gagolewski.com/, DOI: 10.5281/zenodo.7490464.">34</a>]</span>.</em></p>
</div></blockquote>
<p>In <span id="id2">[<a class="reference internal" href="999-bibliography.html#id17" title="Gagolewski, M. (2022).  stringi: Fast and portable character string processing in R. Journal of Statistical Software, 103(2):1–59. URL: https://stringi.gagolewski.com/, DOI: 10.18637/jss.v103.i02.">33</a>]</span>, it is noted that
effective processing of character strings is needed at various
stages of data analysis pipelines:
from data cleansing and preparation, through
information extraction, to report generation;
compare, e.g., <span id="id3">[<a class="reference internal" href="999-bibliography.html#id19" title="van der Loo, M. and de Jonge, E. (2018).  Statistical Data Cleaning with Applications in R. John Wiley &amp; Sons.">90</a>]</span> and <span id="id4">[<a class="reference internal" href="999-bibliography.html#id20" title="Dasu, T. and Johnson, T. (2003).  Exploratory Data Mining and Data Cleaning. John Wiley &amp; Sons.">18</a>]</span>.
<em>Pattern searching, string collation and sorting, normalisation,
transliteration, and formatting are ubiquitous in
text mining, natural language processing, and bioinformatics.</em>
Means for the handling of string data
<em>should be included in each statistician’s or data scientist’s
repertoire to complement their  numerical computing
and data wrangling skills.</em></p>
<p>In this chapter, we discuss the handiest string operations
in base Python, together with their vectorised versions
in <strong class="program">numpy</strong> and <strong class="program">pandas</strong>.
We also mention some more advanced features of the Unicode
<strong class="program">ICU</strong> library.</p>
<section id="basic-string-operations">
<h2><span class="section-number">14.1. </span>Basic string operations<a class="headerlink" href="#basic-string-operations" title="Link to this heading">#</a></h2>
<p>Recall from <a class="reference internal" href="120-scalar.html#sec-strings-intro"><span class="std std-numref">Section 2.1.3</span></a>
that the <code class="docutils literal notranslate"><span class="pre">str</span></code> class represents individual character strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;spam&quot;</span>
<span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &lt;class &#39;str&#39;&gt;</span>
</pre></div>
</div>
<p>There are a few binary operators overloaded for strings,
e.g., `<strong class="command">+</strong>` stands for string concatenation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot; and eggs&quot;</span>
<span class="c1">## &#39;spam and eggs&#39;</span>
</pre></div>
</div>
<p>`<strong class="command">*</strong>` duplicates a given string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">*</span> <span class="mi">3</span>
<span class="c1">## &#39;spamspamspam&#39;</span>
</pre></div>
</div>
<p><a class="reference internal" href="130-sequential.html#chap-sequential"><span class="std std-numref">Chapter 3</span></a> noted that <code class="docutils literal notranslate"><span class="pre">str</span></code>
is a sequential type. As a consequence, we can extract
individual code points and create substrings using the index operator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last letter</span>
<span class="c1">## &#39;m&#39;</span>
</pre></div>
</div>
<p>Strings are immutable, but parts thereof can always be
reused in conjunction with the concatenation operator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;ecial&quot;</span>
<span class="c1">## &#39;special&#39;</span>
</pre></div>
</div>
<section id="unicode-as-the-universal-encoding">
<h3><span class="section-number">14.1.1. </span>Unicode as the universal encoding<a class="headerlink" href="#unicode-as-the-universal-encoding" title="Link to this heading">#</a></h3>
<p>It is worth knowing that all strings in Python (from version 3.0)
use Unicode<a class="footnote-reference brackets" href="#footunicode" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>,
which is a universal encoding capable of representing
c. 150 000 characters covering letters and numbers in
contemporary and historic alphabets/scripts,
mathematical, political, phonetic, and other symbols, emojis, etc.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite the wide support for Unicode,
sometimes our own or other readers’ display
(e.g., web browsers when viewing
an HTML version of the output report) might not be able
to <em>render</em> all code points properly, e.g., due to missing fonts.
Still, we can rest assured that they are processed correctly
if string functions are applied thereon.</p>
</div>
</section>
<section id="normalising-strings">
<h3><span class="section-number">14.1.2. </span>Normalising strings<a class="headerlink" href="#normalising-strings" title="Link to this heading">#</a></h3>
<p>Dirty text data are a pain, especially if similar (semantically)
tokens are encoded in many different ways. For the sake
of string matching, we might want, e.g., the German
<code class="docutils literal notranslate"><span class="pre">&quot;groß&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;GROSS&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;</span>&#160; <span class="pre">gross</span>&#160;&#160;&#160;&#160; <span class="pre">&quot;</span></code>
to compare all equal.</p>
<p><strong class="command">str.strip</strong> removes whitespaces (spaces, tabs, newline characters)
at both ends of strings (see also <strong class="command">str.lstrip</strong> and <strong class="command">str.rstrip</strong>
for their nonsymmetric versions).</p>
<p><strong class="command">str.lower</strong> and <strong class="command">str.upper</strong> change letter case.
For caseless comparison/matching, <strong class="command">str.casefold</strong> might be a slightly better
option as it unfolds many more code point sequences:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Groß&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;Groß&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s2">&quot;Groß&quot;</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span>
<span class="c1">## (&#39;groß&#39;, &#39;GROSS&#39;, &#39;gross&#39;)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) More advanced string
<a class="reference external" href="https://unicode-org.github.io/icu/userguide/transforms/general">transliteration</a>
can be performed by means of the <a class="reference external" href="https://icu.unicode.org/"><strong class="program">ICU</strong></a>
(International Components for Unicode) library. Its Python bindings are provided by the <strong class="program">PyICU</strong> package.
Unfortunately, the package is not easily available
on W****ws.</p>
<p>For instance, converting all code points to ASCII (English)
might be necessary when identifiers are expected to miss some diacritics
that would normally be included (as in <code class="docutils literal notranslate"><span class="pre">&quot;Gągolewski&quot;</span></code> vs <code class="docutils literal notranslate"><span class="pre">&quot;Gagolewski&quot;</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">icu</span>  <span class="c1"># PyICU package</span>
<span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Transliterator</span>
    <span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="s2">&quot;Lower; Any-Latin; Latin-ASCII&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transliterate</span><span class="p">(</span>
        <span class="s2">&quot;Χαίρετε! Groß gżegżółka — © La Niña – köszönöm – Gągolewski&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="c1">## &#39;chairete! gross gzegzolka - (C) la nina - koszonom - gagolewski&#39;</span>
</pre></div>
</div>
<p>Converting between different
<a class="reference external" href="https://www.unicode.org/faq/normalization.html">Unicode Normalisation Forms</a>
(also available in the <strong class="program">unicodedata</strong> package
and via <strong class="command">pandas.Series.str.normalize</strong>)
might be used for the removal of some formatting nuances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">icu</span><span class="o">.</span><span class="n">Transliterator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="s2">&quot;NFKD; NFC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transliterate</span><span class="p">(</span><span class="s2">&quot;¼ąr²&quot;</span><span class="p">)</span>
<span class="c1">## &#39;1⁄4ąr2&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="substring-searching-and-replacing">
<h3><span class="section-number">14.1.3. </span>Substring searching and replacing<a class="headerlink" href="#substring-searching-and-replacing" title="Link to this heading">#</a></h3>
<p>Determining if a string has a particular fixed substring
can be done in several ways.</p>
<p>For instance,
the <strong class="command">in</strong> operator verifies whether a particular substring
occurs at least once:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span> <span class="o">=</span> <span class="s2">&quot;bacon, spam, spam, srapatapam, eggs, and spam&quot;</span>
<span class="s2">&quot;spam&quot;</span> <span class="ow">in</span> <span class="n">food</span>
<span class="c1">## True</span>
</pre></div>
</div>
<p>The <strong class="command">str.count</strong> method determines the number of occurrences
of a substring:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## 3</span>
</pre></div>
</div>
<p>To locate the first pattern appearance, we call <strong class="command">str.index</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## 7</span>
</pre></div>
</div>
<p><strong class="command">str.replace</strong> substitutes matching substrings with new content:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;veggies&quot;</span><span class="p">)</span>
<span class="c1">## &#39;bacon, veggies, veggies, srapatapam, eggs, and veggies&#39;</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.1</span>
        
    </div><div class="proof-content">
<p>Read the manual of
the following methods: <strong class="command">str.startswith</strong>, <strong class="command">str.endswith</strong>,
<strong class="command">str.find</strong>, <strong class="command">str.rfind</strong>, <strong class="command">str.rindex</strong>,
<strong class="command">str.removeprefix</strong>, and <strong class="command">str.removesuffix</strong>.</p>
</div></div><p>The splitting of long strings at specific fixed delimiters
can be done via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
<span class="c1">## [&#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;srapatapam&#39;, &#39;eggs&#39;, &#39;and spam&#39;]</span>
</pre></div>
</div>
<p>See also <strong class="command">str.partition</strong>. The <strong class="command">str.join</strong> method
implements the inverse operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">])</span>
<span class="c1">## &#39;spam, bacon, eggs, spam&#39;</span>
</pre></div>
</div>
<p>Moreover, <a class="reference internal" href="#sec-regex"><span class="std std-numref">Section 14.4</span></a> will discuss pattern matching with
regular expressions. They can be useful in, amongst others, extracting
more abstract data chunks (numbers, URLs, email addresses, IDs)
from strings.</p>
</section>
<section id="locale-aware-services-in-icu">
<h3><span class="section-number">14.1.4. </span>Locale-aware services in <strong class="program">ICU</strong> (*)<a class="headerlink" href="#locale-aware-services-in-icu" title="Link to this heading">#</a></h3>
<p>Recall that relational operators such as `<strong class="command">&lt;</strong>` and
`<strong class="command">&gt;=</strong>` perform the lexicographic comparing of strings
(like in a dictionary or an encyclopedia):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spam&quot;</span> <span class="o">&gt;</span> <span class="s2">&quot;egg&quot;</span>
<span class="c1">## True</span>
</pre></div>
</div>
<p>We have:
<code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;aa&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;aaaaaaaaaaaaa&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;ab&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;aba&quot;</span></code> &lt;
<code class="docutils literal notranslate"><span class="pre">&quot;abb&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;b&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;ba&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;baaaaaaa&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;bb&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;Spanish</span> <span class="pre">Inquisition&quot;</span></code>.</p>
<p>The lexicographic ordering (character-by-character, from left to right)
is not necessarily appropriate for strings with numerals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;a9&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;a123&quot;</span>  <span class="c1"># 1 is smaller than 9</span>
<span class="c1">## False</span>
</pre></div>
</div>
<p>Additionally, it only takes into account the
numeric codes (see <a class="reference internal" href="#sec-code-points"><span class="std std-numref">Section 14.4.3.4</span></a>) corresponding to each
Unicode character. Consequently, it does not work well with non-English
alphabets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;MIELONECZKĄ&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;MIELONECZKI&quot;</span>
<span class="c1">## False</span>
</pre></div>
</div>
<p>In Polish, <em>A with ogonek</em> (Ą) is expected to sort after <em>A</em>
and before <em>B</em>, let alone <em>I</em>.
However, their corresponding numeric codes in the Unicode table are:
260 (Ą), 65 (A), 66 (B), and 73 (I). The resulting
ordering is thus incorrect, as far as natural language processing
is concerned.</p>
<p>It is best to perform string collation using the services provided
by <strong class="program">ICU</strong>. Here is an example of German phone book-like collation
where <code class="docutils literal notranslate"><span class="pre">&quot;ö&quot;</span></code> is treated the same as <code class="docutils literal notranslate"><span class="pre">&quot;oe&quot;</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Locale</span><span class="p">(</span><span class="s2">&quot;de_DE@collation=phonebook&quot;</span><span class="p">))</span>
<span class="n">c</span><span class="o">.</span><span class="n">setStrength</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># ignore case and some diacritics</span>
<span class="n">c</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;Löwe&quot;</span><span class="p">,</span> <span class="s2">&quot;loewe&quot;</span><span class="p">)</span>
<span class="c1">## 0</span>
</pre></div>
</div>
<p>A result of <code class="docutils literal notranslate"><span class="pre">0</span></code> means that the strings are deemed equal.</p>
<div style="margin-top: 1em"></div><p>In some languages, contractions occur,
e.g., in Slovak and Czech, two code points <code class="docutils literal notranslate"><span class="pre">&quot;ch&quot;</span></code> are
treated as a single entity and are sorted after <code class="docutils literal notranslate"><span class="pre">&quot;h&quot;</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Locale</span><span class="p">(</span><span class="s2">&quot;sk_SK&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;chladný&quot;</span><span class="p">,</span> <span class="s2">&quot;hladný&quot;</span><span class="p">)</span>
<span class="c1">## 1</span>
</pre></div>
</div>
<p>This means that we have <code class="docutils literal notranslate"><span class="pre">&quot;chladný&quot;</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">&quot;hladný&quot;</span></code> (the first argument
is greater than the second one). Compare the above to something similar
in Polish:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Locale</span><span class="p">(</span><span class="s2">&quot;pl_PL&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;chłodny&quot;</span><span class="p">,</span> <span class="s2">&quot;hardy&quot;</span><span class="p">)</span>
<span class="c1">## -1</span>
</pre></div>
</div>
<p>That is, <code class="docutils literal notranslate"><span class="pre">&quot;chłodny&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;hardy&quot;</span></code> (the first argument is less than
the second one).</p>
<div style="margin-top: 1em"></div><p>Also, with <strong class="program">ICU</strong>, numeric collation is possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span>
    <span class="n">icu</span><span class="o">.</span><span class="n">UCollAttribute</span><span class="o">.</span><span class="n">NUMERIC_COLLATION</span><span class="p">,</span>
    <span class="n">icu</span><span class="o">.</span><span class="n">UCollAttributeValue</span><span class="o">.</span><span class="n">ON</span>
<span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;a9&quot;</span><span class="p">,</span> <span class="s2">&quot;a123&quot;</span><span class="p">)</span>
<span class="c1">## -1</span>
</pre></div>
</div>
<p>Which is the correct result: <code class="docutils literal notranslate"><span class="pre">&quot;a9&quot;</span></code> is less than <code class="docutils literal notranslate"><span class="pre">&quot;a123&quot;</span></code>
(compare the above to the example
where we used the ordinary `<strong class="command">&lt;</strong>`).</p>
</section>
<section id="string-operations-in-pandas">
<h3><span class="section-number">14.1.5. </span>String operations in <strong class="program">pandas</strong><a class="headerlink" href="#string-operations-in-pandas" title="Link to this heading">#</a></h3>
<p>String sequences in <code class="docutils literal notranslate"><span class="pre">pandas.Series</span></code> are
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/text.html">by default</a>
using the broadest possible <code class="docutils literal notranslate"><span class="pre">object</span></code> data type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">])</span>
<span class="c1">## 0     spam</span>
<span class="c1">## 1    bacon</span>
<span class="c1">## 2     spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>This allows for missing values encoding by means
of the <code class="docutils literal notranslate"><span class="pre">None</span></code> object (which is of the type <code class="docutils literal notranslate"><span class="pre">None</span></code>, not <code class="docutils literal notranslate"><span class="pre">str</span></code>);
compare <a class="reference internal" href="520-missingness.html#sec-missing-data"><span class="std std-numref">Section 15.1</span></a>.</p>
<p>Vectorised versions of base string operations
are available via the <strong class="command">pandas.Series.str</strong> accessor.
We thus have <strong class="command">pandas.Series.str.strip</strong>,
<strong class="command">pandas.Series.str.split</strong>, <strong class="command">pandas.Series.str.find</strong>,
and so forth. For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;buckwheat&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">])</span>
<span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="c1">## 0         SPAM</span>
<span class="c1">## 1        BACON</span>
<span class="c1">## 2         None</span>
<span class="c1">## 3    BUCKWHEAT</span>
<span class="c1">## 4         SPAM</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>But there is more. For example, a function to compute the length
of each string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="c1">## 0    4.0</span>
<span class="c1">## 1    5.0</span>
<span class="c1">## 2    NaN</span>
<span class="c1">## 3    9.0</span>
<span class="c1">## 4    4.0</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Vectorised concatenation of strings can be performed using the overloaded
`<strong class="command">+</strong>` operator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot; and spam&quot;</span>
<span class="c1">## 0         spam and spam</span>
<span class="c1">## 1        bacon and spam</span>
<span class="c1">## 2                   NaN</span>
<span class="c1">## 3    buckwheat and spam</span>
<span class="c1">## 4         spam and spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>To concatenate all items into a single string, we call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;; &quot;</span><span class="p">)</span>
<span class="c1">## &#39;spam; bacon; buckwheat; spam&#39;</span>
</pre></div>
</div>
<p>Conversion to numeric:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span> <span class="s2">&quot;-7&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;3523&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1">## 0       1.3</span>
<span class="c1">## 1      -7.0</span>
<span class="c1">## 2       NaN</span>
<span class="c1">## 3    3523.0</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Select substrings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># like x.iloc[i][2:-1] for all i</span>
<span class="c1">## 0         a</span>
<span class="c1">## 1        co</span>
<span class="c1">## 2      None</span>
<span class="c1">## 3    ckwhea</span>
<span class="c1">## 4         a</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>Replace substrings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice_replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;tofu&quot;</span><span class="p">)</span>  <span class="c1"># like x.iloc[i][2:-1] = &quot;tofu&quot;</span>
<span class="c1">## 0         tofuam</span>
<span class="c1">## 1        tofucon</span>
<span class="c1">## 2           None</span>
<span class="c1">## 3    tofuckwheat</span>
<span class="c1">## 4         tofuam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.2</span>
        
    </div><div class="proof-content">
<p>Consider the <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/other/nasaweather_glaciers.csv"><code class="docutils literal notranslate"><span class="pre">nasaweather_glaciers</span></code></a> data frame.
All glaciers are assigned 11/12-character unique identifiers
as defined by the WGMS convention that forms the glacier ID number
by combining the following five elements.</p>
<ol class="arabic simple">
<li><p>2-character political unit (first two letters of the ID),</p></li>
<li><p>1-digit continent code (the third letter),</p></li>
<li><p>4-character drainage code (next four),</p></li>
<li><p>2-digit free position code (next two),</p></li>
<li><p>2- or 3-digit local glacier code (the remaining ones).</p></li>
</ol>
<p>Extract the five chunks and store them as independent
columns in the data frame.</p>
</div></div></section>
<section id="string-operations-in-numpy">
<h3><span class="section-number">14.1.6. </span>String operations in <strong class="program">numpy</strong> (*)<a class="headerlink" href="#string-operations-in-numpy" title="Link to this heading">#</a></h3>
<p>There is a huge overlap between the <strong class="program">numpy</strong> and
<strong class="program">pandas</strong> capabilities
for string handling, with the latter being more powerful.
After all, <strong class="program">numpy</strong> is a workhorse for <em>numerical</em> computing.
Still, some readers might find the following useful.</p>
<p>As mentioned in our introduction to <strong class="program">numpy</strong> vectors,
objects of the type <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> can store not only numeric and logical
data, but also character strings. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;egg&quot;</span><span class="p">])</span>
<span class="n">x</span>
<span class="c1">## array([&#39;spam&#39;, &#39;bacon&#39;, &#39;egg&#39;], dtype=&#39;&lt;U5&#39;)</span>
</pre></div>
</div>
<p>Here, the data type “<code class="docutils literal notranslate"><span class="pre">&lt;U5</span></code>” means
that we deal with Unicode strings of length no greater than five.
Unfortunately, replacing elements with too long a content
will spawn truncated strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;buckwheat&quot;</span>
<span class="n">x</span>
<span class="c1">## array([&#39;spam&#39;, &#39;bacon&#39;, &#39;buckw&#39;], dtype=&#39;&lt;U5&#39;)</span>
</pre></div>
</div>
<p>To remedy this, we first need to recast the vector manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;&lt;U10&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;buckwheat&quot;</span>
<span class="n">x</span>
<span class="c1">## array([&#39;spam&#39;, &#39;bacon&#39;, &#39;buckwheat&#39;], dtype=&#39;&lt;U10&#39;)</span>
</pre></div>
</div>
<p>Conversion from/to numeric is also possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span> <span class="s2">&quot;-7&quot;</span><span class="p">,</span> <span class="s2">&quot;3523&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1">## array([ 1.300e+00, -7.000e+00,  3.523e+03])</span>
<span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="o">-</span><span class="mi">5153</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="c1">## array([&#39;1.0&#39;, &#39;3.14&#39;, &#39;-5153.0&#39;], dtype=&#39;&lt;U32&#39;)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://numpy.org/doc/stable/reference/routines.char.html"><strong class="command">numpy.char</strong></a>
module includes several vectorised versions of string routines,
most of which we discussed above. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam, bacon, and spam&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spam, eggs, bacon, spam, spam, and spam&quot;</span>
<span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
<span class="c1">## array([list([&#39;spam&#39;]), list([&#39;spam&#39;, &#39;bacon&#39;, &#39;and spam&#39;]),</span>
<span class="c1">##        list([&#39;spam&#39;, &#39;eggs&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;and spam&#39;])],</span>
<span class="c1">##       dtype=object)</span>
<span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## array([1, 2, 4])</span>
</pre></div>
</div>
<p>Vectorised operations that we would normally perform through
the binary operators (i.e., `<strong class="command">+</strong>`, `<strong class="command">*</strong>`,
`<strong class="command">&lt;</strong>`, etc.)
are available through standalone functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">],</span> <span class="s2">&quot; and spam&quot;</span><span class="p">)</span>
<span class="c1">## array([&#39;spam and spam&#39;, &#39;bacon and spam&#39;], dtype=&#39;&lt;U14&#39;)</span>
<span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">equal</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">],</span> <span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## array([ True, False,  True])</span>
</pre></div>
</div>
<p>The function that returns the length of each string is also noteworthy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">str_len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## array([ 4, 21, 39])</span>
</pre></div>
</div>
</section>
</section>
<section id="working-with-string-lists">
<span id="sec-string-list"></span><h2><span class="section-number">14.2. </span>Working with string lists<a class="headerlink" href="#working-with-string-lists" title="Link to this heading">#</a></h2>
<p><strong class="program">pandas</strong> nicely supports lists of strings of varying lengths.
For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span>
    <span class="s2">&quot;spam&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spam, bacon, spam&quot;</span><span class="p">,</span>
    <span class="s2">&quot;potatoes&quot;</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;spam, eggs, bacon, spam, spam&quot;</span>
<span class="p">])</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">xs</span>
<span class="c1">## 0                             [spam]</span>
<span class="c1">## 1                [spam, bacon, spam]</span>
<span class="c1">## 2                         [potatoes]</span>
<span class="c1">## 3                               None</span>
<span class="c1">## 4    [spam, eggs, bacon, spam, spam]</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>And now, e.g., looking at the last element:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">## [&#39;spam&#39;, &#39;eggs&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>reveals that it is indeed a list of strings.</p>
<p>There are a few vectorised operations that enable us
to work with such variable length lists,
such as concatenating all strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">)</span>
<span class="c1">## 0                             spam</span>
<span class="c1">## 1                spam; bacon; spam</span>
<span class="c1">## 2                         potatoes</span>
<span class="c1">## 3                             None</span>
<span class="c1">## 4    spam; eggs; bacon; spam; spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>selecting, say, the first string in each list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## 0        spam</span>
<span class="c1">## 1        spam</span>
<span class="c1">## 2    potatoes</span>
<span class="c1">## 3        None</span>
<span class="c1">## 4        spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>or slicing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># like xs.iloc[i][0:-1] for all i</span>
<span class="c1">## 0                           []</span>
<span class="c1">## 1                [spam, bacon]</span>
<span class="c1">## 2                           []</span>
<span class="c1">## 3                         None</span>
<span class="c1">## 4    [spam, eggs, bacon, spam]</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.3</span>
        
    </div><div class="proof-content">
<p>(*)
Using <strong class="command">pandas.merge</strong>, join the
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/other/countries.csv"><code class="docutils literal notranslate"><span class="pre">countries</span></code></a>,
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/world_factbook_2020.csv"><code class="docutils literal notranslate"><span class="pre">world_factbook_2020</span></code></a>,
and <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/ssi_2016_dimensions.csv"><code class="docutils literal notranslate"><span class="pre">ssi_2016_dimensions</span></code></a>
datasets based on the country names.
Note that some manual data cleansing will be necessary beforehand.</p>
</div></div><div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.4</span>
        
    </div><div class="proof-content">
<p>(**)
Given a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object <code class="docutils literal notranslate"><span class="pre">xs</span></code> that includes lists of strings,
convert it to a 0/1 representation.</p>
<ol class="arabic simple">
<li><p>Determine the list of all unique strings; let us call it <code class="docutils literal notranslate"><span class="pre">xu</span></code>.</p></li>
<li><p>Create a data frame <code class="docutils literal notranslate"><span class="pre">x</span></code> with <code class="docutils literal notranslate"><span class="pre">xs.shape[0]</span></code> rows
and <code class="docutils literal notranslate"><span class="pre">len(xu)</span></code> columns such that <code class="docutils literal notranslate"><span class="pre">x.iloc[i,</span> <span class="pre">j]</span></code> is equal to 1 if
<code class="docutils literal notranslate"><span class="pre">xu[j]</span></code> is amongst <code class="docutils literal notranslate"><span class="pre">xs.loc[i]</span></code> and equal to 0 otherwise.
Set the column names to <code class="docutils literal notranslate"><span class="pre">xs</span></code>.</p></li>
<li><p>Given <code class="docutils literal notranslate"><span class="pre">x</span></code> (and only <code class="docutils literal notranslate"><span class="pre">x</span></code>: neither <code class="docutils literal notranslate"><span class="pre">xs</span></code> nor <code class="docutils literal notranslate"><span class="pre">xu</span></code>),
perform the inverse operation.</p></li>
</ol>
<p>For example, for the above <code class="docutils literal notranslate"><span class="pre">xs</span></code> object, <code class="docutils literal notranslate"><span class="pre">x</span></code> should look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##    bacon  eggs  potatoes  spam</span>
<span class="c1">## 0      0     0         0     1</span>
<span class="c1">## 1      1     0         0     1</span>
<span class="c1">## 2      0     0         1     0</span>
<span class="c1">## 3      0     0         0     0</span>
<span class="c1">## 4      1     1         0     1</span>
</pre></div>
</div>
</div></div></section>
<section id="formatted-outputs-for-reproducible-report-generation">
<span id="sec-format-output"></span><h2><span class="section-number">14.3. </span>Formatted outputs for reproducible report generation<a class="headerlink" href="#formatted-outputs-for-reproducible-report-generation" title="Link to this heading">#</a></h2>
<p>Some good development practices related to reproducible report generation
are discussed in <span id="id6">[<a class="reference internal" href="999-bibliography.html#id152" title="Sandve, G.K., Nekrutenko, A., Taylor, J., and Hovig, E. (2013).  Ten simple rules for reproducible computational research. PLOS Computational Biology, 9(10):1–4. DOI: 10.1371/journal.pcbi.1003285.">82</a>, <a class="reference internal" href="999-bibliography.html#id150" title="Wilson, G. and others. (2014).  Best practices for scientific computing. PLOS Biology, 12(1):1–7. DOI: 10.1371/journal.pbio.1001745.">98</a>, <a class="reference internal" href="999-bibliography.html#id151" title="Wilson, G. and others. (2017).  Good enough practices in scientific computing. PLOS Computational Biology, 13(6):1–20. DOI: 10.1371/journal.pcbi.1005510.">99</a>]</span>.
Note that the paradigm of literate programming was introduced by D. Knuth
in <span id="id7">[<a class="reference internal" href="999-bibliography.html#id78" title="Knuth, D.E. (1992).  Literate Programming. CSLI.">55</a>]</span>.</p>
<p>Reports from data analysis can be prepared, e.g., in
Jupyter Notebooks or by writing directly to Markdown files which we
can later compile to PDF or HTML.
Below we briefly discuss how to output
nicely formatted objects programmatically.</p>
<section id="formatting-strings">
<h3><span class="section-number">14.3.1. </span>Formatting strings<a class="headerlink" href="#formatting-strings" title="Link to this heading">#</a></h3>
<p>Inclusion of textual representation of data stored in existing
objects can easily be done using f-strings
(formatted string literals; see <a class="reference internal" href="120-scalar.html#sec-f-strings"><span class="std std-numref">Section 2.1.3.1</span></a>)
of the type <code class="docutils literal notranslate"><span class="pre">f&quot;...{expression}...&quot;</span></code>. For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14159265358979323846</span>
<span class="sa">f</span><span class="s2">&quot;π = </span><span class="si">{</span><span class="n">pi</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c1">## &#39;π = 3.14&#39;</span>
</pre></div>
</div>
<p>creates a string showing the value of the variable <code class="docutils literal notranslate"><span class="pre">pi</span></code> formatted
as a <code class="docutils literal notranslate"><span class="pre">float</span></code> rounded to two places after the decimal separator.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**) Similar functionality can be achieved using
the <strong class="command">str.format</strong> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;π = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
<span class="c1">## &#39;π = 3.14&#39;</span>
</pre></div>
</div>
<p>as well as the `<strong class="command">%</strong>` operator overloaded for strings, which uses
<strong class="command">sprintf</strong>-like value placeholders known to some readers
from other programming languages (such as C):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;π = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pi</span>
<span class="c1">## &#39;π = 3.14&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="str-and-repr">
<h3><span class="section-number">14.3.2. </span><strong class="command">str</strong> and <strong class="command">repr</strong><a class="headerlink" href="#str-and-repr" title="Link to this heading">#</a></h3>
<p>The <strong class="command">str</strong> and <strong class="command">repr</strong> functions can create string
representations of many objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &#39;[1 2 3]&#39;</span>
<span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &#39;array([1, 2, 3])&#39;</span>
</pre></div>
</div>
<p>The former is more human-readable, and the latter is slightly more technical.
Note that <strong class="command">repr</strong> often returns an output that can be
interpreted as executable Python code with no
or few adjustments. Nonetheless, <strong class="program">pandas</strong> objects are amongst
the many exceptions to this rule.</p>
</section>
<section id="aligning-strings">
<h3><span class="section-number">14.3.3. </span>Aligning strings<a class="headerlink" href="#aligning-strings" title="Link to this heading">#</a></h3>
<p><strong class="command">str.center</strong>, <strong class="command">str.ljust</strong>, <strong class="command">str.rjust</strong> can be used
to centre-, left-, or right-align a string so that
it is of at least given width. This might make the display thereof
more aesthetic.
Very long strings, possibly containing whole text paragraphs
can be dealt with using the <strong class="command">wrap</strong> and <strong class="command">shorten</strong> functions
from the <strong class="program">textwrap</strong> package.</p>
</section>
<section id="direct-markdown-output-in-jupyter">
<h3><span class="section-number">14.3.4. </span>Direct Markdown output in Jupyter<a class="headerlink" href="#direct-markdown-output-in-jupyter" title="Link to this heading">#</a></h3>
<p>Further, with IPython/Jupyter, we can output
strings that will be directly interpreted as Markdown-formatted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">2</span>
<span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Result*: $2^2=2</span><span class="se">\\</span><span class="s2">cdot 2=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">$.&quot;</span>  <span class="c1"># LaTeX math</span>
<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Result</em>: <span class="math notranslate nohighlight">\(2^2=2\cdot 2=4\)</span>.</p>
<p>Recall from <a class="reference internal" href="110-setup.html#sec-markdown"><span class="std std-numref">Section 1.2.5</span></a> that Markdown is a very flexible
markup<a class="footnote-reference brackets" href="#footmarkup" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> language that allows us to define itemised and
numbered lists, mathematical formulae, tables, images, etc.</p>
<p>On a side note, data frames can be nicely prepared for display in a report
using <strong class="command">pandas.DataFrame.to_markdown</strong>.</p>
</section>
<section id="manual-markdown-file-output">
<span id="sec-manual-markdown"></span><h3><span class="section-number">14.3.5. </span>Manual Markdown file output (*)<a class="headerlink" href="#manual-markdown-file-output" title="Link to this heading">#</a></h3>
<p>We can also generate Markdown code programmatically
in the form of standalone <code class="docutils literal notranslate"><span class="pre">.md</span></code> files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s2">&quot;test-report.md&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>  <span class="c1"># open for writing (overwrite if exists)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;**Yummy Foods** include, but are not limited to:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;* </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">And now for something *completely* different:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Rank | Food</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----|-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">10</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is the resulting raw Markdown source file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># will call f.close() automatically</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="c1">## **Yummy Foods** include, but are not limited to:</span>
<span class="c1">## </span>
<span class="c1">## * spam</span>
<span class="c1">## * bacon</span>
<span class="c1">## * eggs</span>
<span class="c1">## * spam</span>
<span class="c1">## </span>
<span class="c1">## And now for something *completely* different:</span>
<span class="c1">## </span>
<span class="c1">## Rank | Food</span>
<span class="c1">## -----|-----</span>
<span class="c1">##    1 | maps      </span>
<span class="c1">##    2 | nocab     </span>
<span class="c1">##    3 | sgge      </span>
<span class="c1">##    4 | maps</span>
</pre></div>
</div>
<p>We can convert it to other formats, including HTML, PDF, EPUB, ODT,
and even presentations
by running<a class="footnote-reference brackets" href="#footrun" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> the <a class="reference external" href="https://pandoc.org/"><strong class="program">pandoc</strong></a> tool.
We may also embed it directly inside an IPython/Jupyter notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Yummy Foods</strong> include, but are not limited to:</p>
<ul class="simple">
<li><p>spam</p></li>
<li><p>bacon</p></li>
<li><p>eggs</p></li>
<li><p>spam</p></li>
</ul>
<p>And now for something <em>completely</em> different:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Rank</p></th>
<th class="head"><p>Food</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>maps</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>nocab</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>sgge</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>maps</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Figures created in <strong class="program">matplotlib</strong>
can be exported to PNG, SVG, or PDF files
using the <strong class="command">matplotlib.pyplot.savefig</strong> function.
We can include them manually in a Markdown document using the
<code class="docutils literal notranslate"><span class="pre">![description](filename)</span></code> syntax.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
IPython/Jupyter Notebooks can be converted to different formats
using the <a class="reference external" href="https://pypi.org/project/nbconvert"><strong class="program">jupyter-nbconvert</strong></a>
command line tool.
<a class="reference external" href="https://jupytext.readthedocs.io/en/latest"><strong class="program">jupytext</strong></a>
can create notebooks from ordinary text files.
Literate programming with mixed R and Python
is possible with the R packages
<a class="reference external" href="https://yihui.org/knitr"><strong class="program">knitr</strong></a> and
<a class="reference external" href="https://rstudio.github.io/reticulate"><strong class="program">reticulate</strong></a>.
See <span id="id10">[<a class="reference internal" href="999-bibliography.html#id153" title="Poore, G.M. (2019).  Codebraid: Live code in pandoc Markdown. In: Proc. 18th Python in Science Conf., pp. 54–61. URL: https://conference.scipy.org/proceedings/scipy2019/pdfs/geoffrey_poore.pdf.">73</a>]</span> for an overview of many more options.</p>
</div>
</section>
</section>
<section id="regular-expressions">
<span id="sec-regex"></span><h2><span class="section-number">14.4. </span>Regular expressions (*)<a class="headerlink" href="#regular-expressions" title="Link to this heading">#</a></h2>
<p>This section contains large excerpts
from yours truly’s other work <span id="id11">[<a class="reference internal" href="999-bibliography.html#id17" title="Gagolewski, M. (2022).  stringi: Fast and portable character string processing in R. Journal of Statistical Software, 103(2):1–59. URL: https://stringi.gagolewski.com/, DOI: 10.18637/jss.v103.i02.">33</a>]</span>.</p>
<p><em>Regular expressions (regexes) provide concise grammar for
defining systematic patterns which can be sought in character strings.
Examples of such patterns include: specific fixed substrings, emojis of
any kind, standalone sequences of lower-case Latin letters (“words”),
substrings that can be interpreted as real numbers (with or without
fractional parts, also in scientific notation), telephone numbers, email
addresses, or URLs.</em></p>
<p><em>Theoretically, the concept of regular pattern matching dates to the
so-called regular languages and finite state automata <span id="id12">[<a class="reference internal" href="999-bibliography.html#id22" title="Kleene, S.C. (1951).  Representation of events in nerve nets and finite automata. Technical Report RM-704, The RAND Corporation, Santa Monica, CA. URL: https://www.rand.org/content/dam/rand/pubs/research_memoranda/2008/RM704.pdf.">54</a>]</span>; see
also <span id="id13">[<a class="reference internal" href="999-bibliography.html#id23" title="Rabin, M. and Scott, D. (1959).  Finite automata and their decision problems. IBM Journal of Research and Development, 3:114–125.">76</a>]</span> and <span id="id14">[<a class="reference internal" href="999-bibliography.html#id25" title="Hopcroft, J.E. and Ullman, J.D. (1979).  Introduction to Automata Theory, Languages, and Computation. Addison-Wesley.">49</a>]</span>.
Regexes, in the form as we know it today,
were already present in one of the pre-UNIX implementations of the
command-line text editor <strong class="program">qed</strong> <span id="id15">[<a class="reference internal" href="999-bibliography.html#id24" title="Ritchie, D.M. and Thompson, K.L. (1970).  QED text editor. Technical Report 70107-002, Bell Telephone Laboratories, Inc. URL: https://wayback.archive-it.org/all/20150203071645/http://cm.bell-labs.com/cm/cs/who/dmr/qedman.pdf.">77</a>]</span>
(the predecessor of the well-known <strong class="program">sed</strong>).</em></p>
<section id="regex-matching-with-re">
<h3><span class="section-number">14.4.1. </span>Regex matching with <strong class="program">re</strong><a class="headerlink" href="#regex-matching-with-re" title="Link to this heading">#</a></h3>
<p>In Python, the <strong class="program">re</strong> module implements a regular expression matching
engine. It accepts patterns that follow similar syntax
to the one available in the Perl language.</p>
<p>As a matter of fact, most programming languages and text editors
(including <a class="reference external" href="https://kate-editor.org/"><strong class="program">Kate</strong></a>,
<a class="reference external" href="https://www.eclipse.org/ide"><strong class="program">Eclipse</strong></a>, and
<a class="reference external" href="https://vscodium.com/"><strong class="program">VSCodium</strong></a>) support finding and
replacing patterns with regexes. This is why they should be amongst the
instruments at every data scientist’s disposal.</p>
<p>Before we proceed with a detailed discussion on how to read and write
regular expressions, let us first review some of the methods
for identifying the matching substrings. Below we use the <code class="docutils literal notranslate"><span class="pre">r&quot;\bni+\b&quot;</span></code>
regex as an example. It catches <code class="docutils literal notranslate"><span class="pre">&quot;n&quot;</span></code> followed by at least one <code class="docutils literal notranslate"><span class="pre">&quot;i&quot;</span></code>
that begins and ends at a <em>word boundary</em>.
In other words, we seek <code class="docutils literal notranslate"><span class="pre">&quot;ni&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;nii&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;niii&quot;</span></code>, etc. which may be
considered standalone words.</p>
<p>In particular, <strong class="command">re.findall</strong> extracts all non-overlapping
matches to a given regex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;We&#39;re the knights who say ni! niiiii! ni! niiiiiiiii!&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;ni&#39;, &#39;niiiii&#39;, &#39;ni&#39;, &#39;niiiiiiiii&#39;]</span>
</pre></div>
</div>
<p>The order of arguments is <em>(look for what, where)</em>,
not vice versa.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We used the <code class="docutils literal notranslate"><span class="pre">r&quot;...&quot;</span></code> prefix to input a string so that “<code class="docutils literal notranslate"><span class="pre">\b</span></code>” is not
treated as an escape sequence which denotes the backspace character.
Otherwise, the above would have to be written as “<code class="docutils literal notranslate"><span class="pre">\\bni+\\b</span></code>”.</p>
</div>
<p>If we had not insisted on matching at the word boundaries (i.e.,
if we used the simple <code class="docutils literal notranslate"><span class="pre">&quot;ni+&quot;</span></code> regex instead),
we would also match the <code class="docutils literal notranslate"><span class="pre">&quot;ni&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">&quot;knights&quot;</span></code>.</p>
<div style="margin-top: 1em"></div><p>The <strong class="command">re.search</strong> function returns an object of the class <code class="docutils literal notranslate"><span class="pre">re.Match</span></code>
that enables us to get some more information about the first match:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="c1">## (26, 28, &#39;ni&#39;)</span>
</pre></div>
</div>
<p>The above includes the start and end position (index) and
the match itself. If the regex contains <em>capture groups</em> (see below for
more details), we can also pinpoint the matches thereto.</p>
<div style="margin-top: 1em"></div><p>Moreover, <strong class="command">re.finditer</strong> returns an iterable object that
includes the same details, but now about all the matches:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">((</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>
<span class="c1">## (26, 28, &#39;ni&#39;)</span>
<span class="c1">## (30, 36, &#39;niiiii&#39;)</span>
<span class="c1">## (38, 40, &#39;ni&#39;)</span>
<span class="c1">## (42, 52, &#39;niiiiiiiii&#39;)</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p><strong class="command">re.split</strong> divides a string into chunks
separated by matches to a given regex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;!\s+&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&quot;We&#39;re the knights who say ni&quot;, &#39;niiiii&#39;, &#39;ni&#39;, &#39;niiiiiiiii!&#39;]</span>
</pre></div>
</div>
<p>The “<code class="docutils literal notranslate"><span class="pre">!\s*</span></code>” regex matches the exclamation mark
followed by one or more whitespace characters.</p>
<div style="margin-top: 1em"></div><p>Using <strong class="command">re.sub</strong>, each match can be replaced with a given string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## &quot;We&#39;re the knights who say nu! nu! nu! nu!&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**) More flexible replacement strings can be generated
by passing a custom function as the second argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="s2">&quot;u&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## &quot;We&#39;re the knights who say nu! nuuuuu! nu! nuuuuuuuuu!&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="regex-matching-with-pandas">
<h3><span class="section-number">14.4.2. </span>Regex matching with <strong class="program">pandas</strong><a class="headerlink" href="#regex-matching-with-pandas" title="Link to this heading">#</a></h3>
<p>The <strong class="command">pandas.Series.str</strong> accessor also defines a number
of vectorised functions that utilise the <strong class="program">re</strong> package’s matcher.</p>
<p>Example <code class="docutils literal notranslate"><span class="pre">Series</span></code> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;ni!&quot;</span><span class="p">,</span> <span class="s2">&quot;niiii, ni, nii!&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;spam, bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;nii, ni!&quot;</span><span class="p">])</span>
<span class="n">x</span>
<span class="c1">## 0                ni!</span>
<span class="c1">## 1    niiii, ni, nii!</span>
<span class="c1">## 2               None</span>
<span class="c1">## 3        spam, bacon</span>
<span class="c1">## 4           nii, ni!</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>Here are the most notable functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">)</span>
<span class="c1">## 0     True</span>
<span class="c1">## 1     True</span>
<span class="c1">## 2     None</span>
<span class="c1">## 3    False</span>
<span class="c1">## 4     True</span>
<span class="c1">## dtype: object</span>
<span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">)</span>
<span class="c1">## 0    1.0</span>
<span class="c1">## 1    3.0</span>
<span class="c1">## 2    NaN</span>
<span class="c1">## 3    0.0</span>
<span class="c1">## 4    2.0</span>
<span class="c1">## dtype: float64</span>
<span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">## 0            nu!</span>
<span class="c1">## 1    nu, nu, nu!</span>
<span class="c1">## 2           None</span>
<span class="c1">## 3    spam, bacon</span>
<span class="c1">## 4        nu, nu!</span>
<span class="c1">## dtype: object</span>
<span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">)</span>
<span class="c1">## 0                [ni]</span>
<span class="c1">## 1    [niiii, ni, nii]</span>
<span class="c1">## 2                None</span>
<span class="c1">## 3                  []</span>
<span class="c1">## 4           [nii, ni]</span>
<span class="c1">## dtype: object</span>
<span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,\s+&quot;</span><span class="p">)</span>  <span class="c1"># a comma, one or more whitespaces</span>
<span class="c1">## 0                [ni!]</span>
<span class="c1">## 1    [niiii, ni, nii!]</span>
<span class="c1">## 2                 None</span>
<span class="c1">## 3        [spam, bacon]</span>
<span class="c1">## 4           [nii, ni!]</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>In the two last cases, we get lists of strings as results.</p>
<div style="margin-top: 1em"></div><p>Also, later we will mention
<strong class="command">pandas.Series.str.extract</strong> and
<strong class="command">pandas.Series.str.extractall</strong>
which work with regexes that include capture groups.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
If we intend to seek matches to the same pattern in many
different strings without the use of <strong class="program">pandas</strong>,
it might be faster to precompile a regex first, and
then use the <strong class="command">re.Pattern.findall</strong> method instead or <strong class="command">re.findall</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bni+\b&quot;</span><span class="p">)</span>  <span class="c1"># returns an object of the class `re.Pattern`</span>
<span class="n">p</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;We&#39;re the Spanish Inquisition ni! ni! niiiii! nininiiiiiiiii!&quot;</span><span class="p">)</span>
<span class="c1">## [&#39;ni&#39;, &#39;ni&#39;, &#39;niiiii&#39;]</span>
</pre></div>
</div>
</div>
</section>
<section id="matching-individual-characters">
<h3><span class="section-number">14.4.3. </span>Matching individual characters<a class="headerlink" href="#matching-individual-characters" title="Link to this heading">#</a></h3>
<p>In the following subsections, we review the most essential
elements of the regex syntax as we did in <span id="id16">[<a class="reference internal" href="999-bibliography.html#id17" title="Gagolewski, M. (2022).  stringi: Fast and portable character string processing in R. Journal of Statistical Software, 103(2):1–59. URL: https://stringi.gagolewski.com/, DOI: 10.18637/jss.v103.i02.">33</a>]</span>.
One general introduction to regexes is <span id="id17">[<a class="reference internal" href="999-bibliography.html#id21" title="Friedl, J.E.F. (2006).  Mastering Regular Expressions. O'Reilly.">29</a>]</span>.
The <strong class="program">re</strong> module flavour is summarised
in the official <a class="reference external" href="https://docs.python.org/3/library/re.html">manual</a>,
see also <span id="id18">[<a class="reference internal" href="999-bibliography.html#id26" title="Kuchling, A.M. (2023).  Regular Expression HOWTO. URL: https://docs.python.org/3/howto/regex.html.">57</a>]</span>.</p>
<p>We begin by discussing different ways to define character sets. In this
part, determining the length of all matching substrings will be quite
straightforward.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The following characters have special meaning to the regex engine:
“<code class="docutils literal notranslate"><span class="pre">.</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">\</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">|</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">(</span></code>“,
“<code class="docutils literal notranslate"><span class="pre">)</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">[</span></code>“,
“<code class="docutils literal notranslate"><span class="pre">]</span></code>”,  “<code class="docutils literal notranslate"><span class="pre">{</span></code>“,
“<code class="docutils literal notranslate"><span class="pre">}</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">^</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">$</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">*</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">+</span></code>”, and
“<code class="docutils literal notranslate"><span class="pre">?</span></code>”.</p>
</div>
<p>Any regular expression that contains none of
the above behaves like a fixed pattern:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam, eggs, spam, bacon, sausage, and spam&quot;</span><span class="p">)</span>
<span class="c1">## [&#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>There are three occurrences of a pattern that is comprised of four code
points, “<code class="docutils literal notranslate"><span class="pre">s</span></code>” followed by “<code class="docutils literal notranslate"><span class="pre">p</span></code>”, then by “<code class="docutils literal notranslate"><span class="pre">a</span></code>”, and ending with “<code class="docutils literal notranslate"><span class="pre">m</span></code>”.</p>
<div style="margin-top: 1em"></div><p>If we wish to include a special character as part of a regular
expression so that it is treated literally, we will need to escape
it with a backslash, “<code class="docutils literal notranslate"><span class="pre">\</span></code>”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.&quot;</span><span class="p">,</span> <span class="s2">&quot;spam...&quot;</span><span class="p">)</span>
<span class="c1">## [&#39;.&#39;, &#39;.&#39;, &#39;.&#39;]</span>
</pre></div>
</div>
<section id="matching-any-character">
<h4><span class="section-number">14.4.3.1. </span>Matching any character<a class="headerlink" href="#matching-any-character" title="Link to this heading">#</a></h4>
<p>The (unescaped) dot, “<code class="docutils literal notranslate"><span class="pre">.</span></code>”, matches any code point except the newline.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Spam, ham,</span><span class="se">\n</span><span class="s2">jam, SPAM, eggs, and spam&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;..am&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="c1">## [&#39;Spam&#39;, &#39; ham&#39;, &#39;SPAM&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>The above extracts non-overlapping substrings of length four
that end with “<code class="docutils literal notranslate"><span class="pre">am</span></code>”, case-insensitively.</p>
<p>The dot’s insensitivity to the newline character is motivated by the
need to maintain compatibility with tools such as <strong class="program">grep</strong> (when
searching within text files in a line-by-line manner). This behaviour
can be altered by setting the <code class="docutils literal notranslate"><span class="pre">DOTALL</span></code> flag.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;..am&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>  <span class="c1"># `|` is the bitwise OR</span>
<span class="c1">## [&#39;Spam&#39;, &#39; ham&#39;, &#39;\njam&#39;, &#39;SPAM&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
</section>
<section id="defining-character-sets">
<h4><span class="section-number">14.4.3.2. </span>Defining character sets<a class="headerlink" href="#defining-character-sets" title="Link to this heading">#</a></h4>
<p>Sets of characters can be introduced by enumerating their members within
a pair of square brackets. For instance, “<code class="docutils literal notranslate"><span class="pre">[abc]</span></code>” denotes the set
<em>{a, b, c}</em> – such a regular expression
matches one (and only one) symbol from this set. Moreover, in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;[hj]am&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;ham&#39;, &#39;jam&#39;]</span>
</pre></div>
</div>
<p>the “<code class="docutils literal notranslate"><span class="pre">[hj]am</span></code>” regex matches: “<code class="docutils literal notranslate"><span class="pre">h</span></code>” or “<code class="docutils literal notranslate"><span class="pre">j</span></code>”, followed by “<code class="docutils literal notranslate"><span class="pre">a</span></code>”,
followed by “<code class="docutils literal notranslate"><span class="pre">m</span></code>”. In other words, <code class="docutils literal notranslate"><span class="pre">&quot;ham&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;jam&quot;</span></code> are the only two
strings that are matched by this pattern (unless matching is done
case-insensitively).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The following characters, if used within square brackets, may be treated
not literally:
“<code class="docutils literal notranslate"><span class="pre">\</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">[</span></code>“,
“<code class="docutils literal notranslate"><span class="pre">]</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">^</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">-</span></code>“,
“<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">~</span></code>”, and
“<code class="docutils literal notranslate"><span class="pre">|</span></code>”.</p>
</div>
<p>To include them as-is in a character set, the
backslash-escape must be used. For example, “<code class="docutils literal notranslate"><span class="pre">[\[\]\\]</span></code>” matches a
backslash or a square bracket.</p>
</section>
<section id="complementing-sets">
<h4><span class="section-number">14.4.3.3. </span>Complementing sets<a class="headerlink" href="#complementing-sets" title="Link to this heading">#</a></h4>
<p>Including “<code class="docutils literal notranslate"><span class="pre">^</span></code>” (the caret) after the opening square bracket denotes
a set’s complement. Hence, “<code class="docutils literal notranslate"><span class="pre">[^abc]</span></code>” matches any code point except “<code class="docutils literal notranslate"><span class="pre">a</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">b</span></code>”, and “<code class="docutils literal notranslate"><span class="pre">c</span></code>”. Here is an example where we seek any substring that
consists of four non-spaces:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Nobody expects the Spanish Inquisition!&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;[^ ][^ ][^ ][^ ]&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;Nobo&#39;, &#39;expe&#39;, &#39;Span&#39;, &#39;Inqu&#39;, &#39;isit&#39;, &#39;ion!&#39;]</span>
</pre></div>
</div>
</section>
<section id="defining-code-point-ranges">
<span id="sec-code-points"></span><h4><span class="section-number">14.4.3.4. </span>Defining code point ranges<a class="headerlink" href="#defining-code-point-ranges" title="Link to this heading">#</a></h4>
<p>Each Unicode character can be referenced by its unique
<a class="reference external" href="https://www.unicode.org/charts">numeric code</a>.
For instance, “<code class="docutils literal notranslate"><span class="pre">a</span></code>” is
assigned code U+0061 and “<code class="docutils literal notranslate"><span class="pre">z</span></code>” is mapped to U+007A. In the pre-Unicode
era (mostly with regard to the ASCII codes, ≤ U+007F, representing
English letters, decimal digits, as well as some punctuation and
control characters), we were used to relying on specific code ranges.
For example, “<code class="docutils literal notranslate"><span class="pre">[a-z]</span></code>” denotes the set comprised of all characters with codes
between U+0061 and U+007A, i.e., lowercase letters of the English
(Latin) alphabet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;[0-9A-Za-z]&quot;</span><span class="p">,</span> <span class="s2">&quot;Gągolewski&quot;</span><span class="p">)</span>
<span class="c1">## [&#39;G&#39;, &#39;g&#39;, &#39;o&#39;, &#39;l&#39;, &#39;e&#39;, &#39;w&#39;, &#39;s&#39;, &#39;k&#39;, &#39;i&#39;]</span>
</pre></div>
</div>
<p>The above pattern denotes the union of three code ranges: ASCII
upper- and lowercase letters and digits.
Nowadays, in the processing of text in natural languages, this notation
should be avoided. Note the missing “<code class="docutils literal notranslate"><span class="pre">ą</span></code>” (Polish “<code class="docutils literal notranslate"><span class="pre">a</span></code>” with
ogonek) in the result.</p>
</section>
<section id="using-predefined-character-sets">
<h4><span class="section-number">14.4.3.5. </span>Using predefined character sets<a class="headerlink" href="#using-predefined-character-sets" title="Link to this heading">#</a></h4>
<p>Consider the following string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;aąbßÆAĄB你12𝟛٤,.;&#39;! </span><span class="se">\t</span><span class="s2">-+=</span><span class="se">\n</span><span class="s2">[]©←→”„&quot;</span>
</pre></div>
</div>
<p>Some glyphs are not available in the PDF version of this book because
we did not install the required fonts, e.g., the Arabic digit 4 or left
and right arrows. However, they are well-defined at the program level.</p>
<p>Noteworthy Unicode-aware code point classes include
the <em>word</em> characters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\w&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;a&#39;, &#39;ą&#39;, &#39;b&#39;, &#39;ß&#39;, &#39;Æ&#39;, &#39;A&#39;, &#39;Ą&#39;, &#39;B&#39;, &#39;你&#39;, &#39;1&#39;, &#39;2&#39;, &#39;𝟛&#39;, &#39;٤&#39;]</span>
</pre></div>
</div>
<p>decimal digits:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;1&#39;, &#39;2&#39;, &#39;𝟛&#39;, &#39;٤&#39;]</span>
</pre></div>
</div>
<p>and whitespaces:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39; &#39;, &#39;\t&#39;, &#39;\n&#39;]</span>
</pre></div>
</div>
<p>Moreover, e.g., “<code class="docutils literal notranslate"><span class="pre">\W</span></code>” is
equivalent to “<code class="docutils literal notranslate"><span class="pre">[^\w]</span></code>” , i.e.,
denotes the set’s complement.</p>
</section>
</section>
<section id="alternating-and-grouping-subexpressions">
<h3><span class="section-number">14.4.4. </span>Alternating and grouping subexpressions<a class="headerlink" href="#alternating-and-grouping-subexpressions" title="Link to this heading">#</a></h3>
<section id="alternation-operator">
<h4><span class="section-number">14.4.4.1. </span>Alternation operator<a class="headerlink" href="#alternation-operator" title="Link to this heading">#</a></h4>
<p>The alternation operator, “<code class="docutils literal notranslate"><span class="pre">|</span></code>” (the pipe or bar),
matches either its left or its right branch. For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;spam, egg, ham, jam, algae, and an amalgam of spam, all al dente&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;spam|ham&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;spam&#39;, &#39;ham&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
</section>
<section id="grouping-subexpressions">
<h4><span class="section-number">14.4.4.2. </span>Grouping subexpressions<a class="headerlink" href="#grouping-subexpressions" title="Link to this heading">#</a></h4>
<p>The “<code class="docutils literal notranslate"><span class="pre">|</span></code>” operator has very low precedence (otherwise, we would
match <code class="docutils literal notranslate"><span class="pre">&quot;spamam&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;spaham&quot;</span></code> above instead).
If we wish to introduce an alternative of <em>sub</em>expressions,
we need to group them using the
“<code class="docutils literal notranslate"><span class="pre">(?:...)</span></code>” syntax. For instance, “<code class="docutils literal notranslate"><span class="pre">(?:sp|h)am</span></code>” matches either <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code>
or <code class="docutils literal notranslate"><span class="pre">&quot;ham&quot;</span></code>.</p>
<p>Notice that the bare use of the round brackets, “<code class="docutils literal notranslate"><span class="pre">(...)</span></code>”
(i.e., without the “<code class="docutils literal notranslate"><span class="pre">?:</span></code>”) part, has the side-effect of creating new
capturing groups; see below for more details.</p>
<p>Also, matching is always done left-to-right, on a first-come,
first-served (greedy) basis. Consequently, if the left branch is a
subset of the right one, the latter will never be matched. In particular,
“<code class="docutils literal notranslate"><span class="pre">(?:al|alga|algae)</span></code>” can only match <code class="docutils literal notranslate"><span class="pre">&quot;al&quot;</span></code>. To fix this, we can write
“<code class="docutils literal notranslate"><span class="pre">(?:algae|alga|al)</span></code>”.</p>
</section>
<section id="non-grouping-parentheses">
<h4><span class="section-number">14.4.4.3. </span>Non-grouping parentheses<a class="headerlink" href="#non-grouping-parentheses" title="Link to this heading">#</a></h4>
<p>Some parenthesised subexpressions – those in which the opening bracket
is followed by the question mark – have a distinct meaning. In
particular, “<code class="docutils literal notranslate"><span class="pre">(?#...)</span></code>” denotes a free-format comment that is ignored by
the regex parser:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
  <span class="s2">&quot;(?# match &#39;sp&#39; or &#39;h&#39;)(?:sp|h)(?# and &#39;am&#39;)am|(?# or match &#39;egg&#39;)egg&quot;</span><span class="p">,</span>
  <span class="n">x</span>
<span class="p">)</span>
<span class="c1">## [&#39;spam&#39;, &#39;egg&#39;, &#39;ham&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>This is just horrible. Luckily,
constructing more sophisticated regexes by concatenating
subfragments thereof is more readable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
       <span class="s2">&quot;(?:sp|h)&quot;</span> <span class="o">+</span>   <span class="c1"># match either &#39;sp&#39; or &#39;h&#39;</span>
       <span class="s2">&quot;am&quot;</span> <span class="o">+</span>         <span class="c1"># followed by &#39;am&#39;</span>
    <span class="s2">&quot;|&quot;</span> <span class="o">+</span>        <span class="c1"># ... or ...</span>
       <span class="s2">&quot;egg&quot;</span><span class="p">,</span>         <span class="c1"># just match &#39;egg&#39;</span>
    <span class="n">x</span>
<span class="p">)</span>
<span class="c1">## [&#39;spam&#39;, &#39;egg&#39;, &#39;ham&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>What is more, e.g., “<code class="docutils literal notranslate"><span class="pre">(?i)</span></code>” enables the case-insensitive mode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;(?i)spam&quot;</span><span class="p">,</span> <span class="s2">&quot;Spam spam SPAMITY spAm&quot;</span><span class="p">)</span>
<span class="c1">## [&#39;Spam&#39;, &#39;spam&#39;, &#39;SPAM&#39;, &#39;spAm&#39;]</span>
</pre></div>
</div>
</section>
</section>
<section id="quantifiers">
<h3><span class="section-number">14.4.5. </span>Quantifiers<a class="headerlink" href="#quantifiers" title="Link to this heading">#</a></h3>
<p>More often than not, a <em>variable</em> number of instances of the same
subexpression needs to be captured. Sometimes
we want to make its presence optional.
These can be achieved by means of the following quantifiers:</p>
<ul class="simple">
<li><p>“<code class="docutils literal notranslate"><span class="pre">?</span></code>” matches 0 or 1 time;</p></li>
<li><p>“<code class="docutils literal notranslate"><span class="pre">*</span></code>” matches 0 or more times;</p></li>
<li><p>“<code class="docutils literal notranslate"><span class="pre">+</span></code>” matches 1 or more times;</p></li>
<li><p>“<code class="docutils literal notranslate"><span class="pre">{n,m}</span></code>” matches between <code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">m</span></code> times;</p></li>
<li><p>“<code class="docutils literal notranslate"><span class="pre">{n,}</span></code>” matches at least <code class="docutils literal notranslate"><span class="pre">n</span></code> times;</p></li>
<li><p>“<code class="docutils literal notranslate"><span class="pre">{n}</span></code>” matches exactly <code class="docutils literal notranslate"><span class="pre">n</span></code> times.</p></li>
</ul>
<p>These operators are applied onto the directly preceding atoms.
For example, “<code class="docutils literal notranslate"><span class="pre">ni+</span></code>” captures <code class="docutils literal notranslate"><span class="pre">&quot;ni&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;nii&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;niii&quot;</span></code>, etc.,
but neither <code class="docutils literal notranslate"><span class="pre">&quot;n&quot;</span></code> alone nor <code class="docutils literal notranslate"><span class="pre">&quot;ninini&quot;</span></code> altogether.</p>
<p>By default, the quantifiers are greedy – they match the repeated
subexpression as many times as possible. The “<code class="docutils literal notranslate"><span class="pre">?</span></code>” suffix (forming
quantifiers such as “<code class="docutils literal notranslate"><span class="pre">??</span></code>”, “<code class="docutils literal notranslate"><span class="pre">*?</span></code>”, “<code class="docutils literal notranslate"><span class="pre">+?</span></code>”, and so forth) tries with as
few occurrences as possible (to obtain a match still).</p>
<div style="margin-top: 1em"></div><p>Greedy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;sp(AM)(maps)(SP)am&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.+\)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;(AM)(maps)(SP)&#39;]</span>
</pre></div>
</div>
<p>Lazy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.+?\)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;(AM)&#39;, &#39;(maps)&#39;, &#39;(SP)&#39;]</span>
</pre></div>
</div>
<p>Greedy (but clever):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\([^)]+\)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;(AM)&#39;, &#39;(maps)&#39;, &#39;(SP)&#39;]</span>
</pre></div>
</div>
<p>The first regex is greedy: it matches an opening bracket, then as many
characters as possible (including “<code class="docutils literal notranslate"><span class="pre">)</span></code>”) that are followed by a closing
bracket. The two other patterns terminate as soon as the first closing
bracket is found.</p>
<div style="margin-top: 1em"></div><p>More examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;spamamamnomnomnomammmmmmmmm&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;sp(?:am|nom)+&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;spamamamnomnomnomam&#39;]</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;sp(?:am|nom)+?&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;spam&#39;]</span>
</pre></div>
</div>
<p>And:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;sp(?:am|nom)+?m*&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;spam&#39;]</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;sp(?:am|nom)+?m+&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;spamamamnomnomnomammmmmmmmm&#39;]</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Let us stress that the quantifier is applied to the subexpression that
stands directly before it. Grouping parentheses can be used in case they
are needed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;12, 34.5, 678.901234, 37...629, ...&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+\.\d+&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;34.5&#39;, &#39;678.901234&#39;]</span>
</pre></div>
</div>
<p>matches digits, a dot, and another series of
digits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+(?:\.\d+)?&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;12&#39;, &#39;34.5&#39;, &#39;678.901234&#39;, &#39;37&#39;, &#39;629&#39;]</span>
</pre></div>
</div>
<p>finds digits which are possibly (but not
necessarily) followed by a dot and a digit sequence.</p>
<div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.5</span>
        
    </div><div class="proof-content">
<p>Write a regex that extracts all #hashtags
from a string #omg #SoEasy.</p>
</div></div></section>
<section id="capture-groups-and-references-thereto">
<h3><span class="section-number">14.4.6. </span>Capture groups and references thereto (**)<a class="headerlink" href="#capture-groups-and-references-thereto" title="Link to this heading">#</a></h3>
<p>Round-bracketed subexpressions (without the “<code class="docutils literal notranslate"><span class="pre">?:</span></code>” prefix)
form the so-called <em>capture groups</em> that can be extracted separately or be
referred to in other parts of the same regex.</p>
<section id="extracting-capture-group-matches">
<h4><span class="section-number">14.4.6.1. </span>Extracting capture group matches<a class="headerlink" href="#extracting-capture-group-matches" title="Link to this heading">#</a></h4>
<p>The above is evident when we use <strong class="command">re.findall</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;name=&#39;Sir Launcelot&#39;, quest=&#39;Seek Grail&#39;, favcolour=&#39;blue&#39;&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)=&#39;(.+?)&#39;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [(&#39;name&#39;, &#39;Sir Launcelot&#39;), (&#39;quest&#39;, &#39;Seek Grail&#39;), (&#39;favcolour&#39;, &#39;blue&#39;)]</span>
</pre></div>
</div>
<p>This returned the matches to the individual capture groups,
not the whole matching substrings.</p>
<p><strong class="command">re.find</strong> and <strong class="command">re.finditer</strong> can pinpoint each component:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)=&#39;(.+?)&#39;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;whole (0):&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;       1 :&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;       2 :&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="c1">## whole (0): (0, 20, &quot;name=&#39;Sir Launcelot&#39;&quot;)</span>
<span class="c1">##        1 : (0, 4, &#39;name&#39;)</span>
<span class="c1">##        2 : (6, 19, &#39;Sir Launcelot&#39;)</span>
</pre></div>
</div>
<p>Here is a vectorised version  of the above from <strong class="program">pandas</strong>,
returning the first match:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span>
    <span class="s2">&quot;name=&#39;Sir Launcelot&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quest=&#39;Seek Grail&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;favcolour=&#39;blue&#39;, favcolour=&#39;yel.. Aaargh!&#39;&quot;</span>
<span class="p">])</span>
<span class="n">y</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)=&#39;(.+?)&#39;&quot;</span><span class="p">)</span>
<span class="c1">##            0              1</span>
<span class="c1">## 0       name  Sir Launcelot</span>
<span class="c1">## 1      quest     Seek Grail</span>
<span class="c1">## 2  favcolour           blue</span>
</pre></div>
</div>
<p>We see that the findings are conveniently presented in the data frame form.
The first column gives the matches to the first capture group.
All matches can be extracted too:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)=&#39;(.+?)&#39;&quot;</span><span class="p">)</span>
<span class="c1">##                  0              1</span>
<span class="c1">##   match                          </span>
<span class="c1">## 0 0           name  Sir Launcelot</span>
<span class="c1">## 1 0          quest     Seek Grail</span>
<span class="c1">## 2 0      favcolour           blue</span>
<span class="c1">##   1      favcolour  yel.. Aaargh!</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Recall that if we just need the grouping part of “<code class="docutils literal notranslate"><span class="pre">(...)</span></code>”, i.e., without the
capturing feature, “<code class="docutils literal notranslate"><span class="pre">(?:...)</span></code>” can be applied.</p>
<div style="margin-top: 1em"></div><p>Also, named capture
groups defined like “<code class="docutils literal notranslate"><span class="pre">(?P&lt;name&gt;...)</span></code>” are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;(?:</span><span class="se">\\</span><span class="s2">w+)=&#39;(?P&lt;value&gt;.+?)&#39;&quot;</span><span class="p">)</span>
<span class="c1">##            value</span>
<span class="c1">## 0  Sir Launcelot</span>
<span class="c1">## 1     Seek Grail</span>
<span class="c1">## 2           blue</span>
</pre></div>
</div>
</section>
<section id="replacing-with-capture-group-matches">
<h4><span class="section-number">14.4.6.2. </span>Replacing with capture group matches<a class="headerlink" href="#replacing-with-capture-group-matches" title="Link to this heading">#</a></h4>
<p>When using <strong class="command">re.sub</strong> and <strong class="command">pandas.Series.str.replace</strong>,
matches to particular capture groups can be recalled in replacement
strings. The match in its entirety is denoted with “<code class="docutils literal notranslate"><span class="pre">\g&lt;0&gt;</span></code>”,
then “<code class="docutils literal notranslate"><span class="pre">\g&lt;1&gt;</span></code>” stores whatever was caught by the first capture group,
and “<code class="docutils literal notranslate"><span class="pre">\g&lt;2&gt;</span></code>” is the match to the second capture group, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)=&#39;(.+?)&#39;&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\g&lt;2&gt; is a \g&lt;1&gt;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## &#39;Sir Launcelot is a name, Seek Grail is a quest, blue is a favcolour&#39;</span>
</pre></div>
</div>
<p>Named capture groups can be referred to too:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;key&gt;\w+)=&#39;(?P&lt;value&gt;.+?)&#39;&quot;</span><span class="p">,</span>
  <span class="sa">r</span><span class="s2">&quot;\g&lt;value&gt; is a \g&lt;key&gt;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## &#39;Sir Launcelot is a name, Seek Grail is a quest, blue is a favcolour&#39;</span>
</pre></div>
</div>
</section>
<section id="back-referencing">
<h4><span class="section-number">14.4.6.3. </span>Back-referencing<a class="headerlink" href="#back-referencing" title="Link to this heading">#</a></h4>
<p>Matches to capture groups can also be part of the regexes themselves.
In such a context, e.g., “<code class="docutils literal notranslate"><span class="pre">\1</span></code>” denotes whatever has been
consumed by the first capture group.</p>
<p>In general, parsing HTML code with regexes is not
recommended, unless it is well-structured (which might be the case
if it is generated programmatically; but we can always use the
<strong class="program">lxml</strong> package).
Despite this, let us consider the following examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;&lt;em&gt;spam&lt;/em&gt;&lt;/p&gt;&lt;code&gt;eggs&lt;/code&gt;&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;[a-z]+&gt;.*?&lt;/[a-z]+&gt;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;&lt;p&gt;&lt;em&gt;spam&lt;/em&gt;&#39;, &#39;&lt;code&gt;eggs&lt;/code&gt;&#39;]</span>
</pre></div>
</div>
<p>This did not match the correct closing HTML tag.
But we can make this happen by writing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(&lt;([a-z]+)&gt;.*?&lt;/\2&gt;)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [(&#39;&lt;p&gt;&lt;em&gt;spam&lt;/em&gt;&lt;/p&gt;&#39;, &#39;p&#39;), (&#39;&lt;code&gt;eggs&lt;/code&gt;&#39;, &#39;code&#39;)]</span>
</pre></div>
</div>
<p>This regex guarantees that the match will include all characters
between the opening <code class="docutils literal notranslate"><span class="pre">&quot;&lt;tag&gt;&quot;</span></code> and the corresponding (not: any) closing
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;/tag&gt;&quot;</span></code>.</p>
<p>Named capture groups can be referenced using the “<code class="docutils literal notranslate"><span class="pre">(?P=name)</span></code>”
syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(&lt;(?P&lt;tagname&gt;[a-z]+)&gt;.*?&lt;/(?P=tagname)&gt;)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [(&#39;&lt;p&gt;&lt;em&gt;spam&lt;/em&gt;&lt;/p&gt;&#39;, &#39;p&#39;), (&#39;&lt;code&gt;eggs&lt;/code&gt;&#39;, &#39;code&#39;)]</span>
</pre></div>
</div>
<p>The angle brackets are part of the token.</p>
</section>
</section>
<section id="anchoring">
<h3><span class="section-number">14.4.7. </span>Anchoring<a class="headerlink" href="#anchoring" title="Link to this heading">#</a></h3>
<p>Lastly, let us mention the ways to match a pattern at a given abstract
position within a string.</p>
<section id="matching-at-the-beginning-or-end-of-a-string">
<h4><span class="section-number">14.4.7.1. </span>Matching at the beginning or end of a string<a class="headerlink" href="#matching-at-the-beginning-or-end-of-a-string" title="Link to this heading">#</a></h4>
<p>“<code class="docutils literal notranslate"><span class="pre">^</span></code>” and “<code class="docutils literal notranslate"><span class="pre">$</span></code>” match, respectively, start and end of the string
(or each line within a string, if the <code class="docutils literal notranslate"><span class="pre">re.MULTILINE</span></code> flag is set).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;spam egg&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;egg spam bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;milk&quot;</span><span class="p">])</span>
<span class="n">rs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;^spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam$&quot;</span><span class="p">,</span> <span class="s2">&quot;spam$|^spam&quot;</span><span class="p">,</span> <span class="s2">&quot;^spam$&quot;</span><span class="p">]</span>  <span class="c1"># regexes to test</span>
</pre></div>
</div>
<p>The five regular expressions match <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code>, respectively, anywhere within
the string, at the beginning, at the end, at the beginning or end, and
in strings that are equal to the pattern itself.
We can check this by calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span>
<span class="c1">##     spam  ^spam  spam$  spam$|^spam  ^spam$</span>
<span class="c1">## 0   True   True  False         True   False</span>
<span class="c1">## 1   True  False   True         True   False</span>
<span class="c1">## 2   True   True   True         True    True</span>
<span class="c1">## 3   True  False  False        False   False</span>
<span class="c1">## 4  False  False  False        False   False</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.6</span>
        
    </div><div class="proof-content">
<p>Compose a regex that does the same job as <strong class="command">str.strip</strong>.</p>
</div></div></section>
<section id="matching-at-word-boundaries">
<h4><span class="section-number">14.4.7.2. </span>Matching at word boundaries<a class="headerlink" href="#matching-at-word-boundaries" title="Link to this heading">#</a></h4>
<p>What is more, “<code class="docutils literal notranslate"><span class="pre">\b</span></code>” matches at a “word boundary”, e.g., near spaces,
punctuation marks, or at the start/end of a string (i.e., wherever there
is a transition between a word, “<code class="docutils literal notranslate"><span class="pre">\w</span></code>”, and a non-word character,
“<code class="docutils literal notranslate"><span class="pre">\W</span></code>”, or vice versa).</p>
<p>In the following example, we match all stand-alone numbers
(this regular expression is imperfect, though):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-+]?\b\d+(?:\.\d+)?\b&quot;</span><span class="p">,</span> <span class="s2">&quot;+12, 34.5, -5.3243&quot;</span><span class="p">)</span>
<span class="c1">## [&#39;+12&#39;, &#39;34.5&#39;, &#39;-5.3243&#39;]</span>
</pre></div>
</div>
</section>
<section id="looking-behind-and-ahead">
<h4><span class="section-number">14.4.7.3. </span>Looking behind and ahead (**)<a class="headerlink" href="#looking-behind-and-ahead" title="Link to this heading">#</a></h4>
<p>There is a way to guarantee that a pattern occurrence begins or
ends with a match to a subexpression: “<code class="docutils literal notranslate"><span class="pre">(?&lt;=...)...</span></code>” denotes the
<em>look-behind</em>, whereas “<code class="docutils literal notranslate"><span class="pre">...(?=...)</span></code>” designates a <em>look-ahead</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;I like spam, spam, eggs, and spam.&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b(?=[,.])&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;spam&#39;, &#39;spam&#39;, &#39;eggs&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>This regex captured words that end with a comma or a dot</p>
<p>Moreover, “<code class="docutils literal notranslate"><span class="pre">(?&lt;!...)...</span></code>” and “<code class="docutils literal notranslate"><span class="pre">...(?!...)</span></code>” are their <em>negated</em>
versions (negative look-behind/ahead).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b(?![,.])&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1">## [&#39;I&#39;, &#39;like&#39;, &#39;and&#39;]</span>
</pre></div>
</div>
<p>This time, we matched the words that end with neither
a comma nor a dot.</p>
</section>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">14.5. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.7</span>
        
    </div><div class="proof-content">
<p>List some ways to normalise character strings.</p>
</div></div><div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.8</span>
        
    </div><div class="proof-content">
<p>(**) What are the challenges of processing non-English text?</p>
</div></div><div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.9</span>
        
    </div><div class="proof-content">
<p>What are the problems with the <code class="docutils literal notranslate"><span class="pre">&quot;[A-Za-z]&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;[A-z]&quot;</span></code> character sets?</p>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.10</span>
        
    </div><div class="proof-content">
<p>Name the two ways to turn on case-insensitive regex matching.</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.11</span>
        
    </div><div class="proof-content">
<p>What is a word boundary?</p>
</div></div><div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.12</span>
        
    </div><div class="proof-content">
<p>What is the difference between the <code class="docutils literal notranslate"><span class="pre">&quot;^&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;$&quot;</span></code> anchors?</p>
</div></div><div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.13</span>
        
    </div><div class="proof-content">
<p>When would we prefer using <code class="docutils literal notranslate"><span class="pre">&quot;[0-9]&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">&quot;\d&quot;</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.14</span>
        
    </div><div class="proof-content">
<p>What is the difference between the <code class="docutils literal notranslate"><span class="pre">&quot;?&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;??&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;*?&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;+&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;+?&quot;</span></code> quantifiers?</p>
</div></div><div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.15</span>
        
    </div><div class="proof-content">
<p>Does <code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code> match all the characters?</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.16</span>
        
    </div><div class="proof-content">
<p>What are named capture groups and how can we refer to the matches
thereto in <strong class="command">re.sub</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.17</span>
        
    </div><div class="proof-content">
<p>Write a regex that extracts
all standalone numbers accepted by Python,
including <code class="docutils literal notranslate"><span class="pre">12.123</span></code>, <code class="docutils literal notranslate"><span class="pre">-53</span></code>, <code class="docutils literal notranslate"><span class="pre">+1e-9</span></code>,
<code class="docutils literal notranslate"><span class="pre">-1.2423e10</span></code>, <code class="docutils literal notranslate"><span class="pre">4.</span></code> and <code class="docutils literal notranslate"><span class="pre">.2</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.18</span>
        
    </div><div class="proof-content">
<p>Author a regex that matches all email addresses.</p>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.19</span>
        
    </div><div class="proof-content">
<p>Indite a regex that matches all URLs
starting with <code class="docutils literal notranslate"><span class="pre">http://</span></code> or <code class="docutils literal notranslate"><span class="pre">https://</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 14.20</span>
        
    </div><div class="proof-content">
<p>Cleanse the
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/warsaw_weather.csv"><code class="docutils literal notranslate"><span class="pre">warsaw_weather</span></code></a>
dataset so that it contains analysable numeric data.</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footunicode" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">1</a><span class="fn-bracket">]</span></span>
<p>(*) More precisely, Python strings are UTF-8-encoded.
Most web pages and APIs are nowadays served in UTF-8.
But we can still occasionally encounter files encoded in
ISO-8859-1 (Western Europe),
Windows-1250 (Eastern Europe),
Windows-1251 (Cyrillic),
GB18030 and Big5 (Chinese),
EUC-KR (Korean),
Shift-JIS and EUC-JP (Japanese), amongst others.
They can be converted using the <strong class="command">str.decode</strong> method.</p>
</aside>
<aside class="footnote brackets" id="footmarkup" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">2</a><span class="fn-bracket">]</span></span>
<p>(*) Markdown is amongst many markup languages.
Other learn-worthy ones include HTML (for the Web)
and LaTeX (especially for the beautiful
typesetting of maths, print-ready articles, and books, e.g., PDF;
see <span id="id19">[<a class="reference internal" href="999-bibliography.html#id11" title="Oetiker, T. and others. (2021).  The Not So Short Introduction to LaTeX 2ε. URL: https://tobi.oetiker.ch/lshort/lshort.pdf.">69</a>]</span> for a comprehensive introduction).</p>
</aside>
<aside class="footnote brackets" id="footrun" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">3</a><span class="fn-bracket">]</span></span>
<p>External programs can be executed using
<strong class="command">subprocess.run</strong>.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="520-missingness.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">15. </span>Missing, censored, and questionable data</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="440-sql.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">13. </span>Accessing databases</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2023 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2023-09-04T15:13:19+1000.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">14. Text data</a><ul>
<li><a class="reference internal" href="#basic-string-operations">14.1. Basic string operations</a><ul>
<li><a class="reference internal" href="#unicode-as-the-universal-encoding">14.1.1. Unicode as the universal encoding</a></li>
<li><a class="reference internal" href="#normalising-strings">14.1.2. Normalising strings</a></li>
<li><a class="reference internal" href="#substring-searching-and-replacing">14.1.3. Substring searching and replacing</a></li>
<li><a class="reference internal" href="#locale-aware-services-in-icu">14.1.4. Locale-aware services in <strong class="program">ICU</strong> (*)</a></li>
<li><a class="reference internal" href="#string-operations-in-pandas">14.1.5. String operations in <strong class="program">pandas</strong></a></li>
<li><a class="reference internal" href="#string-operations-in-numpy">14.1.6. String operations in <strong class="program">numpy</strong> (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-string-lists">14.2. Working with string lists</a></li>
<li><a class="reference internal" href="#formatted-outputs-for-reproducible-report-generation">14.3. Formatted outputs for reproducible report generation</a><ul>
<li><a class="reference internal" href="#formatting-strings">14.3.1. Formatting strings</a></li>
<li><a class="reference internal" href="#str-and-repr">14.3.2. <strong class="command">str</strong> and <strong class="command">repr</strong></a></li>
<li><a class="reference internal" href="#aligning-strings">14.3.3. Aligning strings</a></li>
<li><a class="reference internal" href="#direct-markdown-output-in-jupyter">14.3.4. Direct Markdown output in Jupyter</a></li>
<li><a class="reference internal" href="#manual-markdown-file-output">14.3.5. Manual Markdown file output (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regular-expressions">14.4. Regular expressions (*)</a><ul>
<li><a class="reference internal" href="#regex-matching-with-re">14.4.1. Regex matching with <strong class="program">re</strong></a></li>
<li><a class="reference internal" href="#regex-matching-with-pandas">14.4.2. Regex matching with <strong class="program">pandas</strong></a></li>
<li><a class="reference internal" href="#matching-individual-characters">14.4.3. Matching individual characters</a><ul>
<li><a class="reference internal" href="#matching-any-character">14.4.3.1. Matching any character</a></li>
<li><a class="reference internal" href="#defining-character-sets">14.4.3.2. Defining character sets</a></li>
<li><a class="reference internal" href="#complementing-sets">14.4.3.3. Complementing sets</a></li>
<li><a class="reference internal" href="#defining-code-point-ranges">14.4.3.4. Defining code point ranges</a></li>
<li><a class="reference internal" href="#using-predefined-character-sets">14.4.3.5. Using predefined character sets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alternating-and-grouping-subexpressions">14.4.4. Alternating and grouping subexpressions</a><ul>
<li><a class="reference internal" href="#alternation-operator">14.4.4.1. Alternation operator</a></li>
<li><a class="reference internal" href="#grouping-subexpressions">14.4.4.2. Grouping subexpressions</a></li>
<li><a class="reference internal" href="#non-grouping-parentheses">14.4.4.3. Non-grouping parentheses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quantifiers">14.4.5. Quantifiers</a></li>
<li><a class="reference internal" href="#capture-groups-and-references-thereto">14.4.6. Capture groups and references thereto (**)</a><ul>
<li><a class="reference internal" href="#extracting-capture-group-matches">14.4.6.1. Extracting capture group matches</a></li>
<li><a class="reference internal" href="#replacing-with-capture-group-matches">14.4.6.2. Replacing with capture group matches</a></li>
<li><a class="reference internal" href="#back-referencing">14.4.6.3. Back-referencing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#anchoring">14.4.7. Anchoring</a><ul>
<li><a class="reference internal" href="#matching-at-the-beginning-or-end-of-a-string">14.4.7.1. Matching at the beginning or end of a string</a></li>
<li><a class="reference internal" href="#matching-at-word-boundaries">14.4.7.2. Matching at word boundaries</a></li>
<li><a class="reference internal" href="#looking-behind-and-ahead">14.4.7.3. Looking behind and ahead (**)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">14.5. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=32b344a2"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/proof.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>