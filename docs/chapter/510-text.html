<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>15. Working with Text Data &mdash; Minimalist Data Wrangling with Python by Marek Gagolewski</title>
  

  
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/510-text.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="16. Regular Expressions (*)" href="520-regex.html" />
    <link rel="prev" title="14. Accessing Databases" href="440-sql.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Minimalist Data Wrangling with Python [DRAFTv0.2.2]
          

          
          </a>

          <div class="version">
          by <a style="color: inherit" href="https://www.gagolewski.com">Marek Gagolewski</a>
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar Types and Control Structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and Other Types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional Numeric Data and Their Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-aggregate.html">5. Aggregating Numeric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-transform-vector.html">6. Transforming and Filtering Numeric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-distribution-uni.html">7. Continuous Probability Distributions (*)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">8. Multidimensional Numeric Data at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">9. Transforming, Aggregating, and Filtering Multidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-corelation.html">10. 🚧 Exploring Relationships Between Variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="410-dataframe.html">11. Introducing Data Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">12. Handling Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-groupby.html">13. 🚧 Processing Data in Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">14. Accessing Databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text and Other Data</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">15. Working with Text Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#string-operations-in-base-python">15.1. String Operations in Base Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unicode-as-the-universal-encoding">15.1.1. Unicode as the Universal Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#normalising-strings">15.1.2. Normalising Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#substring-searching-and-replacing">15.1.3. Substring Searching and Replacing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#locale-aware-services-in-icu">15.1.4. Locale-Aware Services in <strong class="program">ICU</strong> (**)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#string-operations-in-pandas">15.2. String Operations in <strong class="program">pandas</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-string-lists">15.3. Working with String Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="#string-operations-in-numpy">15.4. String Operations in <strong class="program">numpy</strong> (**)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formatted-outputs">15.5. Formatted Outputs (*)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#formatting-strings">15.5.1. Formatting Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#str-and-repr">15.5.2. <strong class="command">str</strong> and <strong class="command">repr</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#justifying-strings">15.5.3. Justifying Strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-markdown-output-in-jupyter">15.5.4. Direct Markdown Output in Jupyter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manual-markdown-file-output">15.5.5. Manual Markdown File Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">15.6. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="520-regex.html">16. Regular Expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-missingness.html">17. Outliers, Missing, Censored, and Incorrect Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="540-time.html">18. Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">Report Bugs or Typos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching_data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com">Author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minimalist Data Wrangling with Python [DRAFTv0.2.2]</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">15. </span>Working with Text Data</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="520-regex.html" class="btn btn-neutral float-right" title="16. Regular Expressions (*)" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="440-sql.html" class="btn btn-neutral float-left" title="14. Accessing Databases" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="working-with-text-data">
<span id="chap-text"></span><h1><span class="section-number">15. </span>Working with Text Data<a class="headerlink" href="#working-with-text-data" title="Permalink to this headline"></a></h1>
<blockquote>
<div><p><em>This is an early draft of</em> Minimalist Data Wrangling with Python <em>by
<a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>. It’s distributed
in the hope that it’ll be useful. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">bug/typos reports/fixes</a>
are appreciated. Although available online, this is a whole course,
and should be read from the beginning to the end. In particular,
refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em></p>
</div></blockquote>
<p>In <span id="id1">[<a class="reference internal" href="999-bibliography.html#id9">Gag22</a>]</span> it is noted that
<em>effective processing of character strings is required at various
stages of data analysis pipelines:
from data cleansing and preparation, through
information extraction, to report generation.
Pattern searching, string collation and sorting, normalisation,
transliteration, and formatting are ubiquitous in
text mining, natural language processing, and bioinformatics.</em>
Means for the handling of string data
<em>should be included in each statistician’s or data scientist’s
repertoire to complement their  numerical computing
and data wrangling skills.</em></p>
<p><em>Diverse data cleansing and preparation operations</em>
(compare, e.g., <span id="id2">[<a class="reference internal" href="999-bibliography.html#id11">vdLdJ18</a>]</span> and <span id="id3">[<a class="reference internal" href="999-bibliography.html#id12">DJ03</a>]</span>)
<em>need to be applied before an analyst can begin to enjoy
an orderly and meaningful data frame, matrix, or spreadsheet being finally
at their disposal.
Activities related to information retrieval, computer vision,
bioinformatics, natural language processing, or even musicology
can also benefit from including them
in data processing pipelines.</em></p>
<p>In this part we discuss the most basic string operations
in base Python, together with their vectorised versions
in <strong class="program">numpy</strong> and <strong class="program">pandas</strong>.</p>
<div class="section" id="string-operations-in-base-python">
<h2><span class="section-number">15.1. </span>String Operations in Base Python<a class="headerlink" href="#string-operations-in-base-python" title="Permalink to this headline"></a></h2>
<p>Recall that the <code class="docutils literal notranslate"><span class="pre">str</span></code> class represents individual character strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;spam&quot;</span>
<span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &lt;class &#39;str&#39;&gt;</span>
</pre></div>
</div>
<p>There are a few binary operators overloaded for strings,
e.g., `<strong class="command">+</strong>` stands for string concatenation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot; and eggs&quot;</span>
<span class="c1">## &#39;spam and eggs&#39;</span>
</pre></div>
</div>
<p>`<strong class="command">*</strong>` duplicates a given string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">*</span> <span class="mi">3</span>
<span class="c1">## &#39;spamspamspam&#39;</span>
</pre></div>
</div>
<p>Further, <code class="docutils literal notranslate"><span class="pre">str</span></code> is a sequential type, therefore we can extract
individual code points and create substrings using the index operator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last letter</span>
<span class="c1">## &#39;m&#39;</span>
</pre></div>
</div>
<p>Recall that strings are immutable.
However, parts of strings can always be reused in conjunction with the
concatenation operator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;ecial&quot;</span>
<span class="c1">## &#39;special&#39;</span>
</pre></div>
</div>
<div class="section" id="unicode-as-the-universal-encoding">
<h3><span class="section-number">15.1.1. </span>Unicode as the Universal Encoding<a class="headerlink" href="#unicode-as-the-universal-encoding" title="Permalink to this headline"></a></h3>
<p>It is worth knowing that all strings in Python (from version 3.0)
use Unicode(https://www.unicode.org/charts/),
which is a universal encoding capable of representing
ca. 150,000 characters covering letters and numbers in
contemporary and historic alphabets/scripts,
mathematical, political, phonetic, and other symbols, emojis, etc.
It is thus a very powerful representation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite the wide support for Unicode,
sometimes our own or other readers’ display
(e.g., web browsers when viewing
a HTML version of the output report) might not be able
to <em>render</em> all code points properly (e.g., due to missing fonts).
However, we should rest assured that they are still there,
and are processed correctly if string functions are applied thereon.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**) More precisely, Python strings
are <a class="reference external" href="https://www.ietf.org/rfc/rfc3629.txt">UTF-8</a>-encoded.
Most web pages and API data are nowadays served in UTF-8.
However, occasionally we can encounter files encoded in
ISO-8859-1 (Western Europe),
Windows-1250 (Eastern Europe),
Windows-1251 (Cyrillic),
GB18030 and Big5 (Chinese),
EUC-KR (Korean),
Shift-JIS and EUC-JP (Japanese), amongst others;
they can be converted using the <strong class="command">str.decode</strong> method.</p>
</div>
</div>
<div class="section" id="normalising-strings">
<h3><span class="section-number">15.1.2. </span>Normalising Strings<a class="headerlink" href="#normalising-strings" title="Permalink to this headline"></a></h3>
<p>Dirty text data are a pain, especially if similar (semantically)
tokens are encoded in many different ways. For the sake
of string matching, we might want, e.g., the German
<code class="docutils literal notranslate"><span class="pre">&quot;groß&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;GROSS&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">gross</span>&#160; <span class="pre">&quot;</span></code>
to compare all equal.</p>
<p><strong class="command">str.strip</strong> removes whitespaces (spaces, tabs, newline characters)
at both ends of strings (see also <strong class="command">str.lstrip</strong> and <strong class="command">str.rstrip</strong>
for their nonsymmetric versions).</p>
<p><strong class="command">str.lower</strong> and <strong class="command">str.upper</strong> change letter case.
For caseless comparison/matching, <strong class="command">str.casefold</strong> might be a slightly better
option as it unfolds many more code point sequences:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Groß&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;Groß&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s2">&quot;Groß&quot;</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span>
<span class="c1">## (&#39;groß&#39;, &#39;GROSS&#39;, &#39;gross&#39;)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>(**) More advanced string
transliteration can be performed by means of
the <a class="reference external" href="https://icu.unicode.org/"><strong class="program">ICU</strong></a> library,
which the <strong class="program">PyICU</strong> package provides wrappers for.</p>
<p>For instance, converting all code points to ASCII (English)
might be necessary when identifiers are expected to miss some diacritics
that would normally be included (as in <code class="docutils literal notranslate"><span class="pre">&quot;Gągolewski&quot;</span></code> vs <code class="docutils literal notranslate"><span class="pre">&quot;Gagolewski&quot;</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">icu</span>  <span class="c1"># PyICU package</span>
<span class="n">icu</span><span class="o">.</span><span class="n">Transliterator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="s2">&quot;Lower; Any-Latin; Latin-ASCII&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transliterate</span><span class="p">(</span>
    <span class="s2">&quot;Χαίρετε! Groß gżegżółka — © La Niña – köszönöm – Gągolewski&quot;</span>
<span class="p">)</span>
<span class="c1">## &#39;chairete! gross gzegzolka - (C) la nina - koszonom - gagolewski&#39;</span>
</pre></div>
</div>
<p>Converting between different
<a class="reference external" href="https://www.unicode.org/faq/normalization.html">Unicode Normalisation Forms</a>
(also available in the <strong class="program">unicodedata</strong> package
and via <strong class="command">pandas.Series.str.normalize</strong>)
might be used for the removal of some formatting nuances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">icu</span><span class="o">.</span><span class="n">Transliterator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="s2">&quot;NFKD; NFC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transliterate</span><span class="p">(</span><span class="s2">&quot;¼ąr²︷&quot;</span><span class="p">)</span>
<span class="c1">## &#39;1⁄4ąr2{&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="substring-searching-and-replacing">
<h3><span class="section-number">15.1.3. </span>Substring Searching and Replacing<a class="headerlink" href="#substring-searching-and-replacing" title="Permalink to this headline"></a></h3>
<p>Determining if a string features a particular fixed substring
can be done in a number of different ways.</p>
<p>For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span> <span class="o">=</span> <span class="s2">&quot;bacon, spam, spam, eggs, and spam&quot;</span>
<span class="s2">&quot;spam&quot;</span> <span class="ow">in</span> <span class="n">food</span>
<span class="c1">## True</span>
</pre></div>
</div>
<p>verifies whether a particular substring exists,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## 3</span>
</pre></div>
</div>
<p>counts the number of occurrences of a substring,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## 7</span>
</pre></div>
</div>
<p>locates the first pattern occurrence (see also <strong class="command">str.rfind</strong>
as well as <strong class="command">str.index</strong> and <strong class="command">str.rindex</strong>),</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;veggies&quot;</span><span class="p">)</span>
<span class="c1">## &#39;bacon, veggies, veggies, eggs, and veggies&#39;</span>
</pre></div>
</div>
<p>replaces matching substrings with another string.</p>
<div class="proof proof-type-exercise" id="id4">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.1</span>
        
    </div><div class="proof-content">
<p>Read the manual of
the following methods: <strong class="command">str.startswith</strong>, <strong class="command">str.endswith</strong>
<strong class="command">str.removeprefix</strong>, <strong class="command">str.removesuffix</strong>.</p>
</div></div><p>The splitting of long strings at specific fixed delimiter strings
can be done via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">food</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
<span class="c1">## [&#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;eggs&#39;, &#39;and spam&#39;]</span>
</pre></div>
</div>
<p>see also <strong class="command">str.partition</strong>. The <strong class="command">str.join</strong> method
implements the inverse operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">])</span>
<span class="c1">## &#39;spam, bacon, eggs, spam&#39;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In <a class="reference internal" href="520-regex.html#chap-regex"><span class="std std-numref">Chapter 16</span></a>, we will discuss pattern matching with regular expressions,
which can be useful in, amongst others, extracting more abstract
data chunks (numbers, URLs, email addresses, IDs) from within strings.</p>
</div>
</div>
<div class="section" id="locale-aware-services-in-icu">
<h3><span class="section-number">15.1.4. </span>Locale-Aware Services in <strong class="program">ICU</strong> (**)<a class="headerlink" href="#locale-aware-services-in-icu" title="Permalink to this headline"></a></h3>
<p>Recall that relational operators such as `<strong class="command">&lt;</strong>` and
`<strong class="command">&gt;=</strong> perform lexicographic comparing of strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;spam&quot;</span> <span class="o">&gt;</span> <span class="s2">&quot;egg&quot;</span>
<span class="c1">## True</span>
</pre></div>
</div>
<p>We have:
<code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;aa&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;aaaaaaaaaaaaa&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;ab&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;aba&quot;</span></code> &lt;
<code class="docutils literal notranslate"><span class="pre">&quot;abb&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;b&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;ba&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;baaaaaaa&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;bb&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;Spanish</span> <span class="pre">inquisition&quot;</span></code>.</p>
<p>Lexicographic ordering (character-by-character, from left to right)
is, however, not necessarily appropriate for strings
featuring numerals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;a9&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;a123&quot;</span>
<span class="c1">## False</span>
</pre></div>
</div>
<p>Also, it only takes into account the
<a class="reference external" href="https://www.unicode.org/charts/">numeric codes</a>
corresponding to each Unicode character, therefore does not work well
with non-English alphabets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;MIELONECZKĄ&quot;</span> <span class="o">&lt;</span> <span class="s2">&quot;MIELONECZKI&quot;</span>
<span class="c1">## False</span>
</pre></div>
</div>
<p>In Polish, <em>A with ogonek</em> (Ą) should sort after <em>A</em>
and before <em>B</em>, let alone <em>I</em>.
However, their corresponding numeric codes in the Unicode table are:
260 (Ą), 65 (A), 66 (B), and 73 (I), therefore the resulting
ordering is incorrect, natural language processing-wisely.</p>
<p>It is best to perform string collation using the services provided
by <strong class="program">ICU</strong>. Here is an example of German phone book-like collation
where <code class="docutils literal notranslate"><span class="pre">&quot;ö&quot;</span></code> is treated the same as <code class="docutils literal notranslate"><span class="pre">&quot;oe&quot;</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Locale</span><span class="p">(</span><span class="s2">&quot;de_DE@collation=phonebook&quot;</span><span class="p">))</span>
<span class="n">c</span><span class="o">.</span><span class="n">setStrength</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;Löwe&quot;</span><span class="p">,</span> <span class="s2">&quot;loewe&quot;</span><span class="p">)</span>
<span class="c1">## 0</span>
</pre></div>
</div>
<p>A result of <code class="docutils literal notranslate"><span class="pre">0</span></code> means that the strings are deemed equal.</p>
<div style="margin-top: 1em"></div><p>In some languages, contractions occur,
e.g., in Slovak and Czech, two code points <code class="docutils literal notranslate"><span class="pre">&quot;ch&quot;</span></code> are
treated as a single entity and are sorted after <code class="docutils literal notranslate"><span class="pre">&quot;h&quot;</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Locale</span><span class="p">(</span><span class="s2">&quot;sk_SK&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;chladný&quot;</span><span class="p">,</span> <span class="s2">&quot;hladný&quot;</span><span class="p">)</span>
<span class="c1">## 1</span>
</pre></div>
</div>
<p>i.e., we have <code class="docutils literal notranslate"><span class="pre">&quot;chladný&quot;</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">&quot;hladný&quot;</span></code> (the 1st argument is greater
than the 2nd one). Compare the above to something similar in Polish:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">Locale</span><span class="p">(</span><span class="s2">&quot;pl_PL&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;chłodny&quot;</span><span class="p">,</span> <span class="s2">&quot;hardy&quot;</span><span class="p">)</span>
<span class="c1">## -1</span>
</pre></div>
</div>
<p>i.e., <code class="docutils literal notranslate"><span class="pre">&quot;chłodny&quot;</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">&quot;hardy&quot;</span></code> (the first argument is less than
the 2nd one).</p>
<div style="margin-top: 1em"></div><p>Also, with <strong class="program">ICU</strong>, numeric collation is possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">icu</span><span class="o">.</span><span class="n">Collator</span><span class="o">.</span><span class="n">createInstance</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">icu</span><span class="o">.</span><span class="n">UCollAttribute</span><span class="o">.</span><span class="n">NUMERIC_COLLATION</span><span class="p">,</span> <span class="n">icu</span><span class="o">.</span><span class="n">UCollAttributeValue</span><span class="o">.</span><span class="n">ON</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s2">&quot;a9&quot;</span><span class="p">,</span> <span class="s2">&quot;a123&quot;</span><span class="p">)</span>
<span class="c1">## -1</span>
</pre></div>
</div>
<p>Which is the correct result: <code class="docutils literal notranslate"><span class="pre">&quot;a9&quot;</span></code> is less than <code class="docutils literal notranslate"><span class="pre">&quot;a123&quot;</span></code>
(compare the above to the example which was using using `<strong class="command">&lt;</strong>`).</p>
</div>
</div>
<div class="section" id="string-operations-in-pandas">
<h2><span class="section-number">15.2. </span>String Operations in <strong class="program">pandas</strong><a class="headerlink" href="#string-operations-in-pandas" title="Permalink to this headline"></a></h2>
<p>String sequences in <code class="docutils literal notranslate"><span class="pre">Series</span></code> are
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/text.html">by default</a>
using the broadest possible <code class="docutils literal notranslate"><span class="pre">object</span></code> data type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">])</span>
<span class="c1">## 0     spam</span>
<span class="c1">## 1    bacon</span>
<span class="c1">## 2     spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>which basically means that we deal with a sequence
of Python objects of arbitrary type (here, are all of class <code class="docutils literal notranslate"><span class="pre">str</span></code>).
This allows for the encoding of missing values by means
of the <code class="docutils literal notranslate"><span class="pre">None</span></code> object.</p>
<p>Vectorised versions of base string operations
are <a class="reference external" href="https://numpy.org/doc/stable/reference/routines.char.html">available</a>
via the <strong class="command">pandas.Series.str</strong> accessor,
which we usually refer to by calling
<code class="docutils literal notranslate"><span class="pre">x.str.method_name()</span></code>, for instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;buckwheat&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">])</span>
<span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="c1">## 0         SPAM</span>
<span class="c1">## 1        BACON</span>
<span class="c1">## 2         None</span>
<span class="c1">## 3    BUCKWHEAT</span>
<span class="c1">## 4         SPAM</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>We thus have <strong class="command">pandas.Series.str.strip</strong>,
<strong class="command">pandas.Series.str.split</strong>, <strong class="command">pandas.Series.str.find</strong>,
and so forth.</p>
<p>But there is more. For example, a function to compute the length
of each string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="c1">## 0    4.0</span>
<span class="c1">## 1    5.0</span>
<span class="c1">## 2    NaN</span>
<span class="c1">## 3    9.0</span>
<span class="c1">## 4    4.0</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Concatenating all items into a single string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;; &quot;</span><span class="p">)</span>
<span class="c1">## &#39;spam; bacon; buckwheat; spam&#39;</span>
</pre></div>
</div>
<p>Vectorised string concatenation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot; and spam&quot;</span>
<span class="c1">## 0         spam and spam</span>
<span class="c1">## 1        bacon and spam</span>
<span class="c1">## 2                   NaN</span>
<span class="c1">## 3    buckwheat and spam</span>
<span class="c1">## 4         spam and spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>Conversion to numeric:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span> <span class="s2">&quot;-7&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;3523&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1">## 0       1.3</span>
<span class="c1">## 1      -7.0</span>
<span class="c1">## 2       NaN</span>
<span class="c1">## 3    3523.0</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Selecting substrings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># like x.iloc[i][2:-1] for all i</span>
<span class="c1">## 0         a</span>
<span class="c1">## 1        co</span>
<span class="c1">## 2      None</span>
<span class="c1">## 3    ckwhea</span>
<span class="c1">## 4         a</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>Replacing substrings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice_replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;tofu&quot;</span><span class="p">)</span>  <span class="c1"># like x.iloc[i][2:-1] = &quot;tofu&quot;</span>
<span class="c1">## 0         tofuam</span>
<span class="c1">## 1        tofucon</span>
<span class="c1">## 2           None</span>
<span class="c1">## 3    tofuckwheat</span>
<span class="c1">## 4         tofuam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id5">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.2</span>
        
    </div><div class="proof-content">
<p>Consider the <a class="reference external" href="https://github.com/gagolews/teaching_data/blob/master/other/nasaweather_glaciers.csv"><code class="docutils literal notranslate"><span class="pre">nasaweather_glaciers</span></code></a> data frame.
All glaciers are assigned 11/12-character unique identifiers.
The ID number is assigned to the glacier as defined by the WGMS
convention that forms the glacier ID number by combining the
following five elements. Extract all of them and store them as independent
columns in the data frame.</p>
<ol class="simple">
<li><p>2-character political unit,</p></li>
<li><p>1-digit continent code,</p></li>
<li><p>4-character drainage code,</p></li>
<li><p>2-digit free position code,</p></li>
<li><p>2- or 3-digit local glacier code.</p></li>
</ol>
</div></div></div>
<div class="section" id="working-with-string-lists">
<span id="sec-string-list"></span><h2><span class="section-number">15.3. </span>Working with String Lists<a class="headerlink" href="#working-with-string-lists" title="Permalink to this headline"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> can also consist of lists of strings of varying lengths.
They can not only be input manually (via the <strong class="command">pandas.Series</strong> constructor),
but also through string splitting.
For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span>
    <span class="s2">&quot;spam&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spam, bacon, spam&quot;</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;spam, eggs, bacon, spam, spam&quot;</span>
<span class="p">])</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">xs</span>
<span class="c1">## 0                             [spam]</span>
<span class="c1">## 1                [spam, bacon, spam]</span>
<span class="c1">## 2                               None</span>
<span class="c1">## 3    [spam, eggs, bacon, spam, spam]</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>and now, e.g., looking at the last element:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">## [&#39;spam&#39;, &#39;eggs&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>reveals that it is indeed a list of strings.</p>
<p>There are a few vectorised operations that enable us
to work with such variable length lists,
such as concatenating all strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">)</span>
<span class="c1">## 0                             spam</span>
<span class="c1">## 1                spam; bacon; spam</span>
<span class="c1">## 2                             None</span>
<span class="c1">## 3    spam; eggs; bacon; spam; spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>selecting, say, the first string in each list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## 0    spam</span>
<span class="c1">## 1    spam</span>
<span class="c1">## 2    None</span>
<span class="c1">## 3    spam</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>or slicing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># like xs.iloc[i][0:-1] for all i</span>
<span class="c1">## 0                           []</span>
<span class="c1">## 1                [spam, bacon]</span>
<span class="c1">## 2                         None</span>
<span class="c1">## 3    [spam, eggs, bacon, spam]</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id6">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.3</span>
        
    </div><div class="proof-content">
<p>(*)
Using <strong class="command">pandas.merge</strong>, join the following datasets:
<a class="reference external" href="https://github.com/gagolews/teaching_data/blob/master/other/countries.csv">countries</a>,
<a class="reference external" href="https://github.com/gagolews/teaching_data/blob/master/marek/world_factbook_2020.csv">world_factbook_2020</a>,
and <a class="reference external" href="https://github.com/gagolews/teaching_data/blob/master/marek/ssi_2016_dimensions.csv">ssi_2016_dimensions</a>
based on the country names.
Note that some manual data cleansing will be necessary.</p>
</div></div><div class="proof proof-type-exercise" id="id7">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.4</span>
        
    </div><div class="proof-content">
<p>(**)
Given a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object featuring lists of strings:</p>
<ol class="simple">
<li><p>determine the list of all unique strings
(e.g., for <code class="docutils literal notranslate"><span class="pre">xs</span></code> above we have: <code class="docutils literal notranslate"><span class="pre">[&quot;spam&quot;,</span> <span class="pre">&quot;bacon&quot;,</span> <span class="pre">&quot;eggs&quot;]</span></code>),
let’s call it <code class="docutils literal notranslate"><span class="pre">xu</span></code>;</p></li>
<li><p>create a data frame <code class="docutils literal notranslate"><span class="pre">x</span></code> with <code class="docutils literal notranslate"><span class="pre">xs.shape[0]</span></code> rows
and <code class="docutils literal notranslate"><span class="pre">len(xu)</span></code> columns such that <code class="docutils literal notranslate"><span class="pre">x.iloc[i,</span> <span class="pre">j]</span></code> is equal to 1 if
<code class="docutils literal notranslate"><span class="pre">xu[j]</span></code> is amongst <code class="docutils literal notranslate"><span class="pre">xs.loc[i]</span></code> and equal to 0 otherwise;</p></li>
<li><p>given <code class="docutils literal notranslate"><span class="pre">x</span></code> (and only <code class="docutils literal notranslate"><span class="pre">x</span></code>: neither <code class="docutils literal notranslate"><span class="pre">xs</span></code> nor <code class="docutils literal notranslate"><span class="pre">xu</span></code>),
perform the inverse operation.</p></li>
</ol>
</div></div></div>
<div class="section" id="string-operations-in-numpy">
<h2><span class="section-number">15.4. </span>String Operations in <strong class="program">numpy</strong> (**)<a class="headerlink" href="#string-operations-in-numpy" title="Permalink to this headline"></a></h2>
<p>There is a huge overlap between the <strong class="program">numpy</strong> and
<strong class="program">pandas</strong> capabilities
for string handling, with the latter being more powerful.
Still, some readers will find the following useful.</p>
<p>As mentioned in our introduction to <strong class="program">numpy</strong> vectors,
objects of type <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> can store not only numeric and logical
data, but also character strings. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;egg&quot;</span><span class="p">])</span>
<span class="n">x</span>
<span class="c1">## array([&#39;spam&#39;, &#39;bacon&#39;, &#39;egg&#39;], dtype=&#39;&lt;U5&#39;)</span>
</pre></div>
</div>
<p>Here, the data type <code class="docutils literal notranslate"><span class="pre">&quot;&lt;U5&quot;</span></code> (compare also <code class="docutils literal notranslate"><span class="pre">x.dtype</span></code>) means
that we deal with Unicode strings of length no greater than 5.
Thus, unfortunately, replacing elements with too long a content
will result in truncated strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;buckwheat&quot;</span>
<span class="n">x</span>
<span class="c1">## array([&#39;spam&#39;, &#39;bacon&#39;, &#39;buckw&#39;], dtype=&#39;&lt;U5&#39;)</span>
</pre></div>
</div>
<p>In order to remedy this, we first need to recast the vector manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;&lt;U10&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;buckwheat&quot;</span>
<span class="n">x</span>
<span class="c1">## array([&#39;spam&#39;, &#39;bacon&#39;, &#39;buckwheat&#39;], dtype=&#39;&lt;U10&#39;)</span>
</pre></div>
</div>
<p>Conversion from/to numeric is also possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span> <span class="s2">&quot;-7&quot;</span><span class="p">,</span> <span class="s2">&quot;3523&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1">## array([ 1.300e+00, -7.000e+00,  3.523e+03])</span>
<span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="o">-</span><span class="mi">5153</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="c1">## array([&#39;1.0&#39;, &#39;3.14&#39;, &#39;-5153.0&#39;], dtype=&#39;&lt;U32&#39;)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://numpy.org/doc/stable/reference/routines.char.html"><strong class="command">numpy.char</strong></a>
module includes a number of vectorised
versions of string routines, most of which we have
discussed above.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam, bacon, and spam&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spam, eggs, bacon, spam, spam, and spam&quot;</span>
<span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
<span class="c1">## array([list([&#39;spam&#39;]), list([&#39;spam&#39;, &#39;bacon&#39;, &#39;and spam&#39;]),</span>
<span class="c1">##        list([&#39;spam&#39;, &#39;eggs&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;and spam&#39;])],</span>
<span class="c1">##       dtype=object)</span>
<span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## array([1, 2, 4])</span>
</pre></div>
</div>
<p>Operations that we would normally perform via the use of binary
operators (i.e., `<strong class="command">+</strong>`, `<strong class="command">*</strong>`, `<strong class="command">&lt;</strong>`, etc.)
are available through standalone functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">],</span> <span class="s2">&quot; and spam&quot;</span><span class="p">)</span>
<span class="c1">## array([&#39;spam and spam&#39;, &#39;bacon and spam&#39;], dtype=&#39;&lt;U14&#39;)</span>
<span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">equal</span><span class="p">([</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">],</span> <span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="c1">## array([ True, False,  True])</span>
</pre></div>
</div>
<p>Also the function that returns the length of each string
is noteworthy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">str_len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## array([ 4, 21, 39])</span>
</pre></div>
</div>
</div>
<div class="section" id="formatted-outputs">
<span id="sec-format-output"></span><h2><span class="section-number">15.5. </span>Formatted Outputs (*)<a class="headerlink" href="#formatted-outputs" title="Permalink to this headline"></a></h2>
<p>When preparing reports from data analysis (e.g., using
Jupyter Notebooks or writing directly to Markdown files which we
later compile to PDF or HTML using <a class="reference external" href="https://pandoc.org/"><strong class="program">pandoc</strong></a>)
it is important to be able to output
nicely formatted content programmatically.</p>
<div class="section" id="formatting-strings">
<h3><span class="section-number">15.5.1. </span>Formatting Strings<a class="headerlink" href="#formatting-strings" title="Permalink to this headline"></a></h3>
<p>Recall that string formatting for inclusion of data stored in existing
objects can easily be done using f-strings
(formatted string literals) of the type <code class="docutils literal notranslate"><span class="pre">f&quot;...{expression}...&quot;</span></code>.
For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14159265358979323846</span>
<span class="sa">f</span><span class="s2">&quot;π = </span><span class="si">{</span><span class="n">pi</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c1">## &#39;π = 3.14&#39;</span>
</pre></div>
</div>
<p>creates a string including the variable <code class="docutils literal notranslate"><span class="pre">pi</span></code> formatted as a <code class="docutils literal notranslate"><span class="pre">float</span></code>
rounded to two places after the decimal separator.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**) Similar functionality can be achieved using the <strong class="command">str.format</strong> method
as well as the `<strong class="command">%</strong>` operator overloaded for strings, which uses
<strong class="command">sprintf</strong>-like value placeholders known to some readers
from other programming languages (such as C):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;π = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span> <span class="s2">&quot;π = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pi</span>
<span class="c1">## (&#39;π = 3.14&#39;, &#39;π = 3.14&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="str-and-repr">
<h3><span class="section-number">15.5.2. </span><strong class="command">str</strong> and <strong class="command">repr</strong><a class="headerlink" href="#str-and-repr" title="Permalink to this headline"></a></h3>
<p>The <strong class="command">str</strong> and <strong class="command">repr</strong> functions can create string representations
of a number of objects, with the former being more human-readable
and latter slightly more technical.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## (&#39;[1 2 3]&#39;, &#39;array([1, 2, 3])&#39;)</span>
</pre></div>
</div>
<p>Note that <strong class="command">repr</strong> often returns an output that can be
interpreted as executable Python code literally (with no
or few adjustments, however, <strong class="program">pandas</strong> objects are one of the
many exceptions).</p>
</div>
<div class="section" id="justifying-strings">
<h3><span class="section-number">15.5.3. </span>Justifying Strings<a class="headerlink" href="#justifying-strings" title="Permalink to this headline"></a></h3>
<p><strong class="command">str.center</strong>, <strong class="command">str.ljust</strong>, <strong class="command">str.rjust</strong> can be used
to centre, left-, or-right justify a string so that
it’s of at least given width, which might make the display thereof
more aesthetic.
Very long strings, possibly containing whole text paragraphs
can be dealt with using the <strong class="command">wrap</strong> and <strong class="command">shorten</strong> functions
from the <strong class="program">textwrap</strong> package.</p>
</div>
<div class="section" id="direct-markdown-output-in-jupyter">
<h3><span class="section-number">15.5.4. </span>Direct Markdown Output in Jupyter<a class="headerlink" href="#direct-markdown-output-in-jupyter" title="Permalink to this headline"></a></h3>
<p>Further, note that with IPython/Jupyter, we can output
strings that will be directly interpreted as Markdown-formatted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">2</span>
<span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Result*: $2^2=2+2=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">$.&quot;</span>
<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Result</em>: <span class="math notranslate nohighlight">\(2^2=2+2=4\)</span>.</p>
<p>Recall that <a class="reference external" href="https://daringfireball.net/projects/markdown/syntax">Markdown</a>
is a very flexible markup language,
allowing us to insert itemised and numbered lists, mathematical
formulae, tables, images, etc.</p>
</div>
<div class="section" id="manual-markdown-file-output">
<h3><span class="section-number">15.5.5. </span>Manual Markdown File Output<a class="headerlink" href="#manual-markdown-file-output" title="Permalink to this headline"></a></h3>
<p>We can also generate Markdown code programmatically
in form of standalone <code class="docutils literal notranslate"><span class="pre">.md</span></code> files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/test-report.md&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>  <span class="c1"># open for writing (overwrite if exists)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;**Yummy Foods** include, but are not limited to:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;* </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">And now for something completely different:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Rank | Food</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----|-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">10</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1">## 50</span>
<span class="c1">## 7</span>
<span class="c1">## 8</span>
<span class="c1">## 7</span>
<span class="c1">## 7</span>
<span class="c1">## 46</span>
<span class="c1">## 12</span>
<span class="c1">## 12</span>
<span class="c1">## 18</span>
<span class="c1">## 18</span>
<span class="c1">## 18</span>
<span class="c1">## 18</span>
</pre></div>
</div>
<p>Here is the resulting raw Markdown source file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/test-report.md&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="c1">## **Yummy Foods** include, but are not limited to:</span>
<span class="c1">## </span>
<span class="c1">## * spam</span>
<span class="c1">## * bacon</span>
<span class="c1">## * eggs</span>
<span class="c1">## * spam</span>
<span class="c1">## </span>
<span class="c1">## And now for something completely different:</span>
<span class="c1">## </span>
<span class="c1">## Rank | Food</span>
<span class="c1">## -----|-----</span>
<span class="c1">##    1 | maps      </span>
<span class="c1">##    2 | nocab     </span>
<span class="c1">##    3 | sgge      </span>
<span class="c1">##    4 | maps</span>
</pre></div>
</div>
<p>We can run it through the <a class="reference external" href="https://pandoc.org/"><strong class="program">pandoc</strong></a> tool
to convert it to a number of formats, including HTML, PDF, EPUB, and ODT.
We may also render it directly into our report:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Yummy Foods</strong> include, but are not limited to:</p>
<ul class="simple">
<li><p>spam</p></li>
<li><p>bacon</p></li>
<li><p>eggs</p></li>
<li><p>spam</p></li>
</ul>
<p>And now for something completely different:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Rank</p></th>
<th class="head"><p>Food</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>maps</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>nocab</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>sgge</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>maps</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Figures created in <strong class="program">matplotlib</strong>
can be exported to PNG, SVG, or PDF files
using the <strong class="command">matplotlib.pyplot.savefig</strong> function.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Data frames can be nicely prepared for display in a report
using <strong class="command">pandas.DataFrame.to_markdown</strong>.</p>
</div>
</div>
</div>
<div class="section" id="exercises">
<h2><span class="section-number">15.6. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline"></a></h2>
<div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.5</span>
        
    </div><div class="proof-content">
<p>List some ways to normalise character strings.</p>
</div></div><div class="proof proof-type-exercise" id="id9">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.6</span>
        
    </div><div class="proof-content">
<p>(**) What are the challenges of processing non-English text?</p>
</div></div></div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="520-regex.html" class="btn btn-neutral float-right" title="16. Regular Expressions (*)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="440-sql.html" class="btn btn-neutral float-left" title="14. Accessing Databases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Marek Gagolewski. Licensed under CC BY-NC-ND 4.0.
      <span class="lastupdated">
        Last updated on 2022-05-20T12:47:44+1000.
      </span>
    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a> theme.
    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>