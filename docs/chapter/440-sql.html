<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Minimalist Data Wrangling with Python" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2023" name="citation_date" />
<meta content="2023" name="citation_publication_date" />
<meta content="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf" name="citation_pdf_url" />
<meta content="https://datawranglingpy.gagolewski.com/" name="citation_public_url" />
<meta content="10.5281/zenodo.6451068" name="citation_doi" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Minimalist Data Wrangling with Python" name="twitter:title" />
<meta content="Minimalist Data Wrangling with Python" name="og:title" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="twitter:description" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="og:description" />
<meta content="gagolews/datawranglingpy" name="og:site_name" />
<meta content="https://datawranglingpy.gagolewski.com/" name="og:url" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://datawranglingpy.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571912" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="14. Text data" href="510-text.html" /><link rel="prev" title="12. Processing data in groups" href="430-group-by.html" />
        <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/440-sql.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/datawranglingpy.png"/><!-- Generated with Sphinx 7.2.5 and Furo 2023.08.19 -->
        <title>13. Accessing databases - Minimalist Data Wrangling with Python</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=dd03ec4f" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Minimalist Data Wrangling with Python</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/datawranglingpy.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Minimalist Data Wrangling with Python</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.3.9005
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/">Deep R programming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar types and control structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and other types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional numeric data and their empirical distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing unidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous probability distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. Multidimensional numeric data at a glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing multidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring relationships between variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="410-data-frame.html">10. Introducing data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">11. Handling categorical data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing data in groups</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">13. Accessing databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other data types</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">14. Text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-missingness.html">15. Missing, censored, and questionable data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/datawranglingpy" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="accessing-databases">
<span id="chap-sql"></span><h1><span class="section-number">13. </span>Accessing databases<a class="headerlink" href="#accessing-databases" title="Link to this heading">#</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://deepr.gagolewski.com/"><em>Deep R Programming</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id2" title="Gagolewski, M. (2023).  Deep R Programming. Zenodo. URL: https://deepr.gagolewski.com/, DOI: 10.5281/zenodo.7490464.">34</a>]</span> too.</em></p>
</div></blockquote>
<p><strong class="program">pandas</strong> is convenient for working with data that fit into memory
and which can be stored in individual CSV files.
Still, larger information banks in a shared environment
will often be made available to us via relational (structured) databases
such as PostgreSQL or MariaDB, or a wide range of commercial products.</p>
<p>Most commonly, we use SQL (Structured Query Language)
to define the data chunks<a class="footnote-reference brackets" href="#footfitmem" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> we wish to analyse.
Then, we fetch them from the database driver in the form
of a <strong class="program">pandas</strong> data frame.
This enables us to perform the operations we are already familiar
with, e.g., various transformations or visualisations.</p>
<p>Below we make a quick introduction to the basics of SQL
using <a class="reference external" href="https://sqlite.org/">SQLite</a>, which is a lightweight,
flat-file, and server-less open-source database management system.
Overall, SQLite is a sensible choice for data of even
hundreds or thousands of gigabytes in size that fit on
a single computer’s disk. This is more than enough
for playing with our data science projects or prototyping
more complex solutions.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In this chapter, we will learn that the syntax of SQL is very readable:
it is modelled after the natural (English) language.
The purpose of this introduction is not to compose own queries
nor to design new databanks. The latter is covered by a separate course
on database systems; see, e.g., <span id="id3">[<a class="reference internal" href="999-bibliography.html#id79" title="Connolly, T. and Begg, C. (2015).  Database Systems: A Practical Approach to Design, Implementation, and Management. Pearson.">15</a>, <a class="reference internal" href="999-bibliography.html#id77" title="Date, C.J. (2003).  An Introduction to Database Systems. Pearson.">19</a>]</span>.</p>
</div>
<section id="example-database">
<h2><span class="section-number">13.1. </span>Example database<a class="headerlink" href="#example-database" title="Link to this heading">#</a></h2>
<p>In this chapter, we will be working with a simplified data dump
of the Q&amp;A site
<a class="reference external" href="https://travel.stackexchange.com/">Travel Stack Exchange</a>, which we
<a class="reference external" href="https://archive.org/details/stackexchange">downloaded</a> on 2017-10-31.
It consists of five separate data frames.</p>
<p>First, <code class="docutils literal notranslate"><span class="pre">Tags</span></code> gives, amongst others,
topic categories (<code class="docutils literal notranslate"><span class="pre">TagName</span></code>) and how many questions mention them (<code class="docutils literal notranslate"><span class="pre">Count</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/travel_stackexchange_com_2017/Tags.csv.gz&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">Tags</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">##    Count  ExcerptPostId  Id    TagName  WikiPostId</span>
<span class="c1">## 0    104         2138.0   1   cruising      2137.0</span>
<span class="c1">## 1     43          357.0   2  caribbean       356.0</span>
<span class="c1">## 2     43          319.0   4  vacations       318.0</span>
</pre></div>
</div>
<p>Second,
<code class="docutils literal notranslate"><span class="pre">Users</span></code> provides information on the registered users.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/travel_stackexchange_com_2017/Users.csv.gz&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">Users</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">##    AccountId   Age             CreationDate  ... Reputation  UpVotes  Views</span>
<span class="c1">## 0       -1.0   NaN  2011-06-21T15:16:44.253  ...        1.0   2472.0    0.0</span>
<span class="c1">## 1        2.0  40.0  2011-06-21T20:10:03.720  ...      101.0      1.0   31.0</span>
<span class="c1">## 2     7598.0  32.0  2011-06-21T20:11:02.490  ...      101.0      1.0   14.0</span>
<span class="c1">## </span>
<span class="c1">## [3 rows x 11 columns]</span>
</pre></div>
</div>
<p>Third,
<code class="docutils literal notranslate"><span class="pre">Badges</span></code> recalls all rewards handed to the users (<code class="docutils literal notranslate"><span class="pre">UserId</span></code>)
for their engaging in various praiseworthy activities:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Badges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/travel_stackexchange_com_2017/Badges.csv.gz&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">Badges</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">##    Class                     Date  Id            Name  TagBased  UserId</span>
<span class="c1">## 0      3  2011-06-21T20:16:48.910   1  Autobiographer     False       2</span>
<span class="c1">## 1      3  2011-06-21T20:16:48.910   2  Autobiographer     False       3</span>
<span class="c1">## 2      3  2011-06-21T20:16:48.910   3  Autobiographer     False       4</span>
</pre></div>
</div>
<p>Fourth,
<code class="docutils literal notranslate"><span class="pre">Posts</span></code> lists all the questions and answers (the latter
do not have <code class="docutils literal notranslate"><span class="pre">ParentId</span></code> set to <code class="docutils literal notranslate"><span class="pre">NaN</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Posts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/travel_stackexchange_com_2017/Posts.csv.gz&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">Posts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">##    AcceptedAnswerId  ...  ViewCount</span>
<span class="c1">## 0             393.0  ...      419.0</span>
<span class="c1">## 1               NaN  ...     1399.0</span>
<span class="c1">## 2               NaN  ...        NaN</span>
<span class="c1">## </span>
<span class="c1">## [3 rows x 17 columns]</span>
</pre></div>
</div>
<p>Fifth,
<code class="docutils literal notranslate"><span class="pre">Votes</span></code> list all the up-votes (<code class="docutils literal notranslate"><span class="pre">VoteTypeId</span></code> equal to 2)
and down-votes (<code class="docutils literal notranslate"><span class="pre">VoteTypeId</span></code> of 3)
to all the posts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Votes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/travel_stackexchange_com_2017/Votes.csv.gz&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">Votes</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">##    BountyAmount             CreationDate  Id  PostId  UserId  VoteTypeId</span>
<span class="c1">## 0           NaN  2011-06-21T00:00:00.000   1       1     NaN           2</span>
<span class="c1">## 1           NaN  2011-06-21T00:00:00.000   2       1     NaN           2</span>
<span class="c1">## 2           NaN  2011-06-21T00:00:00.000   3       2     NaN           2</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id7">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.1</span>
        
    </div><div class="proof-content">
<p>See the <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/travel_stackexchange_com_2017/README.md"><code class="docutils literal notranslate"><span class="pre">README</span></code></a>
file for a detailed description of each column.
Note that rows are uniquely defined by their respective <code class="docutils literal notranslate"><span class="pre">Id</span></code>s.
They are relations between the data frames, e.g.,
<code class="docutils literal notranslate"><span class="pre">Users.Id</span></code> vs <code class="docutils literal notranslate"><span class="pre">Badges.UserId</span></code>,
<code class="docutils literal notranslate"><span class="pre">Posts.Id</span></code> vs <code class="docutils literal notranslate"><span class="pre">Votes.PostId</span></code>, etc.
Moreover, for privacy reasons, some <code class="docutils literal notranslate"><span class="pre">UserId</span></code>s might be missing.
In such a case, they are encoded with a not-a-number;
compare <a class="reference internal" href="520-missingness.html#chap-missingness"><span class="std std-numref">Chapter 15</span></a>.</p>
</div></div></section>
<section id="exporting-data-to-a-database">
<h2><span class="section-number">13.2. </span>Exporting data to a database<a class="headerlink" href="#exporting-data-to-a-database" title="Link to this heading">#</a></h2>
<p>Let us establish a connection with the to-be
SQLite database. In our case,
this will be an ordinary file stored on the computer’s disk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="n">dbfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s2">&quot;travel.db&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dbfile</span><span class="p">)</span>
<span class="c1">## /tmp/tmp1jrbg84j/travel.db</span>
</pre></div>
</div>
<p>The above defines the file path (compare <a class="reference internal" href="#sec-file-paths"><span class="std std-numref">Section 13.6.1</span></a>)
where the database is going to be stored. We use a randomly generated
filename inside the local file system’s (we are on Linux)
temporary directory, <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>. This is just a pleasant exercise, and
we will not be using this database afterwards.
The reader might prefer setting a filename relative to the
current working directory (as given by <strong class="command">os.getcwd</strong>), e.g.,
<code class="docutils literal notranslate"><span class="pre">dbfile</span> <span class="pre">=</span> <span class="pre">&quot;travel.db&quot;</span></code>.</p>
<p>We can now connect to the database:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbfile</span><span class="p">)</span>
</pre></div>
</div>
<p>The database might now be queried:
we can add new tables, insert new rows, and retrieve records.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the end, we must not forget about the call to <code class="docutils literal notranslate"><span class="pre">conn.close()</span></code>.</p>
</div>
<p>Our data are already in the form of <strong class="program">pandas</strong> data frames.
Therefore, exporting them to the database is straightforward.
We only need to make a series of calls to the
<strong class="command">pandas.DataFrame.to_sql</strong> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Tags</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Tags&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Users</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Users&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Badges</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Badges&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Posts</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Posts&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Votes</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Votes&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) It is possible to export data that do not fit into memory
by reading them in chunks of considerable, but not too large, sizes.
In particular <strong class="command">pandas.read_csv</strong> has the <code class="docutils literal notranslate"><span class="pre">nrows</span></code> argument that
lets us read several rows from a file connection; see
<a class="reference internal" href="#sec-file-connection"><span class="std std-numref">Section 13.6.4</span></a>. Then,
<strong class="command">pandas.DataFrame.to_sql</strong><code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">if_exists=&quot;append&quot;)</span></code> can
be used to append new rows to an existing table.</p>
<p>Exporting data can be done without <strong class="program">pandas</strong> as well,
e.g., when they are to be fetched from XML or JSON files
(compare <a class="reference internal" href="#sec-json-xml"><span class="std std-numref">Section 13.5</span></a>) and processed manually, row by row.
Intermediate-level SQL users can call <code class="docutils literal notranslate"><span class="pre">conn.execute(&quot;CREATE</span> <span class="pre">TABLE</span> <span class="pre">t...&quot;)</span></code>,
followed by
<code class="docutils literal notranslate"><span class="pre">conn.executemany(&quot;INSERT</span> <span class="pre">INTO</span> <span class="pre">t</span> <span class="pre">VALUES(?,</span> <span class="pre">?,</span> <span class="pre">?)&quot;,</span> <span class="pre">l)</span></code>,
and then
<code class="docutils literal notranslate"><span class="pre">conn.commit()</span></code>. This will create a new table (here: named <code class="docutils literal notranslate"><span class="pre">t</span></code>)
populated by a list of records (e.g., in the form of tuples or
<strong class="program">numpy</strong> vectors). For more details, see the
<a class="reference external" href="https://docs.python.org/3/library/sqlite3.html">manual</a>
of the <strong class="program">sqlite3</strong> package.</p>
</div>
</section>
<section id="exercises-on-sql-vs-pandas">
<h2><span class="section-number">13.3. </span>Exercises on SQL vs <strong class="program">pandas</strong><a class="headerlink" href="#exercises-on-sql-vs-pandas" title="Link to this heading">#</a></h2>
<p>We can use <strong class="program">pandas</strong> to fetch the results of any SQL query
in the form of a data frame. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT * FROM Tags LIMIT 3</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1">##    Count  ExcerptPostId  Id    TagName  WikiPostId</span>
<span class="c1">## 0    104         2138.0   1   cruising      2137.0</span>
<span class="c1">## 1     43          357.0   2  caribbean       356.0</span>
<span class="c1">## 2     43          319.0   4  vacations       318.0</span>
</pre></div>
</div>
<p>The above query selected all columns (<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code>) and
the first three rows (<code class="docutils literal notranslate"><span class="pre">LIMIT</span> <span class="pre">3</span></code>) from the <code class="docutils literal notranslate"><span class="pre">Tags</span></code> table.</p>
<div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.2</span>
        
    </div><div class="proof-content">
<p>For the above and all the following SQL queries,
write the equivalent Python code that generates the same result
using <strong class="program">pandas</strong> functions and methods.
In each case, there might be more than one equally fine solution.
In case of any doubt about the meaning of the queries,
please refer to the <a class="reference external" href="https://sqlite.org/lang.html">SQLite documentation</a>.
Example solutions are provided at the end of this section.</p>
</div></div><div class="proof proof-type-example" id="id9">

    <div class="proof-title">
        <span class="proof-type">Example 13.3</span>
        
    </div><div class="proof-content">
<p>For a reference query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res1a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT * FROM Tags LIMIT 3</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<p>The equivalent <strong class="program">pandas</strong> implementation might look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res1b</span> <span class="o">=</span> <span class="n">Tags</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>To verify that the results are equal, we can call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res1a</span><span class="p">,</span> <span class="n">res1b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
<p>No error message means that the test is passed.
The cordial thing about the <strong class="command">assert_frame_equal</strong> function is that
it ignores small round-off errors introduced by arithmetic operations.</p>
<p>Nonetheless, the results generated by <strong class="program">pandas</strong>
might be the same <em>up to the reordering of rows</em>. In such a case,
before calling <strong class="command">pandas.testing.assert_frame_equal</strong>,
we can invoke <code class="docutils literal notranslate"><span class="pre">DataFrame.sort_values</span></code> on both data frames to sort them
with respect to 1 or 2 chosen columns.</p>
</div></div><section id="filtering">
<h3><span class="section-number">13.3.1. </span>Filtering<a class="headerlink" href="#filtering" title="Link to this heading">#</a></h3>
<div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.4</span>
        
    </div><div class="proof-content">
<p>From <code class="docutils literal notranslate"><span class="pre">Tags</span></code>, select two columns <code class="docutils literal notranslate"><span class="pre">TagName</span></code> and <code class="docutils literal notranslate"><span class="pre">Count</span></code>
and rows for which <code class="docutils literal notranslate"><span class="pre">TagName</span></code> is equal to one of the three choices provided.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res2a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT TagName, Count</span>
<span class="s2">    FROM Tags</span>
<span class="s2">    WHERE TagName IN (&#39;poland&#39;, &#39;australia&#39;, &#39;china&#39;)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res2a</span>
<span class="c1">##      TagName  Count</span>
<span class="c1">## 0      china    443</span>
<span class="c1">## 1  australia    411</span>
<span class="c1">## 2     poland    139</span>
</pre></div>
</div>
<p>Hint: use <strong class="command">pandas.Series.isin</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id11">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.5</span>
        
    </div><div class="proof-content">
<p>Select a set of columns from <code class="docutils literal notranslate"><span class="pre">Posts</span></code> whose rows fulfil a given
set of conditions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res3a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT Title, Score, ViewCount, FavoriteCount</span>
<span class="s2">    FROM Posts</span>
<span class="s2">    WHERE PostTypeId=1 AND</span>
<span class="s2">        ViewCount&gt;=10000 AND</span>
<span class="s2">        FavoriteCount BETWEEN 35 AND 100</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res3a</span>
<span class="c1">##                                                Title  ...  FavoriteCount</span>
<span class="c1">## 0  When traveling to a country with a different c...  ...           35.0</span>
<span class="c1">## 1         How can I do a &quot;broad&quot; search for flights?  ...           49.0</span>
<span class="c1">## 2  Tactics to avoid getting harassed by corrupt p...  ...           42.0</span>
<span class="c1">## 3  Flight tickets: buy two weeks before even duri...  ...           36.0</span>
<span class="c1">## 4  OK we&#39;re all adults here, so really, how on ea...  ...           79.0</span>
<span class="c1">## 5  How to intentionally get denied entry to the U...  ...           53.0</span>
<span class="c1">## 6  How do you know if Americans genuinely/literal...  ...           79.0</span>
<span class="c1">## 7  OK, we are all adults here, so what is a bidet...  ...           38.0</span>
<span class="c1">## 8          How to cope with too slow Wi-Fi at hotel?  ...           41.0</span>
<span class="c1">## </span>
<span class="c1">## [9 rows x 4 columns]</span>
</pre></div>
</div>
</div></div></section>
<section id="ordering">
<h3><span class="section-number">13.3.2. </span>Ordering<a class="headerlink" href="#ordering" title="Link to this heading">#</a></h3>
<div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.6</span>
        
    </div><div class="proof-content">
<p>Select the <code class="docutils literal notranslate"><span class="pre">Title</span></code> and <code class="docutils literal notranslate"><span class="pre">Score</span></code> columns from <code class="docutils literal notranslate"><span class="pre">Posts</span></code>
where <code class="docutils literal notranslate"><span class="pre">ParentId</span></code> is missing (i.e., the post is, in fact, a question)
and <code class="docutils literal notranslate"><span class="pre">Title</span></code> is well-defined.
Then, sort the results by the <code class="docutils literal notranslate"><span class="pre">Score</span></code> column, decreasingly
(descending order). Finally, return only the first five rows (e.g.,
top five scoring questions).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res4a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT Title, Score</span>
<span class="s2">    FROM Posts</span>
<span class="s2">    WHERE ParentId IS NULL AND Title IS NOT NULL</span>
<span class="s2">    ORDER BY Score DESC</span>
<span class="s2">    LIMIT 5</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res4a</span>
<span class="c1">##                                                Title  Score</span>
<span class="c1">## 0  OK we&#39;re all adults here, so really, how on ea...    306</span>
<span class="c1">## 1  How do you know if Americans genuinely/literal...    254</span>
<span class="c1">## 2  How to intentionally get denied entry to the U...    219</span>
<span class="c1">## 3  Why are airline passengers asked to lift up wi...    210</span>
<span class="c1">## 4                       Why prohibit engine braking?    178</span>
</pre></div>
</div>
<p>Hint: use <strong class="command">pandas.DataFrame.sort_values</strong> and
<strong class="command">numpy.isnan</strong> or <strong class="command">pandas.isnull</strong>.</p>
</div></div></section>
<section id="removing-duplicates">
<h3><span class="section-number">13.3.3. </span>Removing duplicates<a class="headerlink" href="#removing-duplicates" title="Link to this heading">#</a></h3>
<div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.7</span>
        
    </div><div class="proof-content">
<p>Get all unique badge names for the user with <code class="docutils literal notranslate"><span class="pre">Id=23</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res5a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT DISTINCT Name</span>
<span class="s2">    FROM Badges</span>
<span class="s2">    WHERE UserId=23</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res5a</span>
<span class="c1">##                 Name</span>
<span class="c1">## 0          Supporter</span>
<span class="c1">## 1            Student</span>
<span class="c1">## 2            Teacher</span>
<span class="c1">## 3            Scholar</span>
<span class="c1">## 4               Beta</span>
<span class="c1">## 5      Nice Question</span>
<span class="c1">## 6             Editor</span>
<span class="c1">## 7        Nice Answer</span>
<span class="c1">## 8           Yearling</span>
<span class="c1">## 9   Popular Question</span>
<span class="c1">## 10        Taxonomist</span>
<span class="c1">## 11  Notable Question</span>
</pre></div>
</div>
<p>Hint: use <strong class="command">pandas.DataFrame.drop_duplicates</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.8</span>
        
    </div><div class="proof-content">
<p>For each badge handed to the user with <code class="docutils literal notranslate"><span class="pre">Id=23</span></code>,
extract the award year store it in a new column named <code class="docutils literal notranslate"><span class="pre">Year</span></code>.
Then, select only the unique pairs <code class="docutils literal notranslate"><span class="pre">(Name,</span> <span class="pre">Year)</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res6a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT DISTINCT</span>
<span class="s2">        Name,</span>
<span class="s2">        CAST(strftime(&#39;%Y&#39;, Date) AS FLOAT) AS Year</span>
<span class="s2">    FROM Badges</span>
<span class="s2">    WHERE UserId=23</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res6a</span>
<span class="c1">##                 Name    Year</span>
<span class="c1">## 0          Supporter  2011.0</span>
<span class="c1">## 1            Student  2011.0</span>
<span class="c1">## 2            Teacher  2011.0</span>
<span class="c1">## 3            Scholar  2011.0</span>
<span class="c1">## 4               Beta  2011.0</span>
<span class="c1">## 5      Nice Question  2011.0</span>
<span class="c1">## 6             Editor  2012.0</span>
<span class="c1">## 7        Nice Answer  2012.0</span>
<span class="c1">## 8           Yearling  2012.0</span>
<span class="c1">## 9      Nice Question  2012.0</span>
<span class="c1">## 10     Nice Question  2013.0</span>
<span class="c1">## 11          Yearling  2013.0</span>
<span class="c1">## 12  Popular Question  2014.0</span>
<span class="c1">## 13          Yearling  2014.0</span>
<span class="c1">## 14        Taxonomist  2014.0</span>
<span class="c1">## 15  Notable Question  2015.0</span>
<span class="c1">## 16     Nice Question  2017.0</span>
</pre></div>
</div>
<p>Hint: use
<code class="docutils literal notranslate"><span class="pre">Badges.Date.astype(&quot;datetime64[s]&quot;).dt.strftime(&quot;%Y&quot;).astype(&quot;float&quot;)</span></code>;
see <a class="reference internal" href="530-time-series.html#chap-time-series"><span class="std std-numref">Chapter 16</span></a>.</p>
</div></div></section>
<section id="grouping-and-aggregating">
<h3><span class="section-number">13.3.4. </span>Grouping and aggregating<a class="headerlink" href="#grouping-and-aggregating" title="Link to this heading">#</a></h3>
<div class="proof proof-type-exercise" id="id15">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.9</span>
        
    </div><div class="proof-content">
<p>Count how many badges of each type the user with <code class="docutils literal notranslate"><span class="pre">Id=23</span></code> won.
Also, for each badge type, compute the minimal, average, and maximal
receiving year.
Return only the top four badges (with respect to the counts).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res7a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">        Name,</span>
<span class="s2">        COUNT(*) AS Count,</span>
<span class="s2">        MIN(CAST(strftime(&#39;%Y&#39;, Date) AS FLOAT)) AS MinYear,</span>
<span class="s2">        AVG(CAST(strftime(&#39;%Y&#39;, Date) AS FLOAT)) AS MeanYear,</span>
<span class="s2">        MAX(CAST(strftime(&#39;%Y&#39;, Date) AS FLOAT)) AS MaxYear</span>
<span class="s2">    FROM Badges</span>
<span class="s2">    WHERE UserId=23</span>
<span class="s2">    GROUP BY Name</span>
<span class="s2">    ORDER BY Count DESC</span>
<span class="s2">    LIMIT 4</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res7a</span>
<span class="c1">##                Name  Count  MinYear  MeanYear  MaxYear</span>
<span class="c1">## 0     Nice Question      4   2011.0   2013.25   2017.0</span>
<span class="c1">## 1          Yearling      3   2012.0   2013.00   2014.0</span>
<span class="c1">## 2  Popular Question      3   2014.0   2014.00   2014.0</span>
<span class="c1">## 3  Notable Question      2   2015.0   2015.00   2015.0</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.10</span>
        
    </div><div class="proof-content">
<p>Count how many unique combinations of pairs <code class="docutils literal notranslate"><span class="pre">(Name,</span> <span class="pre">Year)</span></code>
for the badges won by the user with <code class="docutils literal notranslate"><span class="pre">Id=23</span></code> are there.
Then, return only the rows having <code class="docutils literal notranslate"><span class="pre">Count</span></code> greater than 1
and order the results by <code class="docutils literal notranslate"><span class="pre">Count</span></code> decreasingly.
In other words, list the badges received more than once in any given
year.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res8a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">        Name,</span>
<span class="s2">        CAST(strftime(&#39;%Y&#39;, Date) AS FLOAT) AS Year,</span>
<span class="s2">        COUNT(*) AS Count</span>
<span class="s2">    FROM Badges</span>
<span class="s2">    WHERE UserId=23</span>
<span class="s2">    GROUP BY Name, Year</span>
<span class="s2">    HAVING Count &gt; 1</span>
<span class="s2">    ORDER BY Count DESC</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res8a</span>
<span class="c1">##                Name    Year  Count</span>
<span class="c1">## 0  Popular Question  2014.0      3</span>
<span class="c1">## 1  Notable Question  2015.0      2</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> is performed before <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, and <code class="docutils literal notranslate"><span class="pre">HAVING</span></code>
is applied thereafter.</p>
</div></div></section>
<section id="joining">
<h3><span class="section-number">13.3.5. </span>Joining<a class="headerlink" href="#joining" title="Link to this heading">#</a></h3>
<div class="proof proof-type-exercise" id="id17">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.11</span>
        
    </div><div class="proof-content">
<p>Join (merge) <code class="docutils literal notranslate"><span class="pre">Tags</span></code>, <code class="docutils literal notranslate"><span class="pre">Posts</span></code>, and <code class="docutils literal notranslate"><span class="pre">Users</span></code>
for all posts with <code class="docutils literal notranslate"><span class="pre">OwnerUserId</span></code> not equal to <code class="docutils literal notranslate"><span class="pre">-1</span></code> (i.e.,
the tags which were created by “alive” users).
Return the top six records with respect to <code class="docutils literal notranslate"><span class="pre">Tags.Count</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res9a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT Tags.TagName, Tags.Count, Posts.OwnerUserId,</span>
<span class="s2">        Users.Age, Users.Location, Users.DisplayName</span>
<span class="s2">    FROM Tags</span>
<span class="s2">    JOIN Posts ON Posts.Id=Tags.WikiPostId</span>
<span class="s2">    JOIN Users ON Users.AccountId=Posts.OwnerUserId</span>
<span class="s2">    WHERE OwnerUserId != -1</span>
<span class="s2">    ORDER BY Tags.Count DESC, Tags.TagName ASC</span>
<span class="s2">    LIMIT 6</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res9a</span>
<span class="c1">##          TagName  Count  ...          Location       DisplayName</span>
<span class="c1">## 0         canada    802  ...     Mumbai, India             hitec</span>
<span class="c1">## 1         europe    681  ...  Philadelphia, PA       Adam Tuttle</span>
<span class="c1">## 2  visa-refusals    554  ...      New York, NY  Benjamin Pollack</span>
<span class="c1">## 3      australia    411  ...     Mumbai, India             hitec</span>
<span class="c1">## 4             eu    204  ...  Philadelphia, PA       Adam Tuttle</span>
<span class="c1">## 5  new-york-city    204  ...     Mumbai, India             hitec</span>
<span class="c1">## </span>
<span class="c1">## [6 rows x 6 columns]</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.12</span>
        
    </div><div class="proof-content">
<p>First, create an auxiliary (temporary) table named <code class="docutils literal notranslate"><span class="pre">UpVotesTab</span></code>,
where we store the information about the number of up-votes
(<code class="docutils literal notranslate"><span class="pre">VoteTypeId=2</span></code>) that each post has received.
Then, join (merge) this table with <code class="docutils literal notranslate"><span class="pre">Posts</span></code>
and fetch some details about the five questions (<code class="docutils literal notranslate"><span class="pre">PostTypeId=1</span></code>)
with the most up-votes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res10a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT UpVotesTab.*, Posts.Title FROM</span>
<span class="s2">    (</span>
<span class="s2">        SELECT PostId, COUNT(*) AS UpVotes</span>
<span class="s2">        FROM Votes</span>
<span class="s2">        WHERE VoteTypeId=2</span>
<span class="s2">        GROUP BY PostId</span>
<span class="s2">    ) AS UpVotesTab</span>
<span class="s2">    JOIN Posts ON UpVotesTab.PostId=Posts.Id</span>
<span class="s2">    WHERE Posts.PostTypeId=1</span>
<span class="s2">    ORDER BY UpVotesTab.UpVotes DESC LIMIT 5</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">res10a</span>
<span class="c1">##    PostId  UpVotes                                              Title</span>
<span class="c1">## 0    3080      307  OK we&#39;re all adults here, so really, how on ea...</span>
<span class="c1">## 1   38177      254  How do you know if Americans genuinely/literal...</span>
<span class="c1">## 2   24540      221  How to intentionally get denied entry to the U...</span>
<span class="c1">## 3   20207      211  Why are airline passengers asked to lift up wi...</span>
<span class="c1">## 4   96447      178                       Why prohibit engine braking?</span>
</pre></div>
</div>
</div></div></section>
<section id="solutions-to-exercises">
<h3><span class="section-number">13.3.6. </span>Solutions to exercises<a class="headerlink" href="#solutions-to-exercises" title="Link to this heading">#</a></h3>
<p>In this section we provide examples of solutions to the above exercises.</p>
<div class="proof proof-type-example" id="id19">

    <div class="proof-title">
        <span class="proof-type">Example 13.13</span>
        
    </div><div class="proof-content">
<p>To obtain a result equivalent to <code class="docutils literal notranslate"><span class="pre">res2a</span></code>, we need basic filtering only:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res2b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Tags</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span>
        <span class="n">Tags</span><span class="o">.</span><span class="n">TagName</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;poland&quot;</span><span class="p">,</span> <span class="s2">&quot;australia&quot;</span><span class="p">,</span> <span class="s2">&quot;china&quot;</span><span class="p">]),</span>
        <span class="p">[</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let us verify whether the two data frames are identical:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res2a</span><span class="p">,</span> <span class="n">res2b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id20">

    <div class="proof-title">
        <span class="proof-type">Example 13.14</span>
        
    </div><div class="proof-content">
<p>To generate <code class="docutils literal notranslate"><span class="pre">res3a</span></code> with <strong class="program">pandas</strong> only, we need some more complex
filtering with <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res3b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Posts</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">Posts</span><span class="o">.</span><span class="n">PostTypeId</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Posts</span><span class="o">.</span><span class="n">ViewCount</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">Posts</span><span class="o">.</span><span class="n">FavoriteCount</span> <span class="o">&gt;=</span> <span class="mi">35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Posts</span><span class="o">.</span><span class="n">FavoriteCount</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">),</span>
        <span class="p">[</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Score&quot;</span><span class="p">,</span> <span class="s2">&quot;ViewCount&quot;</span><span class="p">,</span> <span class="s2">&quot;FavoriteCount&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res3a</span><span class="p">,</span> <span class="n">res3b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id21">

    <div class="proof-title">
        <span class="proof-type">Example 13.15</span>
        
    </div><div class="proof-content">
<p>For <code class="docutils literal notranslate"><span class="pre">res4a</span></code>, some filtering and sorting is all we need:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res4b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Posts</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span>
        <span class="n">Posts</span><span class="o">.</span><span class="n">ParentId</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">Posts</span><span class="o">.</span><span class="n">Title</span><span class="o">.</span><span class="n">isna</span><span class="p">()),</span>
        <span class="p">[</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Score&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span>
    <span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span>
    <span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res4a</span><span class="p">,</span> <span class="n">res4b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id22">

    <div class="proof-title">
        <span class="proof-type">Example 13.16</span>
        
    </div><div class="proof-content">
<p>The key to <code class="docutils literal notranslate"><span class="pre">res5a</span></code> is the <strong class="command">pandas.DataFrame.drop_duplicates</strong>
method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res5b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">Badges</span><span class="o">.</span><span class="n">UserId</span> <span class="o">==</span> <span class="mi">23</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]]</span><span class="o">.</span>
    <span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res5a</span><span class="p">,</span> <span class="n">res5b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id23">

    <div class="proof-title">
        <span class="proof-type">Example 13.17</span>
        
    </div><div class="proof-content">
<p>For <code class="docutils literal notranslate"><span class="pre">res6a</span></code>, we first need to add a new column to the copy of <code class="docutils literal notranslate"><span class="pre">Badges</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Badges2</span> <span class="o">=</span> <span class="n">Badges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># otherwise we would destroy the original object</span>
<span class="n">Badges2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges2</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[s]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, we apply some basic filtering and the removal of duplicated rows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res6b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges2</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">Badges2</span><span class="o">.</span><span class="n">UserId</span> <span class="o">==</span> <span class="mi">23</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">]]</span><span class="o">.</span>
    <span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res6a</span><span class="p">,</span> <span class="n">res6b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id24">

    <div class="proof-title">
        <span class="proof-type">Example 13.18</span>
        
    </div><div class="proof-content">
<p>For <code class="docutils literal notranslate"><span class="pre">res7a</span></code>, we can use <strong class="command">pandas.DataFrameGroupBy.aggregate</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Badges2</span> <span class="o">=</span> <span class="n">Badges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Badges2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges2</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[s]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">res7b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges2</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">Badges2</span><span class="o">.</span><span class="n">UserId</span> <span class="o">==</span> <span class="mi">23</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">]]</span><span class="o">.</span>
    <span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">)[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span>
    <span class="n">aggregate</span><span class="p">([</span><span class="nb">len</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">])</span><span class="o">.</span>
    <span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span>
    <span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">res7b</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;MinYear&quot;</span><span class="p">,</span> <span class="s2">&quot;MeanYear&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxYear&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Had we not converted <code class="docutils literal notranslate"><span class="pre">Year</span></code> to <code class="docutils literal notranslate"><span class="pre">float</span></code>, we would obtain
a meaningless average year, without any warning.</p>
<p>Unfortunately, the rows in <code class="docutils literal notranslate"><span class="pre">res7a</span></code> and <code class="docutils literal notranslate"><span class="pre">res7b</span></code> are ordered
differently. For testing, we need to reorder them in the same way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span>
    <span class="n">res7a</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">res7b</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id25">

    <div class="proof-title">
        <span class="proof-type">Example 13.19</span>
        
    </div><div class="proof-content">
<p>For <code class="docutils literal notranslate"><span class="pre">res8a</span></code>, we first count the number of values in each group:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Badges2</span> <span class="o">=</span> <span class="n">Badges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Badges2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges2</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[s]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">res8b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Badges2</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span> <span class="n">Badges2</span><span class="o">.</span><span class="n">UserId</span> <span class="o">==</span> <span class="mi">23</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span>
    <span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">])</span><span class="o">.</span>
    <span class="n">size</span><span class="p">()</span><span class="o">.</span>
    <span class="n">rename</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> part is performed after <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> and <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res8b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">res8b</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span> <span class="n">res8b</span><span class="o">.</span><span class="n">Count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span><span class="o">.</span>
    <span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res8a</span><span class="p">,</span> <span class="n">res8b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id26">

    <div class="proof-title">
        <span class="proof-type">Example 13.20</span>
        
    </div><div class="proof-content">
<p>To obtain a result equivalent to <code class="docutils literal notranslate"><span class="pre">res9a</span></code>, we need to merge
<code class="docutils literal notranslate"><span class="pre">Posts</span></code> with <code class="docutils literal notranslate"><span class="pre">Tags</span></code>, and then merge the result with <code class="docutils literal notranslate"><span class="pre">Users</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res9b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">Posts</span><span class="p">,</span> <span class="n">Tags</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;WikiPostId&quot;</span><span class="p">)</span>
<span class="n">res9b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="n">res9b</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;AccountId&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;OwnerUserId&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, some filtering and sorting will do the trick:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res9b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">res9b</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">res9b</span><span class="o">.</span><span class="n">OwnerUserId</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">res9b</span><span class="o">.</span><span class="n">OwnerUserId</span><span class="o">.</span><span class="n">isna</span><span class="p">()),</span>
        <span class="p">[</span><span class="s2">&quot;TagName&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;OwnerUserId&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span> <span class="s2">&quot;DisplayName&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span>
    <span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;TagName&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span><span class="o">.</span>
    <span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In SQL, “not equals to -1” implies <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res9a</span><span class="p">,</span> <span class="n">res9b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id27">

    <div class="proof-title">
        <span class="proof-type">Example 13.21</span>
        
    </div><div class="proof-content">
<p>To obtain a result equivalent to <code class="docutils literal notranslate"><span class="pre">res10a</span></code>,
we first need to create an auxiliary data frame
that corresponds to the subquery.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">UpVotesTab</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Votes</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">Votes</span><span class="o">.</span><span class="n">VoteTypeId</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span>
    <span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PostId&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">size</span><span class="p">()</span><span class="o">.</span>
    <span class="n">rename</span><span class="p">(</span><span class="s2">&quot;UpVotes&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res10b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">UpVotesTab</span><span class="p">,</span> <span class="n">Posts</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;PostId&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>
<span class="n">res10b</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">res10b</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">res10b</span><span class="o">.</span><span class="n">PostTypeId</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;PostId&quot;</span><span class="p">,</span> <span class="s2">&quot;UpVotes&quot;</span><span class="p">,</span> <span class="s2">&quot;Title&quot;</span><span class="p">]]</span><span class="o">.</span>
    <span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;UpVotes&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span>
    <span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">res10a</span><span class="p">,</span> <span class="n">res10b</span><span class="p">)</span>  <span class="c1"># no error == OK</span>
</pre></div>
</div>
</div></div></section>
</section>
<section id="closing-the-database-connection">
<h2><span class="section-number">13.4. </span>Closing the database connection<a class="headerlink" href="#closing-the-database-connection" title="Link to this heading">#</a></h2>
<p>We said we should not forget about:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This gives some sense of closure. Such a relief.</p>
</section>
<section id="common-data-serialisation-formats-for-the-web">
<span id="sec-json-xml"></span><h2><span class="section-number">13.5. </span>Common data serialisation formats for the Web<a class="headerlink" href="#common-data-serialisation-formats-for-the-web" title="Link to this heading">#</a></h2>
<p>CSV files are an all-round way to exchange <em>tabular</em> data between
different programming and data analysis environments.</p>
<p>For unstructured or non-tabularly-structured data, XML and JSON
(and its superset, YAML) are the common formats of choice,
especially for communicating with different Web APIs.</p>
<p>We recommend solving the following exercises
to make sure we can fetch data in these formats.
Sadly, often this will require some quite tedious labour,
neither art nor science; see also <span id="id4">[<a class="reference internal" href="999-bibliography.html#id19" title="van der Loo, M. and de Jonge, E. (2018).  Statistical Data Cleaning with Applications in R. John Wiley &amp; Sons.">90</a>]</span> and <span id="id5">[<a class="reference internal" href="999-bibliography.html#id20" title="Dasu, T. and Johnson, T. (2003).  Exploratory Data Mining and Data Cleaning. John Wiley &amp; Sons.">18</a>]</span>.</p>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.22</span>
        
    </div><div class="proof-content">
<p>Consider the Web API for <a class="reference external" href="https://data.melbourne.vic.gov.au/explore/dataset/on-street-parking-bay-sensors/api">accessing</a> the on-street parking bay
sensor data in Melbourne, VIC, Australia.
Using the <strong class="program">json</strong> package, convert the <a class="reference external" href="https://data.melbourne.vic.gov.au/api/explore/v2.1/catalog/datasets/on-street-parking-bay-sensors/exports/json">data</a> in the JSON format to a data frame.</p>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.23</span>
        
    </div><div class="proof-content">
<p>Australian Radiation Protection and Nuclear Safety Agency
<a class="reference external" href="https://www.arpansa.gov.au/our-services/monitoring/ultraviolet-radiation-monitoring/ultraviolet-radation-data-information">publishes</a> UV data for different Aussie cities.
Using the <strong class="program">xml</strong> package,
convert <a class="reference external" href="https://uvdata.arpansa.gov.au/xml/uvvalues.xml">this XML dataset</a>
to a data frame.</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.24</span>
        
    </div><div class="proof-content">
<p>(*)
Check out the English Wikipedia article with
a <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_20th-century_classical_composers">list of 20th-century classical composers</a>.
Using <strong class="command">pandas.read_html</strong>, convert the <em>Climate Data</em> table
included therein to a data frame.</p>
</div></div><div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.25</span>
        
    </div><div class="proof-content">
<p>(*)
Using the <strong class="program">lxml</strong> package,
author a function that converts each bullet list
featured in a given Wikipedia article (e.g.,
<a class="reference external" href="https://en.wikipedia.org/wiki/Category:Fr%C3%A9d%C3%A9ric_Chopin">this one</a>),
to a list of strings.</p>
</div></div><div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.26</span>
        
    </div><div class="proof-content">
<p>(**)
Import an archived version of a
<a class="reference external" href="https://stackexchange.com/">Stack Exchange</a> site that you find interesting
and store it in an SQLite database.
You can find the relevant data dumps
<a class="reference external" href="https://archive.org/details/stackexchange">here</a>.</p>
</div></div><div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.27</span>
        
    </div><div class="proof-content">
<p>(**)
<a class="reference external" href="https://meta.wikimedia.org/wiki/Data_dumps">Download</a>
and then import an archived version of one of the wikis hosted by the
<a class="reference external" href="https://wikimediafoundation.org/">Wikimedia Foundation</a>
(e.g., the whole English Wikipedia)
so that it can be stored in an SQLite database.</p>
</div></div></section>
<section id="working-with-many-files">
<h2><span class="section-number">13.6. </span>Working with many files<a class="headerlink" href="#working-with-many-files" title="Link to this heading">#</a></h2>
<p>For the mass-processing of many files, it is worth knowing <em>of</em>
the most basic functions for dealing with file paths, searching for files,
etc. Usually, we will be looking up ways to complete specific
tasks at hand, e.g., how to read data from a ZIP-like archive,
on the internet.
After all, contrary to the basic operations of vectors, matrices,
and data frames, they are not amongst the actions that we perform
frequently.</p>
<p>Good development practices related to data storage are described
in <span id="id6">[<a class="reference internal" href="999-bibliography.html#id147" title="Hart, E.M. and others. (2016).  Ten simple rules for digital data storage. PLOS Computational Biology, 12(10):1–12. DOI: 10.1371/journal.pcbi.1005097.">46</a>]</span>.</p>
<section id="file-paths">
<span id="sec-file-paths"></span><h3><span class="section-number">13.6.1. </span>File paths<a class="headerlink" href="#file-paths" title="Link to this heading">#</a></h3>
<p>UNIX-like operating systems, including GNU/Linux and m<strong>OS,
use slashes, “<code class="docutils literal notranslate"><span class="pre">/</span></code>”, as path separators, e.g., <code class="docutils literal notranslate"><span class="pre">&quot;/home/marek/file.csv&quot;</span></code>.
Win</strong>*s, however, uses backslashes, “<code class="docutils literal notranslate"><span class="pre">\</span></code>”, which have a special meaning
in character strings (escape sequences; see <a class="reference internal" href="120-scalar.html#sec-strings-intro"><span class="std std-numref">Section 2.1.3</span></a>).
Therefore, they should be input as, e.g., <code class="docutils literal notranslate"><span class="pre">&quot;c:\\users\\marek\\file.csv&quot;</span></code>.
Alternatively, we can use <em>raw</em> strings, where the backslash
is treated literally, e.g., <code class="docutils literal notranslate"><span class="pre">r&quot;c:\users\marek\file.csv&quot;</span></code>.</p>
<p>When constructing file paths programmatically, it is thus best
to rely on <strong class="command">os.path.join</strong>, which takes care of the system-specific nuances.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">,</span> <span class="s2">&quot;Desktop&quot;</span><span class="p">,</span> <span class="s2">&quot;file.csv&quot;</span><span class="p">)</span>  <span class="c1"># we are on GNU/Linux</span>
<span class="c1">## &#39;~/Desktop/file.csv&#39;</span>
</pre></div>
</div>
<p>The tilde, “<code class="docutils literal notranslate"><span class="pre">~</span></code>”, denotes the current user’s <em>home</em> directory.</p>
<p>For storing auxiliary data, we can use
the system’s temporary directory. See the <strong class="program">tempfile</strong>
module for functions that generate appropriate file paths therein.
For instance, a subdirectory inside the temporary directory
can be created via a call to <strong class="command">tempfile.mkdtemp</strong>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We will frequently be referring to file paths
relative to the working directory of the currently executed Python session
(e.g., from which IPython/Jupyter notebook server was started);
see <strong class="command">os.getcwd</strong>.</p>
</div>
<p>All non-absolute file names (ones that do not start
with “<code class="docutils literal notranslate"><span class="pre">~</span></code>”, “<code class="docutils literal notranslate"><span class="pre">/</span></code>”, “<code class="docutils literal notranslate"><span class="pre">c:\\</span></code>”, and the like),
for example, <code class="docutils literal notranslate"><span class="pre">&quot;filename.csv&quot;</span></code> or
<strong class="command">os.path.join</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;subdir&quot;,</span> <span class="pre">&quot;filename.csv&quot;)</span></code>
are always <em>relative</em> to the current working directory.</p>
<p>For instance, if the working directory is
<code class="docutils literal notranslate"><span class="pre">&quot;/home/marek/projects/python&quot;</span></code>,
then <code class="docutils literal notranslate"><span class="pre">&quot;filename.csv&quot;</span></code>
refers to <code class="docutils literal notranslate"><span class="pre">&quot;/home/marek/projects/python/filename.csv&quot;</span></code>.</p>
<p>Also, “<code class="docutils literal notranslate"><span class="pre">..</span></code>” denotes the current working directory’s parent directory.
Thus, <code class="docutils literal notranslate"><span class="pre">&quot;../filename2.csv&quot;</span></code>
resolves to <code class="docutils literal notranslate"><span class="pre">&quot;/home/marek/projects/filename2.csv&quot;</span></code>.</p>
<div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.28</span>
        
    </div><div class="proof-content">
<p>Print the current working directory by calling <strong class="command">os.getcwd</strong>.
Next, download the file
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/air_quality_2018_param.csv"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_param</span></code></a>
and save it in the current Python session’s working directory
(e.g., in your web browser, right-click on the web page’s canvas
and select <em>Save Page As…</em>).
Load with <strong class="program">pandas.read_csv</strong> by passing
<code class="docutils literal notranslate"><span class="pre">&quot;air_quality_2018_param.csv&quot;</span></code> as the input path.</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.29</span>
        
    </div><div class="proof-content">
<p>(*) Download the aforementioned file programmatically
(if you have not done so yet) using the <strong class="command">requests</strong> module.</p>
</div></div></section>
<section id="file-search">
<h3><span class="section-number">13.6.2. </span>File search<a class="headerlink" href="#file-search" title="Link to this heading">#</a></h3>
<p><strong class="command">glob.glob</strong> and <strong class="command">os.listdir</strong> generate a list of files
in a given directory (and possibly all its subdirectories).</p>
<p><strong class="command">os.path.isdir</strong> and <strong class="command">os.path.isfile</strong>
determine the type of a given object in the file system.</p>
<div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.30</span>
        
    </div><div class="proof-content">
<p>Write a function that computes the total
size of all the files in a given directory and all its subdirectories.</p>
</div></div></section>
<section id="exception-handling">
<h3><span class="section-number">13.6.3. </span>Exception handling<a class="headerlink" href="#exception-handling" title="Link to this heading">#</a></h3>
<p>Accessing resources on the disk or the internet
can lead to errors, for example, when the file is not found.
The <strong class="command">try..except</strong> statement can be used if we want
to be able to react to any of the envisaged errors</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># statements to execute</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;file_not_found.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>  <span class="c1"># this will not be executed if the above raises an error</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="c1"># if an exception occurs, we can handle it here</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File has not been found&quot;</span><span class="p">)</span>
<span class="c1">## File has not been found</span>
</pre></div>
</div>
<p>For more details, refer to the
<a class="reference external" href="https://docs.python.org/3/tutorial/errors.html">documentation</a>.</p>
</section>
<section id="file-connections">
<span id="sec-file-connection"></span><h3><span class="section-number">13.6.4. </span>File connections (*)<a class="headerlink" href="#file-connections" title="Link to this heading">#</a></h3>
<p>Basic ways of opening and reading from/writing to file connections
are described in the
<a class="reference external" href="https://docs.python.org/3/tutorial/inputoutput.html">documentation</a>.
<a class="reference internal" href="510-text.html#sec-manual-markdown"><span class="std std-numref">Section 14.3.5</span></a> shows an example where we
create a Markdown file manually.</p>
<p>They may be useful if we wish to process large files chunk by chunk.
In particular, <strong class="command">pandas.read_csv</strong>
accepts a file handler (see <strong class="command">open</strong>).
Then, passing the <code class="docutils literal notranslate"><span class="pre">nrows</span></code> argument we can indicate the number of rows
to fetch.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">13.7. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.31</span>
        
    </div><div class="proof-content">
<p>Find an example of an XML and JSON file. Which
one is more human-readable? Do they differ in terms of capabilities?</p>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.32</span>
        
    </div><div class="proof-content">
<p>What is wrong with constructing file paths like
<code class="docutils literal notranslate"><span class="pre">&quot;~&quot;</span> <span class="pre">+</span> <span class="pre">&quot;\\&quot;</span> <span class="pre">+</span> <span class="pre">&quot;filename.csv&quot;</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.33</span>
        
    </div><div class="proof-content">
<p>What are the benefits of using a SQL
database management system in data science activities?</p>
</div></div><div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.34</span>
        
    </div><div class="proof-content">
<p>(*) How can we populate a database with gigabytes of data
read from many CSV files?</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footfitmem" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>Technically, there are ways to use <strong class="command">pandas</strong>
with data that do not fit into memory. However, SQL is usually
a more versatile choice. If we have too much data,
we can always fetch their random samples
(this is what statistics is for) or pre-aggregate the information
on the server side. This should be sufficient for most
intermediate-level users.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="510-text.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">14. </span>Text data</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="430-group-by.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">12. </span>Processing data in groups</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2023 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2023-11-10T10:59:52+1100.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">13. Accessing databases</a><ul>
<li><a class="reference internal" href="#example-database">13.1. Example database</a></li>
<li><a class="reference internal" href="#exporting-data-to-a-database">13.2. Exporting data to a database</a></li>
<li><a class="reference internal" href="#exercises-on-sql-vs-pandas">13.3. Exercises on SQL vs <strong class="program">pandas</strong></a><ul>
<li><a class="reference internal" href="#filtering">13.3.1. Filtering</a></li>
<li><a class="reference internal" href="#ordering">13.3.2. Ordering</a></li>
<li><a class="reference internal" href="#removing-duplicates">13.3.3. Removing duplicates</a></li>
<li><a class="reference internal" href="#grouping-and-aggregating">13.3.4. Grouping and aggregating</a></li>
<li><a class="reference internal" href="#joining">13.3.5. Joining</a></li>
<li><a class="reference internal" href="#solutions-to-exercises">13.3.6. Solutions to exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#closing-the-database-connection">13.4. Closing the database connection</a></li>
<li><a class="reference internal" href="#common-data-serialisation-formats-for-the-web">13.5. Common data serialisation formats for the Web</a></li>
<li><a class="reference internal" href="#working-with-many-files">13.6. Working with many files</a><ul>
<li><a class="reference internal" href="#file-paths">13.6.1. File paths</a></li>
<li><a class="reference internal" href="#file-search">13.6.2. File search</a></li>
<li><a class="reference internal" href="#exception-handling">13.6.3. Exception handling</a></li>
<li><a class="reference internal" href="#file-connections">13.6.4. File connections (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">13.7. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=32b344a2"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/proof.js"></script>
    </body>
</html>