<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>11. Handling Categorical Data &mdash; Minimalist Data Wrangling with Python by Marek Gagolewski</title>
  

  
  
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/420-categorical.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="12. Processing Data in Groups" href="430-group-by.html" />
    <link rel="prev" title="10. Introducing Data Frames" href="410-data-frame.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Minimalist Data Wrangling with Python [v0.5.2]
          

          
          </a>

          <div class="version">
          by <a style="color: inherit" href="https://www.gagolewski.com">Marek Gagolewski</a>
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar Types and Control Structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and Other Types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional Numeric Data and Their Empirical Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing Unidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous Probability Distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. Multidimensional Numeric Data at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing Multidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring Relationships Between Variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="410-data-frame.html">10. Introducing Data Frames</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Handling Categorical Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#representing-and-generating-categorical-data">11.1. Representing and Generating Categorical Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#encoding-and-decoding-factors">11.1.1. Encoding and Decoding Factors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#categorical-data-in-pandas">11.1.2. Categorical Data in <strong class="program">pandas</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-data-and-logical-vectors">11.1.3. Binary Data and Logical Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-hot-encoding">11.1.4. One-Hot Encoding (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binning-numeric-data-revisited">11.1.5. Binning Numeric Data (Revisited)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-pseudorandom-labels">11.1.6. Generating Pseudorandom Labels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#frequency-distributions">11.2. Frequency Distributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#counting">11.2.1. Counting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-way-contingency-tables-factor-combinations">11.2.2. Two-Way Contingency Tables: Factor Combinations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combinations-of-even-more-factors">11.2.3. Combinations of Even More Factors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualising-factors">11.3. Visualising Factors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bar-plots">11.3.1. Bar Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#political-marketing-and-statistics">11.3.2. Political Marketing and Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pie-cha-don-t-even-trip">11.3.3. Pie Cha… Don’t Even Trip</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pareto-charts">11.3.4. Pareto Charts (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#heat-maps">11.3.5. Heat Maps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#aggregating-and-comparing-factors">11.4. Aggregating and Comparing Factors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-mode">11.4.1. A Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-data-as-logical-vectors">11.4.2. Binary Data as Logical Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pearson-s-chi-squared-test">11.4.3. Pearson’s Chi-Squared Test (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-sample-pearson-s-chi-squared-test">11.4.4. Two-Sample Pearson’s Chi-Squared Test (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measuring-association">11.4.5. Measuring Association (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binned-numeric-data">11.4.6. Binned Numeric Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ordinal-data">11.4.7. Ordinal Data (*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">11.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing Data in Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">13. Accessing Databases (An Interlude)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Data Types</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">14. Text Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-missingness.html">15. Missing, Censored, and Questionable Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">Report Bugs or Typos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching_data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com">Author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minimalist Data Wrangling with Python [v0.5.2]</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">11. </span>Handling Categorical Data</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        
        <a class="github-button" href="https://github.com/gagolews/datawranglingpy" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star gagolews/datawranglingpy on GitHub">Star</a>
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="430-group-by.html" class="btn btn-neutral float-right" title="12. Processing Data in Groups" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="410-data-frame.html" class="btn btn-neutral float-left" title="10. Introducing Data Frames" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="handling-categorical-data">
<span id="chap-categorical"></span><h1><span class="section-number">11. </span>Handling Categorical Data<a class="headerlink" href="#handling-categorical-data" title="Permalink to this headline"></a></h1>
<blockquote>
<div><p><em>The online version of the open access textbook</em> Minimalist Data
Wrangling with Python <em>by <a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>).
Any <a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">bug/typos reports/fixes</a>
are appreciated. Although available online, this is a whole course,
and should be read from the beginning to the end. In particular,
refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em></p>
</div></blockquote>
<p>So far we have been mostly dealing with <em>quantitative</em> (numeric) data –
real numbers on which we can apply various mathematical operations,
such as computing the arithmetic mean or taking the square thereof.
Of course, not every transformation thereof must always make sense in every
context (e.g., multiplying temperatures – what does it mean
when we say that it is twice as hot today as compared to yesterday?),
but still, the possibilities were plenty.</p>
<p><em>Qualitative</em> data (also known as categorical data, factors,
enumerated types), on the other hand, take a small number of unique values
and support a very limited set of admissible operations.
Usually, we can only determine
where two entities are equal to each other or not (think: eye colour,
blood type, or a flag whether a patient is ill).</p>
<p>In datasets involving many features, which we shall cover
in <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>, categorical variables
are often used for observation <em>grouping</em> (e.g., so that
we can compute the best and average time for marathoners in
each age category or draw box plots for finish times of
men and women separately). Also, they may serve as
target variables in statistical classification tasks
(e.g., so that we can determine if an email is “spam” or “not spam”).</p>
<p>Also, sometimes we might additionally be able to <em>rank</em> the
observations (Australian school grades are <em>linearly ordered</em>
like F (fail) &lt; P (pass) &lt; C (credit) &lt; D (distinction) &lt; HD
(high distinction), some questionnaires use Likert-type scales such as
“strongly disagree” &lt; “disagree” &lt; “neutral” &lt; “agree” &lt; “strongly agree”, etc.).</p>
<div class="section" id="representing-and-generating-categorical-data">
<h2><span class="section-number">11.1. </span>Representing and Generating Categorical Data<a class="headerlink" href="#representing-and-generating-categorical-data" title="Permalink to this headline"></a></h2>
<p>Common ways to represent a categorical variable
with <em>l</em> distinct levels <span class="math notranslate nohighlight">\(\{L_1,L_2,\dots,L_l\}\)</span>
is by storing it as:</p>
<ul class="simple">
<li><p>a vector of strings,</p></li>
<li><p>a vector of integers between 0 (inclusive) and <em>l</em> (exclusive).</p></li>
</ul>
<p>These two are easily interchangeable.</p>
<p>Furthermore, for <span class="math notranslate nohighlight">\(l=2\)</span> (binary data), another convenient representation
is by means of logical vectors. This can be extended to a so-called
one-hot encoded representation using a logical vector of length <em>l</em>.</p>
<div style="margin-top: 1em"></div><p>Let us consider the data on the original whereabouts of the top
16 marathoners (the 37th PZU Warsaw Marathon dataset):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/37_pzu_warsaw_marathon_simplified.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">cntrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;country&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="n">cntrs16</span> <span class="o">=</span> <span class="n">cntrs</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">cntrs16</span>
<span class="c1">## array([&#39;KE&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;PL&#39;, &#39;IL&#39;,</span>
<span class="c1">##        &#39;PL&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;PL&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>These are two-letter ISO 3166 country codes,
encoded of course as strings (note the <code class="docutils literal notranslate"><span class="pre">dtype=&quot;str&quot;</span></code> argument).</p>
<p>Calling <strong class="command">numpy.unique</strong> allows us to determine
the set of distinct categories:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">)</span>
<span class="n">cat_cntrs16</span>
<span class="c1">## array([&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>Hence, <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> is a categorical vector of length <em>n</em>=16
(<strong class="command">len</strong><code class="code docutils literal notranslate"><span class="pre">(cntrs16)</span></code>)
with data assuming one of <span class="math notranslate nohighlight">\(l=5\)</span> different levels
(<strong class="command">len</strong><code class="code docutils literal notranslate"><span class="pre">(cat_cntrs16)</span></code>).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong class="command">numpy.unique</strong> sorts the distinct values lexicographically.
In other words, they are not listed in the order of appearance,
which might be something desirable in certain contexts.</p>
</div>
<div class="section" id="encoding-and-decoding-factors">
<h3><span class="section-number">11.1.1. </span>Encoding and Decoding Factors<a class="headerlink" href="#encoding-and-decoding-factors" title="Permalink to this headline"></a></h3>
<p>In order to <em>encode</em> a label vector through a set of consecutive nonnegative
integers, we pass the <code class="docutils literal notranslate"><span class="pre">return_inverse=True</span></code> argument
to <strong class="command">numpy.unique</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span><span class="p">,</span> <span class="n">codes_cntrs16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cat_cntrs16</span>
<span class="c1">## array([&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
<span class="n">codes_cntrs16</span>
<span class="c1">## array([2, 2, 2, 0, 2, 2, 0, 3, 4, 4, 1, 4, 2, 2, 4, 4])</span>
</pre></div>
</div>
<p>Note that the code sequence 2, 2, 2, 0, …
corresponds to the 3rd, 3rd, 3rd, 1st, … level in <code class="docutils literal notranslate"><span class="pre">cat_cntrs16</span></code>,
i.e., Kenya, Kenya, Kenya, Ethiopia, ….</p>
<p>The values between <span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(l-1=4\)</span> can be used to index a given array
of length <span class="math notranslate nohighlight">\(l=5\)</span>. Hence, in order to <em>decode</em> our factor, we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span><span class="p">[</span><span class="n">codes_cntrs16</span><span class="p">]</span>
<span class="c1">## array([&#39;KE&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;PL&#39;, &#39;IL&#39;,</span>
<span class="c1">##        &#39;PL&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;PL&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>We can use any other set of labels now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;Ethiopia&quot;</span><span class="p">,</span> <span class="s2">&quot;Israel&quot;</span><span class="p">,</span> <span class="s2">&quot;Kenya&quot;</span><span class="p">,</span> <span class="s2">&quot;Morocco&quot;</span><span class="p">,</span> <span class="s2">&quot;Poland&quot;</span><span class="p">])[</span><span class="n">codes_cntrs16</span><span class="p">]</span>
<span class="c1">## array([&#39;Kenya&#39;, &#39;Kenya&#39;, &#39;Kenya&#39;, &#39;Ethiopia&#39;, &#39;Kenya&#39;, &#39;Kenya&#39;,</span>
<span class="c1">##        &#39;Ethiopia&#39;, &#39;Morocco&#39;, &#39;Poland&#39;, &#39;Poland&#39;, &#39;Israel&#39;, &#39;Poland&#39;,</span>
<span class="c1">##        &#39;Kenya&#39;, &#39;Kenya&#39;, &#39;Poland&#39;, &#39;Poland&#39;], dtype=&#39;&lt;U8&#39;)</span>
</pre></div>
</div>
<p>This is an instance of the <em>recoding</em> of a categorical variable.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Despite the fact that we can
<em>represent</em> categorical variables using a set of integers,
it does not mean that they become instances of a quantitative type.
Arithmetic operations thereon do not really make sense.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When we represent categorical data using numeric codes,
it is possible to introduce non-occurring levels.
Such information can be useful, e.g., we could explicitly
indicate that there were no runners from Australia in the top 16.</p>
</div>
<div class="proof proof-type-exercise" id="id3">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.1</span>
        
    </div><div class="proof-content">
<p>(**)
Determine the set of unique values
in <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> in the order of appearance (and not sorted lexicographically).
Then, encode <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> using this level set.</p>
<p><em>Hint: check out the <code class="docutils literal notranslate"><span class="pre">return_index</span></code> argument to <strong class="command">numpy.unique</strong>
and the <strong class="command">numpy.searchsorted</strong> function.</em></p>
</div></div></div>
<div class="section" id="categorical-data-in-pandas">
<h3><span class="section-number">11.1.2. </span>Categorical Data in <strong class="program">pandas</strong><a class="headerlink" href="#categorical-data-in-pandas" title="Permalink to this headline"></a></h3>
<p><strong class="program">pandas</strong> <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html">includes</a>
a special <code class="docutils literal notranslate"><span class="pre">dtype</span></code> for storing categorical data.
Namely, we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cntrs16_series</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">16</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">cntrs16_series</span>
<span class="c1">## 0     KE</span>
<span class="c1">## 1     KE</span>
<span class="c1">## 2     KE</span>
<span class="c1">## 3     ET</span>
<span class="c1">## 4     KE</span>
<span class="c1">## 5     KE</span>
<span class="c1">## 6     ET</span>
<span class="c1">## 7     MA</span>
<span class="c1">## 8     PL</span>
<span class="c1">## 9     PL</span>
<span class="c1">## 10    IL</span>
<span class="c1">## 11    PL</span>
<span class="c1">## 12    KE</span>
<span class="c1">## 13    KE</span>
<span class="c1">## 14    PL</span>
<span class="c1">## 15    PL</span>
<span class="c1">## Name: country, dtype: category</span>
<span class="c1">## Categories (5, object): [&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;]</span>
</pre></div>
</div>
<p>or, equivalently in our case, <code class="docutils literal notranslate"><span class="pre">pd.Series(cntrs16,</span> <span class="pre">dtype=&quot;category&quot;)</span></code>.
This yields a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object displayed as if it was represented
using string labels, however, in fact it is encoded using the numeric
representation. This can be revealed by accessing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cntrs16_series</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="c1">## array([2, 2, 2, 0, 2, 2, 0, 3, 4, 4, 1, 4, 2, 2, 4, 4], dtype=int8)</span>
<span class="n">cntrs16_series</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
<span class="c1">## Index([&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<p>exactly matching what we have obtained with <code class="docutils literal notranslate"><span class="pre">numpy.unique</span></code>.
Most often, however, categorical data in data frames will be stored
as ordinary strings.</p>
</div>
<div class="section" id="binary-data-and-logical-vectors">
<span id="sec-binary-logical"></span><h3><span class="section-number">11.1.3. </span>Binary Data and Logical Vectors<a class="headerlink" href="#binary-data-and-logical-vectors" title="Permalink to this headline"></a></h3>
<p><em>Binary data</em> is a special case of the qualitative setting,
where we only have two categories.</p>
<p>For convenience, we usually encode the two classes
as integers:</p>
<ul class="simple">
<li><p>0 (or logical <code class="docutils literal notranslate"><span class="pre">False</span></code>, e.g., healthy/fail/off/non-spam/absent/…) and</p></li>
<li><p>1 (or <code class="docutils literal notranslate"><span class="pre">True</span></code>, e.g., ill/success/on/spam/present/…).</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When converting
logical to numeric, <code class="docutils literal notranslate"><span class="pre">False</span></code> becomes 0 and <code class="docutils literal notranslate"><span class="pre">True</span></code> becomes 1.
Conversely, 0 is converted to <code class="docutils literal notranslate"><span class="pre">False</span></code> and anything else (including -0.326)
to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1">## array([1, 0, 1, 1, 0])</span>
</pre></div>
</div>
<p>The other way around:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.326</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7643</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="c1">## array([ True,  True,  True, False,  True,  True,  True])</span>
</pre></div>
</div>
<p>or, equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.326</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7643</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="c1">## array([ True,  True,  True, False,  True,  True,  True])</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id4">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.2</span>
        
    </div><div class="proof-content">
<p>Given a numeric vector <code class="docutils literal notranslate"><span class="pre">x</span></code>, create a vector of the same length
as <code class="docutils literal notranslate"><span class="pre">x</span></code> whose <em>i</em>-th element is equal to <code class="docutils literal notranslate"><span class="pre">&quot;yes&quot;</span></code>
if <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> is in the unit interval and to <code class="docutils literal notranslate"><span class="pre">&quot;no&quot;</span></code> otherwise.
Use <strong class="command">numpy.where</strong>, which can act as a vectorised version
of the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p>
</div></div></div>
<div class="section" id="one-hot-encoding">
<h3><span class="section-number">11.1.4. </span>One-Hot Encoding (*)<a class="headerlink" href="#one-hot-encoding" title="Permalink to this headline"></a></h3>
<p>Let <span class="math notranslate nohighlight">\(\boldsymbol{x}\)</span> be vector of <em>n</em> integers in <span class="math notranslate nohighlight">\(\{0,...,l-1\}\)</span>.
Its <em>one-hot</em> encoded version is a 0-1 (or, equivalently, logical)
matrix <span class="math notranslate nohighlight">\(\mathbf{R}\)</span> of shape  <em>n</em> by <em>l</em>
such that <span class="math notranslate nohighlight">\(r_{i,j}=1\)</span> if and only if <span class="math notranslate nohighlight">\(x_i = j\)</span>.</p>
<p>For example, if <span class="math notranslate nohighlight">\(\boldsymbol{x}=(0, 1, 2, 1)\)</span> and <span class="math notranslate nohighlight">\(l=4\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{R} = \left[
\begin{array}{cccc}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
\end{array}
\right].
\end{split}\]</div>
<p>Such a representation is useful when solving
a multiclass classification problem by means of <em>l</em> binary classifiers.
For example, if <em>spam</em>, <em>bacon</em>, and <em>hot dogs</em> are on the menu,
then <em>spam</em> is encoded as <span class="math notranslate nohighlight">\((1, 0, 0)\)</span>, i.e.,
yeah-spam, nah-bacon, and nah-hot dog.
We can build three binary classifiers, each specialising
in telling whether what it encounters is a given food or something else.</p>
<div class="proof proof-type-example" id="id5">

    <div class="proof-title">
        <span class="proof-type">Example 11.3</span>
        
    </div><div class="proof-content">
<p>Write a function to one-hot encode a given categorical vector.</p>
</div></div><div class="proof proof-type-example" id="id6">

    <div class="proof-title">
        <span class="proof-type">Example 11.4</span>
        
    </div><div class="proof-content">
<p>Write a function to decode a one-hot encoded matrix.</p>
</div></div></div>
<div class="section" id="binning-numeric-data-revisited">
<span id="sec-binning"></span><h3><span class="section-number">11.1.5. </span>Binning Numeric Data (Revisited)<a class="headerlink" href="#binning-numeric-data-revisited" title="Permalink to this headline"></a></h3>
<p>Numerical data can be converted to categorical via
binning (quantisation). This results in information (precision) loss,
however, it also opens some new possibilities. In fact, this is what we needed
to do in order to draw all the histograms in <a class="reference internal" href="210-vector.html#chap-vector"><span class="std std-numref">Chapter 4</span></a>.
Also, reporting observation counts in each bin instead of raw data
enables us to include them in printed reports (in the form of tables).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As strong proponents of openness and transparency,
we always encourage all entities (governments, universities,
non-for-profits, corporations, etc.)
to share (e.g., under the Creative Commons CC-BY-SA-4.0 license)
unabridged versions of their datasets to enable public scrutiny
and getting the most of the possibilities they can bring for
the public good.</p>
<p>Of course, sometimes the sharing of unprocessed information
can violate the privacy of the subjects. In such a case,
it might be a good idea to communicate them in a binned form.</p>
</div>
<p>Consider the 16 best marathon finish times (in minutes):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mins</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;mins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">mins16</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">mins16</span>
<span class="c1">## array([129.32, 130.75, 130.97, 134.17, 134.68, 135.97, 139.88, 143.2 ,</span>
<span class="c1">##        145.22, 145.92, 146.83, 147.8 , 149.65, 149.88, 152.65, 152.88])</span>
</pre></div>
</div>
<p><strong class="command">numpy.searchsorted</strong> can be used to determine
the interval where each value in <code class="docutils literal notranslate"><span class="pre">mins</span></code> falls.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">150</span><span class="p">]</span>
<span class="n">codes_mins16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">mins16</span><span class="p">)</span>
<span class="n">codes_mins16</span>
<span class="c1">## array([0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3])</span>
</pre></div>
</div>
<p>By default, the intervals are of the form <em>(a, b]</em> (not including
<em>a</em>, including <em>b</em>).
Code 0 corresponds to values less than the first bin bound,
whereas code 3 – greater than or equal to the last bound:</p>
<p><strong class="command">pandas.cut</strong> us another interface to the same binning method.
It returns a vector-like object of <code class="docutils literal notranslate"><span class="pre">dtype</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;category&quot;</span></code>,
with very readable labels generated automatically
(and ordered, see <a class="reference internal" href="#sec-ordinal-data"><span class="std std-numref">Section 11.4.7</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cut_mins16</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">mins16</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]))</span>
<span class="n">cut_mins16</span>
<span class="c1">## 0      (-inf, 130.0]</span>
<span class="c1">## 1     (130.0, 140.0]</span>
<span class="c1">## 2     (130.0, 140.0]</span>
<span class="c1">## 3     (130.0, 140.0]</span>
<span class="c1">## 4     (130.0, 140.0]</span>
<span class="c1">## 5     (130.0, 140.0]</span>
<span class="c1">## 6     (130.0, 140.0]</span>
<span class="c1">## 7     (140.0, 150.0]</span>
<span class="c1">## 8     (140.0, 150.0]</span>
<span class="c1">## 9     (140.0, 150.0]</span>
<span class="c1">## 10    (140.0, 150.0]</span>
<span class="c1">## 11    (140.0, 150.0]</span>
<span class="c1">## 12    (140.0, 150.0]</span>
<span class="c1">## 13    (140.0, 150.0]</span>
<span class="c1">## 14      (150.0, inf]</span>
<span class="c1">## 15      (150.0, inf]</span>
<span class="c1">## dtype: category</span>
<span class="c1">## Categories (4, interval[float64, right]): [(-inf, 130.0] &lt; (130.0, 140.0] &lt; (140.0, 150.0] &lt;</span>
<span class="c1">##                                            (150.0, inf]]</span>
<span class="n">cut_mins16</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="c1">## Index([&#39;(-inf, 130.0]&#39;, &#39;(130.0, 140.0]&#39;, &#39;(140.0, 150.0]&#39;,</span>
<span class="c1">##        &#39;(150.0, inf]&#39;],</span>
<span class="c1">##       dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id7">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.5</span>
        
    </div><div class="proof-content">
<p>(*) Check out the <strong class="command">numpy.histogram_bin_edges</strong>
function which tries to determine some informative
interval bounds automatically based on a range of
simple heuristics.
Also, note that <strong class="command">numpy.linspace</strong> and <strong class="command">numpy.geomspace</strong>
which we have covered in <a class="reference internal" href="210-vector.html#chap-vector"><span class="std std-numref">Chapter 4</span></a>
can be useful for generating equidistant bounds
on linear and logarithmic scale, respectively.</p>
</div></div><div class="proof proof-type-example" id="id8">

    <div class="proof-title">
        <span class="proof-type">Example 11.6</span>
        
    </div><div class="proof-content">
<p>(**) We can create a set of the corresponding categories manually,
for example, as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">cat_mins16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">bins2</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bins2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins2</span><span class="p">))]</span>
<span class="p">)</span>
<span class="n">cat_mins16</span>
<span class="c1">## array([&#39;(-inf, 130.0]&#39;, &#39;(130.0, 140.0]&#39;, &#39;(140.0, 150.0]&#39;,</span>
<span class="c1">##        &#39;(150.0, inf]&#39;], dtype=&#39;&lt;U14&#39;)</span>
</pre></div>
</div>
<p>Recall from <a class="reference internal" href="220-transform-vector.html#sec-list-comprehension"><span class="std std-numref">Section 5.6.3</span></a> that
list comprehensions
are a convenient substitute for a <strong class="command">for</strong> loop and
the <strong class="command">list.append</strong> method. Recoding based on the above yields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_mins16</span><span class="p">[</span><span class="n">codes_mins16</span><span class="p">]</span>
<span class="c1">## array([&#39;(-inf, 130.0]&#39;, &#39;(130.0, 140.0]&#39;, &#39;(130.0, 140.0]&#39;,</span>
<span class="c1">##        &#39;(130.0, 140.0]&#39;, &#39;(130.0, 140.0]&#39;, &#39;(130.0, 140.0]&#39;,</span>
<span class="c1">##        &#39;(130.0, 140.0]&#39;, &#39;(140.0, 150.0]&#39;, &#39;(140.0, 150.0]&#39;,</span>
<span class="c1">##        &#39;(140.0, 150.0]&#39;, &#39;(140.0, 150.0]&#39;, &#39;(140.0, 150.0]&#39;,</span>
<span class="c1">##        &#39;(140.0, 150.0]&#39;, &#39;(140.0, 150.0]&#39;, &#39;(150.0, inf]&#39;,</span>
<span class="c1">##        &#39;(150.0, inf]&#39;], dtype=&#39;&lt;U14&#39;)</span>
</pre></div>
</div>
</div></div></div>
<div class="section" id="generating-pseudorandom-labels">
<span id="sec-random-choice"></span><h3><span class="section-number">11.1.6. </span>Generating Pseudorandom Labels<a class="headerlink" href="#generating-pseudorandom-labels" title="Permalink to this headline"></a></h3>
<p>It is worth knowing that
<strong class="command">numpy.random.choice</strong> allows us to create a pseudorandom sample
with categories picked with any probabilities:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
    <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;tempeh&quot;</span><span class="p">],</span>
    <span class="n">p</span><span class="o">=</span><span class="p">[</span>   <span class="mf">0.7</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">0.15</span><span class="p">,</span>     <span class="mf">0.05</span><span class="p">],</span>
    <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">16</span>
<span class="p">)</span>
<span class="c1">## array([&#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;tempeh&#39;, &#39;spam&#39;,</span>
<span class="c1">##        &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;bacon&#39;],</span>
<span class="c1">##       dtype=&#39;&lt;U6&#39;)</span>
</pre></div>
</div>
<p>Hence, if we generate a sufficiently large sample,
we will expect <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code> to occur ca. 70% times, and <code class="docutils literal notranslate"><span class="pre">&quot;tempeh&quot;</span></code>
to be drawn in 5% of the cases, etc.</p>
</div>
</div>
<div class="section" id="frequency-distributions">
<h2><span class="section-number">11.2. </span>Frequency Distributions<a class="headerlink" href="#frequency-distributions" title="Permalink to this headline"></a></h2>
<div class="section" id="counting">
<h3><span class="section-number">11.2.1. </span>Counting<a class="headerlink" href="#counting" title="Permalink to this headline"></a></h3>
<p>For arbitrary categorical data, we can call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span><span class="p">,</span> <span class="n">counts_cntrs16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cat_cntrs16</span><span class="p">,</span> <span class="n">counts_cntrs16</span>
<span class="c1">## (array([&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;), array([2, 1, 7, 1, 5]))</span>
</pre></div>
</div>
<p>to get both the set of unique categories and
the <em>corresponding</em> number of occurrences.
For instance, there were 7 runners from Kenya amongst the top 16.</p>
<p>Also, note that if we <em>already</em> have an array of integer codes between
<span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(l-1\)</span>, there is no need to call <strong class="command">numpy.unique</strong>,
as <strong class="command">numpy.bincount</strong> can return the number of
times each code appears therein.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">codes_cntrs16</span><span class="p">)</span>
<span class="c1">## array([2, 1, 7, 1, 5])</span>
</pre></div>
</div>
<p>Of course, a vector of counts can easily be turned into
a vector of proportions (fractions):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts_cntrs16</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts_cntrs16</span><span class="p">)</span>
<span class="c1">## array([0.125 , 0.0625, 0.4375, 0.0625, 0.3125])</span>
</pre></div>
</div>
<p>Hence, almost 31.25% of the top runners were from Poland
(it is a marathon in Warsaw after all…).
Note that we can of course multiply the above by 100 to get the percentages.</p>
<p>We can output a nice <em>frequency table</em> by storing both objects
in a single data frame (or a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object with an appropriate
vector of row labels):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;Country&quot;</span><span class="p">:</span> <span class="n">cat_cntrs16</span><span class="p">,</span>
    <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">counts_cntrs16</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts_cntrs16</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">table</span>
<span class="c1">##   Country      %</span>
<span class="c1">## 0      ET  12.50</span>
<span class="c1">## 1      IL   6.25</span>
<span class="c1">## 2      KE  43.75</span>
<span class="c1">## 3      MA   6.25</span>
<span class="c1">## 4      PL  31.25</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id9">

    <div class="proof-title">
        <span class="proof-type">Example 11.7</span>
        
    </div><div class="proof-content">
<p>(*)
In <a class="reference internal" href="510-text.html#sec-format-output"><span class="std std-numref">Section 14.3</span></a> we will discuss
<strong class="command">IPython.display.Markdown</strong> as a means to
embed arbitrary Markdown code inside IPython/Jupyter reports.
In the meantime, let us just note that nicely formatted
tables can be created from data frames by calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Country</p></th>
<th class="text-align:right head"><p>%</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>ET</p></td>
<td class="text-align:right"><p>12.5</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>IL</p></td>
<td class="text-align:right"><p>6.25</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>KE</p></td>
<td class="text-align:right"><p>43.75</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>MA</p></td>
<td class="text-align:right"><p>6.25</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>PL</p></td>
<td class="text-align:right"><p>31.25</p></td>
</tr>
</tbody>
</table>
</div></div><p><strong class="command">pandas.Series.value_counts</strong> is even more convenient,
as it returns a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object equipped with a readable index
(element labels):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">16</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1">## KE    7</span>
<span class="c1">## PL    5</span>
<span class="c1">## ET    2</span>
<span class="c1">## MA    1</span>
<span class="c1">## IL    1</span>
<span class="c1">## Name: country, dtype: int64</span>
</pre></div>
</div>
<p>Note that by default data are ordered with respect to the counts,
decreasingly.</p>
<div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.8</span>
        
    </div><div class="proof-content">
<p>In <a class="reference internal" href="210-vector.html#chap-vector"><span class="std std-numref">Chapter 4</span></a>
we have mentioned the <strong class="command">numpy.histogram</strong> function which applies the
binning of a numeric vector and then counts the number
of occurrences.
This is merely a helper function: the same result can be obtained
by means of the more basic
<strong class="command">numpy.searchsorted</strong>, <strong class="command">numpy.bincount</strong>,
and <strong class="command">numpy.histogram_bin_edges</strong>.
Apply <strong class="command">numpy.histogram</strong>
on the whole <code class="docutils literal notranslate"><span class="pre">37_pzu_warsaw_marathon_mins</span></code> dataset.</p>
</div></div><div class="proof proof-type-exercise" id="id11">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.9</span>
        
    </div><div class="proof-content">
<p>Using <strong class="command">numpy.argsort</strong>, sort
<code class="docutils literal notranslate"><span class="pre">counts_cntrs16</span></code> increasingly
together with the corresponding items in <code class="docutils literal notranslate"><span class="pre">cat_cntrs16</span></code>.</p>
</div></div></div>
<div class="section" id="two-way-contingency-tables-factor-combinations">
<span id="sec-contingency-two"></span><h3><span class="section-number">11.2.2. </span>Two-Way Contingency Tables: Factor Combinations<a class="headerlink" href="#two-way-contingency-tables-factor-combinations" title="Permalink to this headline"></a></h3>
<p>Some datasets may feature many categorical columns,
each having possibly different levels.
Let us now consider the whole <code class="docutils literal notranslate"><span class="pre">marathon</span></code> dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># first two chars</span>
<span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">marathon</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="s2">&quot;60&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;60+&quot;</span>  <span class="c1"># too few runners aged 70+</span>
<span class="n">marathon</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">]]</span>
<span class="n">marathon</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1">##   sex age country</span>
<span class="c1">## 0   M  20      KE</span>
<span class="c1">## 1   M  20      KE</span>
<span class="c1">## 2   M  20      KE</span>
<span class="c1">## 3   M  20      ET</span>
<span class="c1">## 4   M  30      KE</span>
</pre></div>
</div>
<p>The three columns are: sex, age (in 10-year brackets), and country.
We can of course analyse the data distribution
in each column individually,
however, some interesting patterns might also arise when we study the
<em>combinations</em> of levels of different variables.</p>
<p>Here are the levels of the sex and age variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;sex&quot;</span><span class="p">])</span>
<span class="c1">## array([&#39;F&#39;, &#39;M&#39;], dtype=object)</span>
<span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="c1">## array([&#39;20&#39;, &#39;30&#39;, &#39;40&#39;, &#39;50&#39;, &#39;60+&#39;], dtype=object)</span>
</pre></div>
</div>
<p>We thus have 10 different possible combinations thereof.</p>
<p>A two-way <em>contingency table</em> is a matrix which gives
the number of occurrences of each pair of values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">v</span>
<span class="c1">## age   20    30    40   50  60+</span>
<span class="c1">## sex                           </span>
<span class="c1">## F    240   449   262   43   19</span>
<span class="c1">## M    879  2200  1708  541  170</span>
</pre></div>
</div>
<p>Hence, for example, there were 19 women aged 60 and over
amongst the marathoners. Nice.</p>
<p>Note that the <em>marginal</em> (one dimensional) frequency distributions
can be recreated by computing the rowwise and columnwise sums.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## sex</span>
<span class="c1">## F    1013</span>
<span class="c1">## M    5498</span>
<span class="c1">## dtype: int64</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## age</span>
<span class="c1">## 20     1119</span>
<span class="c1">## 30     2649</span>
<span class="c1">## 40     1970</span>
<span class="c1">## 50      584</span>
<span class="c1">## 60+     189</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
</div>
<div class="section" id="combinations-of-even-more-factors">
<h3><span class="section-number">11.2.3. </span>Combinations of Even More Factors<a class="headerlink" href="#combinations-of-even-more-factors" title="Permalink to this headline"></a></h3>
<p><strong class="command">pandas.DataFrame.value_counts</strong> can also be used
with a combination of more than 2 categorical variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span>\
    <span class="n">rename</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##     sex  age country  count</span>
<span class="c1">## 0     M   30      PL   2081</span>
<span class="c1">## 1     M   40      PL   1593</span>
<span class="c1">## 2     M   20      PL    824</span>
<span class="c1">## 3     M   50      PL    475</span>
<span class="c1">## 4     F   30      PL    422</span>
<span class="c1">## ..   ..  ...     ...    ...</span>
<span class="c1">## 189   M   30      SI      1</span>
<span class="c1">## 190   F  60+      EE      1</span>
<span class="c1">## 191   F  60+      FI      1</span>
<span class="c1">## 192   M   30      PE      1</span>
<span class="c1">## 193   F   20      BE      1</span>
<span class="c1">## </span>
<span class="c1">## [194 rows x 4 columns]</span>
</pre></div>
</div>
<p>Of course, the display will be in the <em>long</em> format
(compare <a class="reference internal" href="410-data-frame.html#sec-stack"><span class="std std-numref">Section 10.6.2</span></a>) here, as high-dimensional
arrays are not nicely printable.</p>
</div>
</div>
<div class="section" id="visualising-factors">
<h2><span class="section-number">11.3. </span>Visualising Factors<a class="headerlink" href="#visualising-factors" title="Permalink to this headline"></a></h2>
<p>Methods for visualising categorical data are by no means
fascinating (unless we use them as grouping variables in more complex
datasets, but this is a topic that we cover in <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>).</p>
<div class="section" id="bar-plots">
<h3><span class="section-number">11.3.1. </span>Bar Plots<a class="headerlink" href="#bar-plots" title="Permalink to this headline"></a></h3>
<p>Bar plots are self-explanatory and hence
will do the trick most of the time, see <a class="reference internal" href="#fig-bar-country"><span class="std std-numref">Figure 11.1</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat_cntrs16</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">counts_cntrs16</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">cat_cntrs16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id12">
<span id="fig-bar-country"></span><img alt="../_images/bar-country-1.png" src="../_images/bar-country-1.png" />
<p class="caption"><span class="caption-number">Figure 11.1 </span><span class="caption-text">Bar plot for the top 16 marathoners’ countries</span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ind</span></code> vector gives the x-coordinates of the bars,
here: consecutive integers.
By calling <strong class="command">matplotlib.pyplot.xticks</strong>
we assign them readable labels.</p>
<div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.10</span>
        
    </div><div class="proof-content">
<p>Assign a different colour to each bar.</p>
</div></div><div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.11</span>
        
    </div><div class="proof-content">
<p>Draw a bar plot which features percentages instead
of counts, so that the total bar height is 100%.</p>
</div></div><div class="proof proof-type-exercise" id="id15">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.12</span>
        
    </div><div class="proof-content">
<p>Print the frequency table and draw a bar plot for the top 100 marathoners’ countries.</p>
</div></div><div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.13</span>
        
    </div><div class="proof-content">
<p>(*) Print the frequency table and draw a bar plot all the marathoners
(not just the elite ones), ordered from the highest to the lowest counts.
There will be too many bars, therefore replace the few last bars
with a single one, labelled “All other”.</p>
</div></div><div style="margin-top: 1em"></div><p>A bar plot is a versatile tool for visualising
the counts also in the two-variable case, see
<a class="reference internal" href="#fig-bar-age-sex"><span class="std std-numref">Figure 11.2</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span>\
    <span class="n">rename</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id17">
<span id="fig-bar-age-sex"></span><img alt="../_images/bar-age-sex-3.png" src="../_images/bar-age-sex-3.png" />
<p class="caption"><span class="caption-number">Figure 11.2 </span><span class="caption-text">Number of runners by age category and sex</span><a class="headerlink" href="#id17" title="Permalink to this image"></a></p>
</div>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.14</span>
        
    </div><div class="proof-content">
<p>(*) Draw a similar chart using <strong class="command">matplotlib.pyplot.bar</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id19">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.15</span>
        
    </div><div class="proof-content">
<p>(**)
Create a stacked bar plot similar to the one
in <a class="reference internal" href="#fig-stacked-bar"><span class="std std-numref">Figure 11.3</span></a>, where we have horizontal bars for
data that have been normalised so that for each sex their sum is 100%.</p>
<div class="figure align-default" id="id20">
<span id="fig-stacked-bar"></span><img alt="../_images/stacked-bar-5.png" src="../_images/stacked-bar-5.png" />
<p class="caption"><span class="caption-number">Figure 11.3 </span><span class="caption-text">Example stacked bar plot: Age distribution for different sexes amongst all the runners</span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</div>
</div></div></div>
<div class="section" id="political-marketing-and-statistics">
<span id="sec-political-marketing"></span><h3><span class="section-number">11.3.2. </span>Political Marketing and Statistics<a class="headerlink" href="#political-marketing-and-statistics" title="Permalink to this headline"></a></h3>
<p>Even such a simple plot can be manipulated.
For example, presidential elections were held in Poland in 2020.
In the second round, Andrzej Duda had won against
Rafał Trzaskowski. In <a class="reference internal" href="#fig-wybory1"><span class="std std-numref">Figure 11.4</span></a> we have the official results
that might be presented
by one of the infamous Polish TV conglomerate:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mf">51.03</span><span class="p">,</span> <span class="mf">48.97</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Duda&quot;</span><span class="p">,</span> <span class="s2">&quot;Trzaskowski&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">48.9</span><span class="p">,</span> <span class="mf">51.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id21">
<span id="fig-wybory1"></span><img alt="../_images/wybory1-7.png" src="../_images/wybory1-7.png" />
<p class="caption"><span class="caption-number">Figure 11.4 </span><span class="caption-text">Flawless victory!</span><a class="headerlink" href="#id21" title="Permalink to this image"></a></p>
</div>
<p>Such a great victory! Wait… it was a close vote after all!
We should just take a look at the y-axis tick marks.</p>
<p>Another media outlet could have reported it like in <a class="reference internal" href="#fig-wybory2"><span class="std std-numref">Figure 11.5</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mf">51.03</span><span class="p">,</span> <span class="mf">48.97</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Duda&quot;</span><span class="p">,</span> <span class="s2">&quot;Trzaskowski&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id22">
<span id="fig-wybory2"></span><img alt="../_images/wybory2-9.png" src="../_images/wybory2-9.png" />
<p class="caption"><span class="caption-number">Figure 11.5 </span><span class="caption-text">It was a draw, so close!</span><a class="headerlink" href="#id22" title="Permalink to this image"></a></p>
</div>
<p>The moral of the story is:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Always read the y-axis tick marks.
And when drawing own bar plots, do not trick the reader;
this is unethical.</p>
</div>
</div>
<div class="section" id="pie-cha-don-t-even-trip">
<h3><span class="section-number">11.3.3. </span>Pie Cha… Don’t Even Trip<a class="headerlink" href="#pie-cha-don-t-even-trip" title="Permalink to this headline"></a></h3>
<p>We are definitely not going to discuss the infamous
pie charts, because
their use in data analysis has been widely criticised for a long time
(it is difficult to judge the ratios of areas of their slices).
Case closed.
Good morning.</p>
</div>
<div class="section" id="pareto-charts">
<h3><span class="section-number">11.3.4. </span>Pareto Charts (*)<a class="headerlink" href="#pareto-charts" title="Permalink to this headline"></a></h3>
<p>As a general (empirical) rule, it is usually the case
that most instances of something’s happening (usually 70–90%)
are due to only few causes (10–30%). This is known as the <em>Pareto rule</em>
(with 80% vs 20% being an often cited rule of thumb).</p>
<div class="proof proof-type-example" id="id23">

    <div class="proof-title">
        <span class="proof-type">Example 11.16</span>
        
    </div><div class="proof-content">
<p>In <a class="reference internal" href="230-distribution.html#chap-distribution"><span class="std std-numref">Chapter 6</span></a> we modelled
the US cities’ population dataset using the Pareto distribution
(the very same Pareto, but a different, yet related object).
We discovered that only ca. 14% of the settlements (those
with 10,000 or more inhabitants) is home to as much as
84% of the population. Hence, we may say that this data domain
follows the Pareto rule.</p>
</div></div><p>Here is a <a class="reference external" href="https://www.cec.health.nsw.gov.au/CEC-Academy/quality-improvement-tools/pareto-charts">dataset</a> fabricated by the
Clinical Excellence Commission in New South Wales, Australia,
listing the most frequent causes for medication errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="s2">&quot;Unauthorised drug&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong IV rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong patient&quot;</span><span class="p">,</span> <span class="s2">&quot;Dose missed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Underdose&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong calculation&quot;</span><span class="p">,</span><span class="s2">&quot;Wrong route&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong drug&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Wrong time&quot;</span><span class="p">,</span> <span class="s2">&quot;Technique error&quot;</span><span class="p">,</span> <span class="s2">&quot;Duplicated drugs&quot;</span><span class="p">,</span> <span class="s2">&quot;Overdose&quot;</span>
<span class="p">])</span>
<span class="n">counts_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">59</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts_med</span><span class="p">)</span>  <span class="c1"># total number of medication errors</span>
<span class="c1">## 430</span>
</pre></div>
</div>
<p>Let us order the dataset with respect to the counts, decreasingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">counts_med</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># ordering permutation (decreasing)</span>
<span class="n">cat_med</span> <span class="o">=</span> <span class="n">cat_med</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>  <span class="c1"># order categories based on counts</span>
<span class="n">counts_med</span> <span class="o">=</span> <span class="n">counts_med</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>  <span class="c1"># equivalent to np.sort(counts_med)[::-1]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">category</span><span class="o">=</span><span class="n">cat_med</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="n">counts_med</span>
<span class="p">))</span>  <span class="c1"># nicer display</span>
<span class="c1">##              category  count</span>
<span class="c1">## 0         Dose missed     92</span>
<span class="c1">## 1          Wrong time     83</span>
<span class="c1">## 2          Wrong drug     76</span>
<span class="c1">## 3            Overdose     59</span>
<span class="c1">## 4       Wrong patient     53</span>
<span class="c1">## 5         Wrong route     27</span>
<span class="c1">## 6   Wrong calculation     16</span>
<span class="c1">## 7    Duplicated drugs      9</span>
<span class="c1">## 8           Underdose      7</span>
<span class="c1">## 9       Wrong IV rate      4</span>
<span class="c1">## 10    Technique error      3</span>
<span class="c1">## 11  Unauthorised drug      1</span>
</pre></div>
</div>
<p>Pareto charts are tools which may aid
in visualising the Pareto-ruled datasets.
They are based on bar plots, but feature some extras:</p>
<ul class="simple">
<li><p>bars are listed in a decreasing order,</p></li>
<li><p>the cumulative percentage curve is added.</p></li>
</ul>
<p>The plotting of the Pareto chart is a little tricky,
because it involves using two different Y axes
(as usual, fine-tuning of the figure and studying the manual
of the <strong class="program">matplotlib</strong> package is left as an exercise.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat_med</span><span class="p">))</span>  <span class="c1"># 0, 1, 2, ...</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">100.0</span><span class="o">*</span><span class="n">counts_med</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts_med</span><span class="p">)</span>  <span class="c1"># percentages</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cat_med</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># creates a new coordinate system with a shared x-axis</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;ro-&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cumulative %&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id24">
<span id="fig-pareto-chart"></span><img alt="../_images/pareto-chart-11.png" src="../_images/pareto-chart-11.png" />
<p class="caption"><span class="caption-number">Figure 11.6 </span><span class="caption-text">The most frequent causes for medication errors</span><a class="headerlink" href="#id24" title="Permalink to this image"></a></p>
</div>
<p>From <a class="reference internal" href="#fig-pareto-chart"><span class="std std-numref">Figure 11.6</span></a>, we can read that 5 causes
(less than 40%) correspond to ca. 85% of the medication errors.
More precisely,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">cat_med</span><span class="p">,</span>
    <span class="s2">&quot;cumulative %&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">})</span>
<span class="c1">##              category  cumulative %</span>
<span class="c1">## 0         Dose missed          21.4</span>
<span class="c1">## 1          Wrong time          40.7</span>
<span class="c1">## 2          Wrong drug          58.4</span>
<span class="c1">## 3            Overdose          72.1</span>
<span class="c1">## 4       Wrong patient          84.4</span>
<span class="c1">## 5         Wrong route          90.7</span>
<span class="c1">## 6   Wrong calculation          94.4</span>
<span class="c1">## 7    Duplicated drugs          96.5</span>
<span class="c1">## 8           Underdose          98.1</span>
<span class="c1">## 9       Wrong IV rate          99.1</span>
<span class="c1">## 10    Technique error          99.8</span>
<span class="c1">## 11  Unauthorised drug         100.0</span>
</pre></div>
</div>
<p>Note that there is an explicit assumption here that
a single error is only due to a single cause.
Also, we presume that each medication error has a similar degree of
severity.</p>
<p>Policy makers and quality controllers often rely on such simplifications,
therefore they most probably are going to be addressing only the
top causes. If we have ever wondered why some processes (mal)function the way
they do, there is a hint above. However, coming up with something
more effective yet so simple at the same time requires much more effort.</p>
</div>
<div class="section" id="heat-maps">
<h3><span class="section-number">11.3.5. </span>Heat Maps<a class="headerlink" href="#heat-maps" title="Permalink to this headline"></a></h3>
<p>Two-way contingency tables can be depicted by means of a heatmap,
where each count affects the corresponding cell’s colour intensity,
see <a class="reference internal" href="#fig-heat-map-marathon"><span class="std std-numref">Figure 11.7</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;copper&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id25">
<span id="fig-heat-map-marathon"></span><img alt="../_images/heat-map-marathon-13.png" src="../_images/heat-map-marathon-13.png" />
<p class="caption"><span class="caption-number">Figure 11.7 </span><span class="caption-text">Heatmap for the marathoners’ sex and age category</span><a class="headerlink" href="#id25" title="Permalink to this image"></a></p>
</div>
</div>
</div>
<div class="section" id="aggregating-and-comparing-factors">
<h2><span class="section-number">11.4. </span>Aggregating and Comparing Factors<a class="headerlink" href="#aggregating-and-comparing-factors" title="Permalink to this headline"></a></h2>
<div class="section" id="a-mode">
<h3><span class="section-number">11.4.1. </span>A Mode<a class="headerlink" href="#a-mode" title="Permalink to this headline"></a></h3>
<p>As we have already said, the only operation on categorical data
that we can rely on is counting (because we have
an equivalence relation on the set of labels and nothing more).
Therefore, as far as qualitative data aggregation is concerned,
what we are with left is the <em>mode</em>, i.e., the most frequently
occurring value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span><span class="p">,</span> <span class="n">counts_cntrs16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cat_cntrs16</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">counts_cntrs16</span><span class="p">)]</span>
<span class="c1">## &#39;KE&#39;</span>
</pre></div>
</div>
<p>Recall that if <code class="docutils literal notranslate"><span class="pre">i</span></code> is <strong class="command">numpy.argmax</strong><code class="code docutils literal notranslate"><span class="pre">(counts)</span></code> (<em>argument maximum</em>, i.e.,
where is it?),
then <code class="docutils literal notranslate"><span class="pre">counts[i]</span></code> is the same as <strong class="command">numpy.max</strong><code class="code docutils literal notranslate"><span class="pre">(counts)</span></code>
and <code class="docutils literal notranslate"><span class="pre">cat[i]</span></code> is the category with the greatest counts.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A mode might be ambiguous.</p>
</div>
<p>For instance, amongst the fastest 22 runners,
there is a tie between Kenya and Poland – both meet our definition
of a mode:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs22</span><span class="p">,</span> <span class="n">counts_cntrs22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cntrs</span><span class="p">[:</span><span class="mi">22</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cat_cntrs22</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">counts_cntrs22</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">counts_cntrs22</span><span class="p">))]</span>
<span class="c1">## array([&#39;KE&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>To avoid any bias, it would be best to report
both of them as potential mode candidates.
Alternatively, we can pick one
at random (calling <strong class="command">numpy.random.choice</strong>).</p>
</div>
<div class="section" id="binary-data-as-logical-vectors">
<h3><span class="section-number">11.4.2. </span>Binary Data as Logical Vectors<a class="headerlink" href="#binary-data-as-logical-vectors" title="Permalink to this headline"></a></h3>
<p>Perhaps the most useful arithmetic operation on
logical vectors is the sum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cntrs16</span> <span class="o">=</span> <span class="n">cntrs</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">cntrs16</span>  <span class="c1"># recall</span>
<span class="c1">## array([&#39;KE&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;PL&#39;, &#39;IL&#39;,</span>
<span class="c1">##        &#39;PL&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;PL&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cntrs16</span> <span class="o">==</span> <span class="s2">&quot;PL&quot;</span><span class="p">)</span>
<span class="c1">## 5</span>
</pre></div>
</div>
<p>is the number of elements in <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> that are equal to <code class="docutils literal notranslate"><span class="pre">&quot;PL&quot;</span></code>
(because the sum of 0s and 1s is equal to the number of 1s in the sequence).
Note that <code class="docutils literal notranslate"><span class="pre">(cntrs16</span> <span class="pre">==</span> <span class="pre">&quot;PL&quot;)</span></code> is a logical vector that
represents a binary categorical variable
with levels: not-Poland (<code class="docutils literal notranslate"><span class="pre">False</span></code>) and Poland (<code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
<div style="margin-top: 1em"></div><p>If we divide the above result by the length of the vector,
we will get the proportion:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cntrs16</span> <span class="o">==</span> <span class="s2">&quot;PL&quot;</span><span class="p">)</span>
<span class="c1">## 0.3125</span>
</pre></div>
</div>
<p>Hence, 31.25% amongst the top 16 runners are from Poland.</p>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.17</span>
        
    </div><div class="proof-content">
<p>What is the meaning of
<strong class="command">numpy.all</strong>, <strong class="command">numpy.any</strong>, <strong class="command">numpy.min</strong>,
<strong class="command">numpy.max</strong>, <strong class="command">numpy.cumsum</strong>, and
<strong class="command">numpy.cumprod</strong> applied on logical vectors?</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**)  Having the 0/1 (or zero/nonzero) vs <code class="docutils literal notranslate"><span class="pre">False</span></code>/<code class="docutils literal notranslate"><span class="pre">True</span></code> correspondence
allows us to perform some logical operations using
integer arithmetic.
In particular, assuming that <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">q</span></code> are logical values
and <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are numeric ones, we have, what follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">!=</span> <span class="pre">0</span></code> means that at least one value is <code class="docutils literal notranslate"><span class="pre">True</span></code>
and <code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">0</span></code> if and only if both are <code class="docutils literal notranslate"><span class="pre">False</span></code>;</p></li>
<li><p>more generally, <code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">2</span></code> if both elements are <code class="docutils literal notranslate"><span class="pre">True</span></code>,
<code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">1</span></code> if only one is <code class="docutils literal notranslate"><span class="pre">True</span></code> (we call it exclusive-or, XOR),
and <code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">0</span></code> if both are <code class="docutils literal notranslate"><span class="pre">False</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p*q</span> <span class="pre">!=</span> <span class="pre">0</span></code> means that both values are <code class="docutils literal notranslate"><span class="pre">True</span></code>
and <code class="docutils literal notranslate"><span class="pre">p*q</span> <span class="pre">==</span> <span class="pre">0</span></code> holds whenever at least one is <code class="docutils literal notranslate"><span class="pre">False</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1-p</span></code> corresponds to negation of <code class="docutils literal notranslate"><span class="pre">p</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p*a</span> <span class="pre">+</span> <span class="pre">(1-p)*b</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">a</span></code> if <code class="docutils literal notranslate"><span class="pre">p</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> and equal to <code class="docutils literal notranslate"><span class="pre">b</span></code> otherwise.</p></li>
</ul>
</div>
</div>
<div class="section" id="pearson-s-chi-squared-test">
<span id="sec-chisq-test"></span><h3><span class="section-number">11.4.3. </span>Pearson’s Chi-Squared Test (*)<a class="headerlink" href="#pearson-s-chi-squared-test" title="Permalink to this headline"></a></h3>
<p>The Kolmogorov–Smirnov test that we described in <a class="reference internal" href="230-distribution.html#sec-ks-test"><span class="std std-numref">Section 6.2.3</span></a>
verifies whether a given sample differs significantly from
a hypothesised <em>continuous</em> distribution, i.e.,
it works for <em>numeric</em> data.</p>
<p>For binned/categorical data, we can use a classical
and easy-to-understand test developed by Karl Pearson in 1900.
It is supposed to judge whether the difference between the observed
proportions <span class="math notranslate nohighlight">\(\hat{p}_1,\dots,\hat{p}_l\)</span> and the
theoretical ones <span class="math notranslate nohighlight">\(p_1,\dots,p_l\)</span> is significantly large or not:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left\{
\begin{array}{rll}
H_0: &amp; \hat{p}_i=p_i\ \text{ for all }i=1,\dots,l &amp; \text{(null hypothesis)}\\
H_1: &amp; \hat{p}_i\neq p_i\ \text{ for some }i=1,\dots,l &amp; \text{(alternative hypothesis)} \\
\end{array}
\right.
\end{split}\]</div>
<p>Having such a test is beneficial, e.g., when
the data we have at hand are based on small surveys
that are supposed to serve as estimates of what might be happening in
a larger population.</p>
<p>Going back to our political example from <a class="reference internal" href="#sec-political-marketing"><span class="std std-numref">Section 11.3.2</span></a>,
it turns out that one of the pre-election polls indicated that <span class="math notranslate nohighlight">\(c=516\)</span>
out of <span class="math notranslate nohighlight">\(n=1017\)</span> people would vote for the first candidate.
We have <span class="math notranslate nohighlight">\(\hat{p}_1=50.74\%\)</span> (Duda)
and <span class="math notranslate nohighlight">\(\hat{p}_2=49.26\%\)</span> (Traskowski).
If we would like to test whether the observed proportions
are significantly different from each other, we could test them
against the theoretical distribution <span class="math notranslate nohighlight">\(p_1=50\%\)</span> and <span class="math notranslate nohighlight">\(p_2=50\%\)</span>,
stating that there is a tie between the competitors
(up to a sampling error).</p>
<p>As a natural test statistic is based on the relative squared differences:</p>
<div class="math notranslate nohighlight">
\[
\hat{T} = n \sum_{i=1}^l \frac{\left(\hat{p}_i-p_i\right)^2}{p_i}.
\]</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">516</span><span class="p">,</span> <span class="mi">1017</span>
<span class="n">p_observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">c</span><span class="p">])</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">p_expected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">p_observed</span><span class="o">-</span><span class="n">p_expected</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">p_expected</span> <span class="p">)</span>
<span class="n">T</span>
<span class="c1">## 0.2212389380530986</span>
</pre></div>
</div>
<p>Similarly to the continuous case in <a class="reference internal" href="230-distribution.html#sec-ks-test"><span class="std std-numref">Section 6.2.3</span></a>,
we should reject the null hypothesis, if</p>
<div class="math notranslate nohighlight">
\[
\hat{T} \ge K,
\]</div>
<p>where the critical value <span class="math notranslate nohighlight">\(K\)</span> is based
on the fact that, if the null hypothesis is true,
<span class="math notranslate nohighlight">\(\hat{T}\)</span> follows the <span class="math notranslate nohighlight">\(\chi^2\)</span> (chi-squared, hence the name of the test)
distribution with <span class="math notranslate nohighlight">\(l-1\)</span> degrees of freedom,
see <strong class="command">scipy.stats.chi2</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># significance level</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_observed</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## 10.827566170662733</span>
</pre></div>
</div>
<p>As <span class="math notranslate nohighlight">\(\hat{T} &lt; K\)</span> (because <span class="math notranslate nohighlight">\(0.22 &lt; 10.83\)</span>), we cannot deem
the two proportions significantly different from each other.
In other words, this poll did not indicate  (at significance level <span class="math notranslate nohighlight">\(0.1\%\)</span>)
any of the candidates as a clear winner.</p>
<div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.18</span>
        
    </div><div class="proof-content">
<p>Determine the smallest <span class="math notranslate nohighlight">\(c\)</span>, i.e., the number of respondents
indicating they would vote for Duda,
that leads to the rejection of the null hypothesis.</p>
</div></div></div>
<div class="section" id="two-sample-pearson-s-chi-squared-test">
<span id="sec-chisq-test2"></span><h3><span class="section-number">11.4.4. </span>Two-Sample Pearson’s Chi-Squared Test (*)<a class="headerlink" href="#two-sample-pearson-s-chi-squared-test" title="Permalink to this headline"></a></h3>
<p>Let us consider the data depicted in <a class="reference internal" href="#fig-stacked-bar"><span class="std std-numref">Figure 11.3</span></a>
and test whether the runners’ age distributions
differ significantly between females and males.</p>
<p>We have <span class="math notranslate nohighlight">\(l=5\)</span> categories.
First, denote the total number of observations
in both groups with <span class="math notranslate nohighlight">\(n'\)</span> and <span class="math notranslate nohighlight">\(n''\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>  <span class="c1"># first row, second row</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
<span class="c1">## (1013, 5498)</span>
</pre></div>
</div>
<p>The observed proportions in the first group (females),
denoted as <span class="math notranslate nohighlight">\(\hat{p}_1',\dots,\hat{p}_l'\)</span>, are, respectively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span> <span class="o">=</span> <span class="n">c1</span><span class="o">/</span><span class="n">n1</span>
<span class="n">p1</span>
<span class="c1">## array([0.23692004, 0.44323791, 0.25863771, 0.04244817, 0.01875617])</span>
</pre></div>
</div>
<p>Here are the proportions in the second group (males),
<span class="math notranslate nohighlight">\(\hat{p}_1'',\dots,\hat{p}_l''\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">/</span><span class="n">n2</span>
<span class="n">p2</span>
<span class="c1">## array([0.15987632, 0.40014551, 0.31065842, 0.09839942, 0.03092033])</span>
</pre></div>
</div>
<p>We would like to verify whether the corresponding proportions are equal
to each other (up to some sampling error):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left\{
\begin{array}{rll}
H_0: &amp; \hat{p}_i'=\hat{p}_i''\ \text{ for all }i=1,\dots,l &amp; \text{(null hypothesis)}\\
H_1: &amp; \hat{p}_i'\neq \hat{p}_i''\ \text{ for some }i=1,\dots,l &amp; \text{(alternative hypothesis)} \\
\end{array}
\right.
\end{split}\]</div>
<p>In other words, we are interested whether the categorical data in the two
groups come from the same discrete probability distribution.</p>
<p>Taking the estimated expected proportions,</p>
<div class="math notranslate nohighlight">
\[\bar{p}_i = \frac{c_i'+c_i''}{n'+n''},\]</div>
<p>for all <span class="math notranslate nohighlight">\(i=1,\dots,l\)</span>,
the test statistic this time is equal to:</p>
<div class="math notranslate nohighlight">
\[
\hat{T} =
n'  \sum_{i=1}^l \frac{\left(\hat{p}_i' -\bar{p}_i\right)^2}{\bar{p}_i} +
n'' \sum_{i=1}^l \frac{\left(\hat{p}_i''-\bar{p}_i\right)^2}{\bar{p}_i},
\]</div>
<p>which is a variation on the one-sample theme
presented in <a class="reference internal" href="#sec-chisq-test2"><span class="std std-numref">Section 11.4.4</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pp</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="o">+</span><span class="n">c2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">pp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">pp</span> <span class="p">)</span> <span class="o">+</span> <span class="n">n2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">pp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">pp</span> <span class="p">)</span>
<span class="n">T</span>
<span class="c1">## 75.31373854741857</span>
</pre></div>
</div>
<p>It can be shown that, if the null hypothesis is true,
the test statistic <em>approximately</em> follows
the <span class="math notranslate nohighlight">\(\chi^2\)</span> distribution with <span class="math notranslate nohighlight">\(l-1\)</span> degrees of freedom<a class="footnote-reference brackets" href="#recipesdof" id="id1">1</a>.
The critical value <span class="math notranslate nohighlight">\(K\)</span> is equal to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># significance level</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## 18.46682695290317</span>
</pre></div>
</div>
<p>As <span class="math notranslate nohighlight">\(\hat{T} \ge K\)</span> (because <span class="math notranslate nohighlight">\(75.31 \ge 18.47\)</span>),
we reject the null hypothesis. And so, the age distribution
differs across sexes (at significance level <span class="math notranslate nohighlight">\(0.1\%\)</span>).</p>
</div>
<div class="section" id="measuring-association">
<h3><span class="section-number">11.4.5. </span>Measuring Association (*)<a class="headerlink" href="#measuring-association" title="Permalink to this headline"></a></h3>
<p>Let us consider Australian Bureau of Statistics’
<a class="reference external" href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey-first-results/2017-18">National Health Survey 2018</a>
data on the prevalence of certain medical conditions
as a function of age. Here is the extracted contingency table:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Arthritis&quot;</span><span class="p">,</span> <span class="s2">&quot;Asthma&quot;</span><span class="p">,</span> <span class="s2">&quot;Back problems&quot;</span><span class="p">,</span> <span class="s2">&quot;Cancer (malignant neoplasms)&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Chronic obstructive pulmonary disease&quot;</span><span class="p">,</span> <span class="s2">&quot;Diabetes mellitus&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Heart, stroke and vascular disease&quot;</span><span class="p">,</span> <span class="s2">&quot;Kidney disease&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Mental and behavioural conditions&quot;</span><span class="p">,</span> <span class="s2">&quot;Osteoporosis&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;15-44&quot;</span><span class="p">,</span> <span class="s2">&quot;45-64&quot;</span><span class="p">,</span> <span class="s2">&quot;65+&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span> <span class="mf">360.2</span><span class="p">,</span>     <span class="mf">1489.0</span><span class="p">,</span>      <span class="mf">1772.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1069.7</span><span class="p">,</span>      <span class="mf">741.9</span><span class="p">,</span>       <span class="mf">433.7</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1469.6</span><span class="p">,</span>     <span class="mf">1513.3</span><span class="p">,</span>       <span class="mf">955.3</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">28.1</span><span class="p">,</span>      <span class="mf">162.7</span><span class="p">,</span>       <span class="mf">237.5</span><span class="p">],</span>
    <span class="p">[</span> <span class="mf">103.8</span><span class="p">,</span>      <span class="mf">207.0</span><span class="p">,</span>       <span class="mf">251.9</span><span class="p">],</span>
    <span class="p">[</span> <span class="mf">135.4</span><span class="p">,</span>      <span class="mf">427.3</span><span class="p">,</span>       <span class="mf">607.7</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">94.0</span><span class="p">,</span>      <span class="mf">344.4</span><span class="p">,</span>       <span class="mf">716.0</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">29.6</span><span class="p">,</span>       <span class="mf">67.7</span><span class="p">,</span>       <span class="mf">123.3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2218.9</span><span class="p">,</span>     <span class="mf">1390.6</span><span class="p">,</span>       <span class="mf">725.0</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">36.1</span><span class="p">,</span>      <span class="mf">312.3</span><span class="p">,</span>       <span class="mf">564.7</span><span class="p">],</span>
<span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">##                                          15-44    45-64      65+</span>
<span class="c1">## Arthritis                               360000  1489000  1772000</span>
<span class="c1">## Asthma                                 1069000   741000   433000</span>
<span class="c1">## Back problems                          1469000  1513000   955000</span>
<span class="c1">## Cancer (malignant neoplasms)             28000   162000   237000</span>
<span class="c1">## Chronic obstructive pulmonary disease   103000   207000   251000</span>
<span class="c1">## Diabetes mellitus                       135000   427000   607000</span>
<span class="c1">## Heart, stroke and vascular disease       94000   344000   716000</span>
<span class="c1">## Kidney disease                           29000    67000   123000</span>
<span class="c1">## Mental and behavioural conditions      2218000  1390000   725000</span>
<span class="c1">## Osteoporosis                             36000   312000   564000</span>
</pre></div>
</div>
<p>Cramer’s <span class="math notranslate nohighlight">\(V\)</span> is one of a few ways
to measure the degree of association between two categorical variables.
It is equal to 0 (lowest possible value) if the two variables are independent
(there is no association between them)
and 1 (highest possible value) if they are tied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">contingency</span><span class="o">.</span><span class="n">association</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="c1">## 0.316237999724298</span>
</pre></div>
</div>
<p>The above means that there might be a small association between
age and the prevalence of certain conditions.
In other words, it might be the case that some conditions
are more prevalent in different age groups than others.</p>
<p>Given a two-way contingency table <span class="math notranslate nohighlight">\(C\)</span> with <span class="math notranslate nohighlight">\(n\)</span> rows and
<span class="math notranslate nohighlight">\(m\)</span> columns and assuming that</p>
<div class="math notranslate nohighlight">
\[
T = \sum_{i=1}^n \sum_{j=1}^m \frac{(c_{i,j} - e_{i,j})^2}{e_{i,j}},
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
e_{i,j} = \frac{
\sum_{k=1}^m v_{i,k}  \sum_{k=1}^n c_{k,j}
}{
\sum_{i=1}^n \sum_{j=1}^m c_{i,j}
}
\]</div>
<p>the Cramer coefficient is given by</p>
<div class="math notranslate nohighlight">
\[
V = \sqrt{
\frac{T}{\min\{n-1, m-1\} \sum_{i=1}^n \sum_{j=1}^m c_{i,j}}
}.
\]</div>
<p>Note that <span class="math notranslate nohighlight">\(c_{i,j}\)</span> gives the actually observed counts and <span class="math notranslate nohighlight">\(e_{i, j}\)</span> denotes
the number that we would expect if the two variables were actually independent.</p>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.19</span>
        
    </div><div class="proof-content">
<p>Compute the Cramer <span class="math notranslate nohighlight">\(V\)</span> using only <strong class="program">numpy</strong> functions.</p>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.20</span>
        
    </div><div class="proof-content">
<p>(**)
Actually we can easily verify the hypothesis whether <span class="math notranslate nohighlight">\(V\)</span> does not differ
significantly from <span class="math notranslate nohighlight">\(0\)</span>, i.e., whether the variables are independent.
Looking at <span class="math notranslate nohighlight">\(T\)</span>, we see that this is actually the test statistic
in Pearson’s chi-squared goodness-of-fit test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">C</span><span class="o">-</span><span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span>
<span class="n">T</span>
<span class="c1">## 3715440.465191512</span>
</pre></div>
</div>
<p>If the data are really independent, <span class="math notranslate nohighlight">\(T\)</span> follows the chi-squared
distribution <span class="math notranslate nohighlight">\(n + m - 1\)</span>, hence the critical value is equal to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># significance level</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">## 32.90949040736021</span>
</pre></div>
</div>
<p>as it is greater than <span class="math notranslate nohighlight">\(T\)</span>, we conclude (at significance level <span class="math notranslate nohighlight">\(0.1\%\)</span>) that
the conditions are not independent of age.</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.21</span>
        
    </div><div class="proof-content">
<p>(*)
Take a look at
<em>Table 19: Comorbidity of selected chronic conditions</em>
of the  <a class="reference external" href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey-first-results/2017-18">National Health Survey 2018</a>,
where we clearly see that many disorders co-occur.
Visualise them on some heatmaps and bar plots (including
data grouped by sex and age).</p>
</div></div></div>
<div class="section" id="binned-numeric-data">
<h3><span class="section-number">11.4.6. </span>Binned Numeric Data<a class="headerlink" href="#binned-numeric-data" title="Permalink to this headline"></a></h3>
<p>Note that generally modes do not work for continuous data,
where repeated values are – at least theoretically – highly unlikely
(unless someone does not report them with full digit precision).
It might make sense to compute it on binned data, though.</p>
<p>Looking at a histogram, the mode is the interval corresponding to the
highest bar (hopefully assuming there is only one).
If we would like to obtain a single number, we can choose
for example the middle of this interval as the mode.</p>
<p>Of course, for numeric data, the mode will heavily depend
on the binning (recall that we can also apply logarithmic binning).
Thus, the question “what is the most popular income” is overall quite
difficult to answer.</p>
<div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.22</span>
        
    </div><div class="proof-content">
<p>Compute some potentially informative modes for
the <a class="reference external" href="https://raw.githubusercontent.com/gagolews/%5Cteaching_data/master/marek/uk_income_simulated_2020.txt">2020 UK income</a> data.
Play around with different numbers
of bins for linear and logarithmic binning and see how it affects the mode.</p>
</div></div></div>
<div class="section" id="ordinal-data">
<span id="sec-ordinal-data"></span><h3><span class="section-number">11.4.7. </span>Ordinal Data (*)<a class="headerlink" href="#ordinal-data" title="Permalink to this headline"></a></h3>
<p>The case where the categories can be linearly ordered,
is called <em>ordinal data</em>.
This gives a few more options as except for the mode,
thanks to the existence of order statistics,
we can also easily define sample quantiles.
However, the standard methods for resolving ties will not work,
hence we need to be careful.</p>
<p>For example, median of a sample of student grades
(P, P, C, D, HD) is C, but
(P, P, C, D, HD, HD) is either C or D - we can choose one at random
or just report that the solution is ambiguous.</p>
<p>Another option, of course, is to treat ordinal data as numbers
(e.g., F=0, P=1, …, HD=4). In the latter example, the median would
be equal to 2.5.</p>
<p>There are some cases, though, where the conversion of
labels to consecutive integers is far from optimal – because
it gives the impression that the “distance” between different
levels is always equal (linear).</p>
<div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.23</span>
        
    </div><div class="proof-content">
<p>(**)
The <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/grades_results.txt">grades_results</a> represents the grades (F, P, C, D, HD)
of 100 students attending an imaginary course in a virtual Australian
university. You can load it in the form of an <em>ordered</em> categorical <code class="docutils literal notranslate"><span class="pre">Series</span></code>
by calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/grades_results.txt&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="n">grades</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">grades</span><span class="p">,</span>
    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;HD&quot;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">grades</span>
<span class="c1">## 0       F</span>
<span class="c1">## 1       F</span>
<span class="c1">## 2       F</span>
<span class="c1">## 3       F</span>
<span class="c1">## 4       F</span>
<span class="c1">##        ..</span>
<span class="c1">## 118    HD</span>
<span class="c1">## 119    HD</span>
<span class="c1">## 120    HD</span>
<span class="c1">## 121    HD</span>
<span class="c1">## 122    HD</span>
<span class="c1">## Length: 123, dtype: category</span>
<span class="c1">## Categories (5, object): [&#39;F&#39; &lt; &#39;P&#39; &lt; &#39;C&#39; &lt; &#39;D&#39; &lt; &#39;HD&#39;]</span>
</pre></div>
</div>
<p>How would you determine the <em>average</em> grade represented as
a number between 0 and 100, taking into account that
for a P you need at least 50%, C is given for ≥ 60%,
D for ≥ 70%, and HD for only 80% of the points.
Come up with a pessimistic, optimistic, and a best-shot estimate
and then compare your result
to the true corresponding scores listed in the
<a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/grades_scores.txt">grades_scores</a> dataset.</p>
</div></div></div>
</div>
<div class="section" id="exercises">
<h2><span class="section-number">11.5. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline"></a></h2>
<div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.24</span>
        
    </div><div class="proof-content">
<p>Does it make sense to compute the arithmetic mean of a categorical
variable?</p>
</div></div><div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.25</span>
        
    </div><div class="proof-content">
<p>Name the basic use cases for categorical data.</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.26</span>
        
    </div><div class="proof-content">
<p>(*) What is a Pareto chart?</p>
</div></div><div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.27</span>
        
    </div><div class="proof-content">
<p>How to deal with the case of the mode being nonunique?</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.28</span>
        
    </div><div class="proof-content">
<p>What is the meaning of <strong class="command">numpy.mean</strong><code class="code docutils literal notranslate"><span class="pre">((x</span> <span class="pre">&gt;</span> <span class="pre">0)</span> <span class="pre">&amp;</span> <span class="pre">(x</span> <span class="pre">&lt;</span> <span class="pre">1))</span></code>, where
<code class="docutils literal notranslate"><span class="pre">x</span></code> is a numeric vector?</p>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.29</span>
        
    </div><div class="proof-content">
<p>What is the meaning of the sum and mean for binary data (logical vectors)?</p>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.30</span>
        
    </div><div class="proof-content">
<p>List some ways to visualise multidimensional categorical data.</p>
</div></div><div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.31</span>
        
    </div><div class="proof-content">
<p>(*)
State the null hypotheses verified by the one- and two-sample
chi-squared tests.</p>
</div></div><div class="proof proof-type-exercise" id="id41">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.32</span>
        
    </div><div class="proof-content">
<p>(*) How is Cramer’s <em>V</em> defined and what values does it take?</p>
</div></div><hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="recipesdof"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Note that <span id="id2">[<a class="reference internal" href="999-bibliography.html#id134">PTVF07</a>]</span> in Section 14.3
suggests <span class="math notranslate nohighlight">\(l\)</span> degrees of freedom, but do not agree with the reasoning
therein. Also, simple Monte Carlo simulations suggests that <span class="math notranslate nohighlight">\(l-1\)</span>
is a better candidate.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="430-group-by.html" class="btn btn-neutral float-right" title="12. Processing Data in Groups" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="410-data-frame.html" class="btn btn-neutral float-left" title="10. Introducing Data Frames" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright &#169; 2022 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>. Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.
      <span class="lastupdated">
        Last updated on 2022-06-22T15:44:17+1000.
      </span>
    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a> theme.
    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>