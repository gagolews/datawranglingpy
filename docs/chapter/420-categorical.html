<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>11. Handling Categorical Data &mdash; Minimalist Data Wrangling with Python by Marek Gagolewski</title>
  

  
  
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/420-categorical.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="12. Processing Data in Groups" href="430-group-by.html" />
    <link rel="prev" title="10. Introducing Data Frames" href="410-data-frame.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Minimalist Data Wrangling with Python [v1.0.1]
          

          
          </a>

          <div class="version">
          An open-access textbook<br />
          by <a style="color: inherit" href="https://www.gagolewski.com">Marek Gagolewski</a>
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy/">Report Bugs or Typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching_data">Datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar Types and Control Structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and Other Types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional Numeric Data and Their Empirical Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing Unidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous Probability Distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. Multidimensional Numeric Data at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing Multidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring Relationships Between Variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="410-data-frame.html">10. Introducing Data Frames</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Handling Categorical Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#representing-and-generating-categorical-data">11.1. Representing and Generating Categorical Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#encoding-and-decoding-factors">11.1.1. Encoding and Decoding Factors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-data-as-logical-and-probability-vectors">11.1.2. Binary Data as Logical and Probability Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-hot-encoding">11.1.3. One-Hot Encoding (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binning-numeric-data-revisited">11.1.4. Binning Numeric Data (Revisited)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-pseudorandom-labels">11.1.5. Generating Pseudorandom Labels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#frequency-distributions">11.2. Frequency Distributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#counting">11.2.1. Counting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-way-contingency-tables-factor-combinations">11.2.2. Two-Way Contingency Tables: Factor Combinations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combinations-of-even-more-factors">11.2.3. Combinations of Even More Factors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualising-factors">11.3. Visualising Factors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bar-plots">11.3.1. Bar Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#political-marketing-and-statistics">11.3.2. Political Marketing and Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pie-cha-don-t-even-trip">11.3.3. Pie Cha… Don’t Even Trip</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pareto-charts">11.3.4. Pareto Charts (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#heat-maps">11.3.5. Heat Maps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#aggregating-and-comparing-factors">11.4. Aggregating and Comparing Factors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-mode">11.4.1. A Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-data-as-logical-vectors">11.4.2. Binary Data as Logical Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pearson-s-chi-squared-test">11.4.3. Pearson’s Chi-Squared Test (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-sample-pearson-s-chi-squared-test">11.4.4. Two-Sample Pearson’s Chi-Squared Test (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measuring-association">11.4.5. Measuring Association (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binned-numeric-data">11.4.6. Binned Numeric Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ordinal-data">11.4.7. Ordinal Data (*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">11.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing Data in Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">13. Accessing Databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Data Types</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">14. Text Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-missingness.html">15. Missing, Censored, and Questionable Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minimalist Data Wrangling with Python [v1.0.1]</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">11. </span>Handling Categorical Data</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        
        <a class="github-button" href="https://github.com/gagolews/datawranglingpy" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star gagolews/datawranglingpy on GitHub">Star</a>
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="430-group-by.html" class="btn btn-neutral float-right" title="12. Processing Data in Groups" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="410-data-frame.html" class="btn btn-neutral float-left" title="10. Introducing Data Frames" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="handling-categorical-data">
<span id="chap-categorical"></span><h1><span class="section-number">11. </span>Handling Categorical Data<a class="headerlink" href="#handling-categorical-data" title="Permalink to this heading"></a></h1>
<blockquote>
<div><p><em>The open-access textbook</em> Minimalist Data
Wrangling with Python <em>by <a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>).
This is a non-profit project.
Although available online, this is a whole course;
it should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em></p>
</div></blockquote>
<p>So far, we have been mostly dealing with <em>quantitative</em> (numeric) data,
on which we were able to apply various mathematical operations,
such as computing the arithmetic mean or taking the square thereof.
Naturally, not every transformation must always make sense in every
context (e.g., multiplying temperatures – what does it mean
when we say that it is twice as hot today as compared to yesterday?),
but still, the possibilities were plenty.</p>
<p><em>Qualitative</em> data (also known as categorical data, factors, or enumerated
types) such as eye colour, blood type, or a flag whether
a patient is ill, on the other hand, take a small number of unique values.
They support an extremely limited set of admissible operations.
Namely, we can only determine whether two entities are equal or not.</p>
<p>In datasets involving many features, which we shall cover
in <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>, categorical variables
are often used for observation <em>grouping</em> (e.g., so that
we can compute the best and average time for marathoners in
each age category or draw box plots for finish times of
men and women separately). Also, they may serve as
target variables in statistical classification tasks
(e.g., so that we can determine if an email is “spam” or “not spam”).</p>
<section id="representing-and-generating-categorical-data">
<h2><span class="section-number">11.1. </span>Representing and Generating Categorical Data<a class="headerlink" href="#representing-and-generating-categorical-data" title="Permalink to this heading"></a></h2>
<p>Common ways to represent a categorical variable
with <em>l</em> distinct levels <span class="math notranslate nohighlight">\(\{L_1,L_2,\dots,L_l\}\)</span>
is by storing it as:</p>
<ul class="simple">
<li><p>a vector of strings,</p></li>
<li><p>a vector of integers between 0 (inclusive) and <em>l</em> (exclusive<a class="footnote-reference brackets" href="#footidx" id="id1">1</a>).</p></li>
</ul>
<p>These two are easily interchangeable.</p>
<p>For <span class="math notranslate nohighlight">\(l=2\)</span> (binary data), another convenient representation
is by means of logical vectors. This can be extended to a so-called
one-hot encoded representation using a logical vector of length <em>l</em>.</p>
<div style="margin-top: 1em"></div><p>Let us consider the data on the original whereabouts of the top
16 marathoners (the 37th PZU native Marathon dataset):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/37_pzu_warsaw_marathon_simplified.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">cntrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">country</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="n">cntrs16</span> <span class="o">=</span> <span class="n">cntrs</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">cntrs16</span>
<span class="c1">## array([&#39;KE&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;PL&#39;, &#39;IL&#39;,</span>
<span class="c1">##        &#39;PL&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;PL&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>These are two-letter ISO 3166 country codes,
encoded of course as strings (notice the <code class="docutils literal notranslate"><span class="pre">dtype=&quot;str&quot;</span></code> argument).</p>
<p>Calling <strong class="command">pandas.unique</strong> allows us to determine
the set of distinct categories:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">)</span>
<span class="n">cat_cntrs16</span>
<span class="c1">## array([&#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;IL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>Hence, <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> is a categorical vector of length <span class="math notranslate nohighlight">\(n=16\)</span>
(<strong class="command">len</strong><code class="code docutils literal notranslate"><span class="pre">(cntrs16)</span></code>)
with data assuming one of <span class="math notranslate nohighlight">\(l=5\)</span> different levels
(<strong class="command">len</strong><code class="code docutils literal notranslate"><span class="pre">(cat_cntrs16)</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We could have also used <strong class="command">numpy.unique</strong>
discussed in <a class="reference internal" href="220-transform-vector.html#sec-ties"><span class="std std-numref">Section 5.5.3</span></a>,
but it would sort the distinct values lexicographically.
In other words, they would <em>not</em> be listed in the order of appearance.</p>
</div>
<section id="encoding-and-decoding-factors">
<h3><span class="section-number">11.1.1. </span>Encoding and Decoding Factors<a class="headerlink" href="#encoding-and-decoding-factors" title="Permalink to this heading"></a></h3>
<p>To <em>encode</em> a label vector using a set of consecutive nonnegative
integers, we can call <strong class="command">pandas.factorize</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">codes_cntrs16</span><span class="p">,</span> <span class="n">cat_cntrs16</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">factorize</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">)</span>  <span class="c1"># sort=False</span>
<span class="n">cat_cntrs16</span>
<span class="c1">## array([&#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;IL&#39;], dtype=&#39;&lt;U2&#39;)</span>
<span class="n">codes_cntrs16</span>
<span class="c1">## array([0, 0, 0, 1, 0, 0, 1, 2, 3, 3, 4, 3, 0, 0, 3, 3])</span>
</pre></div>
</div>
<p>The code sequence 0, 0, 0, 1, … corresponds to
the 1st, 1st, 1st, 2nd, … level in <code class="docutils literal notranslate"><span class="pre">cat_cntrs16</span></code>,
i.e., Kenya, Kenya, Kenya, Ethiopia, ….</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When we represent categorical data using numeric codes,
it is possible to introduce non-occurring levels.
Such information can be useful, e.g., we could explicitly
indicate that there were no runners from Australia in the top 16.</p>
<p>Even though we can <em>represent</em> categorical variables using
a set of integers, it does not mean that they become instances of
a quantitative type. Arithmetic operations thereon do not really make sense.</p>
</div>
<p>The values between <span class="math notranslate nohighlight">\(0\)</span> (inclusive) and <span class="math notranslate nohighlight">\(5\)</span> (exclusive) can be used
to index a given array of length <span class="math notranslate nohighlight">\(l=5\)</span>.
As a consequence, to <em>decode</em> our factor, we can simply write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cntrs16</span><span class="p">[</span><span class="n">codes_cntrs16</span><span class="p">]</span>
<span class="c1">## array([&#39;KE&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;ET&#39;, &#39;MA&#39;, &#39;PL&#39;, &#39;PL&#39;, &#39;IL&#39;,</span>
<span class="c1">##        &#39;PL&#39;, &#39;KE&#39;, &#39;KE&#39;, &#39;PL&#39;, &#39;PL&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>We can use any other set of labels now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;Kenya&quot;</span><span class="p">,</span> <span class="s2">&quot;Ethiopia&quot;</span><span class="p">,</span> <span class="s2">&quot;Morocco&quot;</span><span class="p">,</span> <span class="s2">&quot;Poland&quot;</span><span class="p">,</span> <span class="s2">&quot;Israel&quot;</span><span class="p">])[</span><span class="n">codes_cntrs16</span><span class="p">]</span>
<span class="c1">## array([&#39;Kenya&#39;, &#39;Kenya&#39;, &#39;Kenya&#39;, &#39;Ethiopia&#39;, &#39;Kenya&#39;, &#39;Kenya&#39;,</span>
<span class="c1">##        &#39;Ethiopia&#39;, &#39;Morocco&#39;, &#39;Poland&#39;, &#39;Poland&#39;, &#39;Israel&#39;, &#39;Poland&#39;,</span>
<span class="c1">##        &#39;Kenya&#39;, &#39;Kenya&#39;, &#39;Poland&#39;, &#39;Poland&#39;], dtype=&#39;&lt;U8&#39;)</span>
</pre></div>
</div>
<p>This is an instance of the <em>relabelling</em> of a categorical variable.</p>
<div class="proof proof-type-exercise" id="id6">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.1</span>
        
    </div><div class="proof-content">
<p>(**) Here is a way of <em>recoding</em> a variable, i.e.,
changing the order of labels and permuting the numeric codes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># an example permutation of labels</span>
<span class="n">new_cat_cntrs16</span> <span class="o">=</span> <span class="n">cat_cntrs16</span><span class="p">[</span><span class="n">new_codes</span><span class="p">]</span>
<span class="n">new_cat_cntrs16</span>
<span class="c1">## array([&#39;PL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;IL&#39;, &#39;ET&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>Then we make use of the fact that <strong class="command">numpy.argsort</strong>
applied on a vector representing a permutation,
determines its very inverse:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_codes_cntrs16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">new_codes</span><span class="p">)[</span><span class="n">codes_cntrs16</span><span class="p">]</span>
<span class="n">new_codes_cntrs16</span>
<span class="c1">## array([1, 1, 1, 4, 1, 1, 4, 2, 0, 0, 3, 0, 1, 1, 0, 0])</span>
</pre></div>
</div>
<p>Verification:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cntrs16</span> <span class="o">==</span> <span class="n">new_cat_cntrs16</span><span class="p">[</span><span class="n">new_codes_cntrs16</span><span class="p">])</span>
<span class="c1">## True</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id7">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.2</span>
        
    </div><div class="proof-content">
<p>(**)
Determine the set of unique values in <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> in the order
of appearance (and not sorted lexicographically), but
without using <strong class="command">pandas.unique</strong>
nor <strong class="command">pandas.factorize</strong>.
Then, encode <code class="docutils literal notranslate"><span class="pre">cntrs16</span></code> using this level set.</p>
<p><em>Hint: check out the <code class="docutils literal notranslate"><span class="pre">return_index</span></code> argument to <strong class="command">numpy.unique</strong>
and <strong class="command">numpy.searchsorted</strong>.</em></p>
</div></div><div style="margin-top: 1em"></div><p>Furthermore,
<strong class="program">pandas</strong> <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html">includes</a>
a special <code class="docutils literal notranslate"><span class="pre">dtype</span></code> for storing categorical data.
Namely, we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cntrs16_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or, equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cntrs16_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>These two yield a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object displayed as if it was represented
using string labels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cntrs16_series</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># preview</span>
<span class="c1">## 0    KE</span>
<span class="c1">## 1    KE</span>
<span class="c1">## 2    KE</span>
<span class="c1">## 3    ET</span>
<span class="c1">## 4    KE</span>
<span class="c1">## dtype: category</span>
<span class="c1">## Categories (5, object): [&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;]</span>
</pre></div>
</div>
<p>Instead, it is encoded using the aforementioned numeric
representation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cntrs16_series</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span><span class="p">)</span>
<span class="c1">## array([2, 2, 2, 0, 2, 2, 0, 3, 4, 4, 1, 4, 2, 2, 4, 4], dtype=int8)</span>
<span class="n">cntrs16_series</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
<span class="c1">## Index([&#39;ET&#39;, &#39;IL&#39;, &#39;KE&#39;, &#39;MA&#39;, &#39;PL&#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<p>This time the labels are sorted lexicographically.</p>
<p>Most often we will be storing categorical data in data frames
as ordinary strings, unless a relabelling on-the-fly is required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">16</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;KE&quot;</span><span class="p">,</span>    <span class="s2">&quot;IL&quot;</span><span class="p">,</span>     <span class="s2">&quot;MA&quot;</span><span class="p">,</span>      <span class="s2">&quot;ET&quot;</span><span class="p">,</span>       <span class="s2">&quot;PL&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;Kenya&quot;</span><span class="p">,</span> <span class="s2">&quot;Israel&quot;</span><span class="p">,</span> <span class="s2">&quot;Morocco&quot;</span><span class="p">,</span> <span class="s2">&quot;Ethiopia&quot;</span><span class="p">,</span> <span class="s2">&quot;Poland&quot;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1">## 0       Kenya</span>
<span class="c1">## 1       Kenya</span>
<span class="c1">## 2       Kenya</span>
<span class="c1">## 3    Ethiopia</span>
<span class="c1">## 4       Kenya</span>
<span class="c1">## Name: country, dtype: object</span>
</pre></div>
</div>
</section>
<section id="binary-data-as-logical-and-probability-vectors">
<span id="sec-binary-logical"></span><h3><span class="section-number">11.1.2. </span>Binary Data as Logical and Probability Vectors<a class="headerlink" href="#binary-data-as-logical-and-probability-vectors" title="Permalink to this heading"></a></h3>
<p><em>Binary data</em> is a special case of the qualitative setting,
where we only have <span class="math notranslate nohighlight">\(l=2\)</span> categories.
For example:</p>
<ul class="simple">
<li><p>0, e.g., healthy/fail/off/non-spam/absent/…),</p></li>
<li><p>1, e.g., ill/success/on/spam/present/…).</p></li>
</ul>
<p>Usually, the <em>interesting</em> or <em>noteworthy</em> category
is denoted with 1.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When converting logical to numeric, <code class="docutils literal notranslate"><span class="pre">False</span></code> becomes 0 and <code class="docutils literal notranslate"><span class="pre">True</span></code> becomes 1.
Conversely, 0 is converted to <code class="docutils literal notranslate"><span class="pre">False</span></code> and anything else (including -0.326)
to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</div>
<p>Hence, instead of working with vectors of 0s and 1s,
we might equivalently be playing with logical arrays.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1">## array([1, 0, 1, 1, 0])</span>
</pre></div>
</div>
<p>The other way around:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.326</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7643</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="c1">## array([ True,  True,  True, False,  True,  True,  True])</span>
</pre></div>
</div>
<p>or, equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.326</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7643</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="c1">## array([ True,  True,  True, False,  True,  True,  True])</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is not rare to work with vectors of probabilities,
where the <em>i</em>-th element therein, say <code class="docutils literal notranslate"><span class="pre">p[i]</span></code>, denotes the likelihood of
an observation’s belonging to class 1.
Consequently, the probability of being a member of class 0 is <code class="docutils literal notranslate"><span class="pre">1-p[i]</span></code>.
In the case where we would rather work with <em>crisp</em>
classes, we can simply apply the conversion <code class="docutils literal notranslate"><span class="pre">(p&gt;=0.5)</span></code>
to get a logical vector.</p>
</div>
<div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.3</span>
        
    </div><div class="proof-content">
<p>Given a numeric vector <code class="docutils literal notranslate"><span class="pre">x</span></code>, create a vector of the same length
as <code class="docutils literal notranslate"><span class="pre">x</span></code> whose <em>i</em>-th element is equal to <code class="docutils literal notranslate"><span class="pre">&quot;yes&quot;</span></code>
if <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> is in the unit interval and to <code class="docutils literal notranslate"><span class="pre">&quot;no&quot;</span></code> otherwise.
Use <strong class="command">numpy.where</strong>, which can act as a vectorised version
of the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p>
</div></div></section>
<section id="one-hot-encoding">
<h3><span class="section-number">11.1.3. </span>One-Hot Encoding (*)<a class="headerlink" href="#one-hot-encoding" title="Permalink to this heading"></a></h3>
<p>Let <span class="math notranslate nohighlight">\(\boldsymbol{x}\)</span> be a vector of <em>n</em>
integer labels in <span class="math notranslate nohighlight">\(\{0,...,l-1\}\)</span>.
Its <em>one-hot</em> encoded version is a 0/1 (or, equivalently, logical)
matrix <span class="math notranslate nohighlight">\(\mathbf{R}\)</span> of shape  <em>n</em>-by-<em>l</em>
such that <span class="math notranslate nohighlight">\(r_{i,j}=1\)</span> if and only if <span class="math notranslate nohighlight">\(x_i = j\)</span>.</p>
<p>For example, if <span class="math notranslate nohighlight">\(\boldsymbol{x}=(0, 1, 2, 1)\)</span> and <span class="math notranslate nohighlight">\(l=4\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{R} = \left[
\begin{array}{cccc}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
\end{array}
\right].
\end{split}\]</div>
<p>One can easily verify that each row consists of one and only one 1
(the number of 1s per one row is 1).
Such a representation is adequate when solving
a multiclass classification problem by means of <em>l</em> binary classifiers.
For example, if <em>spam</em>, <em>bacon</em>, and <em>hot dogs</em> are on the menu,
then <em>spam</em> is encoded as <span class="math notranslate nohighlight">\((1, 0, 0)\)</span>, i.e.,
yeah-spam, nah-bacon, and nah-hot dog.
We can build three binary classifiers, each narrowly specialising
in sniffing one particular type of food.</p>
<div class="proof proof-type-example" id="id9">

    <div class="proof-title">
        <span class="proof-type">Example 11.4</span>
        
    </div><div class="proof-content">
<p>Write a function to one-hot encode a given categorical vector
represented using character strings.</p>
</div></div><div class="proof proof-type-example" id="id10">

    <div class="proof-title">
        <span class="proof-type">Example 11.5</span>
        
    </div><div class="proof-content">
<p>Write a function to decode a one-hot encoded matrix.</p>
</div></div><div class="proof proof-type-example" id="id11">

    <div class="proof-title">
        <span class="proof-type">Example 11.6</span>
        
    </div><div class="proof-content">
<p>(*)
We can also work with matrices like <span class="math notranslate nohighlight">\(\mathbf{P}\in[0,1]^{n\times l}\)</span>,
where <span class="math notranslate nohighlight">\(p_{i,j}\)</span> denotes the probability of the <em>i</em>-th object’s
belonging to the <em>j</em>-th class.
Given an example matrix of this kind,
verify that in each row the probabilities sum to 1 (up to a small
numeric error).
Then, decode such a matrix by choosing the greatest element
in each row.</p>
</div></div></section>
<section id="binning-numeric-data-revisited">
<span id="sec-binning"></span><h3><span class="section-number">11.1.4. </span>Binning Numeric Data (Revisited)<a class="headerlink" href="#binning-numeric-data-revisited" title="Permalink to this heading"></a></h3>
<p>Numerical data can be converted to categorical via binning (quantisation).
Even though this results in information loss,
it may open some new possibilities. In fact,
we needed binning to draw all the histograms in <a class="reference internal" href="210-vector.html#chap-vector"><span class="std std-numref">Chapter 4</span></a>.
Also, reporting observation counts in each bin instead of raw data
enables us to include them in printed reports (in the form of tables).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As strong proponents of openness and transparency,
we always encourage all entities (governments, universities,
non-for-profits, corporations, etc.)
to share raw, unabridged versions of their datasets under the terms
of some open data license.
This is to enable public scrutiny and to get
the most out of the possibilities they can bring for
benefit of the community.</p>
<p>Of course, sometimes the sharing of unprocessed information
can violate the privacy of the subjects. In such a case,
it might be a good idea to communicate them in a binned form.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rounding is a kind of binning. In particular, <strong class="command">numpy.round</strong>
allows for rounding to the nearest tenths, hundredths, …,
as well as tens, hundreds, …
It is useful if data are naturally imprecise, and we do not
want to give the impression that it is otherwise.
Nonetheless, rounding can easily introduce tied observations,
which are problematic on their own; see <a class="reference internal" href="220-transform-vector.html#sec-ties"><span class="std std-numref">Section 5.5.3</span></a>.</p>
</div>
<p>Consider the 16 best marathon finish times (in minutes):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">mins</span><span class="p">)</span>
<span class="n">mins16</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">mins16</span>
<span class="c1">## array([129.32, 130.75, 130.97, 134.17, 134.68, 135.97, 139.88, 143.2 ,</span>
<span class="c1">##        145.22, 145.92, 146.83, 147.8 , 149.65, 149.88, 152.65, 152.88])</span>
</pre></div>
</div>
<p><strong class="command">numpy.searchsorted</strong> can be used to determine
the interval where each value in <code class="docutils literal notranslate"><span class="pre">mins</span></code> falls.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">150</span><span class="p">]</span>
<span class="n">codes_mins16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">mins16</span><span class="p">)</span>
<span class="n">codes_mins16</span>
<span class="c1">## array([0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3])</span>
</pre></div>
</div>
<p>By default, the intervals are of the form <em>(a, b]</em> (not including
<em>a</em>, including <em>b</em>).
Code 0 corresponds to values less than the first bin bound,
whereas code 3 – greater than or equal to the last bound:</p>
<p><strong class="command">pandas.cut</strong> gives us another interface to the same binning method.
It returns a vector-like object with <code class="docutils literal notranslate"><span class="pre">dtype=&quot;category&quot;</span></code>,
with very readable labels generated automatically
(and ordered, see <a class="reference internal" href="#sec-ordinal-data"><span class="std std-numref">Section 11.4.7</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cut_mins16</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">mins16</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]))</span>
<span class="n">cut_mins16</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>  <span class="c1"># preview</span>
<span class="c1">## 0      (-inf, 130.0]</span>
<span class="c1">## 1     (130.0, 140.0]</span>
<span class="c1">## 6     (130.0, 140.0]</span>
<span class="c1">## 7     (140.0, 150.0]</span>
<span class="c1">## 13    (140.0, 150.0]</span>
<span class="c1">## 14      (150.0, inf]</span>
<span class="c1">## 15      (150.0, inf]</span>
<span class="c1">## dtype: object</span>
<span class="n">cut_mins16</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="c1">## Index([&#39;(-inf, 130.0]&#39;, &#39;(130.0, 140.0]&#39;, &#39;(140.0, 150.0]&#39;,</span>
<span class="c1">##        &#39;(150.0, inf]&#39;],</span>
<span class="c1">##       dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id12">

    <div class="proof-title">
        <span class="proof-type">Example 11.7</span>
        
    </div><div class="proof-content">
<p>(*) We can create a set of the corresponding categories manually,
for example, as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">bins2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bins2</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
<span class="p">)</span>
<span class="c1">## array([&#39;(-inf, 130.0]&#39;, &#39;(130.0, 140.0]&#39;, &#39;(140.0, 150.0]&#39;,</span>
<span class="c1">##        &#39;(150.0, inf]&#39;], dtype=&#39;&lt;U14&#39;)</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.8</span>
        
    </div><div class="proof-content">
<p>(*) Check out the <strong class="command">numpy.histogram_bin_edges</strong>
function which tries to determine some informative
interval bounds based on a few simple heuristics.
Recall that <strong class="command">numpy.linspace</strong> and <strong class="command">numpy.geomspace</strong>
can be used for generating equidistant bounds
on linear and logarithmic scales, respectively.</p>
</div></div></section>
<section id="generating-pseudorandom-labels">
<span id="sec-random-choice"></span><h3><span class="section-number">11.1.5. </span>Generating Pseudorandom Labels<a class="headerlink" href="#generating-pseudorandom-labels" title="Permalink to this heading"></a></h3>
<p><strong class="command">numpy.random.choice</strong> allows us to create a pseudorandom sample
with categories picked with given probabilities:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
    <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;tempeh&quot;</span><span class="p">],</span>
    <span class="n">p</span><span class="o">=</span><span class="p">[</span>   <span class="mf">0.7</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">0.15</span><span class="p">,</span>     <span class="mf">0.05</span><span class="p">],</span>
    <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">16</span>
<span class="p">)</span>
<span class="c1">## array([&#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;tempeh&#39;, &#39;spam&#39;,</span>
<span class="c1">##        &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;bacon&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;bacon&#39;],</span>
<span class="c1">##       dtype=&#39;&lt;U6&#39;)</span>
</pre></div>
</div>
<p>If we generate a sufficiently long vector,
we will expect <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code> to occur ca. 70% times, and <code class="docutils literal notranslate"><span class="pre">&quot;tempeh&quot;</span></code>
to be drawn in 5% of the cases, etc.</p>
</section>
</section>
<section id="frequency-distributions">
<h2><span class="section-number">11.2. </span>Frequency Distributions<a class="headerlink" href="#frequency-distributions" title="Permalink to this heading"></a></h2>
<section id="counting">
<h3><span class="section-number">11.2.1. </span>Counting<a class="headerlink" href="#counting" title="Permalink to this heading"></a></h3>
<p><strong class="command">pandas.Series.value_counts</strong> creates
a frequency table in the form of a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object
equipped with a readable index (element labels):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cntrs16</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>  <span class="c1"># sort=True, ascending=False</span>
<span class="c1">## KE    7</span>
<span class="c1">## PL    5</span>
<span class="c1">## ET    2</span>
<span class="c1">## MA    1</span>
<span class="c1">## IL    1</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>By default, data are ordered with respect to the counts,
decreasingly.</p>
<p>If we <em>already</em> have an array of integer codes between
<span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(l-1\)</span>, <strong class="command">numpy.bincount</strong> will return the number of
times each code appears therein.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts_cntrs16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">codes_cntrs16</span><span class="p">)</span>
<span class="n">counts_cntrs16</span>
<span class="c1">## array([7, 2, 1, 5, 1])</span>
</pre></div>
</div>
<p>A vector of counts can easily be turned into
a vector of proportions (fractions)
or percentages (if we multiply them by 100):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts_cntrs16</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts_cntrs16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="c1">## array([43.75, 12.5 ,  6.25, 31.25,  6.25])</span>
</pre></div>
</div>
<p>Almost 31.25% of the top runners were from Poland
(this marathon is held in Warsaw after all…).</p>
<div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.9</span>
        
    </div><div class="proof-content">
<p>Using <strong class="command">numpy.argsort</strong>, sort
<code class="docutils literal notranslate"><span class="pre">counts_cntrs16</span></code> increasingly
together with the corresponding items in <code class="docutils literal notranslate"><span class="pre">cat_cntrs16</span></code>.</p>
</div></div></section>
<section id="two-way-contingency-tables-factor-combinations">
<span id="sec-contingency-two"></span><h3><span class="section-number">11.2.2. </span>Two-Way Contingency Tables: Factor Combinations<a class="headerlink" href="#two-way-contingency-tables-factor-combinations" title="Permalink to this heading"></a></h3>
<p>Some datasets may feature many categorical columns,
each having possibly different levels.
Let us now consider all the runners in the <code class="docutils literal notranslate"><span class="pre">marathon</span></code> dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># first two chars</span>
<span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">marathon</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="s2">&quot;60&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;60+&quot;</span>  <span class="c1"># too few runners aged 70+</span>
<span class="n">marathon</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">]]</span>
<span class="n">marathon</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1">##   sex age country</span>
<span class="c1">## 0   M  20      KE</span>
<span class="c1">## 1   M  20      KE</span>
<span class="c1">## 2   M  20      KE</span>
<span class="c1">## 3   M  20      ET</span>
<span class="c1">## 4   M  30      KE</span>
</pre></div>
</div>
<p>The three columns are: sex, age (in 10-year brackets), and country.
We can of course analyse the data distribution
in each column individually, but this we leave as an exercise.
Instead, we note that some interesting patterns might also arise
when we study the <em>combinations</em> of levels of different variables.</p>
<p>Here are the levels of the sex and age variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">sex</span><span class="p">)</span>
<span class="c1">## array([&#39;M&#39;, &#39;F&#39;], dtype=object)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c1">## array([&#39;20&#39;, &#39;30&#39;, &#39;50&#39;, &#39;40&#39;, &#39;60+&#39;], dtype=object)</span>
</pre></div>
</div>
<p>We have <span class="math notranslate nohighlight">\(2\cdot 5=10\)</span> combinations thereof.
We can use <strong class="command">pandas.DataFrame.value_counts</strong> to determine
the number of observations at each two-dimensional level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts2</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">counts2</span>
<span class="c1">## sex  age</span>
<span class="c1">## M    30     2200</span>
<span class="c1">##      40     1708</span>
<span class="c1">##      20      879</span>
<span class="c1">##      50      541</span>
<span class="c1">## F    30      449</span>
<span class="c1">##      40      262</span>
<span class="c1">##      20      240</span>
<span class="c1">## M    60+     170</span>
<span class="c1">## F    50       43</span>
<span class="c1">##      60+      19</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>These can be converted to a two-way <em>contingency table</em>,
which is a matrix that gives
the number of occurrences of each pair of values
from the two factors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">counts2</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">V</span>
<span class="c1">## age   20    30    40   50  60+</span>
<span class="c1">## sex                           </span>
<span class="c1">## F    240   449   262   43   19</span>
<span class="c1">## M    879  2200  1708  541  170</span>
</pre></div>
</div>
<p>For example, there were 19 women aged at least 60
amongst the marathoners. Jolly good.</p>
<p>The <em>marginal</em> (one-dimensional) frequency distributions
can be recreated by computing the rowwise and columnwise sums
of <code class="docutils literal notranslate"><span class="pre">V</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## sex</span>
<span class="c1">## F    1013</span>
<span class="c1">## M    5498</span>
<span class="c1">## dtype: int64</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## age</span>
<span class="c1">## 20     1119</span>
<span class="c1">## 30     2649</span>
<span class="c1">## 40     1970</span>
<span class="c1">## 50      584</span>
<span class="c1">## 60+     189</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
</section>
<section id="combinations-of-even-more-factors">
<h3><span class="section-number">11.2.3. </span>Combinations of Even More Factors<a class="headerlink" href="#combinations-of-even-more-factors" title="Permalink to this heading"></a></h3>
<p><strong class="command">pandas.DataFrame.value_counts</strong> can also be used
with a combination of more than two categorical variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts3</span> <span class="o">=</span> <span class="p">(</span><span class="n">marathon</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">marathon</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;PL&quot;</span><span class="p">,</span> <span class="s2">&quot;UA&quot;</span><span class="p">,</span> <span class="s2">&quot;SK&quot;</span><span class="p">]),</span>
        <span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">counts3</span>
<span class="c1">##    country sex  age  count</span>
<span class="c1">## 0       PL   M   30   2081</span>
<span class="c1">## 1       PL   M   40   1593</span>
<span class="c1">## 2       PL   M   20    824</span>
<span class="c1">## 3       PL   M   50    475</span>
<span class="c1">## 4       PL   F   30    422</span>
<span class="c1">## 5       PL   F   40    248</span>
<span class="c1">## 6       PL   F   20    222</span>
<span class="c1">## 7       PL   M  60+    134</span>
<span class="c1">## 8       PL   F   50     26</span>
<span class="c1">## 9       PL   F  60+      8</span>
<span class="c1">## 10      UA   M   20      8</span>
<span class="c1">## 11      UA   M   30      8</span>
<span class="c1">## 12      UA   M   50      3</span>
<span class="c1">## 13      UA   F   30      2</span>
<span class="c1">## 14      UA   M   40      2</span>
<span class="c1">## 15      SK   F   50      1</span>
<span class="c1">## 16      SK   M   40      1</span>
<span class="c1">## 17      SK   M  60+      1</span>
</pre></div>
</div>
<p>The display is in the <em>long</em> format (compare <a class="reference internal" href="410-data-frame.html#sec-stack"><span class="std std-numref">Section 10.6.2</span></a>),
because we cannot nicely print a three-dimensional array.
Yet, we can always partially unstack the dataset,
for aesthetic reasons:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="c1">##              count                              </span>
<span class="c1">## age             20      30      40     50    60+</span>
<span class="c1">## country sex                                     </span>
<span class="c1">## PL      F    222.0   422.0   248.0   26.0    8.0</span>
<span class="c1">##         M    824.0  2081.0  1593.0  475.0  134.0</span>
<span class="c1">## SK      F      NaN     NaN     NaN    1.0    NaN</span>
<span class="c1">##         M      NaN     NaN     1.0    NaN    1.0</span>
<span class="c1">## UA      F      NaN     2.0     NaN    NaN    NaN</span>
<span class="c1">##         M      8.0     8.0     2.0    3.0    NaN</span>
</pre></div>
</div>
<p>Let us again appreciate how versatile is the concept
of data frames. Not only can we represent data to be investigated
(one row per observation, variables possibly of mixed types),
but also we can store the results of such analyses
(neatly formatted tables).</p>
</section>
</section>
<section id="visualising-factors">
<h2><span class="section-number">11.3. </span>Visualising Factors<a class="headerlink" href="#visualising-factors" title="Permalink to this heading"></a></h2>
<p>Methods for visualising categorical data are by no means
fascinating (unless we use them as grouping variables in more complex
datasets, but this is a topic that we cover in <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>).</p>
<section id="bar-plots">
<h3><span class="section-number">11.3.1. </span>Bar Plots<a class="headerlink" href="#bar-plots" title="Permalink to this heading"></a></h3>
<p>Example data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">([</span><span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span> <span class="s2">&quot;40&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span><span class="p">,</span> <span class="s2">&quot;60+&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">x</span>
<span class="c1">## 20     1119</span>
<span class="c1">## 30     2649</span>
<span class="c1">## 40     1970</span>
<span class="c1">## 50      584</span>
<span class="c1">## 60+     189</span>
<span class="c1">## Name: age, dtype: int64</span>
</pre></div>
</div>
<p>Bar plots are self-explanatory and hence
will do the trick most of the time; see <a class="reference internal" href="#fig-bar-country"><span class="std std-numref">Figure 11.1</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># 0, 1, 2, 3, 4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id15">
<span id="fig-bar-country"></span><img alt="../_images/bar-country-1.png" src="../_images/bar-country-1.png" />
<figcaption>
<p><span class="caption-number">Figure 11.1 </span><span class="caption-text">Runners’ age categories</span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">ind</span></code> vector gives the x-coordinates of the bars,
here: consecutive integers.
By calling <strong class="command">matplotlib.pyplot.xticks</strong>
we assign them readable labels.</p>
<div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.10</span>
        
    </div><div class="proof-content">
<p>Draw a bar plot for the 5 most prevalent foreign (i.e.,
excluding Polish) marathoners’ original
whereabouts which features an additional bar that represents
“all other” countries.
Depict percentages instead of counts, so that the total bar height is 100%.
Assign a different colour to each bar.</p>
</div></div><div style="margin-top: 1em"></div><p>A bar plot is a versatile tool for visualising
the counts also in the two-variable case; see
<a class="reference internal" href="#fig-bar-age-sex"><span class="std std-numref">Figure 11.2</span></a>.
Let us use <strong class="command">seaborn.barplot</strong> now, which
is a pleasant wrapper around <strong class="command">matplotlib.pyplot.bar</strong>
(but, as usual, gives less control over the details):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id17">
<span id="fig-bar-age-sex"></span><img alt="../_images/bar-age-sex-3.png" src="../_images/bar-age-sex-3.png" />
<figcaption>
<p><span class="caption-number">Figure 11.2 </span><span class="caption-text">Number of runners by age category and sex</span><a class="headerlink" href="#id17" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.11</span>
        
    </div><div class="proof-content">
<p>(*) Draw a similar chart using <strong class="command">matplotlib.pyplot.bar</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id19">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.12</span>
        
    </div><div class="proof-content">
<p>(**)
Create a stacked bar plot similar to the one
in <a class="reference internal" href="#fig-stacked-bar"><span class="std std-numref">Figure 11.3</span></a>, where we have horizontal bars for
data that have been normalised so that, for each sex, their sum is 100%.</p>
<figure class="align-default" id="id20">
<span id="fig-stacked-bar"></span><img alt="../_images/stacked-bar-5.png" src="../_images/stacked-bar-5.png" />
<figcaption>
<p><span class="caption-number">Figure 11.3 </span><span class="caption-text">An example stacked bar plot: Age distribution for different sexes amongst all the runners</span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div></div></section>
<section id="political-marketing-and-statistics">
<span id="sec-political-marketing"></span><h3><span class="section-number">11.3.2. </span>Political Marketing and Statistics<a class="headerlink" href="#political-marketing-and-statistics" title="Permalink to this heading"></a></h3>
<p>Even such a simple chart as bar plot can be manipulated.
In the second round of the presidential elections that
were held in Poland in 2020, Andrzej Duda won against
Rafał Trzaskowski. In <a class="reference internal" href="#fig-wybory1"><span class="std std-numref">Figure 11.4</span></a> we have the official results
that might be presented by the pro-government
media outlets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mf">51.03</span><span class="p">,</span> <span class="mf">48.97</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Duda&quot;</span><span class="p">,</span> <span class="s2">&quot;Trzaskowski&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">48.9</span><span class="p">,</span> <span class="mf">51.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id21">
<span id="fig-wybory1"></span><img alt="../_images/wybory1-7.png" src="../_images/wybory1-7.png" />
<figcaption>
<p><span class="caption-number">Figure 11.4 </span><span class="caption-text">Such a great victory! Wait… Just look at the y-axis tick marks.</span><a class="headerlink" href="#id21" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Another media conglomerate could have reported
it like in <a class="reference internal" href="#fig-wybory2"><span class="std std-numref">Figure 11.5</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mf">51.03</span><span class="p">,</span> <span class="mf">48.97</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Duda&quot;</span><span class="p">,</span> <span class="s2">&quot;Trzaskowski&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id22">
<span id="fig-wybory2"></span><img alt="../_images/wybory2-9.png" src="../_images/wybory2-9.png" />
<figcaption>
<p><span class="caption-number">Figure 11.5 </span><span class="caption-text">It was a draw! So close!</span><a class="headerlink" href="#id22" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We should always read the axis tick marks.
And when drawing our own bar plots, we must never trick the reader;
this is unethical; compare Rule#9.</p>
</div>
</section>
<section id="pie-cha-don-t-even-trip">
<h3><span class="section-number">11.3.3. </span>Pie Cha… Don’t Even Trip<a class="headerlink" href="#pie-cha-don-t-even-trip" title="Permalink to this heading"></a></h3>
<p>We are definitely not going to discuss the infamous
pie charts, because
their use in data analysis has been widely criticised for a long time
(it is difficult to judge the ratios of areas of their slices).
Do not draw them. Ever. Good morning.</p>
</section>
<section id="pareto-charts">
<h3><span class="section-number">11.3.4. </span>Pareto Charts (*)<a class="headerlink" href="#pareto-charts" title="Permalink to this heading"></a></h3>
<p>As a general (empirical) rule, it is usually the case
that most instances of something’s happening (usually 70–90%)
are due to only a few causes (10–30%). This is known as the <em>Pareto principle</em>
(with 80% vs 20% being an often cited rule of thumb).</p>
<div class="proof proof-type-example" id="id23">

    <div class="proof-title">
        <span class="proof-type">Example 11.13</span>
        
    </div><div class="proof-content">
<p>In <a class="reference internal" href="230-distribution.html#chap-distribution"><span class="std std-numref">Chapter 6</span></a> we modelled
the US cities’ population dataset using the Pareto distribution
(the very same Pareto, but a different, yet related mathematical object).
We discovered that only ca. 14% of the settlements (those
with 10,000 or more inhabitants) are home to as much as
84% of the population. Hence, we may say that this data domain
follows the Pareto rule.</p>
</div></div><p>Here is a <a class="reference external" href="https://www.cec.health.nsw.gov.au/CEC-Academy/quality-improvement-tools/pareto-charts">dataset</a> fabricated by the
Clinical Excellence Commission in New South Wales, Australia,
listing the most frequent causes of medication errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cat_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="s2">&quot;Unauthorised drug&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong IV rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong patient&quot;</span><span class="p">,</span> <span class="s2">&quot;Dose missed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Underdose&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong calculation&quot;</span><span class="p">,</span><span class="s2">&quot;Wrong route&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrong drug&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Wrong time&quot;</span><span class="p">,</span> <span class="s2">&quot;Technique error&quot;</span><span class="p">,</span> <span class="s2">&quot;Duplicated drugs&quot;</span><span class="p">,</span> <span class="s2">&quot;Overdose&quot;</span>
<span class="p">])</span>
<span class="n">counts_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">59</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts_med</span><span class="p">)</span>  <span class="c1"># total number of medication errors</span>
<span class="c1">## 430</span>
</pre></div>
</div>
<p>Let us display the dataset ordered with respect to the counts,
decreasingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">med</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">counts_med</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cat_med</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">med</span>
<span class="c1">## Dose missed          92</span>
<span class="c1">## Wrong time           83</span>
<span class="c1">## Wrong drug           76</span>
<span class="c1">## Overdose             59</span>
<span class="c1">## Wrong patient        53</span>
<span class="c1">## Wrong route          27</span>
<span class="c1">## Wrong calculation    16</span>
<span class="c1">## Duplicated drugs      9</span>
<span class="c1">## Underdose             7</span>
<span class="c1">## Wrong IV rate         4</span>
<span class="c1">## Technique error       3</span>
<span class="c1">## Unauthorised drug     1</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>Pareto charts may aid in visualising the datasets
where the Pareto principle is likely to hold, at least
approximately. They include bar plots with some extras:</p>
<ul class="simple">
<li><p>bars are listed in decreasing order,</p></li>
<li><p>the cumulative percentage curve is added.</p></li>
</ul>
<p>The plotting of the Pareto chart is a little tricky,
because it involves using two different Y axes
(as usual, fine-tuning the figure and studying the manual
of the <strong class="program">matplotlib</strong> package is left as an exercise.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">med</span><span class="p">))</span>  <span class="c1"># 0, 1, 2, ...</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">100.0</span><span class="o">*</span><span class="n">med</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">med</span><span class="p">)</span>  <span class="c1"># percentages</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">med</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># creates a new coordinate system with a shared x-axis</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;ro-&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cumulative %&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id24">
<span id="fig-pareto-chart"></span><img alt="../_images/pareto-chart-11.png" src="../_images/pareto-chart-11.png" />
<figcaption>
<p><span class="caption-number">Figure 11.6 </span><span class="caption-text">An example Pareto chart: the most frequent causes for medication errors</span><a class="headerlink" href="#id24" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>From <a class="reference internal" href="#fig-pareto-chart"><span class="std std-numref">Figure 11.6</span></a>, we can read that the first five causes
(less than 40%) correspond to ca. 85% of the medication errors.
More precisely, the cumulative probabilities are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">med</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">med</span><span class="p">)</span>
<span class="c1">## Dose missed          0.213953</span>
<span class="c1">## Wrong time           0.406977</span>
<span class="c1">## Wrong drug           0.583721</span>
<span class="c1">## Overdose             0.720930</span>
<span class="c1">## Wrong patient        0.844186</span>
<span class="c1">## Wrong route          0.906977</span>
<span class="c1">## Wrong calculation    0.944186</span>
<span class="c1">## Duplicated drugs     0.965116</span>
<span class="c1">## Underdose            0.981395</span>
<span class="c1">## Wrong IV rate        0.990698</span>
<span class="c1">## Technique error      0.997674</span>
<span class="c1">## Unauthorised drug    1.000000</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Note that there is an explicit assumption here that
a single error is only due to a single cause.
Also, we presume that each medication error has a similar degree of
severity.</p>
<p>Policymakers and quality controllers often rely on similar simplifications.
They most probably are going to be addressing only the
top causes. If we ever wondered why some processes (mal)function the way
they do, there is a hint above. Inventing something
more effective yet so simple at the same time requires much more effort.</p>
<p>It would be also nice to report the number of cases
where no mistakes are made and the cases where errors
are insignificant. Healthcare workers are doing a wonderful job
for our communities, especially in the public system.
Why add to their stress?</p>
</section>
<section id="heat-maps">
<h3><span class="section-number">11.3.5. </span>Heat Maps<a class="headerlink" href="#heat-maps" title="Permalink to this heading"></a></h3>
<p>Two-way contingency tables can be depicted by means of a heatmap,
where each count influences the corresponding cell’s colour intensity;
see <a class="reference internal" href="#fig-heat-map-marathon"><span class="std std-numref">Figure 11.7</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;copper&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id25">
<span id="fig-heat-map-marathon"></span><img alt="../_images/heat-map-marathon-13.png" src="../_images/heat-map-marathon-13.png" />
<figcaption>
<p><span class="caption-number">Figure 11.7 </span><span class="caption-text">A heatmap for the marathoners’ sex and age category</span><a class="headerlink" href="#id25" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="aggregating-and-comparing-factors">
<h2><span class="section-number">11.4. </span>Aggregating and Comparing Factors<a class="headerlink" href="#aggregating-and-comparing-factors" title="Permalink to this heading"></a></h2>
<section id="a-mode">
<h3><span class="section-number">11.4.1. </span>A Mode<a class="headerlink" href="#a-mode" title="Permalink to this heading"></a></h3>
<p>The only operation on categorical data on which we can rely is counting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1">## PL    6033</span>
<span class="c1">## GB      71</span>
<span class="c1">## DE      38</span>
<span class="c1">## FR      33</span>
<span class="c1">## SE      30</span>
<span class="c1">## Name: country, dtype: int64</span>
</pre></div>
</div>
<p>Therefore, as far as qualitative data aggregation is concerned,
what we are left with is the <em>mode</em>, i.e., the most frequently
occurring value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># counts are sorted</span>
<span class="c1">## &#39;PL&#39;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A mode might be ambiguous.</p>
</div>
<p>It turns out that amongst the fastest 22 runners (a nicely round number),
there is a tie between Kenya and Poland – both meet our definition
of a mode:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">22</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">counts</span>
<span class="c1">## KE    7</span>
<span class="c1">## PL    7</span>
<span class="c1">## ET    3</span>
<span class="c1">## IL    3</span>
<span class="c1">## MA    1</span>
<span class="c1">## MD    1</span>
<span class="c1">## Name: country, dtype: int64</span>
</pre></div>
</div>
<p>To avoid any bias, it is always best to report all the potential mode
candidates:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">counts</span> <span class="o">==</span> <span class="n">counts</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span>
<span class="c1">## Index([&#39;KE&#39;, &#39;PL&#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<p>If one value is required, though,
we can pick one at random (calling <strong class="command">numpy.random.choice</strong>).</p>
</section>
<section id="binary-data-as-logical-vectors">
<h3><span class="section-number">11.4.2. </span>Binary Data as Logical Vectors<a class="headerlink" href="#binary-data-as-logical-vectors" title="Permalink to this heading"></a></h3>
<p>Recall that we are used to representing binary data as logical
vectors or, equivalently, vectors of 0s and 1s.</p>
<p>Perhaps the most useful arithmetic operation on
logical vectors is the sum. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">country</span> <span class="o">==</span> <span class="s2">&quot;PL&quot;</span><span class="p">)</span>
<span class="c1">## 6033</span>
</pre></div>
</div>
<p>This gave the number of elements that are equal to <code class="docutils literal notranslate"><span class="pre">&quot;PL&quot;</span></code>
(because the sum of 0s and 1s is equal to the number of 1s in the sequence).
Note that <code class="docutils literal notranslate"><span class="pre">(country</span> <span class="pre">==</span> <span class="pre">&quot;PL&quot;)</span></code> is a logical vector that
represents a binary categorical variable
with levels: not-Poland (<code class="docutils literal notranslate"><span class="pre">False</span></code>) and Poland (<code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
<div style="margin-top: 1em"></div><p>If we divide the above result by the length of the vector,
we will get the proportion:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">marathon</span><span class="o">.</span><span class="n">country</span> <span class="o">==</span> <span class="s2">&quot;PL&quot;</span><span class="p">)</span>
<span class="c1">## 0.9265857779142989</span>
</pre></div>
</div>
<p>About 93% of the runners were from Poland.
As this is greater than 0.5, <code class="docutils literal notranslate"><span class="pre">&quot;PL</span></code>” is definitely the mode.</p>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.14</span>
        
    </div><div class="proof-content">
<p>What is the meaning of
<strong class="command">numpy.all</strong>, <strong class="command">numpy.any</strong>, <strong class="command">numpy.min</strong>,
<strong class="command">numpy.max</strong>, <strong class="command">numpy.cumsum</strong>, and
<strong class="command">numpy.cumprod</strong>
applied on logical vectors?</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**)
Having the 0/1 (or zero/nonzero) vs <code class="docutils literal notranslate"><span class="pre">False</span></code>/<code class="docutils literal notranslate"><span class="pre">True</span></code> correspondence
allows us to perform some logical operations using integer arithmetic.
In mathematics, 0 is the annihilator of multiplication
and the neutral element of addition,
whereas 1 is the neutral element of multiplication.
In particular, assuming that <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">q</span></code> are logical values
and <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are numeric ones, we have, what follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">!=</span> <span class="pre">0</span></code> means that at least one value is <code class="docutils literal notranslate"><span class="pre">True</span></code>
and <code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">0</span></code> if and only if both are <code class="docutils literal notranslate"><span class="pre">False</span></code>;</p></li>
<li><p>more generally, <code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">2</span></code> if both elements are <code class="docutils literal notranslate"><span class="pre">True</span></code>,
<code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">1</span></code> if only one is <code class="docutils literal notranslate"><span class="pre">True</span></code> (we call it exclusive-or, XOR),
and <code class="docutils literal notranslate"><span class="pre">p+q</span> <span class="pre">==</span> <span class="pre">0</span></code> if both are <code class="docutils literal notranslate"><span class="pre">False</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p*q</span> <span class="pre">!=</span> <span class="pre">0</span></code> means that both values are <code class="docutils literal notranslate"><span class="pre">True</span></code>
and <code class="docutils literal notranslate"><span class="pre">p*q</span> <span class="pre">==</span> <span class="pre">0</span></code> holds whenever at least one is <code class="docutils literal notranslate"><span class="pre">False</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1-p</span></code> corresponds to the negation of <code class="docutils literal notranslate"><span class="pre">p</span></code> (changes 1 to 0 and 0 to 1);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p*a</span> <span class="pre">+</span> <span class="pre">(1-p)*b</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">a</span></code> if <code class="docutils literal notranslate"><span class="pre">p</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> and equal to <code class="docutils literal notranslate"><span class="pre">b</span></code> otherwise.</p></li>
</ul>
</div>
</section>
<section id="pearson-s-chi-squared-test">
<span id="sec-chisq-test"></span><h3><span class="section-number">11.4.3. </span>Pearson’s Chi-Squared Test (*)<a class="headerlink" href="#pearson-s-chi-squared-test" title="Permalink to this heading"></a></h3>
<p>The Kolmogorov–Smirnov test that we described in <a class="reference internal" href="230-distribution.html#sec-ks-test"><span class="std std-numref">Section 6.2.3</span></a>
verifies whether a given sample differs significantly from
a hypothesised <em>continuous</em><a class="footnote-reference brackets" href="#footdiscreteks" id="id2">2</a> distribution, i.e.,
it works for <em>numeric</em> data.</p>
<p>For binned/categorical data, we can use a classical
and easy-to-understand test developed by Karl Pearson in 1900.
It is supposed to judge whether the differences between the observed
proportions <span class="math notranslate nohighlight">\(\hat{p}_1,\dots,\hat{p}_l\)</span> and the
theoretical ones <span class="math notranslate nohighlight">\(p_1,\dots,p_l\)</span> are significantly large or not:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left\{
\begin{array}{rll}
H_0: &amp; \hat{p}_i=p_i\ \text{ for all }i=1,\dots,l &amp; \text{(null hypothesis)}\\
H_1: &amp; \hat{p}_i\neq p_i\ \text{ for some }i=1,\dots,l &amp; \text{(alternative hypothesis)} \\
\end{array}
\right.
\end{split}\]</div>
<p>Having such a test is beneficial, e.g., when
the data we have at hand are based on small surveys
that are supposed to serve as estimates of what might be happening in
a larger population.</p>
<p>Going back to our political example from <a class="reference internal" href="#sec-political-marketing"><span class="std std-numref">Section 11.3.2</span></a>,
it turns out that one of the pre-election polls indicated that <span class="math notranslate nohighlight">\(c=516\)</span>
out of <span class="math notranslate nohighlight">\(n=1017\)</span> people would vote for the first candidate.
We have <span class="math notranslate nohighlight">\(\hat{p}_1=50.74\%\)</span> (Duda)
and <span class="math notranslate nohighlight">\(\hat{p}_2=49.26\%\)</span> (Trzaskowski).
If we would like to test whether the observed proportions
are significantly different from each other, we could test them
against the theoretical distribution <span class="math notranslate nohighlight">\(p_1=50\%\)</span> and <span class="math notranslate nohighlight">\(p_2=50\%\)</span>,
which states that there is a tie between the competitors
(up to a sampling error).</p>
<p>A natural test statistic is based on the relative squared differences:</p>
<div class="math notranslate nohighlight">
\[
\hat{T} = n \sum_{i=1}^l \frac{\left(\hat{p}_i-p_i\right)^2}{p_i}.
\]</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">516</span><span class="p">,</span> <span class="mi">1017</span>
<span class="n">p_observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">c</span><span class="p">])</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">p_expected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">p_observed</span><span class="o">-</span><span class="n">p_expected</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">p_expected</span> <span class="p">)</span>
<span class="n">T</span>
<span class="c1">## 0.2212389380530986</span>
</pre></div>
</div>
<p>Similarly to the continuous case in <a class="reference internal" href="230-distribution.html#sec-ks-test"><span class="std std-numref">Section 6.2.3</span></a>,
we should reject the null hypothesis, if:</p>
<div class="math notranslate nohighlight">
\[
\hat{T} \ge K.
\]</div>
<p>The critical value <span class="math notranslate nohighlight">\(K\)</span> is computed based
on the fact that, if the null hypothesis is true,
<span class="math notranslate nohighlight">\(\hat{T}\)</span> follows the <span class="math notranslate nohighlight">\(\chi^2\)</span> (chi-squared, hence the name of the test)
distribution with <span class="math notranslate nohighlight">\(l-1\)</span> degrees of freedom,
see <strong class="command">scipy.stats.chi2</strong>.</p>
<p>We thus need to query the theoretical quantile function to determine
the test statistic that is not exceeded in 99.9% of the trials
(under the null hypothesis):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># significance level</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_observed</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## 10.827566170662733</span>
</pre></div>
</div>
<p>As <span class="math notranslate nohighlight">\(\hat{T} &lt; K\)</span> (because <span class="math notranslate nohighlight">\(0.22 &lt; 10.83\)</span>), we cannot deem
the two proportions significantly different.
In other words, this poll did not indicate (at the significance
level <span class="math notranslate nohighlight">\(0.1\%\)</span>) any of the candidates as a clear winner.</p>
<div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.15</span>
        
    </div><div class="proof-content">
<p>Assuming <span class="math notranslate nohighlight">\(n=1017\)</span>,
determine the smallest <span class="math notranslate nohighlight">\(c\)</span>, i.e., the number of respondents
claiming they would vote for Duda,
that leads to the rejection of the null hypothesis.</p>
</div></div></section>
<section id="two-sample-pearson-s-chi-squared-test">
<span id="sec-chisq-test2"></span><h3><span class="section-number">11.4.4. </span>Two-Sample Pearson’s Chi-Squared Test (*)<a class="headerlink" href="#two-sample-pearson-s-chi-squared-test" title="Permalink to this heading"></a></h3>
<p>Let us consider the data depicted in <a class="reference internal" href="#fig-stacked-bar"><span class="std std-numref">Figure 11.3</span></a>
and test whether the runners’ age distributions
differ significantly between men and women.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">marathon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>  <span class="c1"># first row, second row</span>
<span class="n">c1</span>  <span class="c1"># women</span>
<span class="c1">## array([240, 449, 262,  43,  19])</span>
<span class="n">c2</span>  <span class="c1"># men</span>
<span class="c1">## array([ 879, 2200, 1708,  541,  170])</span>
</pre></div>
</div>
<p>There are <span class="math notranslate nohighlight">\(l=5\)</span> age categories.
First, denote the total number of observations
in both groups with <span class="math notranslate nohighlight">\(n'\)</span> and <span class="math notranslate nohighlight">\(n''\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n1</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
<span class="c1">## (1013, 5498)</span>
</pre></div>
</div>
<p>The observed proportions in the first group (females),
denoted as <span class="math notranslate nohighlight">\(\hat{p}_1',\dots,\hat{p}_l'\)</span>, are, respectively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span> <span class="o">=</span> <span class="n">c1</span><span class="o">/</span><span class="n">n1</span>
<span class="n">p1</span>
<span class="c1">## array([0.23692004, 0.44323791, 0.25863771, 0.04244817, 0.01875617])</span>
</pre></div>
</div>
<p>Here are the proportions in the second group (males),
<span class="math notranslate nohighlight">\(\hat{p}_1'',\dots,\hat{p}_l''\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">/</span><span class="n">n2</span>
<span class="n">p2</span>
<span class="c1">## array([0.15987632, 0.40014551, 0.31065842, 0.09839942, 0.03092033])</span>
</pre></div>
</div>
<p>We would like to verify whether the corresponding proportions are equal
(up to some sampling error):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left\{
\begin{array}{rll}
H_0: &amp; \hat{p}_i'=\hat{p}_i''\ \text{ for all }i=1,\dots,l &amp; \text{(null hypothesis)}\\
H_1: &amp; \hat{p}_i'\neq \hat{p}_i''\ \text{ for some }i=1,\dots,l &amp; \text{(alternative hypothesis)} \\
\end{array}
\right.
\end{split}\]</div>
<p>In other words, we are interested whether the categorical data in the two
groups come from the same discrete probability distribution.</p>
<p>Taking the estimated expected proportions:</p>
<div class="math notranslate nohighlight">
\[\bar{p}_i = \frac{n_i' \hat{p}_i' + n_i'' \hat{p}_i''}{n'+n''},\]</div>
<p>for all <span class="math notranslate nohighlight">\(i=1,\dots,l\)</span>,
the test statistic this time is equal to:</p>
<div class="math notranslate nohighlight">
\[
\hat{T} =
n'  \sum_{i=1}^l \frac{\left(\hat{p}_i' -\bar{p}_i\right)^2}{\bar{p}_i} +
n'' \sum_{i=1}^l \frac{\left(\hat{p}_i''-\bar{p}_i\right)^2}{\bar{p}_i},
\]</div>
<p>which is a variation on the one-sample theme
presented in the previous subsection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pp</span> <span class="o">=</span> <span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="n">p1</span><span class="o">+</span><span class="n">n2</span><span class="o">*</span><span class="n">p2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">pp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">pp</span> <span class="p">)</span> <span class="o">+</span> <span class="n">n2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">pp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">pp</span> <span class="p">)</span>
<span class="n">T</span>
<span class="c1">## 75.31373854741857</span>
</pre></div>
</div>
<p>It can be shown that, if the null hypothesis is true,
the test statistic <em>approximately</em> follows
the <span class="math notranslate nohighlight">\(\chi^2\)</span> distribution with <span class="math notranslate nohighlight">\(l-1\)</span> degrees of freedom<a class="footnote-reference brackets" href="#recipesdof" id="id3">3</a>.
The critical value <span class="math notranslate nohighlight">\(K\)</span> is equal to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># significance level</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## 18.46682695290317</span>
</pre></div>
</div>
<p>As <span class="math notranslate nohighlight">\(\hat{T} \ge K\)</span> (because <span class="math notranslate nohighlight">\(75.31 \ge 18.47\)</span>),
we reject the null hypothesis. And so, the runners’ age distribution
differs across sexes (at significance level 0.1%).</p>
</section>
<section id="measuring-association">
<h3><span class="section-number">11.4.5. </span>Measuring Association (*)<a class="headerlink" href="#measuring-association" title="Permalink to this heading"></a></h3>
<p>Let us consider the Australian Bureau of Statistics
<a class="reference external" href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey-first-results/2017-18">National Health Survey 2018</a>
data on the prevalence of certain medical conditions
as a function of age. Here is the extracted contingency table:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Arthritis&quot;</span><span class="p">,</span> <span class="s2">&quot;Asthma&quot;</span><span class="p">,</span> <span class="s2">&quot;Back problems&quot;</span><span class="p">,</span> <span class="s2">&quot;Cancer (malignant neoplasms)&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Chronic obstructive pulmonary disease&quot;</span><span class="p">,</span> <span class="s2">&quot;Diabetes mellitus&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Heart, stroke and vascular disease&quot;</span><span class="p">,</span> <span class="s2">&quot;Kidney disease&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Mental and behavioural conditions&quot;</span><span class="p">,</span> <span class="s2">&quot;Osteoporosis&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;15-44&quot;</span><span class="p">,</span> <span class="s2">&quot;45-64&quot;</span><span class="p">,</span> <span class="s2">&quot;65+&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span> <span class="mf">360.2</span><span class="p">,</span>     <span class="mf">1489.0</span><span class="p">,</span>      <span class="mf">1772.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1069.7</span><span class="p">,</span>      <span class="mf">741.9</span><span class="p">,</span>       <span class="mf">433.7</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1469.6</span><span class="p">,</span>     <span class="mf">1513.3</span><span class="p">,</span>       <span class="mf">955.3</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">28.1</span><span class="p">,</span>      <span class="mf">162.7</span><span class="p">,</span>       <span class="mf">237.5</span><span class="p">],</span>
    <span class="p">[</span> <span class="mf">103.8</span><span class="p">,</span>      <span class="mf">207.0</span><span class="p">,</span>       <span class="mf">251.9</span><span class="p">],</span>
    <span class="p">[</span> <span class="mf">135.4</span><span class="p">,</span>      <span class="mf">427.3</span><span class="p">,</span>       <span class="mf">607.7</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">94.0</span><span class="p">,</span>      <span class="mf">344.4</span><span class="p">,</span>       <span class="mf">716.0</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">29.6</span><span class="p">,</span>       <span class="mf">67.7</span><span class="p">,</span>       <span class="mf">123.3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2218.9</span><span class="p">,</span>     <span class="mf">1390.6</span><span class="p">,</span>       <span class="mf">725.0</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">36.1</span><span class="p">,</span>      <span class="mf">312.3</span><span class="p">,</span>       <span class="mf">564.7</span><span class="p">],</span>
<span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">##                                          15-44    45-64      65+</span>
<span class="c1">## Arthritis                               360000  1489000  1772000</span>
<span class="c1">## Asthma                                 1069000   741000   433000</span>
<span class="c1">## Back problems                          1469000  1513000   955000</span>
<span class="c1">## Cancer (malignant neoplasms)             28000   162000   237000</span>
<span class="c1">## Chronic obstructive pulmonary disease   103000   207000   251000</span>
<span class="c1">## Diabetes mellitus                       135000   427000   607000</span>
<span class="c1">## Heart, stroke and vascular disease       94000   344000   716000</span>
<span class="c1">## Kidney disease                           29000    67000   123000</span>
<span class="c1">## Mental and behavioural conditions      2218000  1390000   725000</span>
<span class="c1">## Osteoporosis                             36000   312000   564000</span>
</pre></div>
</div>
<p>Cramér’s <span class="math notranslate nohighlight">\(V\)</span> is one of a few ways
to measure the degree of association between two categorical variables.
It is equal to 0 (the lowest possible value) if the two variables are
independent (there is no association between them)
and 1 (the highest possible value) if they are tied.</p>
<p>Given a two-way contingency table <span class="math notranslate nohighlight">\(C\)</span> with <span class="math notranslate nohighlight">\(n\)</span> rows and
<span class="math notranslate nohighlight">\(m\)</span> columns and assuming that:</p>
<div class="math notranslate nohighlight">
\[
T = \sum_{i=1}^n \sum_{j=1}^m \frac{(c_{i,j} - e_{i,j})^2}{e_{i,j}},
\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[
e_{i,j} = \frac{
\left(\sum_{k=1}^m c_{i,k}\right)  \left(\sum_{k=1}^n c_{k,j}\right)
}{
\sum_{i=1}^n \sum_{j=1}^m c_{i,j}
},
\]</div>
<p>the Cramér coefficient is given by:</p>
<div class="math notranslate nohighlight">
\[
V = \sqrt{
\frac{T}{\min\{n-1, m-1\} \sum_{i=1}^n \sum_{j=1}^m c_{i,j}}
}.
\]</div>
<p>Here, <span class="math notranslate nohighlight">\(c_{i,j}\)</span> gives the actually observed counts and <span class="math notranslate nohighlight">\(e_{i, j}\)</span> denotes
the number that we would expect to see
if the two variables were really independent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">contingency</span><span class="o">.</span><span class="n">association</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="c1">## 0.316237999724298</span>
</pre></div>
</div>
<p>The above means that there might be a small association between
age and the prevalence of certain conditions.
In other words, it might be the case that some conditions
are more prevalent in different age groups than others.</p>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.16</span>
        
    </div><div class="proof-content">
<p>Compute the Cramér <span class="math notranslate nohighlight">\(V\)</span> using only <strong class="program">numpy</strong> functions.</p>
</div></div><div class="proof proof-type-example" id="id29">

    <div class="proof-title">
        <span class="proof-type">Example 11.17</span>
        
    </div><div class="proof-content">
<p>(**)
We can easily verify the hypothesis whether <span class="math notranslate nohighlight">\(V\)</span> does not differ
significantly from <span class="math notranslate nohighlight">\(0\)</span>, i.e., whether the variables are independent.
Looking at <span class="math notranslate nohighlight">\(T\)</span>, we see that this is essentially the test statistic
in Pearson’s chi-squared goodness-of-fit test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">C</span><span class="o">-</span><span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span>
<span class="n">T</span>
<span class="c1">## 3715440.465191512</span>
</pre></div>
</div>
<p>If the data are really independent, <span class="math notranslate nohighlight">\(T\)</span> follows the chi-squared distribution
<span class="math notranslate nohighlight">\(n + m - 1\)</span>. As a consequence, the critical value <span class="math notranslate nohighlight">\(K\)</span> is equal to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># significance level</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">## 32.90949040736021</span>
</pre></div>
</div>
<p>As <span class="math notranslate nohighlight">\(T\)</span> is much greater than <span class="math notranslate nohighlight">\(K\)</span>, we conclude
(at significance level <span class="math notranslate nohighlight">\(0.1\%\)</span>) that
the health conditions are not independent of age.</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.18</span>
        
    </div><div class="proof-content">
<p>(*)
Take a look at <em>Table 19: Comorbidity of selected chronic conditions</em> in the
<a class="reference external" href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey-first-results/2017-18">National Health Survey 2018</a>,
where we clearly see that many disorders co-occur.
Visualise them on some heatmaps and bar plots (including
data grouped by sex and age).</p>
</div></div></section>
<section id="binned-numeric-data">
<h3><span class="section-number">11.4.6. </span>Binned Numeric Data<a class="headerlink" href="#binned-numeric-data" title="Permalink to this heading"></a></h3>
<p>Generally, modes are meaningless for continuous data,
where repeated values are – at least theoretically – highly unlikely.
It might make sense to compute them on binned data, though.</p>
<p>Looking at a histogram, e.g., in <a class="reference internal" href="210-vector.html#fig-heights-histogram-bins11"><span class="std std-numref">Figure 4.2</span></a>,
the mode is the interval corresponding to the
highest bar (hopefully assuming there is only one).
If we would like to obtain a single number, we can choose
for example the middle of this interval as the mode.</p>
<p>For numeric data, the mode will heavily depend
on the coarseness and type of binning; compare
<a class="reference internal" href="210-vector.html#fig-income-histogram-binnumber"><span class="std std-numref">Figure 4.4</span></a> and <a class="reference internal" href="230-distribution.html#fig-heights-lognormal"><span class="std std-numref">Figure 6.7</span></a>.
Thus, the question “what is the most popular income” is overall a
quite difficult one to answer.</p>
<div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.19</span>
        
    </div><div class="proof-content">
<p>Compute some potentially informative modes for
the <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/uk_income_simulated_2020.txt">2020 UK income</a> data.
Play around with different numbers
of bins on linear and logarithmic scales and see how they affect the mode.</p>
</div></div></section>
<section id="ordinal-data">
<span id="sec-ordinal-data"></span><h3><span class="section-number">11.4.7. </span>Ordinal Data (*)<a class="headerlink" href="#ordinal-data" title="Permalink to this heading"></a></h3>
<p>The case where the categories can be linearly ordered,
is called <em>ordinal data</em>. For instance,
Australian university grades are: F (fail) &lt; P (pass) &lt; C (credit) &lt; D
(distinction) &lt; HD (high distinction), some questionnaires
use Likert-type scales such as “strongly disagree” &lt; “disagree” &lt;
“neutral” &lt; “agree” &lt; “strongly agree”, etc.</p>
<p>A linear ordering allows us to go beyond the mode. This is because,
due to the existence of order statistics and observation ranks,
we can also easily define sample quantiles.
Nevertheless, the standard methods for resolving ties will not work:
we need to be careful.</p>
<p>For example, the median of a sample of student grades
(P, P, C, D, HD) is C, but
(P, P, C, D, HD, HD) is either C or D - we can choose one at random
or just report that the solution is ambiguous (C+? D-? C/D?).</p>
<p>Another option, of course, is to treat ordinal data as numbers
(e.g., F=0, P=1, …, HD=4). In the latter example, the median would
be equal to 2.5.</p>
<p>There are some cases, though, where the conversion of
labels to consecutive integers is far from optimal – because
it gives the impression that the “distance” between different
levels is always equal (linear).</p>
<div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.20</span>
        
    </div><div class="proof-content">
<p>(**)
The <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/grades_results.txt"><code class="docutils literal notranslate"><span class="pre">grades_results</span></code></a>
dataset represents the grades (F, P, C, D, HD)
of 100 students attending an imaginary course in an Australian
university. You can load it in the form of an <em>ordered</em> categorical <code class="docutils literal notranslate"><span class="pre">Series</span></code>
by calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/grades_results.txt&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="n">grades</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">grades</span><span class="p">,</span>
    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;HD&quot;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">grades</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>  <span class="c1"># note the order of labels</span>
<span class="c1">## F     30</span>
<span class="c1">## P     29</span>
<span class="c1">## C     23</span>
<span class="c1">## HD    22</span>
<span class="c1">## D     19</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>How would you determine the <em>average</em> grade represented as
a number between 0 and 100, taking into account that
for a P you need at least 50%, C is given for ≥ 60%,
D for ≥ 70%, and HD for only (!) 80% of the points.
Come up with a pessimistic, optimistic, and best-shot estimate,
and then compare your result
to the true corresponding scores listed in the
<a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/grades_scores.txt"><code class="docutils literal notranslate"><span class="pre">grades_scores</span></code></a> dataset.</p>
</div></div></section>
</section>
<section id="exercises">
<h2><span class="section-number">11.5. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading"></a></h2>
<div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.21</span>
        
    </div><div class="proof-content">
<p>Does it make sense to compute the arithmetic mean of a categorical
variable?</p>
</div></div><div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.22</span>
        
    </div><div class="proof-content">
<p>Name the basic use cases for categorical data.</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.23</span>
        
    </div><div class="proof-content">
<p>(*) What is a Pareto chart?</p>
</div></div><div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.24</span>
        
    </div><div class="proof-content">
<p>How can we deal with the case of the mode being nonunique?</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.25</span>
        
    </div><div class="proof-content">
<p>What is the meaning of the sum and mean for binary data (logical vectors)?</p>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.26</span>
        
    </div><div class="proof-content">
<p>What is the meaning of <strong class="command">numpy.mean</strong><code class="code docutils literal notranslate"><span class="pre">((x</span> <span class="pre">&gt;</span> <span class="pre">0)</span> <span class="pre">&amp;</span> <span class="pre">(x</span> <span class="pre">&lt;</span> <span class="pre">1))</span></code>,
where <code class="docutils literal notranslate"><span class="pre">x</span></code> is a numeric vector?</p>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.27</span>
        
    </div><div class="proof-content">
<p>List some ways to visualise multidimensional categorical data
(combinations of two or more factors).</p>
</div></div><div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.28</span>
        
    </div><div class="proof-content">
<p>(*)
State the null hypotheses verified by the one- and two-sample
chi-squared goodness-of-fit tests.</p>
</div></div><div class="proof proof-type-exercise" id="id41">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.29</span>
        
    </div><div class="proof-content">
<p>(*) How is Cramér’s <em>V</em> defined and what values does it take?</p>
</div></div><hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="footidx"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>This coincides with the possible indexes into an
array of length <em>l</em>. In some other languages, e.g., R,
we would use integers between 1 and <em>l</em> (inclusive).
Nevertheless, a dataset creator is free to encode the labels
however they want. For example, <code class="docutils literal notranslate"><span class="pre">DMDBORN4</span></code> in NHANES has:
1 (born in 50 US states or Washington, DC),
2 (others),
77 (refused to answer), and
99 (do not know).</p>
</dd>
<dt class="label" id="footdiscreteks"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>(*) There exists a discrete version of the
Kolmogorov–Smirnov test, but it is defined in a different
way than in <a class="reference internal" href="230-distribution.html#sec-ks-test"><span class="std std-numref">Section 6.2.3</span></a>; compare <span id="id4">[<a class="reference internal" href="999-bibliography.html#id147" title="T.B. Arnold and J.W. Emerson. Nonparametric goodness-of-fit tests for discrete null distributions. The R Journal, 3(2):34–39, 2011. doi:10.32614/RJ-2011-016.">AE11</a>, <a class="reference internal" href="999-bibliography.html#id146" title="W.J. Conover. A Kolmogorov goodness-of-fit test for discontinuous distributions. Journal of the American Statistical Association, 67(339):591–596, 1972. doi:10.1080/01621459.1972.10481254.">Con72</a>]</span>.</p>
</dd>
<dt class="label" id="recipesdof"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Notice that <span id="id5">[<a class="reference internal" href="999-bibliography.html#id140" title="W.H. Press, S.A. Teukolsky, W.T. Vetterling, and B.P. Flannery. Numerical Recipes. The Art of Scientific Computing. Cambridge University Press, 2007.">PTVF07</a>]</span> in Section 14.3
recommends <span class="math notranslate nohighlight">\(l\)</span> degrees of freedom, but we do not agree with
this rather informal reasoning.
Also, simple Monte Carlo simulations suggest that <span class="math notranslate nohighlight">\(l-1\)</span>
is a better candidate.</p>
</dd>
</dl>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="430-group-by.html" class="btn btn-neutral float-right" title="12. Processing Data in Groups" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="410-data-frame.html" class="btn btn-neutral float-left" title="10. Introducing Data Frames" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright &#169; 2022 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>. Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.

    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a>
    theme.
      <span class="lastupdated">
        Last updated on 2022-08-12T12:27:03+1000.
      </span>


    This site will never display any ads: it is a non-profit project.
    It does not collect any data.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>