<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Minimalist Data Wrangling with Python" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2025" name="citation_date" />
<meta content="2025" name="citation_publication_date" />
<meta content="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf" name="citation_pdf_url" />
<meta content="https://datawranglingpy.gagolewski.com/" name="citation_public_url" />
<meta content="10.5281/zenodo.6451068" name="citation_doi" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Minimalist Data Wrangling with Python" name="twitter:title" />
<meta content="Minimalist Data Wrangling with Python" name="og:title" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="twitter:description" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="og:description" />
<meta content="gagolews/datawranglingpy" name="og:site_name" />
<meta content="https://datawranglingpy.gagolewski.com/" name="og:url" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://datawranglingpy.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571912" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="11. Handling categorical data" href="420-categorical.html" /><link rel="prev" title="9. Exploring relationships between variables" href="330-relationship.html" />
        <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/410-data-frame.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/datawranglingpy.png"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>10. Introducing data frames - Minimalist Data Wrangling with Python</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=a4cbedb2" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Minimalist Data Wrangling with Python</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/datawranglingpy.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Minimalist Data Wrangling with Python</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.1.0.9002
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/">Deep R programming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar types and control structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and other types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional numeric data and their empirical distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing unidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous probability distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. From uni- to multidimensional numeric data</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing multidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring relationships between variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous data</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">10. Introducing data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">11. Handling categorical data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing data in groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">13. Accessing databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other data types</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">14. Text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-missingness.html">15. Missing, censored, and questionable data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/datawranglingpy" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="introducing-data-frames">
<span id="chap-data-frame"></span><h1><span class="section-number">10. </span>Introducing data frames<a class="headerlink" href="#introducing-data-frames" title="Link to this heading">¶</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://deepr.gagolewski.com/"><em>Deep R Programming</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id2" title="Gagolewski, M. (2025).  Deep R Programming. URL: https://deepr.gagolewski.com/, DOI: 10.5281/zenodo.7490464.">36</a>]</span> too.</em></p>
</div></blockquote>
<p><strong class="program">numpy</strong> arrays are an extremely versatile tool for performing data
analysis activities and other numerical computations of various kinds.
Even though it is theoretically possible otherwise, in practice,
we only store elements of the same type there: most often numbers.</p>
<p><a class="reference external" href="https://pandas.pydata.org/"><strong class="program">pandas</strong></a> <span id="id2">[<a class="reference internal" href="999-bibliography.html#id18" title="McKinney, W. (2022).  Python for Data Analysis. O'Reilly. URL: https://wesmckinney.com/book.">66</a>]</span>
is amongst over <a class="reference external" href="https://libraries.io/pypi/numpy">one hundred thousand</a>
open-source packages and repositories that use <strong class="program">numpy</strong> to provide
additional data wrangling functionality.
It was originally written by Wes McKinney
but was heavily inspired by the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code><a class="footnote-reference brackets" href="#footdf" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> objects in S and R
as well as tables in relational (think: SQL) databases
and spreadsheets.</p>
<div style="margin-top: 1em"></div><p><strong class="program">pandas</strong> defines a few classes, of which the most important are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> – for representing tabular data (matrix-like)
with columns of possibly different types,
in particular a mix of numerical and categorical variables,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code> – vector-like objects for storing individual columns,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Index</span></code> and its derivatives – vector-like (usually) objects
for labelling individual
rows and columns in <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>s and items in <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SeriesGroupBy</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> – which
model observations grouped by a categorical variable
or a combination of factors (<a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>),</p></li>
</ul>
<p>together with many methods for:</p>
<ul class="simple">
<li><p>transforming/aggregating/processing data, also
in groups determined by categorical variables or products thereof,</p></li>
<li><p>reshaping (e.g., from wide to long format) and joining datasets,</p></li>
<li><p>importing/exporting data from/to various sources and formats,
e.g., CSV and HDF5 files or relational databases,</p></li>
<li><p>handling missing data,</p></li>
</ul>
<p>all of which we introduce in this part.</p>
<div style="margin-top: 1em"></div><p>It is customary to import the <strong class="program">pandas</strong> package under
the following alias:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Let’s repeat: <strong class="program">pandas</strong> is built on top of
<strong class="program">numpy</strong> and most objects therein can be processed by
<strong class="program">numpy</strong> functions as well.
Many other functions, e.g., in <strong class="program">scikit-learn</strong>,
accept both <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> objects,
but often convert the former to the latter internally to enable data
processing using fast, lower-level C/C++/Fortran routines.</p>
<p>What we have learnt so far<a class="footnote-reference brackets" href="#footgoback" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> still applies.
But there is more, hence this part.</p>
</div>
<section id="creating-data-frames">
<h2><span class="section-number">10.1. </span>Creating data frames<a class="headerlink" href="#creating-data-frames" title="Link to this heading">¶</a></h2>
<p>Data frames can be created, amongst others,
using the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> class constructor, which
can be fed, for example, with a <strong class="program">numpy</strong> matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1">##           a         b         c</span>
<span class="c1">## 0  0.696469  0.286139  0.226851</span>
<span class="c1">## 1  0.551315  0.719469  0.423106</span>
<span class="c1">## 2  0.980764  0.684830  0.480932</span>
<span class="c1">## 3  0.392118  0.343178  0.729050</span>
</pre></div>
</div>
<p>Notice that rows and columns are labelled (and how readable that is).</p>
<p>A dictionary of vector-like objects of equal lengths is another
common data source:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">],</span>
    <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">],</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="s2">&quot;2021-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2022-02-02&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-03-03&quot;</span><span class="p">,</span> <span class="s2">&quot;2024-04-04&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-05-05&quot;</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[D]&quot;</span><span class="p">),</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;ham&quot;</span><span class="p">]</span>
    <span class="p">],</span>
<span class="p">))</span>
<span class="n">df</span>
<span class="c1">##       a    b      c     d      e          f                    g</span>
<span class="c1">## 0  0.70  1.0   True     A   spam 2021-01-01               [spam]</span>
<span class="c1">## 1  0.29  2.5   True     B   spam 2022-02-02        [bacon, spam]</span>
<span class="c1">## 2  0.23  NaN  False     C  bacon 2023-03-03                 None</span>
<span class="c1">## 3  0.55  4.0  False  None   spam 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## 4  0.72  NaN   True     E   eggs 2025-05-05                [ham]</span>
</pre></div>
</div>
<p>The above illustrates the possibility of having columns of different
types.</p>
<div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.1</span>
        
    </div><div class="proof-content">
<p>Check out <strong class="command">pandas.DataFrame.from_dict</strong> and
<strong class="command">from_records</strong>
in the <a class="reference external" href="https://pandas.pydata.org/docs">documentation</a>.
Use them to create some example data frames.</p>
</div></div><p>Further, data frames can be read from files in different
formats, for instance, CSV:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/nhanes_adult_female_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">body</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># display the first few rows (five by default)</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 0   97.1  160.2     34.7    40.8     35.8   126.1     117.9</span>
<span class="c1">## 1   91.1  152.7     33.5    33.0     38.5   125.5     103.1</span>
<span class="c1">## 2   73.0  161.2     37.4    38.0     31.8   106.2      92.0</span>
<span class="c1">## 3   61.7  157.4     38.0    34.7     29.0   101.0      90.5</span>
<span class="c1">## 4   55.4  154.6     34.6    34.0     28.3    92.5      73.2</span>
</pre></div>
</div>
<p>Reading from URLs and local files
is also supported; compare <a class="reference internal" href="440-sql.html#sec-file-paths"><span class="std std-numref">Section 13.6.1</span></a>.</p>
<div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.2</span>
        
    </div><div class="proof-content">
<p>Check out other <strong class="command">pandas.read_*</strong> functions
in the <strong class="program">pandas</strong> documentation,
e.g., for importing spreadsheets, Apache Parquet and HDF5 files,
scraping tables from HTML documents, or reading data from
relational databases.
We will discuss some of them in more detail later.</p>
</div></div><div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.3</span>
        
    </div><div class="proof-content">
<p>(*) Large files that do not fit into computer’s memory (but not too large)
can still be read with <strong class="command">pandas.read_csv</strong>.
Check out the meaning of
the <code class="docutils literal notranslate"><span class="pre">usecols</span></code>, <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, <code class="docutils literal notranslate"><span class="pre">skiprows</span></code>,
and <code class="docutils literal notranslate"><span class="pre">nrows</span></code> arguments.
On a side note, sampling is mentioned in <a class="reference internal" href="#sec-random-sampling"><span class="std std-numref">Section 10.5.4</span></a>
and chunking in <a class="reference internal" href="440-sql.html#sec-data-export"><span class="std std-numref">Section 13.2</span></a>.</p>
</div></div><section id="data-frames-are-matrix-like">
<h3><span class="section-number">10.1.1. </span>Data frames are matrix-like<a class="headerlink" href="#data-frames-are-matrix-like" title="Link to this heading">¶</a></h3>
<p>Data frames are modelled through <strong class="program">numpy</strong> matrices.
We can thus already feel quite at home with them.</p>
<p>For example, a data frame, it is easy to fetch its number of rows
and columns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
<span class="c1">## (5, 7)</span>
</pre></div>
</div>
<p>or the type of each column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>  <span class="c1"># returns a Series object; see below</span>
<span class="c1">## a          float64</span>
<span class="c1">## b          float64</span>
<span class="c1">## c             bool</span>
<span class="c1">## d           object</span>
<span class="c1">## e           object</span>
<span class="c1">## f    datetime64[s]</span>
<span class="c1">## g           object</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>Recall that  <strong class="program">numpy</strong> arrays are equipped with the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> slot.</p>
</section>
<section id="series">
<h3><span class="section-number">10.1.2. </span><code class="docutils literal notranslate"><span class="pre">Series</span></code><a class="headerlink" href="#series" title="Link to this heading">¶</a></h3>
<p>There is a separate class for storing individual data frame
columns: it is called <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>  <span class="c1"># extract the `a` column; alternatively: df.a</span>
<span class="n">s</span>
<span class="c1">## 0    0.70</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 2    0.23</span>
<span class="c1">## 3    0.55</span>
<span class="c1">## 4    0.72</span>
<span class="c1">## Name: a, dtype: float64</span>
</pre></div>
</div>
<p>Data frames with one column are printed
out slightly differently.
We get the column name at the top,
but do not have the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> information at the bottom.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>  <span class="c1"># or: pd.DataFrame(s)</span>
<span class="c1">##       a</span>
<span class="c1">## 0  0.70</span>
<span class="c1">## 1  0.29</span>
<span class="c1">## 2  0.23</span>
<span class="c1">## 3  0.55</span>
<span class="c1">## 4  0.72</span>
</pre></div>
</div>
<p>Indexing will be discussed later.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is crucial to know when we are dealing
with a <code class="docutils literal notranslate"><span class="pre">Series</span></code> and when with a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object
as each of them defines a slightly different set of methods.</p>
<p>We will now be relying on object-orientated syntax
(compare <a class="reference internal" href="120-scalar.html#sec-oop"><span class="std std-numref">Section 2.2.3</span></a>) much more frequently than before.</p>
</div>
<div class="proof proof-type-example" id="id15">

    <div class="proof-title">
        <span class="proof-type">Example 10.4</span>
        
    </div><div class="proof-content">
<p>By calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">## 0.49800000000000005</span>
</pre></div>
</div>
<p>we refer to <strong class="command">pandas.Series.mean</strong> (which returns a scalar), whereas:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">## a    0.498</span>
<span class="c1">## b    2.500</span>
<span class="c1">## c    0.600</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>uses <strong class="command">pandas.DataFrame.mean</strong> (which yields a <code class="docutils literal notranslate"><span class="pre">Series</span></code>).</p>
<p>Look up these two methods in the <strong class="program">pandas</strong> manual.
Note that their argument list is slightly different.</p>
</div></div><p>Objects of the class <code class="docutils literal notranslate"><span class="pre">Series</span></code> are vector-like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">shape</span>
<span class="c1">## (5,)</span>
<span class="n">s</span><span class="o">.</span><span class="n">dtype</span>
<span class="c1">## dtype(&#39;float64&#39;)</span>
</pre></div>
</div>
<p>They are wrappers around <strong class="program">numpy</strong> arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">values</span>
<span class="c1">## array([0.7 , 0.29, 0.23, 0.55, 0.72])</span>
</pre></div>
</div>
<p>Most importantly, <strong class="program">numpy</strong> functions can be called directly on them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1">## 0.49800000000000005</span>
</pre></div>
</div>
<p>As a consequence, what we covered in the part of this book that dealt
with vector processing still holds for data frame columns
(but there will be more).</p>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> can also be <em>named</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">name</span>
<span class="c1">## &#39;a&#39;</span>
</pre></div>
</div>
<p>This is convenient, especially when we convert them to a data frame
as the <code class="docutils literal notranslate"><span class="pre">name</span></code> sets the label of the newly created column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="c1">##    spam</span>
<span class="c1">## 0  0.70</span>
<span class="c1">## 1  0.29</span>
<span class="c1">## 2  0.23</span>
<span class="c1">## 3  0.55</span>
<span class="c1">## 4  0.72</span>
</pre></div>
</div>
</section>
<section id="index">
<span id="sec-df-index"></span><h3><span class="section-number">10.1.3. </span><code class="docutils literal notranslate"><span class="pre">Index</span></code><a class="headerlink" href="#index" title="Link to this heading">¶</a></h3>
<p>Another important class is called <code class="docutils literal notranslate"><span class="pre">Index</span></code><a class="footnote-reference brackets" href="#footindex" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.
We use it for storing element or axes labels.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">index</span></code> (lowercase) <em>slot</em> of a data frame stores an
object of the class <code class="docutils literal notranslate"><span class="pre">Index</span></code> (or one of its derivatives)
that gives the row names:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span>  <span class="c1"># row labels</span>
<span class="c1">## RangeIndex(start=0, stop=5, step=1)</span>
</pre></div>
</div>
<p>It represents a sequence (0, 1, 2, 3, 4).
Furthermore, the <code class="docutils literal notranslate"><span class="pre">column</span></code> slot gives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>  <span class="c1"># column labels</span>
<span class="c1">## Index([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<p>Also, we can label the individual elements in <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">index</span>
<span class="c1">## RangeIndex(start=0, stop=5, step=1)</span>
</pre></div>
</div>
<p>The <strong class="command">set_index</strong> method can be applied
to make a data frame column act as a sequence of row labels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
<span class="n">df2</span>
<span class="c1">##           a    b      c     d          f                    g</span>
<span class="c1">## e                                                            </span>
<span class="c1">## spam   0.70  1.0   True     A 2021-01-01               [spam]</span>
<span class="c1">## spam   0.29  2.5   True     B 2022-02-02        [bacon, spam]</span>
<span class="c1">## bacon  0.23  NaN  False     C 2023-03-03                 None</span>
<span class="c1">## spam   0.55  4.0  False  None 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## eggs   0.72  NaN   True     E 2025-05-05                [ham]</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">Index</span></code> object is named:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
<span class="c1">## &#39;e&#39;</span>
</pre></div>
</div>
<p>We can also rename the axes on the fly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;ROWS&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;COLS&quot;</span><span class="p">)</span>
<span class="c1">## COLS      a    b      c     d          f                    g</span>
<span class="c1">## ROWS                                                         </span>
<span class="c1">## spam   0.70  1.0   True     A 2021-01-01               [spam]</span>
<span class="c1">## spam   0.29  2.5   True     B 2022-02-02        [bacon, spam]</span>
<span class="c1">## bacon  0.23  NaN  False     C 2023-03-03                 None</span>
<span class="c1">## spam   0.55  4.0  False  None 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## eggs   0.72  NaN   True     E 2025-05-05                [ham]</span>
</pre></div>
</div>
<p>Having a named <code class="docutils literal notranslate"><span class="pre">index</span></code> slot is handy when converting a vector
of row labels back to a standalone column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;NEW_COLUMN&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##   NEW_COLUMN     a    b      c     d          f                    g</span>
<span class="c1">## 0       spam  0.70  1.0   True     A 2021-01-01               [spam]</span>
<span class="c1">## 1       spam  0.29  2.5   True     B 2022-02-02        [bacon, spam]</span>
<span class="c1">## 2      bacon  0.23  NaN  False     C 2023-03-03                 None</span>
<span class="c1">## 3       spam  0.55  4.0  False  None 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## 4       eggs  0.72  NaN   True     E 2025-05-05                [ham]</span>
</pre></div>
</div>
<p>But we can also do it this way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="s2">&quot;Spanish Inquisition&quot;</span><span class="p">)</span>
<span class="c1">##   Spanish Inquisition     a    b  ...     d          f                    g</span>
<span class="c1">## 0                spam  0.70  1.0  ...     A 2021-01-01               [spam]</span>
<span class="c1">## 1                spam  0.29  2.5  ...     B 2022-02-02        [bacon, spam]</span>
<span class="c1">## 2               bacon  0.23  NaN  ...     C 2023-03-03                 None</span>
<span class="c1">## 3                spam  0.55  4.0  ...  None 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## 4                eggs  0.72  NaN  ...     E 2025-05-05                [ham]</span>
<span class="c1">## </span>
<span class="c1">## [5 rows x 7 columns]</span>
</pre></div>
</div>
<p>There is also an option to drop the current <code class="docutils literal notranslate"><span class="pre">index</span></code> whatsoever
and to replace it with the default label sequence, i.e.,
0, 1, 2, …:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">##       a    b      c     d          f                    g</span>
<span class="c1">## 0  0.70  1.0   True     A 2021-01-01               [spam]</span>
<span class="c1">## 1  0.29  2.5   True     B 2022-02-02        [bacon, spam]</span>
<span class="c1">## 2  0.23  NaN  False     C 2023-03-03                 None</span>
<span class="c1">## 3  0.55  4.0  False  None 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## 4  0.72  NaN   True     E 2025-05-05                [ham]</span>
</pre></div>
</div>
<p>Take note of the fact that <strong class="command">reset_index</strong>, and many other methods
that we have used so far, do not modify the data frame in place.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We will soon get used to calling
<strong class="command">reset_index</strong><code class="code docutils literal notranslate"><span class="pre">(drop=True)</span></code> frequently: sometimes
more than once in a single series of commands.</p>
</div>
<div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.5</span>
        
    </div><div class="proof-content">
<p>Use the
<strong class="command">pandas.DataFrame.rename</strong> method to
change the name of the <code class="docutils literal notranslate"><span class="pre">a</span></code> column in <code class="docutils literal notranslate"><span class="pre">df</span></code> to <code class="docutils literal notranslate"><span class="pre">spam</span></code>.</p>
</div></div><p>Also, a <em>hierarchical</em> index – one that is comprised
of more than one level – is possible.
For example, here is a sorted (see <a class="reference internal" href="#sec-df-sort"><span class="std std-numref">Section 10.6.1</span></a>) version
of <code class="docutils literal notranslate"><span class="pre">df</span></code> with a new index based on two columns at the same time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="c1">##                 a    b     d          f                    g</span>
<span class="c1">## e     c                                                     </span>
<span class="c1">## spam  True   0.70  1.0     A 2021-01-01               [spam]</span>
<span class="c1">##       True   0.29  2.5     B 2022-02-02        [bacon, spam]</span>
<span class="c1">##       False  0.55  4.0  None 2024-04-04  [eggs, bacon, spam]</span>
<span class="c1">## eggs  True   0.72  NaN     E 2025-05-05                [ham]</span>
<span class="c1">## bacon False  0.23  NaN     C 2023-03-03                 None</span>
</pre></div>
</div>
<p>For the sake of readability,
the consecutive repeated <code class="docutils literal notranslate"><span class="pre">spam</span></code>s were not printed.</p>
<div class="proof proof-type-example" id="id17">

    <div class="proof-title">
        <span class="proof-type">Example 10.6</span>
        
    </div><div class="proof-content">
<p>Hierarchical indexes might arise after aggregating data in groups.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/nhanes_p_demo_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span>
        <span class="s2">&quot;BMXBMI&quot;</span><span class="p">:</span> <span class="s2">&quot;bmival&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RIAGENDR&quot;</span><span class="p">:</span> <span class="s2">&quot;gender&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DMDBORN4&quot;</span><span class="p">:</span> <span class="s2">&quot;usborn&quot;</span>
    <span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>In <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>, we will get used to writing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">nhanes</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;usborn&quot;</span><span class="p">])[</span><span class="s2">&quot;bmival&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">res</span>  <span class="c1"># BMI by gender and US born-ness</span>
<span class="c1">## gender  usborn</span>
<span class="c1">## 1       1         25.734110</span>
<span class="c1">##         2         27.405251</span>
<span class="c1">## 2       1         27.120261</span>
<span class="c1">##         2         27.579448</span>
<span class="c1">##         77        28.725000</span>
<span class="c1">##         99        32.600000</span>
<span class="c1">## Name: bmival, dtype: float64</span>
</pre></div>
</div>
<p>This returned a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object with a hierarchical index.
If we do not fancy it, <strong class="command">reset_index</strong> comes to our rescue:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##    gender  usborn     bmival</span>
<span class="c1">## 0       1       1  25.734110</span>
<span class="c1">## 1       1       2  27.405251</span>
<span class="c1">## 2       2       1  27.120261</span>
<span class="c1">## 3       2       2  27.579448</span>
<span class="c1">## 4       2      77  28.725000</span>
<span class="c1">## 5       2      99  32.600000</span>
</pre></div>
</div>
</div></div></section>
</section>
<section id="aggregating-data-frames">
<h2><span class="section-number">10.2. </span>Aggregating data frames<a class="headerlink" href="#aggregating-data-frames" title="Link to this heading">¶</a></h2>
<p>Here is another toy data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;sausage&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">])</span>
<span class="n">df</span>
<span class="c1">##       u     v        w</span>
<span class="c1">## a  0.70  0.32     spam</span>
<span class="c1">## b  0.29 -0.05    bacon</span>
<span class="c1">## c  0.23 -0.20     spam</span>
<span class="c1">## d  0.55  1.98     eggs</span>
<span class="c1">## e  0.72 -1.62  sausage</span>
</pre></div>
</div>
<p>All <strong class="program">numpy</strong> functions can be applied on individual
columns, i.e., objects of the type <code class="docutils literal notranslate"><span class="pre">Series</span></code>, because they are vector-like.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span>  <span class="c1"># extract the `u` column (gives a Series; see below)</span>
<span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1">## array([0.23, 0.55, 0.72])</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Most <strong class="program">numpy</strong> functions also work if they are fed with data frames,
but we will need to extract the numeric columns manually.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span>  <span class="c1"># select two columns (a DataFrame; see below)</span>
<span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## array([[ 0.23, -1.62],</span>
<span class="c1">##        [ 0.55, -0.05],</span>
<span class="c1">##        [ 0.72,  1.98]])</span>
</pre></div>
</div>
<p>Sometimes the results will automatically be coerced to a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object
with the <code class="docutils literal notranslate"><span class="pre">index</span></code> slot set appropriately:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## u    0.498</span>
<span class="c1">## v    0.086</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>For convenience, many operations are also available as methods for the
<code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> classes, e.g., <strong class="command">mean</strong>, <strong class="command">median</strong>,
<strong class="command">min</strong>, <strong class="command">max</strong>, <strong class="command">quantile</strong>,
<strong class="command">var</strong>, <strong class="command">std</strong>, and <strong class="command">skew</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">## u    0.498</span>
<span class="c1">## v    0.086</span>
<span class="c1">## dtype: float64</span>
<span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">##         u     v</span>
<span class="c1">## 0.0  0.23 -1.62</span>
<span class="c1">## 0.5  0.55 -0.05</span>
<span class="c1">## 1.0  0.72  1.98</span>
</pre></div>
</div>
<p>Also note the <strong class="command">describe</strong> method, which
returns a few statistics at the same time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1">##               u         v</span>
<span class="c1">## count  5.000000  5.000000</span>
<span class="c1">## mean   0.498000  0.086000</span>
<span class="c1">## std    0.227969  1.289643</span>
<span class="c1">## min    0.230000 -1.620000</span>
<span class="c1">## 25%    0.290000 -0.200000</span>
<span class="c1">## 50%    0.550000 -0.050000</span>
<span class="c1">## 75%    0.700000  0.320000</span>
<span class="c1">## max    0.720000  1.980000</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.7</span>
        
    </div><div class="proof-content">
<p>Check out the <strong class="command">pandas.DataFrame.agg</strong> method
that can apply all aggregates given by a list of functions.
Compose a call equivalent to <code class="docutils literal notranslate"><span class="pre">df.describe()</span></code>.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) Let’s stress that above we see
the corrected for bias (but still only asymptotically unbiased)
version of standard deviation,
given by <span class="math">\(\sqrt{\frac{1}{n-1} \sum_{i=1}^n (x_i-\bar{x})^2}\)</span>;
compare <a class="reference internal" href="220-transform-vector.html#sec-aggregate"><span class="std std-numref">Section 5.1</span></a>.
In <strong class="program">pandas</strong>, <strong class="command">std</strong> methods assume <code class="docutils literal notranslate"><span class="pre">ddof=1</span></code> by default,
whereas we recall that <strong class="program">numpy</strong> uses <code class="docutils literal notranslate"><span class="pre">ddof=0</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">([</span><span class="n">u</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">u</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1">## array([0.228, 0.204, 0.204, 0.204])</span>
</pre></div>
</div>
<p>This is an unfortunate inconsistency between the two packages,
but please do not blame the messenger.</p>
</div>
</section>
<section id="transforming-data-frames">
<h2><span class="section-number">10.3. </span>Transforming data frames<a class="headerlink" href="#transforming-data-frames" title="Link to this heading">¶</a></h2>
<p>By applying the already well-known vectorised mathematical
functions from <strong class="program">numpy</strong>, we can transform each data cell
and return an object of the same type as the input one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">])</span>
<span class="c1">## a    2.013753</span>
<span class="c1">## b    1.336427</span>
<span class="c1">## c    1.258600</span>
<span class="c1">## d    1.733253</span>
<span class="c1">## e    2.054433</span>
<span class="c1">## Name: u, dtype: float64</span>
<span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]])</span>
<span class="c1">##           u         v</span>
<span class="c1">## a  2.013753  1.377128</span>
<span class="c1">## b  1.336427  0.951229</span>
<span class="c1">## c  1.258600  0.818731</span>
<span class="c1">## d  1.733253  7.242743</span>
<span class="c1">## e  2.054433  0.197899</span>
</pre></div>
</div>
<p>When applying the binary arithmetic, relational,
and logical operators on an object of the class <code class="docutils literal notranslate"><span class="pre">Series</span></code> and
a scalar or a <strong class="program">numpy</strong> vector, the operations are performed
elementwisely – a style with which we are already familiar.</p>
<p>For instance, here is a standardised version of the <code class="docutils literal notranslate"><span class="pre">u</span></code> column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span>
<span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="c1">## a    0.990672</span>
<span class="c1">## b   -1.020098</span>
<span class="c1">## c   -1.314357</span>
<span class="c1">## d    0.255025</span>
<span class="c1">## e    1.088759</span>
<span class="c1">## Name: u, dtype: float64</span>
</pre></div>
</div>
<p>Binary operators act on the elements with corresponding labels.
For two objects having identical <code class="docutils literal notranslate"><span class="pre">index</span></code> slots
(this is the most common scenario), this is the same as elementwise
vectorisation. For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;v&quot;</span><span class="p">]</span>  <span class="c1"># here: elementwise comparison</span>
<span class="c1">## a     True</span>
<span class="c1">## b     True</span>
<span class="c1">## c     True</span>
<span class="c1">## d    False</span>
<span class="c1">## e     True</span>
<span class="c1">## dtype: bool</span>
</pre></div>
</div>
<p>For transforming many numerical columns at once,
it is worthwhile either to
convert them to a numeric matrix explicitly
and then use the basic <strong class="program">numpy</strong> functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]])</span>
<span class="n">uv2</span> <span class="o">=</span> <span class="p">(</span><span class="n">uv</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">uv2</span>
<span class="c1">## array([[ 0.99067229,  0.20286225],</span>
<span class="c1">##        [-1.0200982 , -0.11790285],</span>
<span class="c1">##        [-1.3143573 , -0.24794275],</span>
<span class="c1">##        [ 0.25502455,  1.64197052],</span>
<span class="c1">##        [ 1.08875866, -1.47898717]])</span>
</pre></div>
</div>
<p>or to use the <strong class="command">pandas.DataFrame.apply</strong> method
which invokes a given function on each column separately:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uv2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">uv2</span>
<span class="c1">##           u         v</span>
<span class="c1">## a  0.990672  0.202862</span>
<span class="c1">## b -1.020098 -0.117903</span>
<span class="c1">## c -1.314357 -0.247943</span>
<span class="c1">## d  0.255025  1.641971</span>
<span class="c1">## e  1.088759 -1.478987</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Anticipating what we cover in the next section,
in both cases, we can write <code class="docutils literal notranslate"><span class="pre">df.loc[:,</span> <span class="pre">[&quot;u&quot;,</span> <span class="pre">&quot;v&quot;]]</span> <span class="pre">=</span> <span class="pre">uv2</span></code>
to replace the old content. Also, new columns can be added based on the
transformed versions of the existing ones. For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;uv_squared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;v&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">df</span>
<span class="c1">##       u     v        w  uv_squared</span>
<span class="c1">## a  0.70  0.32     spam    0.050176</span>
<span class="c1">## b  0.29 -0.05    bacon    0.000210</span>
<span class="c1">## c  0.23 -0.20     spam    0.002116</span>
<span class="c1">## d  0.55  1.98     eggs    1.185921</span>
<span class="c1">## e  0.72 -1.62  sausage    1.360489</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id19">

    <div class="proof-title">
        <span class="proof-type">Example 10.8</span>
        
    </div><div class="proof-content">
<p>(*)
Binary operations on objects with different <code class="docutils literal notranslate"><span class="pre">index</span></code> slots
are vectorised <em>labelwisely</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="n">x</span>
<span class="c1">## a        1</span>
<span class="c1">## b       10</span>
<span class="c1">## a      100</span>
<span class="c1">## a     1000</span>
<span class="c1">## c    10000</span>
<span class="c1">## dtype: int64</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="n">y</span>
<span class="c1">## b    1</span>
<span class="c1">## b    2</span>
<span class="c1">## a    3</span>
<span class="c1">## d    4</span>
<span class="c1">## c    5</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="c1">## a        3.0</span>
<span class="c1">## a      300.0</span>
<span class="c1">## a     3000.0</span>
<span class="c1">## b       10.0</span>
<span class="c1">## b       20.0</span>
<span class="c1">## c    50000.0</span>
<span class="c1">## d        NaN</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Here, each element in the first <code class="docutils literal notranslate"><span class="pre">Series</span></code> named <code class="docutils literal notranslate"><span class="pre">a</span></code> was
multiplied by each (there was only one) element labelled <code class="docutils literal notranslate"><span class="pre">a</span></code> in the second
<code class="docutils literal notranslate"><span class="pre">Series</span></code>. For <code class="docutils literal notranslate"><span class="pre">d</span></code>, there were no matches, hence the result’s being marked
as missing; compare <a class="reference internal" href="520-missingness.html#chap-missingness"><span class="std std-numref">Chapter 15</span></a>.
Thus, it behaves like a full outer join-type operation;
see <a class="reference internal" href="#sec-join"><span class="std std-numref">Section 10.6.3</span></a>.</p>
<p>The above is different from <em>elementwise</em> vectorisation in <strong class="program">numpy</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## array([    1,    20,   300,  4000, 50000])</span>
</pre></div>
</div>
<p>Labelwise vectorisation <em>can</em> be useful in certain contexts.
However, we need to be aware of this (yet another) incompatibility between
the two packages.</p>
</div></div></section>
<section id="indexing-series-objects">
<span id="sec-series-indexing"></span><h2><span class="section-number">10.4. </span>Indexing <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects<a class="headerlink" href="#indexing-series-objects" title="Link to this heading">¶</a></h2>
<p>Recall that each <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">Series</span></code> object
is equipped with a slot called <code class="docutils literal notranslate"><span class="pre">index</span></code>, which is
an object of the class <code class="docutils literal notranslate"><span class="pre">Index</span></code> (or subclass thereof),
giving the row and element labels, respectively.
It turns out that we may apply
the <em>index</em> operator, <code class="docutils literal notranslate"><span class="pre">[...]</span></code>, to subset  these objects
not only through the <em>indexers</em> known from
the <strong class="program">numpy</strong> part (e.g., numerical ones, i.e., by position)
but also ones that pinpoint the items via their
labels. We have thus quite a lot of index-ing to discuss.</p>
<p>For illustration, we will be playing with two objects of
the type <code class="docutils literal notranslate"><span class="pre">Series</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">b</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">b</span>
<span class="c1">## 2    0.70</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 8    0.23</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## 9    0.72</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## 5    0.98</span>
<span class="c1">## 6    0.68</span>
<span class="c1">## 3    0.48</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;abcdefghij&quot;</span><span class="p">)</span>
<span class="n">c</span>
<span class="c1">## a    0.70</span>
<span class="c1">## b    0.29</span>
<span class="c1">## c    0.23</span>
<span class="c1">## d    0.55</span>
<span class="c1">## e    0.72</span>
<span class="c1">## f    0.42</span>
<span class="c1">## g    0.98</span>
<span class="c1">## h    0.68</span>
<span class="c1">## i    0.48</span>
<span class="c1">## j    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>They consist of the same values, in the same order,
but have different labels (<code class="docutils literal notranslate"><span class="pre">index</span></code> slots).
In particular, <code class="docutils literal notranslate"><span class="pre">b</span></code>’s labels
are integers that <em>do not</em> match the physical element
positions (where 0 would denote the first element, etc.).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For <strong class="program">numpy</strong> vectors, we had four different indexing schemes:
via a scalar (extracts an element at a given position),
a slice, an integer vector, and a logical vector.
<code class="docutils literal notranslate"><span class="pre">Series</span></code> objects are <em>additionally</em> labelled. Therefore,
they can also be accessed through the contents of the <code class="docutils literal notranslate"><span class="pre">index</span></code> slot.</p>
</div>
<section id="do-not-use-directly-in-the-current-version-of-pandas">
<h3><span class="section-number">10.4.1. </span>Do not use <code class="docutils literal notranslate"><span class="pre">[...]</span></code> directly (in the current version of <strong class="program">pandas</strong>)<a class="headerlink" href="#do-not-use-directly-in-the-current-version-of-pandas" title="Link to this heading">¶</a></h3>
<p>Applying the index operator,
<code class="docutils literal notranslate"><span class="pre">[...]</span></code>, directly on <code class="docutils literal notranslate"><span class="pre">Series</span></code> is currently not a wise idea:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># do not use it</span>
<span class="c1">## 0.39</span>
<span class="n">b</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>  <span class="c1"># do not use it</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>both do not select the first item, but the item labelled <code class="docutils literal notranslate"><span class="pre">0</span></code>.
However, the undermentioned two calls fall back to position-based
indexing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># do not use it: it will change in the future!</span>
<span class="c1">## 2    0.7</span>
<span class="c1">## dtype: float64</span>
<span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># there is no label `0` (do not use it: it will change in the future!)</span>
<span class="c1">## 0.7</span>
</pre></div>
</div>
<p>Confusing? Well, with some self-discipline, the solution is easy:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the current version of <strong class="program">pandas</strong>, we recommend abstaining
from applying <code class="docutils literal notranslate"><span class="pre">[...]</span></code> directly on <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects.
We should explicitly refer to the
<strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> accessors
for the label- and position-based filtering, respectively.</p>
<p>In the future, direct call to <code class="docutils literal notranslate"><span class="pre">[...]</span></code> on <code class="docutils literal notranslate"><span class="pre">Series</span></code> will
use label-based indexing (as we will see below, <code class="docutils literal notranslate"><span class="pre">b[:5]</span></code>
will hence not mean “select the first five rows”).
At the same time, <code class="docutils literal notranslate"><span class="pre">[...]</span></code> on <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>
currently serves as a label-based selector of columns only.</p>
</div>
</section>
<section id="loc">
<h3><span class="section-number">10.4.2. </span><strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code><a class="headerlink" href="#loc" title="Link to this heading">¶</a></h3>
<p><strong class="command">Series.loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> implements label-based indexing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">## 0.39</span>
</pre></div>
</div>
<p>This returned the element labelled <code class="docutils literal notranslate"><span class="pre">0</span></code>. On the other hand, <code class="docutils literal notranslate"><span class="pre">c.loc[0]</span></code> will
raise a <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> because <code class="docutils literal notranslate"><span class="pre">c</span></code> consists of string labels only.
But in this case, we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span>
<span class="c1">## 0.39</span>
</pre></div>
</div>
<p>Next, we can use lists of labels to select a <em>subset</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## dtype: float64</span>
<span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## j    0.39</span>
<span class="c1">## b    0.29</span>
<span class="c1">## j    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>The result is always of the type <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<p>Slicing behaves differently as the range is <em>inclusive</em>
(sic!<a class="footnote-reference brackets" href="#footinclusive" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>) at both sides:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 8    0.23</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## dtype: float64</span>
<span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## 3    0.48</span>
<span class="c1">## 6    0.68</span>
<span class="c1">## 5    0.98</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## dtype: float64</span>
<span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">:</span><span class="s2">&quot;g&quot;</span><span class="p">]</span>
<span class="c1">## d    0.55</span>
<span class="c1">## e    0.72</span>
<span class="c1">## f    0.42</span>
<span class="c1">## g    0.98</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>They return all elements between the two indicated labels.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be careful that if there are repeated labels, then
we will be returning <em>all</em> (sic!<a class="footnote-reference brackets" href="#footallmatch" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>) the matching items:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="c1">## a    1</span>
<span class="c1">## a    3</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>The result is not a scalar but a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object.</p>
</div>
</section>
<section id="iloc">
<h3><span class="section-number">10.4.3. </span><strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code><a class="headerlink" href="#iloc" title="Link to this heading">¶</a></h3>
<p>Here are some examples of position-based indexing with
the <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> accessor.
It is worth stressing that, fortunately, its behaviour
is consistent with its <strong class="program">numpy</strong> counterpart, i.e.,
the ordinary square brackets applied on objects of the class <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># the same: c.iloc[0]</span>
<span class="c1">## 0.7</span>
</pre></div>
</div>
<p>returns the first element.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># the same: b.iloc[1:7]</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 8    0.23</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## 9    0.72</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## 5    0.98</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>returns the second, third, …, seventh element
(not including <code class="docutils literal notranslate"><span class="pre">b.iloc[7]</span></code>, i.e., the eight one).</p>
</section>
<section id="logical-indexing">
<h3><span class="section-number">10.4.4. </span>Logical indexing<a class="headerlink" href="#logical-indexing" title="Link to this heading">¶</a></h3>
<p>Indexing using a logical vector-like object is also available.
For this purpose, we will usually be using <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
with either a logical <code class="docutils literal notranslate"><span class="pre">Series</span></code> object of identical <code class="docutils literal notranslate"><span class="pre">index</span></code> slot
as the subsetted object, or a Boolean <strong class="program">numpy</strong> vector.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)]</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## 3    0.48</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>For <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>, the indexer must be unlabelled,
e.g., be an ordinary <strong class="program">numpy</strong> vector.</p>
</section>
</section>
<section id="indexing-data-frames">
<span id="sec-df-indexing"></span><h2><span class="section-number">10.5. </span>Indexing data frames<a class="headerlink" href="#indexing-data-frames" title="Link to this heading">¶</a></h2>
<section id="loc-and-iloc">
<h3><span class="section-number">10.5.1. </span><strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code><a class="headerlink" href="#loc-and-iloc" title="Link to this heading">¶</a></h3>
<p>For data frames, <code class="docutils literal notranslate"><span class="pre">iloc</span></code> and <code class="docutils literal notranslate"><span class="pre">loc</span></code> can be applied too.
Now, however, they require <em>two</em> arguments: a row and a column
selector. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;sausage&quot;</span><span class="p">],</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
<span class="p">))</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span><span class="s2">&quot;w&quot;</span> <span class="p">]</span>
<span class="c1">##       u     v        w</span>
<span class="c1">## 0  0.70  0.32     spam</span>
<span class="c1">## 3  0.55  1.98     eggs</span>
<span class="c1">## 4  0.72 -1.62  sausage</span>
</pre></div>
</div>
<p>It selected the rows where the values in the <code class="docutils literal notranslate"><span class="pre">u</span></code>
column are greater than 0.5 and then
returns all columns between <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">w</span></code> (inclusive!).</p>
<p>Furthermore:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]</span>
<span class="c1">##       u      w</span>
<span class="c1">## 0  0.70   spam</span>
<span class="c1">## 1  0.29  bacon</span>
<span class="c1">## 2  0.23   spam</span>
</pre></div>
</div>
<p>It fetched the first three rows (by position; <code class="docutils literal notranslate"><span class="pre">iloc</span></code> is necessary)
and then selects two indicated columns.</p>
<p>Compare this to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]</span>  <span class="c1"># df[:3, [&quot;u&quot;, &quot;w&quot;]] does not even work; please don&#39;t</span>
<span class="c1">##       u      w</span>
<span class="c1">## 0  0.70   spam</span>
<span class="c1">## 1  0.29  bacon</span>
<span class="c1">## 2  0.23   spam</span>
<span class="c1">## 3  0.55   eggs</span>
</pre></div>
</div>
<p>which has four (!) rows.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Getting a scrambled numeric index that does not match the
physical positions is not rare: for instance, in the context
of data frame sorting (<a class="reference internal" href="#sec-df-sort"><span class="std std-numref">Section 10.6.1</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
<span class="n">df2</span>
<span class="c1">##       u     v        w      x</span>
<span class="c1">## 4  0.72 -1.62  sausage   True</span>
<span class="c1">## 2  0.23 -0.20     spam   True</span>
<span class="c1">## 1  0.29 -0.05    bacon  False</span>
<span class="c1">## 0  0.70  0.32     spam   True</span>
<span class="c1">## 3  0.55  1.98     eggs  False</span>
</pre></div>
</div>
<p>Note how different are the following results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># up to label 3, inclusive</span>
<span class="c1">##       u     v        w      x</span>
<span class="c1">## 4  0.72 -1.62  sausage   True</span>
<span class="c1">## 2  0.23 -0.20     spam   True</span>
<span class="c1">## 1  0.29 -0.05    bacon  False</span>
<span class="c1">## 0  0.70  0.32     spam   True</span>
<span class="c1">## 3  0.55  1.98     eggs  False</span>
<span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># always: the first three</span>
<span class="c1">##       u     v        w      x</span>
<span class="c1">## 4  0.72 -1.62  sausage   True</span>
<span class="c1">## 2  0.23 -0.20     spam   True</span>
<span class="c1">## 1  0.29 -0.05    bacon  False</span>
</pre></div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We can frequently write <code class="docutils literal notranslate"><span class="pre">df.u</span></code> as a shorter version of <code class="docutils literal notranslate"><span class="pre">df.loc[:,</span> <span class="pre">&quot;u&quot;]</span></code>.
This improves the readability in contexts such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">u</span> <span class="o">&lt;=</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]</span>
<span class="c1">##       u     w</span>
<span class="c1">## 0  0.70  spam</span>
<span class="c1">## 3  0.55  eggs</span>
</pre></div>
</div>
<p>This accessor is, sadly, not universal.
We can verify this by considering a data frame with
a column named, e.g., <code class="docutils literal notranslate"><span class="pre">mean</span></code>: it clashes with the built-in method.
As a workaround, we should either use  <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
or rename the column, for instance, like <code class="docutils literal notranslate"><span class="pre">Mean</span></code> or <code class="docutils literal notranslate"><span class="pre">MEAN</span></code>.</p>
</div>
<div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.9</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.drop</strong>
to select all columns except <code class="docutils literal notranslate"><span class="pre">v</span></code> in <code class="docutils literal notranslate"><span class="pre">df</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.10</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.Series.isin</strong> (amongst others)
to select all rows with <code class="docutils literal notranslate"><span class="pre">spam</span></code> and <code class="docutils literal notranslate"><span class="pre">bacon</span></code> on the <code class="docutils literal notranslate"><span class="pre">df</span></code>’s menu.</p>
</div></div><div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.11</span>
        
    </div><div class="proof-content">
<p>In the
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/other/tips.csv"><code class="docutils literal notranslate"><span class="pre">tips</span></code></a>
dataset, select data on male customers where the total bills were in the
<span class="math">\([10, 20]\)</span> interval. Also, select Saturday and Sunday records where
the tips were greater than $5.</p>
</div></div></section>
<section id="adding-rows-and-columns">
<h3><span class="section-number">10.5.2. </span>Adding rows and columns<a class="headerlink" href="#adding-rows-and-columns" title="Link to this heading">¶</a></h3>
<p><strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> can also be used to add new columns to an
existing data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># or df.loc[:, &quot;y&quot;] = df.u**2</span>
<span class="n">df</span>
<span class="c1">##       u     v        w      x       y</span>
<span class="c1">## 0  0.70  0.32     spam   True  0.4900</span>
<span class="c1">## 1  0.29 -0.05    bacon  False  0.0841</span>
<span class="c1">## 2  0.23 -0.20     spam   True  0.0529</span>
<span class="c1">## 3  0.55  1.98     eggs  False  0.3025</span>
<span class="c1">## 4  0.72 -1.62  sausage   True  0.5184</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Notation like “<code class="docutils literal notranslate"><span class="pre">df.new_column</span> <span class="pre">=</span> <span class="pre">...</span></code>” does not work.
As we said, only <code class="docutils literal notranslate"><span class="pre">loc</span></code> and <code class="docutils literal notranslate"><span class="pre">iloc</span></code> are universal.
For other accessors, this is not necessarily the case.</p>
</div>
<div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.12</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.insert</strong>
to add a new column not necessarily at the end of <code class="docutils literal notranslate"><span class="pre">df</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.13</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.assign</strong>
to add a new column and replace an existing one with another, not necessarily
of the same <code class="docutils literal notranslate"><span class="pre">dtype</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.14</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.append</strong>
to add a few more rows to <code class="docutils literal notranslate"><span class="pre">df</span></code>.</p>
</div></div></section>
<section id="modifying-items">
<h3><span class="section-number">10.5.3. </span>Modifying items<a class="headerlink" href="#modifying-items" title="Link to this heading">¶</a></h3>
<p>In the current version of <strong class="program">pandas</strong>, modifying particular elements
gives a warning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># the same as df.u.iloc[0] = 7</span>
<span class="c1">## SettingWithCopyWarning:</span>
<span class="c1">## A value is trying to be set on a copy of a slice from a DataFrame</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># testing</span>
<span class="c1">## 7.0</span>
</pre></div>
</div>
<p>To remedy this, it is best to create a copy of a column,
modify it, and then to replace the old contents with the new ones.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">u</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1"># or a whole for loop to process them all, or whatever</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># testing</span>
<span class="c1">## 42.0</span>
</pre></div>
</div>
</section>
<section id="pseudorandom-sampling-and-splitting">
<span id="sec-random-sampling"></span><h3><span class="section-number">10.5.4. </span>Pseudorandom sampling and splitting<a class="headerlink" href="#pseudorandom-sampling-and-splitting" title="Link to this heading">¶</a></h3>
<p>As a simple application of what we have covered so far, let’s consider
some ways to sample several rows from an existing data frame.
We may need them, e.g., when our datasets are too large to fit into memory
or make data analysis too slow to run. In the most rudimentary scenarios,
we can use the <strong class="command">pandas.DataFrame.sample</strong> method, e.g., to:</p>
<ul class="simple">
<li><p>select five rows, without replacement,</p></li>
<li><p>select 20% rows, with replacement,</p></li>
<li><p>rearrange all the rows.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/nhanes_adult_female_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">body</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># 5 rows without replacement</span>
<span class="c1">##       BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 4214   58.4  156.2     35.2    34.7     27.2    99.5      77.5</span>
<span class="c1">## 3361   73.7  161.0     36.5    34.5     29.0   107.6      98.2</span>
<span class="c1">## 3759   61.4  164.6     37.5    40.4     26.9    93.5      84.4</span>
<span class="c1">## 3733  120.4  158.8     33.5    34.6     40.5   147.2     129.3</span>
<span class="c1">## 1121  123.5  157.5     35.5    29.0     50.5   143.0     136.4</span>
</pre></div>
</div>
<p>Notice the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> argument which controls the seed
of the pseudorandom number generator: this way, we get reproducible results.
Alternatively, we could call <strong class="command">numpy.random.seed</strong>.</p>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.15</span>
        
    </div><div class="proof-content">
<p>Show how the three aforementioned scenarios
can be implemented manually using <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
and <strong class="command">numpy.random.permutation</strong>
or <strong class="command">numpy.random.choice</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.16</span>
        
    </div><div class="proof-content">
<p>Can <strong class="command">pandas.read_csv</strong> be used to read only a random sample
of rows from a CSV file?</p>
</div></div><p>In machine learning practice, we are used to training and evaluating
machine learning models on different (mutually disjoint) subsets
of the whole data frame.</p>
<p>For instance, <a class="reference internal" href="430-group-by.html#sec-train-test-split"><span class="std std-numref">Section 12.3.3</span></a> mentions
that we may be interested in performing the
so-called <em>training/test split</em> (partitioning),
where 80% (or 60% or 70%) of the
randomly selected rows would constitute the first
new data frame and the remaining 20% (or 40% or 30%, respectively)
would go to the second one.</p>
<p>Given a data frame like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># this is just an example</span>
<span class="n">df</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 0   97.1  160.2     34.7    40.8     35.8   126.1     117.9</span>
<span class="c1">## 1   91.1  152.7     33.5    33.0     38.5   125.5     103.1</span>
<span class="c1">## 2   73.0  161.2     37.4    38.0     31.8   106.2      92.0</span>
<span class="c1">## 3   61.7  157.4     38.0    34.7     29.0   101.0      90.5</span>
<span class="c1">## 4   55.4  154.6     34.6    34.0     28.3    92.5      73.2</span>
<span class="c1">## 5   62.0  144.7     32.5    34.2     29.8   106.7      84.8</span>
<span class="c1">## 6   66.2  166.5     37.5    37.6     32.0    96.3      95.7</span>
<span class="c1">## 7   75.9  154.5     35.4    37.6     32.7   107.7      98.7</span>
<span class="c1">## 8   77.2  159.2     38.5    40.5     35.7   102.0      97.5</span>
<span class="c1">## 9   91.6  174.5     36.1    45.9     35.2   121.3     100.3</span>
</pre></div>
</div>
<p>one way to perform the aforementioned split is to generate a random
permutation of the set of row indexes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># reproducibility matters</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">idx</span>
<span class="c1">## array([4, 0, 7, 5, 8, 3, 1, 6, 9, 2])</span>
</pre></div>
</div>
<p>Then, we pick the first 80% for the training set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="p">:]</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 4   55.4  154.6     34.6    34.0     28.3    92.5      73.2</span>
<span class="c1">## 0   97.1  160.2     34.7    40.8     35.8   126.1     117.9</span>
<span class="c1">## 7   75.9  154.5     35.4    37.6     32.7   107.7      98.7</span>
<span class="c1">## 5   62.0  144.7     32.5    34.2     29.8   106.7      84.8</span>
<span class="c1">## 8   77.2  159.2     38.5    40.5     35.7   102.0      97.5</span>
<span class="c1">## 3   61.7  157.4     38.0    34.7     29.0   101.0      90.5</span>
<span class="c1">## 1   91.1  152.7     33.5    33.0     38.5   125.5     103.1</span>
<span class="c1">## 6   66.2  166.5     37.5    37.6     32.0    96.3      95.7</span>
</pre></div>
</div>
<p>The remaining ones produce the test set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">k</span><span class="p">:],</span> <span class="p">:]</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 9   91.6  174.5     36.1    45.9     35.2   121.3     100.3</span>
<span class="c1">## 2   73.0  161.2     37.4    38.0     31.8   106.2      92.0</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.17</span>
        
    </div><div class="proof-content">
<p>In the
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/other/wine_quality_all.csv"><code class="docutils literal notranslate"><span class="pre">wine_quality_all</span></code></a>
dataset, leave out all but the white wines. Partition the resulting data
frame randomly into three data frames: <code class="docutils literal notranslate"><span class="pre">wines_train</span></code> (60% of the rows),
<code class="docutils literal notranslate"><span class="pre">wines_validate</span></code> (another 20% of the rows), and <code class="docutils literal notranslate"><span class="pre">wines_test</span></code>
(the remaining 20%).</p>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.18</span>
        
    </div><div class="proof-content">
<p>Compose a function <strong class="command">kfold</strong> which takes a data frame <code class="docutils literal notranslate"><span class="pre">df</span></code> and an
integer <span class="math">\(k&gt;1\)</span> as arguments. Return a list of data frames resulting
in stemming from randomly partitioning <code class="docutils literal notranslate"><span class="pre">df</span></code> into <span class="math">\(k\)</span> disjoint chunks of
equal (or almost equal if that is not possible) sizes.</p>
</div></div></section>
<section id="hierarchical-indexes">
<h3><span class="section-number">10.5.5. </span>Hierarchical indexes (*)<a class="headerlink" href="#hierarchical-indexes" title="Link to this heading">¶</a></h3>
<p>Consider a data frame with a hierarchical index:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2024</span><span class="p">,</span> <span class="mi">2025</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">quarter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">,</span> <span class="s2">&quot;Q4&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">))</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;quarter&quot;</span><span class="p">])</span>
<span class="n">df</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">##      Q2       0.29</span>
<span class="c1">##      Q3       0.23</span>
<span class="c1">##      Q4       0.55</span>
<span class="c1">## 2024 Q1       0.72</span>
<span class="c1">##      Q2       0.42</span>
<span class="c1">##      Q3       0.98</span>
<span class="c1">##      Q4       0.68</span>
<span class="c1">## 2025 Q1       0.48</span>
<span class="c1">##      Q2       0.39</span>
<span class="c1">##      Q3       0.34</span>
<span class="c1">##      Q4       0.73</span>
</pre></div>
</div>
<p>The index has both levels named, but this is
purely for aesthetic reasons.</p>
<p>Indexing using <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> by default relates to
the first level of the hierarchy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2023</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">##          data</span>
<span class="c1">## quarter      </span>
<span class="c1">## Q1       0.70</span>
<span class="c1">## Q2       0.29</span>
<span class="c1">## Q3       0.23</span>
<span class="c1">## Q4       0.55</span>
</pre></div>
</div>
<p>Note that we selected <em>all</em> rows corresponding to a given label
and dropped (!) this level of the hierarchy.</p>
<p>Another example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">[</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2025</span><span class="p">],</span> <span class="p">:</span> <span class="p">]</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">##      Q2       0.29</span>
<span class="c1">##      Q3       0.23</span>
<span class="c1">##      Q4       0.55</span>
<span class="c1">## 2025 Q1       0.48</span>
<span class="c1">##      Q2       0.39</span>
<span class="c1">##      Q3       0.34</span>
<span class="c1">##      Q4       0.73</span>
</pre></div>
</div>
<p>To access deeper levels, we can use tuples as indexers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">),</span> <span class="p">:</span> <span class="p">]</span>
<span class="c1">## data    0.7</span>
<span class="c1">## Name: (2023, Q1), dtype: float64</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">[(</span><span class="mi">2023</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">)],</span> <span class="p">:</span> <span class="p">]</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">## 2024 Q3       0.98</span>
</pre></div>
</div>
<p>In certain scenarios, though, it will probably be much easier
to subset a hierarchical index by using <strong class="command">reset_index</strong>
and <strong class="command">set_index</strong> creatively (together with
<strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">pandas.Series.isin</strong>, etc.).</p>
<p>Let’s stress again that the `<strong class="command">:</strong>` operator
can only be used <em>directly</em> within the square brackets.
Nonetheless, we can always use the <strong class="command">slice</strong> constructor to create
a slice in any context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">]),</span> <span class="p">:</span> <span class="p">]</span>  <span class="c1"># :, [&quot;Q1&quot;, &quot;Q3&quot;]</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">##      Q3       0.23</span>
<span class="c1">## 2024 Q1       0.72</span>
<span class="c1">##      Q3       0.98</span>
<span class="c1">## 2025 Q1       0.48</span>
<span class="c1">##      Q3       0.34</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;Q2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">)),</span> <span class="p">:</span> <span class="p">]</span>  <span class="c1"># ::-1, &quot;Q2&quot;:&quot;Q3&quot;</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2025 Q3       0.34</span>
<span class="c1">##      Q2       0.39</span>
<span class="c1">## 2024 Q3       0.98</span>
<span class="c1">##      Q2       0.42</span>
<span class="c1">## 2023 Q3       0.23</span>
<span class="c1">##      Q2       0.29</span>
</pre></div>
</div>
</section>
</section>
<section id="further-operations-on-data-frames">
<h2><span class="section-number">10.6. </span>Further operations on data frames<a class="headerlink" href="#further-operations-on-data-frames" title="Link to this heading">¶</a></h2>
<p>One of the many roles of data frames is to represent tables
of values for their nice presentation, e.g., in reports
from data analysis or research papers. Here are some functions
that can aid in their formatting.</p>
<section id="sorting">
<span id="sec-df-sort"></span><h3><span class="section-number">10.6.1. </span>Sorting<a class="headerlink" href="#sorting" title="Link to this heading">¶</a></h3>
<p>Consider another example dataset: the yearly (for 2018) average
<a class="reference external" href="https://discover.data.vic.gov.au/dataset/epa-air-watch-all-sites-air-quality-hourly-averages-yearly">air quality data</a>
in the Australian state of Victoria.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/air_quality_2018_means.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">air</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">air</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">air</span><span class="o">.</span><span class="n">param_id</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;BPM2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">]),</span> <span class="p">:]</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We chose two air quality parameters using
<strong class="command">pandas.Series.isin</strong>, which determines whether
each element in a <code class="docutils literal notranslate"><span class="pre">Series</span></code> is enlisted in a given sequence.
We could also have used <strong class="command">set_index</strong> and <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
for that.</p>
<p>Notice that the preceding code spans many lines.
We needed to enclose it in round brackets to avoid a syntax error.
Alternatively, we could have used backslashes at the end of each line.</p>
<p>Anyway, here is the data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span>
<span class="c1">##           sp_name param_id      value</span>
<span class="c1">## 0      Alphington   BPM2.5   7.848758</span>
<span class="c1">## 1      Alphington      NO2   9.558120</span>
<span class="c1">## 2    Altona North      NO2   9.467912</span>
<span class="c1">## 3       Churchill   BPM2.5   6.391230</span>
<span class="c1">## 4       Dandenong      NO2   9.800705</span>
<span class="c1">## 5       Footscray   BPM2.5   7.640948</span>
<span class="c1">## 6       Footscray      NO2  10.274531</span>
<span class="c1">## 7   Geelong South   BPM2.5   6.502762</span>
<span class="c1">## 8   Geelong South      NO2   5.681722</span>
<span class="c1">## 9   Melbourne CBD   BPM2.5   8.072998</span>
<span class="c1">## 10            Moe   BPM2.5   6.427079</span>
<span class="c1">## 11   Morwell East   BPM2.5   6.784596</span>
<span class="c1">## 12  Morwell South   BPM2.5   6.512849</span>
<span class="c1">## 13  Morwell South      NO2   5.124430</span>
<span class="c1">## 14      Traralgon   BPM2.5   8.024735</span>
<span class="c1">## 15      Traralgon      NO2   5.776333</span>
</pre></div>
</div>
<p><strong class="command">sort_values</strong> is a convenient means to order the rows
with respect to one criterion, be it numeric or categorical.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">##           sp_name param_id      value</span>
<span class="c1">## 6       Footscray      NO2  10.274531</span>
<span class="c1">## 4       Dandenong      NO2   9.800705</span>
<span class="c1">## 1      Alphington      NO2   9.558120</span>
<span class="c1">## 2    Altona North      NO2   9.467912</span>
<span class="c1">## 9   Melbourne CBD   BPM2.5   8.072998</span>
<span class="c1">## 14      Traralgon   BPM2.5   8.024735</span>
<span class="c1">## 0      Alphington   BPM2.5   7.848758</span>
<span class="c1">## 5       Footscray   BPM2.5   7.640948</span>
<span class="c1">## 11   Morwell East   BPM2.5   6.784596</span>
<span class="c1">## 12  Morwell South   BPM2.5   6.512849</span>
<span class="c1">## 7   Geelong South   BPM2.5   6.502762</span>
<span class="c1">## 10            Moe   BPM2.5   6.427079</span>
<span class="c1">## 3       Churchill   BPM2.5   6.391230</span>
<span class="c1">## 15      Traralgon      NO2   5.776333</span>
<span class="c1">## 8   Geelong South      NO2   5.681722</span>
<span class="c1">## 13  Morwell South      NO2   5.124430</span>
</pre></div>
</div>
<p>It is also possible to take into account more sorting criteria:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;param_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="c1">##           sp_name param_id      value</span>
<span class="c1">## 9   Melbourne CBD   BPM2.5   8.072998</span>
<span class="c1">## 14      Traralgon   BPM2.5   8.024735</span>
<span class="c1">## 0      Alphington   BPM2.5   7.848758</span>
<span class="c1">## 5       Footscray   BPM2.5   7.640948</span>
<span class="c1">## 11   Morwell East   BPM2.5   6.784596</span>
<span class="c1">## 12  Morwell South   BPM2.5   6.512849</span>
<span class="c1">## 7   Geelong South   BPM2.5   6.502762</span>
<span class="c1">## 10            Moe   BPM2.5   6.427079</span>
<span class="c1">## 3       Churchill   BPM2.5   6.391230</span>
<span class="c1">## 6       Footscray      NO2  10.274531</span>
<span class="c1">## 4       Dandenong      NO2   9.800705</span>
<span class="c1">## 1      Alphington      NO2   9.558120</span>
<span class="c1">## 2    Altona North      NO2   9.467912</span>
<span class="c1">## 15      Traralgon      NO2   5.776333</span>
<span class="c1">## 8   Geelong South      NO2   5.681722</span>
<span class="c1">## 13  Morwell South      NO2   5.124430</span>
</pre></div>
</div>
<p>Here, in each group of identical parameters,
we get a decreasing order with respect to the value.</p>
<div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.19</span>
        
    </div><div class="proof-content">
<p>Compare the ordering with respect to <code class="docutils literal notranslate"><span class="pre">param_id</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code>
vs <code class="docutils literal notranslate"><span class="pre">value</span></code> and then <code class="docutils literal notranslate"><span class="pre">param_id</span></code>.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Lamentably, <strong class="command">DataFrame.sort_values</strong> by default
does not use a stable algorithm. If a data frame is sorted with respect to one criterion,
and then we reorder it with respect to another one, tied observations
are not guaranteed to be listed in the original order:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/air_quality_2018_means.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;sp_name&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;BPM2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">],</span> <span class="p">:]</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="c1">##    param_id        sp_name      value</span>
<span class="c1">## 0    BPM2.5  Melbourne CBD   8.072998</span>
<span class="c1">## 1    BPM2.5            Moe   6.427079</span>
<span class="c1">## 2    BPM2.5      Footscray   7.640948</span>
<span class="c1">## 3    BPM2.5   Morwell East   6.784596</span>
<span class="c1">## 4    BPM2.5      Churchill   6.391230</span>
<span class="c1">## 5    BPM2.5  Morwell South   6.512849</span>
<span class="c1">## 6    BPM2.5      Traralgon   8.024735</span>
<span class="c1">## 7    BPM2.5     Alphington   7.848758</span>
<span class="c1">## 8    BPM2.5  Geelong South   6.502762</span>
<span class="c1">## 9       NO2  Morwell South   5.124430</span>
<span class="c1">## 10      NO2      Traralgon   5.776333</span>
<span class="c1">## 11      NO2  Geelong South   5.681722</span>
<span class="c1">## 12      NO2   Altona North   9.467912</span>
<span class="c1">## 13      NO2     Alphington   9.558120</span>
<span class="c1">## 14      NO2      Dandenong   9.800705</span>
<span class="c1">## 15      NO2      Footscray  10.274531</span>
</pre></div>
</div>
<p>We lost the ordering based on station names in the two subgroups.
To switch to a mergesort-like method (timsort), we should pass
<code class="docutils literal notranslate"><span class="pre">kind=&quot;stable&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/air_quality_2018_means.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;sp_name&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">)</span>  <span class="c1"># !</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;BPM2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">],</span> <span class="p">:]</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="c1">##    param_id        sp_name      value</span>
<span class="c1">## 0    BPM2.5     Alphington   7.848758</span>
<span class="c1">## 1    BPM2.5      Churchill   6.391230</span>
<span class="c1">## 2    BPM2.5      Footscray   7.640948</span>
<span class="c1">## 3    BPM2.5  Geelong South   6.502762</span>
<span class="c1">## 4    BPM2.5  Melbourne CBD   8.072998</span>
<span class="c1">## 5    BPM2.5            Moe   6.427079</span>
<span class="c1">## 6    BPM2.5   Morwell East   6.784596</span>
<span class="c1">## 7    BPM2.5  Morwell South   6.512849</span>
<span class="c1">## 8    BPM2.5      Traralgon   8.024735</span>
<span class="c1">## 9       NO2     Alphington   9.558120</span>
<span class="c1">## 10      NO2   Altona North   9.467912</span>
<span class="c1">## 11      NO2      Dandenong   9.800705</span>
<span class="c1">## 12      NO2      Footscray  10.274531</span>
<span class="c1">## 13      NO2  Geelong South   5.681722</span>
<span class="c1">## 14      NO2  Morwell South   5.124430</span>
<span class="c1">## 15      NO2      Traralgon   5.776333</span>
</pre></div>
</div>
</div>
<div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.20</span>
        
    </div><div class="proof-content">
<p>(*) Perform identical reorderings but using only
<strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>, <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>,
and <strong class="command">numpy.argsort</strong>.</p>
</div></div></section>
<section id="stacking-and-unstacking-long-tall-and-wide-forms">
<span id="sec-stack"></span><h3><span class="section-number">10.6.2. </span>Stacking and unstacking (long/tall and wide forms)<a class="headerlink" href="#stacking-and-unstacking-long-tall-and-wide-forms" title="Link to this heading">¶</a></h3>
<p>Let’s discuss some further ways to transform
data frames that benefit from, make sense thanks to,
or are possible because they can have columns of various types.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">air</span></code> dataset is in the <em>long</em> (<em>tall</em>) format.
All measurements are <em>stacked</em> one after/below another.
Such a form is convenient for data storage,
especially where there are only a few recorded values
but many possible combinations of levels (sparse data).</p>
<p>The long format might not be optimal in all data processing
activities, though; compare <span id="id8">[<a class="reference internal" href="999-bibliography.html#id40" title="Wickham, H. (2014).  Tidy data. Journal of Statistical Software, 59(10):1–23. DOI: 10.18637/jss.v059.i10.">101</a>]</span>.
In the part of this book on matrix processing,
it was much more natural for us to have a single <em>observation</em>
in each row (e.g., data for each measurement station).</p>
<p>We can <em>unstack</em> the <code class="docutils literal notranslate"><span class="pre">air</span></code> data frame easily:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air_wide</span> <span class="o">=</span> <span class="n">air</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;sp_name&quot;</span><span class="p">,</span> <span class="s2">&quot;param_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span>
<span class="n">air_wide</span>
<span class="c1">## param_id         BPM2.5        NO2</span>
<span class="c1">## sp_name                           </span>
<span class="c1">## Alphington     7.848758   9.558120</span>
<span class="c1">## Altona North        NaN   9.467912</span>
<span class="c1">## Churchill      6.391230        NaN</span>
<span class="c1">## Dandenong           NaN   9.800705</span>
<span class="c1">## Footscray      7.640948  10.274531</span>
<span class="c1">## Geelong South  6.502762   5.681722</span>
<span class="c1">## Melbourne CBD  8.072998        NaN</span>
<span class="c1">## Moe            6.427079        NaN</span>
<span class="c1">## Morwell East   6.784596        NaN</span>
<span class="c1">## Morwell South  6.512849   5.124430</span>
<span class="c1">## Traralgon      8.024735   5.776333</span>
</pre></div>
</div>
<p>This is the so-called <em>wide</em> format.</p>
<p>A missing value is denoted by <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (not-a-number);
see <a class="reference internal" href="520-missingness.html#sec-missing-data"><span class="std std-numref">Section 15.1</span></a> for more details.
Interestingly, we obtained a hierarchical index in the <code class="docutils literal notranslate"><span class="pre">columns</span></code> (sic!) slot.
Hence, to drop the last level of the hierarchy,
we had to add the <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> part.
Also notice that the <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> slots are named.</p>
<p>The other way around, we can use the <strong class="command">stack</strong> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air_wide</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;param&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##    location          param      value</span>
<span class="c1">## 0    BPM2.5     Alphington   7.848758</span>
<span class="c1">## 1    BPM2.5      Churchill   6.391230</span>
<span class="c1">## 2    BPM2.5      Footscray   7.640948</span>
<span class="c1">## 3    BPM2.5  Geelong South   6.502762</span>
<span class="c1">## 4    BPM2.5  Melbourne CBD   8.072998</span>
<span class="c1">## 5    BPM2.5            Moe   6.427079</span>
<span class="c1">## 6    BPM2.5   Morwell East   6.784596</span>
<span class="c1">## 7    BPM2.5  Morwell South   6.512849</span>
<span class="c1">## 8    BPM2.5      Traralgon   8.024735</span>
<span class="c1">## 9       NO2     Alphington   9.558120</span>
<span class="c1">## 10      NO2   Altona North   9.467912</span>
<span class="c1">## 11      NO2      Dandenong   9.800705</span>
<span class="c1">## 12      NO2      Footscray  10.274531</span>
<span class="c1">## 13      NO2  Geelong South   5.681722</span>
<span class="c1">## 14      NO2  Morwell South   5.124430</span>
<span class="c1">## 15      NO2      Traralgon   5.776333</span>
</pre></div>
</div>
<p>We used the data frame transpose (<strong class="command">T</strong>) to
get a location-major order (less boring an outcome in this context).
Missing values are gone now. We do not need them anymore.
Nevertheless, passing <code class="docutils literal notranslate"><span class="pre">dropna=False</span></code> would help us identify
the combinations of <code class="docutils literal notranslate"><span class="pre">location</span></code> and <code class="docutils literal notranslate"><span class="pre">param</span></code> for which the readings
are not provided.</p>
</section>
<section id="joining-merging">
<span id="sec-join"></span><h3><span class="section-number">10.6.3. </span>Joining (merging)<a class="headerlink" href="#joining-merging" title="Link to this heading">¶</a></h3>
<p>In database design, it is common to normalise
the datasets. We do this to avoid the duplication of information
and pathologies stemming from them (e.g., <span id="id9">[<a class="reference internal" href="999-bibliography.html#id77" title="Date, C.J. (2003).  An Introduction to Database Systems. Pearson.">21</a>]</span>).</p>
<div class="proof proof-type-example" id="id32">

    <div class="proof-title">
        <span class="proof-type">Example 10.21</span>
        
    </div><div class="proof-content">
<p>The air quality parameters are separately described in another data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/air_quality_2018_param.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">param_std_unit_of_measure</span><span class="o">=</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">param</span>
<span class="c1">##   param_id                   param_name   unit      param_short_name</span>
<span class="c1">## 0      API      Airborne particle index   none  Visibility Reduction</span>
<span class="c1">## 1   BPM2.5  BAM  Particles &lt; 2.5 micron  ug/m3                 PM2.5</span>
<span class="c1">## 2       CO              Carbon Monoxide    ppm                    CO</span>
<span class="c1">## 3    HPM10                   Hivol PM10  ug/m3                   NaN</span>
<span class="c1">## 4      NO2             Nitrogen Dioxide    ppb                   NO2</span>
<span class="c1">## 5       O3                        Ozone    ppb                    O3</span>
<span class="c1">## 6     PM10     TEOM Particles &lt;10micron  ug/m3                  PM10</span>
<span class="c1">## 7   PPM2.5               Partisol PM2.5  ug/m3                   NaN</span>
<span class="c1">## 8      SO2               Sulfur Dioxide    ppb                   SO2</span>
</pre></div>
</div>
<p>We could have stored them alongside the <code class="docutils literal notranslate"><span class="pre">air</span></code> data frame,
but that would be a waste of space.
Also, if we wanted to modify some datum
(note, e.g., the annoying double space in <code class="docutils literal notranslate"><span class="pre">param_name</span></code> for <code class="docutils literal notranslate"><span class="pre">BPM2.5</span></code>),
we would have to update all the relevant records.</p>
<p>Instead, we can always match the records in both data frames
that have the same <code class="docutils literal notranslate"><span class="pre">param_id</span></code>s,
and join (merge) these datasets only when we really need this.</p>
</div></div><div style="margin-top: 1em"></div><p>Let’s discuss the possible join operations by studying two toy datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;b0&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="s2">&quot;b3&quot;</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">A</span>
<span class="c1">##     x   y</span>
<span class="c1">## 0  a0  b0</span>
<span class="c1">## 1  a1  b1</span>
<span class="c1">## 2  a2  b2</span>
<span class="c1">## 3  a3  b3</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a4&quot;</span><span class="p">],</span>
    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">B</span>
<span class="c1">##     x   z</span>
<span class="c1">## 0  a0  c0</span>
<span class="c1">## 1  a2  c1</span>
<span class="c1">## 2  a2  c2</span>
<span class="c1">## 3  a4  c3</span>
</pre></div>
</div>
<p>They both have one column somewhat <em>in common</em>, <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>The <em>inner (natural) join</em> returns the records that have a match in
both datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x   y   z</span>
<span class="c1">## 0  a0  b0  c0</span>
<span class="c1">## 1  a2  b2  c1</span>
<span class="c1">## 2  a2  b2  c2</span>
</pre></div>
</div>
<p>The <em>left join</em> of <span class="math">\(A\)</span> with <span class="math">\(B\)</span> guarantees to return all the records
from <span class="math">\(A\)</span>, even those which are not matched by anything in <span class="math">\(B\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x   y    z</span>
<span class="c1">## 0  a0  b0   c0</span>
<span class="c1">## 1  a1  b1  NaN</span>
<span class="c1">## 2  a2  b2   c1</span>
<span class="c1">## 3  a2  b2   c2</span>
<span class="c1">## 4  a3  b3  NaN</span>
</pre></div>
</div>
<p>The <em>right join</em> of <span class="math">\(A\)</span> with <span class="math">\(B\)</span> is the same as the left join of
<span class="math">\(B\)</span> with <span class="math">\(A\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x    y   z</span>
<span class="c1">## 0  a0   b0  c0</span>
<span class="c1">## 1  a2   b2  c1</span>
<span class="c1">## 2  a2   b2  c2</span>
<span class="c1">## 3  a4  NaN  c3</span>
</pre></div>
</div>
<p>Finally, the <em>full outer join</em> is the set-theoretic
union of the left and the right join:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x    y    z</span>
<span class="c1">## 0  a0   b0   c0</span>
<span class="c1">## 1  a1   b1  NaN</span>
<span class="c1">## 2  a2   b2   c1</span>
<span class="c1">## 3  a2   b2   c2</span>
<span class="c1">## 4  a3   b3  NaN</span>
<span class="c1">## 5  a4  NaN   c3</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.22</span>
        
    </div><div class="proof-content">
<p>Join
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/air_quality_2018_value.csv.gz"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_value</span></code></a>
with <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/air_quality_2018_point.csv"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_point</span></code></a>,
and then with <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/air_quality_2018_param.csv"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_param</span></code></a>.</p>
</div></div><div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.23</span>
        
    </div><div class="proof-content">
<p>Normalise
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/air_quality_2018.csv.gz"><code class="docutils literal notranslate"><span class="pre">air_quality_2018</span></code></a>
so that you get the three separate data frames mentioned in the previous
exercise (<code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">point</span></code>, and <code class="docutils literal notranslate"><span class="pre">param</span></code>).</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.24</span>
        
    </div><div class="proof-content">
<p>(*)
In the National Health and Nutrition Examination Survey,
each participant is uniquely identified by their sequence number (<code class="docutils literal notranslate"><span class="pre">SEQN</span></code>).
This token is mentioned in numerous datasets, including:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/P_DEMO.htm">demographic variables</a>,</p></li>
<li><p><a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/P_BMX.htm">body measures</a>,</p></li>
<li><p><a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/AUX_J.htm">audiometry</a>,</p></li>
<li><p>and <a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/continuousnhanes/default.aspx?BeginYear=2017">many more</a>.</p></li>
</ul>
<p>Join a few chosen datasets that you find interesting.</p>
</div></div></section>
<section id="set-theoretic-operations-and-removing-duplicates">
<h3><span class="section-number">10.6.4. </span>Set-theoretic operations and removing duplicates<a class="headerlink" href="#set-theoretic-operations-and-removing-duplicates" title="Link to this heading">¶</a></h3>
<p>Here are two not at all disjoint sets of imaginary persons:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/some_birth_dates1.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">A</span>
<span class="c1">##                   Name   BirthDate</span>
<span class="c1">## 0     Paitoon Ornwimol  26.06.1958</span>
<span class="c1">## 1         Antónia Lata  20.05.1935</span>
<span class="c1">## 2    Bertoldo Mallozzi  17.08.1972</span>
<span class="c1">## 3        Nedeljko Bukv  19.12.1921</span>
<span class="c1">## 4        Micha Kitchen  17.09.1930</span>
<span class="c1">## 5      Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 6         Paul Meckler  29.09.1968</span>
<span class="c1">## 7      Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 8         Åge Trelstad  07.03.1935</span>
<span class="c1">## 9  Duchanee Panomyaong  19.06.1952</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/some_birth_dates2.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">B</span>
<span class="c1">##                    Name   BirthDate</span>
<span class="c1">## 0    Hushang Naigamwala  25.08.1991</span>
<span class="c1">## 1              Zhen Wei  16.11.1975</span>
<span class="c1">## 2         Micha Kitchen  17.09.1930</span>
<span class="c1">## 3           Jodoc Alwin  16.11.1969</span>
<span class="c1">## 4            Igor Mazał  14.05.2004</span>
<span class="c1">## 5       Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 6   Duchanee Panomyaong  19.06.1952</span>
<span class="c1">## 7       Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 8          Paul Meckler  29.09.1968</span>
<span class="c1">## 9         Noe Tae-Woong  11.07.1970</span>
<span class="c1">## 10         Åge Trelstad  07.03.1935</span>
</pre></div>
</div>
<p>In both datasets, there is a single categorical column whose
elements uniquely identify each record (i.e., <code class="docutils literal notranslate"><span class="pre">Name</span></code>).
In the language of relational databases, we would call it
the <em>primary key</em>.
In such a case, implementing the set-theoretic operations
is relatively easy, as we can refer to the <strong class="command">pandas.Series.isin</strong>
method.</p>
<p>First, <span class="math">\(A\cap B\)</span> (intersection),
includes only the rows that are <em>both</em> in <span class="math">\(A\)</span> and in <span class="math">\(B\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="p">:]</span>
<span class="c1">##                   Name   BirthDate</span>
<span class="c1">## 4        Micha Kitchen  17.09.1930</span>
<span class="c1">## 5      Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 6         Paul Meckler  29.09.1968</span>
<span class="c1">## 7      Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 8         Åge Trelstad  07.03.1935</span>
<span class="c1">## 9  Duchanee Panomyaong  19.06.1952</span>
</pre></div>
</div>
<p>Second, <span class="math">\(A\smallsetminus B\)</span> (difference), gives all
the rows that are in <span class="math">\(A\)</span> <em>but not</em> in <span class="math">\(B\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">A</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="p">:]</span>
<span class="c1">##                 Name   BirthDate</span>
<span class="c1">## 0   Paitoon Ornwimol  26.06.1958</span>
<span class="c1">## 1       Antónia Lata  20.05.1935</span>
<span class="c1">## 2  Bertoldo Mallozzi  17.08.1972</span>
<span class="c1">## 3      Nedeljko Bukv  19.12.1921</span>
</pre></div>
</div>
<p>Third, <span class="math">\(A\cup B\)</span> (union), returns the rows that exist in <span class="math">\(A\)</span> <em>or</em>
are in <span class="math">\(B\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">B</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="p">:]))</span>
<span class="c1">##                   Name   BirthDate</span>
<span class="c1">## 0     Paitoon Ornwimol  26.06.1958</span>
<span class="c1">## 1         Antónia Lata  20.05.1935</span>
<span class="c1">## 2    Bertoldo Mallozzi  17.08.1972</span>
<span class="c1">## 3        Nedeljko Bukv  19.12.1921</span>
<span class="c1">## 4        Micha Kitchen  17.09.1930</span>
<span class="c1">## 5      Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 6         Paul Meckler  29.09.1968</span>
<span class="c1">## 7      Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 8         Åge Trelstad  07.03.1935</span>
<span class="c1">## 9  Duchanee Panomyaong  19.06.1952</span>
<span class="c1">## 0   Hushang Naigamwala  25.08.1991</span>
<span class="c1">## 1             Zhen Wei  16.11.1975</span>
<span class="c1">## 3          Jodoc Alwin  16.11.1969</span>
<span class="c1">## 4           Igor Mazał  14.05.2004</span>
<span class="c1">## 9        Noe Tae-Woong  11.07.1970</span>
</pre></div>
</div>
<p>There are no duplicate rows in any of the above outputs.</p>
<div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.25</span>
        
    </div><div class="proof-content">
<p>Determine
<span class="math">\((A\cup B) \smallsetminus (A\cap B) = (A\smallsetminus B)\cup(B\smallsetminus A)\)</span>
(symmetric difference).</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.26</span>
        
    </div><div class="proof-content">
<p>(*)
Determine the union, intersection, and difference of the
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/other/wine_sample1.csv"><code class="docutils literal notranslate"><span class="pre">wine_sample1</span></code></a>
and
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/other/wine_sample2.csv"><code class="docutils literal notranslate"><span class="pre">wine_sample2</span></code></a> datasets,
where there is no column uniquely identifying the observations.
Hint: consider using
<strong class="command">pandas.concat</strong> and
<strong class="command">pandas.DataFrame.duplicated</strong> or
<strong class="command">pandas.DataFrame.drop_duplicates</strong>.</p>
</div></div></section>
<section id="and-too-many-more">
<h3><span class="section-number">10.6.5. </span>…and (too) many more<a class="headerlink" href="#and-too-many-more" title="Link to this heading">¶</a></h3>
<p>Looking at the list of methods
for the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">Series</span></code> classes in the <strong class="program">pandas</strong> package’s
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">documentation</a>,
we can see that they are abundant. Together with the object-orientated
syntax, we will often find ourselves appreciating the high readability
of even complex operation chains such as
<code class="docutils literal notranslate"><span class="pre">data.drop_duplicates().groupby([&quot;year&quot;,</span> <span class="pre">&quot;month&quot;]).mean().reset_index()</span></code>;
see <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>.</p>
<p>Nevertheless, the methods are probably too plentiful to our taste.
Their developers were overgenerous. They wanted
to include a list of all the possible <em>verbs</em> related to data analysis,
even if they can be trivially expressed by a composition of 2-3 simpler
operations from <strong class="program">numpy</strong> or <strong class="program">scipy</strong> instead.</p>
<p>As strong advocates of minimalism, we would rather
save ourselves from being overloaded with too much new information.
This is why our focus in this book is on developing the most
<em>transferable</em><a class="footnote-reference brackets" href="#foottransfer" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> skills.
Our approach is also slightly more hygienic.
We do not want the reader to develop a hopeless mindset,
the habit of looking everything up on the internet
when faced with even the simplest kinds of problems.
We have brains for a reason.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">10.7. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.27</span>
        
    </div><div class="proof-content">
<p>How are data frames different from matrices?</p>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.28</span>
        
    </div><div class="proof-content">
<p>What are the use cases of the <code class="docutils literal notranslate"><span class="pre">name</span></code> slot
in <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">Index</span></code> objects?</p>
</div></div><div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.29</span>
        
    </div><div class="proof-content">
<p>What is the purpose of <strong class="command">set_index</strong> and <strong class="command">reset_index</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id41">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.30</span>
        
    </div><div class="proof-content">
<p>Why learning <strong class="program">numpy</strong> is crucial when someone wants to become
a proficient user of <strong class="program">pandas</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id42">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.31</span>
        
    </div><div class="proof-content">
<p>What is the difference between <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id43">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.32</span>
        
    </div><div class="proof-content">
<p>Why applying the index operator <code class="docutils literal notranslate"><span class="pre">[...]</span></code> directly on a
<code class="docutils literal notranslate"><span class="pre">Series</span></code> or <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object is discouraged?</p>
</div></div><div class="proof proof-type-exercise" id="id44">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.33</span>
        
    </div><div class="proof-content">
<p>What is the difference between <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">Index</span></code>, and <code class="docutils literal notranslate"><span class="pre">columns</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id45">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.34</span>
        
    </div><div class="proof-content">
<p>How can we compute the arithmetic mean and median
of all the numeric columns in a data frame, using
a single line of code?</p>
</div></div><div class="proof proof-type-exercise" id="id46">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.35</span>
        
    </div><div class="proof-content">
<p>What is a training/test split and how to perform it using
<strong class="program">numpy</strong> and <strong class="program">pandas</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id47">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.36</span>
        
    </div><div class="proof-content">
<p>What is the difference between stacking and unstacking?
Which one yields a wide (as opposed to long) format?</p>
</div></div><div class="proof proof-type-exercise" id="id48">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.37</span>
        
    </div><div class="proof-content">
<p>Name different data frame join (merge) operations and explain how
they work.</p>
</div></div><div class="proof proof-type-exercise" id="id49">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.38</span>
        
    </div><div class="proof-content">
<p>How does sorting with respect to more than one criterion work?</p>
</div></div><div class="proof proof-type-exercise" id="id50">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.39</span>
        
    </div><div class="proof-content">
<p>Name the set-theoretic operations on data frames.</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footdf" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>Data frames were first introduced in the 1991 version
of the S language <span id="id11">[<a class="reference internal" href="999-bibliography.html#id39" title="Chambers, J.M. and Hastie, T. (1991).  Statistical Models in S. Wadsworth &amp; Brooks/Cole.">15</a>]</span>.</p>
</aside>
<aside class="footnote brackets" id="footgoback" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">2</a><span class="fn-bracket">]</span></span>
<p>If, by any chance, some overenthusiastic readers
decided to start this superb book at this chapter,
it is now the time to go back to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a>
and learn everything in the right order. See you later.</p>
</aside>
<aside class="footnote brackets" id="footindex" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">3</a><span class="fn-bracket">]</span></span>
<p>The name <code class="docutils literal notranslate"><span class="pre">Index</span></code> is confusing not only because
it clashes with the <em>index</em> operator (square brackets),
but also the concept of an <em>index</em> in relational databases.
In <strong class="program">pandas</strong>, we can have nonunique row names.</p>
</aside>
<aside class="footnote brackets" id="footinclusive" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">4</a><span class="fn-bracket">]</span></span>
<p>Inconsistency; but makes sense when
selecting column ranges.</p>
</aside>
<aside class="footnote brackets" id="footallmatch" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">5</a><span class="fn-bracket">]</span></span>
<p>Inconsistency; but makes sense for hierarchical
indexes with repeated.</p>
</aside>
<aside class="footnote brackets" id="foottransfer" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">6</a><span class="fn-bracket">]</span></span>
<p>This is also in line with the observation that
Python with <strong class="program">pandas</strong> is not the only environment
where we can work with data frames; e.g., base R and Julia with
<strong class="program">DataFrame.jl</strong> support that too.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="420-categorical.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">11. </span>Handling categorical data</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="330-relationship.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">9. </span>Exploring relationships between variables</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2025 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2025-04-22T11:00:38+0200.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">10. Introducing data frames</a><ul>
<li><a class="reference internal" href="#creating-data-frames">10.1. Creating data frames</a><ul>
<li><a class="reference internal" href="#data-frames-are-matrix-like">10.1.1. Data frames are matrix-like</a></li>
<li><a class="reference internal" href="#series">10.1.2. <code class="docutils literal notranslate"><span class="pre">Series</span></code></a></li>
<li><a class="reference internal" href="#index">10.1.3. <code class="docutils literal notranslate"><span class="pre">Index</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#aggregating-data-frames">10.2. Aggregating data frames</a></li>
<li><a class="reference internal" href="#transforming-data-frames">10.3. Transforming data frames</a></li>
<li><a class="reference internal" href="#indexing-series-objects">10.4. Indexing <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects</a><ul>
<li><a class="reference internal" href="#do-not-use-directly-in-the-current-version-of-pandas">10.4.1. Do not use <code class="docutils literal notranslate"><span class="pre">[...]</span></code> directly (in the current version of <strong class="program">pandas</strong>)</a></li>
<li><a class="reference internal" href="#loc">10.4.2. <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code></a></li>
<li><a class="reference internal" href="#iloc">10.4.3. <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code></a></li>
<li><a class="reference internal" href="#logical-indexing">10.4.4. Logical indexing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexing-data-frames">10.5. Indexing data frames</a><ul>
<li><a class="reference internal" href="#loc-and-iloc">10.5.1. <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code></a></li>
<li><a class="reference internal" href="#adding-rows-and-columns">10.5.2. Adding rows and columns</a></li>
<li><a class="reference internal" href="#modifying-items">10.5.3. Modifying items</a></li>
<li><a class="reference internal" href="#pseudorandom-sampling-and-splitting">10.5.4. Pseudorandom sampling and splitting</a></li>
<li><a class="reference internal" href="#hierarchical-indexes">10.5.5. Hierarchical indexes (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-operations-on-data-frames">10.6. Further operations on data frames</a><ul>
<li><a class="reference internal" href="#sorting">10.6.1. Sorting</a></li>
<li><a class="reference internal" href="#stacking-and-unstacking-long-tall-and-wide-forms">10.6.2. Stacking and unstacking (long/tall and wide forms)</a></li>
<li><a class="reference internal" href="#joining-merging">10.6.3. Joining (merging)</a></li>
<li><a class="reference internal" href="#set-theoretic-operations-and-removing-duplicates">10.6.4. Set-theoretic operations and removing duplicates</a></li>
<li><a class="reference internal" href="#and-too-many-more">10.6.5. …and (too) many more</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">10.7. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=ff40c50f"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>