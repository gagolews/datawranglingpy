<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>10. Introducing Data Frames &mdash; Minimalist Data Wrangling with Python by Marek Gagolewski</title>
  

  
  
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/410-data-frame.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Handling Categorical Data" href="420-categorical.html" />
    <link rel="prev" title="9. Exploring Relationships Between Variables" href="330-relationship.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Minimalist Data Wrangling with Python [v0.5.2]
          

          
          </a>

          <div class="version">
          by <a style="color: inherit" href="https://www.gagolewski.com">Marek Gagolewski</a>
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar Types and Control Structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and Other Types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional Numeric Data and Their Empirical Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing Unidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous Probability Distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. Multidimensional Numeric Data at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing Multidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring Relationships Between Variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous Data</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. Introducing Data Frames</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-data-frames">10.1. Creating Data Frames</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-frames-are-matrix-like">10.1.1. Data Frames are Matrix-Like</a></li>
<li class="toctree-l3"><a class="reference internal" href="#series">10.1.2. <code class="docutils literal notranslate"><span class="pre">Series</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#index">10.1.3. <code class="docutils literal notranslate"><span class="pre">Index</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#aggregating-data-frames">10.2. Aggregating Data Frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transforming-data-frames">10.3. Transforming Data Frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="#indexing-series-objects">10.4. Indexing <code class="docutils literal notranslate"><span class="pre">Series</span></code> Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#do-not-use-directly">10.4.1. Do Not Use <code class="docutils literal notranslate"><span class="pre">[...]</span></code> Directly</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loc">10.4.2. <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#iloc">10.4.3. <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#logical-indexing">10.4.4. Logical Indexing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#indexing-data-frames">10.5. Indexing Data Frames</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loc-and-iloc">10.5.1. <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-rows-and-columns">10.5.2. Adding Rows and Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#random-sampling">10.5.3. Random Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hierarchical-indices">10.5.4. Hierarchical Indices (*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#further-operations-on-data-frames">10.6. Further Operations on Data Frames</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sorting">10.6.1. Sorting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stacking-and-unstacking-long-and-wide-forms">10.6.2. Stacking and Unstacking (Long and Wide Forms)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-theoretic-operations">10.6.3. Set-Theoretic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-merging">10.6.4. Joining (Merging)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#and-too-many-more">10.6.5. …And (Too) Many More</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">10.7. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">11. Handling Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing Data in Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">13. Accessing Databases (An Interlude)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Data Types</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">14. Text Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-missingness.html">15. Missing, Censored, and Questionable Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">Report Bugs or Typos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching_data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com">Author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minimalist Data Wrangling with Python [v0.5.2]</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">10. </span>Introducing Data Frames</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        
        <a class="github-button" href="https://github.com/gagolews/datawranglingpy" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star gagolews/datawranglingpy on GitHub">Star</a>
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="420-categorical.html" class="btn btn-neutral float-right" title="11. Handling Categorical Data" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="330-relationship.html" class="btn btn-neutral float-left" title="9. Exploring Relationships Between Variables" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="introducing-data-frames">
<span id="chap-data-frame"></span><h1><span class="section-number">10. </span>Introducing Data Frames<a class="headerlink" href="#introducing-data-frames" title="Permalink to this headline"></a></h1>
<blockquote>
<div><p><em>The online version of the open access textbook</em> Minimalist Data
Wrangling with Python <em>by <a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>).
Any <a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">bug/typos reports/fixes</a>
are appreciated. Although available online, this is a whole course,
and should be read from the beginning to the end. In particular,
refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em></p>
</div></blockquote>
<p><strong class="program">numpy</strong> arrays are an extremely versatile tool for performing data
analysis and other numerical computations computations of various kinds.
Although theoretically possible otherwise, in practice
we only store elements of the same type therein, most often numbers.</p>
<p><a class="reference external" href="https://pandas.pydata.org/"><strong class="program">pandas</strong></a> <span id="id1">[<a class="reference internal" href="999-bibliography.html#id13">McK17</a>]</span>
is amongst over <a class="reference external" href="https://libraries.io/pypi/numpy">one hundred thousand</a>
of open source packages and repositories that use <strong class="program">numpy</strong> to provide
additional data wrangling functionality.
It was originally written by Wes McKinney
and was heavily inspired by the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code><a class="footnote-reference brackets" href="#footdf" id="id2">1</a> objects in S and R
as well as tables in relational (think: SQL) databases
and spreadsheets.</p>
<div style="margin-top: 1em"></div><p>It is customary to load this package with the following alias:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>The <strong class="program">pandas</strong> package delivers a few classes, of which the most important are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> – for representing tabular data (matrix-like)
with columns of possibly different types,
in particular a mix of numerical and categorical variables,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code> – vector-like objects for representing individual columns,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Index</span></code> – vector-like (usually) objects for labelling individual
rows and columns of <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>s and items in <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects,</p></li>
</ul>
<p>together with many methods for:</p>
<ul class="simple">
<li><p>transforming/aggregating/processing data, also
in groups determined by categorical variables or products thereof,</p></li>
<li><p>reshaping (e.g., from wide to long format) and joining datasets,</p></li>
<li><p>importing/exporting data from/to various sources and formats,
e.g., CSV and HDF5 files or relational databases,</p></li>
<li><p>handling missing data,</p></li>
</ul>
<p>which we introduce in this and further chapters.</p>
<div class="section" id="creating-data-frames">
<h2><span class="section-number">10.1. </span>Creating Data Frames<a class="headerlink" href="#creating-data-frames" title="Permalink to this headline"></a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Let us repeat: <strong class="program">pandas</strong> is built on top of
<strong class="program">numpy</strong> and most objects therein can be processed by
<strong class="program">numpy</strong> functions as well.
Other functions (e.g., in <strong class="program">seaborn</strong> or <strong class="program">sklearn</strong>)
will be accepting both <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> objects,
but will be converting the former to the latter
automatically to enable data processing using
fast C/C++/Fortran routines.
What we have learnt so far still applies.
But there is of course more, hence this part.</p>
</div>
<p>Data frames can be created, amongst others,
using the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> class constructor, which
can be fed, for example, with a <strong class="program">numpy</strong> matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1">##           a         b         c</span>
<span class="c1">## 0  0.696469  0.286139  0.226851</span>
<span class="c1">## 1  0.551315  0.719469  0.423106</span>
<span class="c1">## 2  0.980764  0.684830  0.480932</span>
<span class="c1">## 3  0.392118  0.343178  0.729050</span>
</pre></div>
</div>
<p>Note that rows and columns are labelled (and how readable that is).</p>
<p>A dictionary of vector-like objects of equal lengths is another
common option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">]</span>
<span class="p">))</span>
<span class="c1">##       u      v  w      x</span>
<span class="c1">## 0  0.70   True  A   spam</span>
<span class="c1">## 1  0.29   True  B   spam</span>
<span class="c1">## 2  0.23  False  C  bacon</span>
<span class="c1">## 3  0.55  False  D   spam</span>
<span class="c1">## 4  0.72   True  E   eggs</span>
</pre></div>
</div>
<p>This illustrates the possibility of having columns of different
types.</p>
<div class="proof proof-type-exercise" id="id6">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.1</span>
        
    </div><div class="proof-content">
<p>Check out the <strong class="command">pandas.DataFrame.from_dict</strong> and
<strong class="command">pandas.DataFrame.from_records</strong>
methods in the <a class="reference external" href="https://pandas.pydata.org/docs/">documentation</a>.
Use them to create some example data frames.</p>
</div></div><p>Further, data frames can be read from files in different
formats, for instance, CSV:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/nhanes_adult_female_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">body</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># display first few rows (5 by default)</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 0   97.1  160.2     34.7    40.8     35.8   126.1     117.9</span>
<span class="c1">## 1   91.1  152.7     33.5    33.0     38.5   125.5     103.1</span>
<span class="c1">## 2   73.0  161.2     37.4    38.0     31.8   106.2      92.0</span>
<span class="c1">## 3   61.7  157.4     38.0    34.7     29.0   101.0      90.5</span>
<span class="c1">## 4   55.4  154.6     34.6    34.0     28.3    92.5      73.2</span>
</pre></div>
</div>
<p>Reading from URLs and local files (compare <a class="reference internal" href="440-sql.html#sec-file-paths"><span class="std std-numref">Section 13.6.1</span></a>)
is of course supported.</p>
<div class="proof proof-type-exercise" id="id7">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.2</span>
        
    </div><div class="proof-content">
<p>Check out the other <strong class="command">pandas.read_*</strong> functions
in the <strong class="program">pandas</strong> documentation – some of which we shall
be discussing later.</p>
</div></div><div class="section" id="data-frames-are-matrix-like">
<h3><span class="section-number">10.1.1. </span>Data Frames are Matrix-Like<a class="headerlink" href="#data-frames-are-matrix-like" title="Permalink to this headline"></a></h3>
<p>Data frames are modelled through <strong class="program">numpy</strong> matrices,
hence we can feel quite at home with them.</p>
<p>For example, given:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">]</span>
<span class="p">))</span>
<span class="n">df</span>
<span class="c1">##       u      v  w      x</span>
<span class="c1">## 0  0.70   True  A   spam</span>
<span class="c1">## 1  0.29   True  B   spam</span>
<span class="c1">## 2  0.23  False  C  bacon</span>
<span class="c1">## 3  0.55  False  D   spam</span>
<span class="c1">## 4  0.72   True  E   eggs</span>
</pre></div>
</div>
<p>it is easy to fetch the number of rows and columns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
<span class="c1">## (5, 4)</span>
</pre></div>
</div>
<p>or the type of each column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="c1">## u    float64</span>
<span class="c1">## v       bool</span>
<span class="c1">## w     object</span>
<span class="c1">## x     object</span>
<span class="c1">## dtype: object</span>
</pre></div>
</div>
<p>Recall that arrays are equipped with the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> slot.</p>
</div>
<div class="section" id="series">
<h3><span class="section-number">10.1.2. </span><code class="docutils literal notranslate"><span class="pre">Series</span></code><a class="headerlink" href="#series" title="Permalink to this headline"></a></h3>
<p>There is a separate class for storing individual data frame
columns: it is called <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span>  <span class="c1"># extract the `u` column; alternatively: d.u</span>
<span class="n">s</span>
<span class="c1">## 0    0.70</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 2    0.23</span>
<span class="c1">## 3    0.55</span>
<span class="c1">## 4    0.72</span>
<span class="c1">## Name: u, dtype: float64</span>
</pre></div>
</div>
<p>Note that a data frame with one column is printed
out slightly differently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="c1">##       u</span>
<span class="c1">## 0  0.70</span>
<span class="c1">## 1  0.29</span>
<span class="c1">## 2  0.23</span>
<span class="c1">## 3  0.55</span>
<span class="c1">## 4  0.72</span>
</pre></div>
</div>
<p>Indexing will of course be discussed later.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is crucial to know when we are dealing
with a <code class="docutils literal notranslate"><span class="pre">Series</span></code> and when with a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object,
because each of them defines a slightly different set of methods.</p>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">## 0.49800000000000005</span>
</pre></div>
</div>
<p>refers to <strong class="command">pandas.Series.mean</strong> (which returns a scalar), whereas</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">## u    0.498</span>
<span class="c1">## v    0.600</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>uses <strong class="command">pandas.DataFrame.mean</strong> (which yields a <code class="docutils literal notranslate"><span class="pre">Series</span></code>).</p>
<div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.3</span>
        
    </div><div class="proof-content">
<p>Look up the two methods in the <strong class="program">pandas</strong> manual.
Note that their argument list is slightly different.</p>
</div></div><p><code class="docutils literal notranslate"><span class="pre">Series</span></code> are wrappers around <strong class="program">numpy</strong> arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">values</span>
<span class="c1">## array([0.7 , 0.29, 0.23, 0.55, 0.72])</span>
</pre></div>
</div>
<p>Most importantly, <strong class="program">numpy</strong> functions can be called directly on them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1">## 0.49800000000000005</span>
</pre></div>
</div>
<p>Hence, what we have covered in the part dealing with vector
processing still holds for data frame columns as well (there will be more,
stay tuned).</p>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> can also be <em>named</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">name</span>
<span class="c1">## &#39;u&#39;</span>
</pre></div>
</div>
<p>This is convenient when we convert from/to a data frame.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="c1">##    spam</span>
<span class="c1">## 0  0.70</span>
<span class="c1">## 1  0.29</span>
<span class="c1">## 2  0.23</span>
<span class="c1">## 3  0.55</span>
<span class="c1">## 4  0.72</span>
</pre></div>
</div>
</div>
<div class="section" id="index">
<h3><span class="section-number">10.1.3. </span><code class="docutils literal notranslate"><span class="pre">Index</span></code><a class="headerlink" href="#index" title="Permalink to this headline"></a></h3>
<p>Another important class is <code class="docutils literal notranslate"><span class="pre">Index</span></code>, which
is used for encoding the row and column names in a data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span>  <span class="c1"># row labels</span>
<span class="c1">## RangeIndex(start=0, stop=5, step=1)</span>
</pre></div>
</div>
<p>The above represents a sequence (0, 1, 2, 3, 4).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>  <span class="c1"># column labels</span>
<span class="c1">## Index([&#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
<p>Also, we can label the individual elements in <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">index</span>
<span class="c1">## RangeIndex(start=0, stop=5, step=1)</span>
</pre></div>
</div>
<p>A quite frequent operation that we will be applying
to make a data frame column act as a vector of row labels
is implemented in the <code class="docutils literal notranslate"><span class="pre">set_index</span></code> method for data frames:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">df2</span>
<span class="c1">##           u      v  w</span>
<span class="c1">## x                    </span>
<span class="c1">## spam   0.70   True  A</span>
<span class="c1">## spam   0.29   True  B</span>
<span class="c1">## bacon  0.23  False  C</span>
<span class="c1">## spam   0.55  False  D</span>
<span class="c1">## eggs   0.72   True  E</span>
</pre></div>
</div>
<p>Note that this <code class="docutils literal notranslate"><span class="pre">Index</span></code> object is named:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
<span class="c1">## &#39;x&#39;</span>
</pre></div>
</div>
<p>which is handy when we decide that we want to convert
the vector of row labels back to a standalone column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##        x     u      v  w</span>
<span class="c1">## 0   spam  0.70   True  A</span>
<span class="c1">## 1   spam  0.29   True  B</span>
<span class="c1">## 2  bacon  0.23  False  C</span>
<span class="c1">## 3   spam  0.55  False  D</span>
<span class="c1">## 4   eggs  0.72   True  E</span>
</pre></div>
</div>
<p>There is also an option to get rid of the current <code class="docutils literal notranslate"><span class="pre">.index</span></code>
and to replace it with the default label sequence, i.e.,
0, 1, 2, …:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">##       u      v  w</span>
<span class="c1">## 0  0.70   True  A</span>
<span class="c1">## 1  0.29   True  B</span>
<span class="c1">## 2  0.23  False  C</span>
<span class="c1">## 3  0.55  False  D</span>
<span class="c1">## 4  0.72   True  E</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In due course, we will be calling
<code class="docutils literal notranslate"><span class="pre">df.reset_index(drop=True)</span></code> quite frequently, sometimes
more than once in a single chain of commands.</p>
</div>
<div class="proof proof-type-exercise" id="id9">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.4</span>
        
    </div><div class="proof-content">
<p>Use the
<strong class="command">pandas.DataFrame.rename</strong> method to
change the name of the <code class="docutils literal notranslate"><span class="pre">u</span></code> column in <code class="docutils literal notranslate"><span class="pre">df</span></code> to <code class="docutils literal notranslate"><span class="pre">spam</span></code>.</p>
</div></div><p>Also, a <em>hierarchical</em> index – one that is comprised
of more than two levels – is possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">])</span>
<span class="c1">##                 u  w</span>
<span class="c1">## x     v             </span>
<span class="c1">## spam  True   0.70  A</span>
<span class="c1">##       True   0.29  B</span>
<span class="c1">##       False  0.55  D</span>
<span class="c1">## eggs  True   0.72  E</span>
<span class="c1">## bacon False  0.23  C</span>
</pre></div>
</div>
<p>Note that a group of three consecutive <code class="docutils literal notranslate"><span class="pre">spam</span></code>s
does not have the labels repeated – this is for increased
readability.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We will soon see that hierarchical indexes might arise
after aggregating data in groups (via the <strong class="command">groupby</strong> method).</p>
</div>
<p>For <a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/P_DEMO.htm">example</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/nhanes_p_demo_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">nhanes</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;RIAGENDR&quot;</span><span class="p">,</span> <span class="s2">&quot;DMDEDUC2&quot;</span><span class="p">])[</span><span class="s2">&quot;BMXBMI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">res</span>  <span class="c1"># BMI by gender and education</span>
<span class="c1">## RIAGENDR  DMDEDUC2</span>
<span class="c1">## 1         1.0         28.765244</span>
<span class="c1">##           2.0         28.534737</span>
<span class="c1">##           3.0         29.637793</span>
<span class="c1">##           4.0         30.323158</span>
<span class="c1">##           5.0         28.689736</span>
<span class="c1">##           9.0         28.080000</span>
<span class="c1">## 2         1.0         30.489032</span>
<span class="c1">##           2.0         31.251247</span>
<span class="c1">##           3.0         30.969200</span>
<span class="c1">##           4.0         31.471476</span>
<span class="c1">##           5.0         28.891357</span>
<span class="c1">##           7.0         30.200000</span>
<span class="c1">##           9.0         33.950000</span>
<span class="c1">## Name: BMXBMI, dtype: float64</span>
</pre></div>
</div>
<p>But let us fret not, as there is always:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##     RIAGENDR  DMDEDUC2     BMXBMI</span>
<span class="c1">## 0          1       1.0  28.765244</span>
<span class="c1">## 1          1       2.0  28.534737</span>
<span class="c1">## 2          1       3.0  29.637793</span>
<span class="c1">## 3          1       4.0  30.323158</span>
<span class="c1">## 4          1       5.0  28.689736</span>
<span class="c1">## 5          1       9.0  28.080000</span>
<span class="c1">## 6          2       1.0  30.489032</span>
<span class="c1">## 7          2       2.0  31.251247</span>
<span class="c1">## 8          2       3.0  30.969200</span>
<span class="c1">## 9          2       4.0  31.471476</span>
<span class="c1">## 10         2       5.0  28.891357</span>
<span class="c1">## 11         2       7.0  30.200000</span>
<span class="c1">## 12         2       9.0  33.950000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="aggregating-data-frames">
<h2><span class="section-number">10.2. </span>Aggregating Data Frames<a class="headerlink" href="#aggregating-data-frames" title="Permalink to this headline"></a></h2>
<p>Here is an example data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;sausage&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">])</span>
<span class="n">d</span>
<span class="c1">##       u     v        w</span>
<span class="c1">## a  0.70  0.32     spam</span>
<span class="c1">## b  0.29 -0.05    bacon</span>
<span class="c1">## c  0.23 -0.20     spam</span>
<span class="c1">## d  0.55  1.98     eggs</span>
<span class="c1">## e  0.72 -1.62  sausage</span>
</pre></div>
</div>
<p>First, all <strong class="program">numpy</strong> functions can be applied directly on individual
columns (i.e., objects of type <code class="docutils literal notranslate"><span class="pre">Series</span></code>),
as the latter are, after all,  vector-like.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1">## array([0.23, 0.55, 0.72])</span>
</pre></div>
</div>
<p>For more details on the <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>-type indexing, see below.
By then, the meaning of the above should be clear from the
context.</p>
<div style="margin-top: 1em"></div><p>Most <strong class="program">numpy</strong> functions also work if they are fed with data frames,
but we will need to extract the numeric matrix columns manually.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## array([[ 0.23, -1.62],</span>
<span class="c1">##        [ 0.55, -0.05],</span>
<span class="c1">##        [ 0.72,  1.98]])</span>
</pre></div>
</div>
<p>Sometimes the results will automatically be coerced to a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object
with <code class="docutils literal notranslate"><span class="pre">index</span></code> slot set appropriately:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">## u    0.498</span>
<span class="c1">## v    0.086</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Many operations, for convenience, have also
been implemented as methods in the <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>
classes, e.g.,
<strong class="command">mean</strong>, <strong class="command">median</strong>, <strong class="command">min</strong>, <strong class="command">max</strong>, <strong class="command">quantile</strong>,
<strong class="command">var</strong>, <strong class="command">std</strong> (with <code class="docutils literal notranslate"><span class="pre">ddof=1</span></code> by default, interestingly),
and <strong class="command">skew</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">## u    0.498</span>
<span class="c1">## v    0.086</span>
<span class="c1">## dtype: float64</span>
<span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">##         u     v</span>
<span class="c1">## 0.0  0.23 -1.62</span>
<span class="c1">## 0.5  0.55 -0.05</span>
<span class="c1">## 1.0  0.72  1.98</span>
</pre></div>
</div>
<p>Also note the <strong class="command">describe</strong> method, which
returns a few statistics at the same time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1">##               u         v</span>
<span class="c1">## count  5.000000  5.000000</span>
<span class="c1">## mean   0.498000  0.086000</span>
<span class="c1">## std    0.227969  1.289643</span>
<span class="c1">## min    0.230000 -1.620000</span>
<span class="c1">## 25%    0.290000 -0.200000</span>
<span class="c1">## 50%    0.550000 -0.050000</span>
<span class="c1">## 75%    0.700000  0.320000</span>
<span class="c1">## max    0.720000  1.980000</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) Let us stress that above we see
the corrected for bias (but still only asymptotically unbiased)
version of standard deviation (<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>),
given by <span class="math notranslate nohighlight">\(\sqrt{\frac{1}{n-1} \sum_{i=1}^n (x_i-\bar{x})^2}\)</span>,
compare <a class="reference internal" href="220-transform-vector.html#sec-aggregate"><span class="std std-numref">Section 5.1</span></a>.</p>
</div>
<div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.5</span>
        
    </div><div class="proof-content">
<p>Check out the <strong class="command">pandas.DataFrame.agg</strong> method
that can apply all aggregating operations from
a given list of functions.
Write a call equivalent to <code class="docutils literal notranslate"><span class="pre">d.describe()</span></code>.</p>
</div></div></div>
<div class="section" id="transforming-data-frames">
<h2><span class="section-number">10.3. </span>Transforming Data Frames<a class="headerlink" href="#transforming-data-frames" title="Permalink to this headline"></a></h2>
<p>By applying the already well-known vectorised mathematical <strong class="program">numpy</strong> functions.
we can transform each data cell and return an object of the same type
as the input one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">])</span>
<span class="c1">## a    2.013753</span>
<span class="c1">## b    1.336427</span>
<span class="c1">## c    1.258600</span>
<span class="c1">## d    1.733253</span>
<span class="c1">## e    2.054433</span>
<span class="c1">## Name: u, dtype: float64</span>
<span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]])</span>
<span class="c1">##           u         v</span>
<span class="c1">## a  2.013753  1.377128</span>
<span class="c1">## b  1.336427  0.951229</span>
<span class="c1">## c  1.258600  0.818731</span>
<span class="c1">## d  1.733253  7.242743</span>
<span class="c1">## e  2.054433  0.197899</span>
</pre></div>
</div>
<p>When applying the binary arithmetic, comparison,
and logical operators on an object of class <code class="docutils literal notranslate"><span class="pre">Series</span></code> and
a scalar or a <strong class="program">numpy</strong> vector, the operations are performed
elementwisely – a style with which we are already familiar.</p>
<p>For instance, here is a standardised version of the <code class="docutils literal notranslate"><span class="pre">u</span></code> column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span>
<span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="c1">## a    0.990672</span>
<span class="c1">## b   -1.020098</span>
<span class="c1">## c   -1.314357</span>
<span class="c1">## d    0.255025</span>
<span class="c1">## e    1.088759</span>
<span class="c1">## Name: u, dtype: float64</span>
</pre></div>
</div>
<p>For two objects of class <code class="docutils literal notranslate"><span class="pre">Series</span></code>, the operators
are vectorised somewhat differently
from their <strong class="program">numpy</strong> counterparts: they are applied
on the pairs of elements having <em>identical labels</em>
(i.e., labelwisely).
Still, if we are transforming the columns
that come from the same data frame
(and thus having identical <code class="docutils literal notranslate"><span class="pre">index</span></code> slots;
this is the most common scenario), there will be no surprises,
because this is equivalent to elementwise action.
For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;v&quot;</span><span class="p">]</span>
<span class="c1">## a     True</span>
<span class="c1">## b     True</span>
<span class="c1">## c     True</span>
<span class="c1">## d    False</span>
<span class="c1">## e     True</span>
<span class="c1">## dtype: bool</span>
</pre></div>
</div>
<p>For transforming many numerical columns at once,
it is a good idea either to
convert them to a numeric matrix explicitly
and then use the basic <strong class="program">numpy</strong> functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uv</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">uv</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">uv</span>
<span class="c1">## array([[ 0.99067229,  0.20286225],</span>
<span class="c1">##        [-1.0200982 , -0.11790285],</span>
<span class="c1">##        [-1.3143573 , -0.24794275],</span>
<span class="c1">##        [ 0.25502455,  1.64197052],</span>
<span class="c1">##        [ 1.08875866, -1.47898717]])</span>
</pre></div>
</div>
<p>or to use the <strong class="command">pandas.DataFrame.apply</strong> method
which invokes a given function on each column separately:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">standardise</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">uv</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standardise</span><span class="p">)</span>
<span class="n">uv</span>
<span class="c1">##           u         v</span>
<span class="c1">## a  0.990672  0.202862</span>
<span class="c1">## b -1.020098 -0.117903</span>
<span class="c1">## c -1.314357 -0.247943</span>
<span class="c1">## d  0.255025  1.641971</span>
<span class="c1">## e  1.088759 -1.478987</span>
</pre></div>
</div>
<p>Note that, in both cases, we can then write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">uv</span>
</pre></div>
</div>
<p>to replace the old content with the transformed one.</p>
<p>Also, new columns can be added based on transformed
versions of the existing ones:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;uv_squared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;v&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">d</span>
<span class="c1">##           u         v        w  uv_squared</span>
<span class="c1">## a  0.990672  0.202862     spam    0.040389</span>
<span class="c1">## b -1.020098 -0.117903    bacon    0.014465</span>
<span class="c1">## c -1.314357 -0.247943     spam    0.106201</span>
<span class="c1">## d  0.255025  1.641971     eggs    0.175346</span>
<span class="c1">## e  1.088759 -1.478987  sausage    2.592938</span>
</pre></div>
</div>
</div>
<div class="section" id="indexing-series-objects">
<span id="sec-series-indexing"></span><h2><span class="section-number">10.4. </span>Indexing <code class="docutils literal notranslate"><span class="pre">Series</span></code> Objects<a class="headerlink" href="#indexing-series-objects" title="Permalink to this headline"></a></h2>
<p>Recall that each <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">Series</span></code> object
is equipped with a slot called <code class="docutils literal notranslate"><span class="pre">index</span></code>, which is
an object of class <code class="docutils literal notranslate"><span class="pre">Index</span></code> (or subclass thereof),
giving the row and element labels, respectively.
It turns out that we may apply
the <em>index</em> operator, <code class="docutils literal notranslate"><span class="pre">[...]</span></code>, to subset  these objects
not only through the <em>indexers</em> known from
the <strong class="program">numpy</strong> part (e.g., numerical ones, i.e., by position)
but also ones that pinpoint the items via their
labels. That is quite a lot of index-ing.</p>
<p>Let us study different forms thereof in very detail.</p>
<p>In this section we play with two example objects of
class <code class="docutils literal notranslate"><span class="pre">Series</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
<span class="n">b</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">b</span>
<span class="c1">## 2    0.70</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 8    0.23</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## 9    0.72</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## 5    0.98</span>
<span class="c1">## 6    0.68</span>
<span class="c1">## 3    0.48</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## dtype: float64</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;abcdefghij&quot;</span><span class="p">)</span>
<span class="n">c</span>
<span class="c1">## a    0.70</span>
<span class="c1">## b    0.29</span>
<span class="c1">## c    0.23</span>
<span class="c1">## d    0.55</span>
<span class="c1">## e    0.72</span>
<span class="c1">## f    0.42</span>
<span class="c1">## g    0.98</span>
<span class="c1">## h    0.68</span>
<span class="c1">## i    0.48</span>
<span class="c1">## j    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>They consist of the same values, in the same order,
but have different labels (<code class="docutils literal notranslate"><span class="pre">.index</span></code> slots).
In particular, <code class="docutils literal notranslate"><span class="pre">b</span></code>’s labels
are integers which <em>do not</em> match the physical element
positions (where 0 would denote the first element, etc.).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For <strong class="program">numpy</strong> vectors, we had four different indexing schemes:
by scalar (extracts an element at given position),
slice, integer vector, and logical vector.
<code class="docutils literal notranslate"><span class="pre">Series</span></code> objects are <em>additionally</em> labelled, therefore
they can <em>additionally</em> be accessed taking into account
the contents of the <code class="docutils literal notranslate"><span class="pre">.index</span></code> slot.</p>
</div>
<div class="section" id="do-not-use-directly">
<h3><span class="section-number">10.4.1. </span>Do Not Use <code class="docutils literal notranslate"><span class="pre">[...]</span></code> Directly<a class="headerlink" href="#do-not-use-directly" title="Permalink to this headline"></a></h3>
<p>Applying the index operator,
<code class="docutils literal notranslate"><span class="pre">[...]</span></code>, directly on <code class="docutils literal notranslate"><span class="pre">Series</span></code> is generally not a good idea:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">## 0.39</span>
<span class="n">b</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>both do not select the first item, but the item labelled <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>However:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># slice - 0 only</span>
<span class="c1">## 2    0.7</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># there is no label `0`</span>
<span class="c1">## 0.7</span>
</pre></div>
</div>
<p>fall back to position-based indexing.</p>
<p>Confusing? Well, with some self-discipline, the solution is easy.
Namely:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To stay away from potential problems, we should
never apply <code class="docutils literal notranslate"><span class="pre">[...]</span></code> directly on <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects.</p>
</div>
</div>
<div class="section" id="loc">
<h3><span class="section-number">10.4.2. </span><strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code><a class="headerlink" href="#loc" title="Permalink to this headline"></a></h3>
<p>To avoid ambiguity, which is what we want,
we should be referring to <strong class="command">Series.loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
and <strong class="command">Series.iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
for label- and position-based filtering, respectively.</p>
<p>And thus:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">## 0.39</span>
</pre></div>
</div>
<p>returns the element labelled <code class="docutils literal notranslate"><span class="pre">0</span></code>. On the other
hand, <code class="docutils literal notranslate"><span class="pre">c.loc[0]</span></code> will raise a <code class="docutils literal notranslate"><span class="pre">KeyError</span></code>,
because <code class="docutils literal notranslate"><span class="pre">c</span></code> consists of character labels only.</p>
<p>Next, we can use lists of labels to select a <em>subset</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## dtype: float64</span>
<span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## j    0.39</span>
<span class="c1">## b    0.29</span>
<span class="c1">## j    0.39</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>The result is always of type <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<p>Slicing behaves differently as the range is <em>inclusive</em>
at both sides:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 8    0.23</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## dtype: float64</span>
<span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">## 0    0.39</span>
<span class="c1">## 3    0.48</span>
<span class="c1">## 6    0.68</span>
<span class="c1">## 5    0.98</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## dtype: float64</span>
<span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">:</span><span class="s2">&quot;g&quot;</span><span class="p">]</span>
<span class="c1">## d    0.55</span>
<span class="c1">## e    0.72</span>
<span class="c1">## f    0.42</span>
<span class="c1">## g    0.98</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>return all elements between the two indicated labels.</p>
<p>Be careful that if there are repeated labels, then
we will be returning all the matching items:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="c1">## a    1</span>
<span class="c1">## a    3</span>
<span class="c1">## dtype: int64</span>
</pre></div>
</div>
<p>The result is not a scalar but a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object.</p>
</div>
<div class="section" id="iloc">
<h3><span class="section-number">10.4.3. </span><strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code><a class="headerlink" href="#iloc" title="Permalink to this headline"></a></h3>
<p>Here are some examples of position-based indexing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># the same: c.iloc[0]</span>
<span class="c1">## 0.7</span>
</pre></div>
</div>
<p>returns the first element.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># the same: b.iloc[1:7]</span>
<span class="c1">## 1    0.29</span>
<span class="c1">## 8    0.23</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## 9    0.72</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## 5    0.98</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>returns the 2nd, 3rd, …, 7th element
(not including <code class="docutils literal notranslate"><span class="pre">b.iloc[7]</span></code>, i.e., the 8th one).</p>
</div>
<div class="section" id="logical-indexing">
<h3><span class="section-number">10.4.4. </span>Logical Indexing<a class="headerlink" href="#logical-indexing" title="Permalink to this headline"></a></h3>
<p>Indexing using a logical vector-like object
is also available.</p>
<p>We usually will be using <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
with either a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object of identical <code class="docutils literal notranslate"><span class="pre">.index</span></code> slot
as the subsetted object or a logical <strong class="program">numpy</strong> vector.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)]</span>
<span class="c1">## 7    0.55</span>
<span class="c1">## 4    0.42</span>
<span class="c1">## 3    0.48</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>For <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>, the indexer must be unlabelled, like in, e.g.,
<code class="docutils literal notranslate"><span class="pre">b.loc[i.values]</span></code>.</p>
</div>
</div>
<div class="section" id="indexing-data-frames">
<span id="sec-df-indexing"></span><h2><span class="section-number">10.5. </span>Indexing Data Frames<a class="headerlink" href="#indexing-data-frames" title="Permalink to this headline"></a></h2>
<div class="section" id="loc-and-iloc">
<h3><span class="section-number">10.5.1. </span><strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code><a class="headerlink" href="#loc-and-iloc" title="Permalink to this headline"></a></h3>
<p>For data frames,
<code class="docutils literal notranslate"><span class="pre">iloc</span></code> and <code class="docutils literal notranslate"><span class="pre">loc</span></code> can be used too,
but they now require two arguments, serving as row and column
selectors.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;sausage&quot;</span><span class="p">],</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
<span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
<span class="c1">##       u     v        w</span>
<span class="c1">## a  0.70  0.32     spam</span>
<span class="c1">## d  0.55  1.98     eggs</span>
<span class="c1">## e  0.72 -1.62  sausage</span>
</pre></div>
</div>
<p>selects the rows where the values in the <code class="docutils literal notranslate"><span class="pre">u</span></code>
column are greater than 0.5 and then
returns all columns between <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">w</span></code>.</p>
<p>Furthermore,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]</span>
<span class="c1">##       u      w</span>
<span class="c1">## a  0.70   spam</span>
<span class="c1">## b  0.29  bacon</span>
<span class="c1">## c  0.23   spam</span>
</pre></div>
</div>
<p>fetches the first 3 rows (by position – <code class="docutils literal notranslate"><span class="pre">iloc</span></code> is necessary)
and then selects two indicated columns.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We can write <code class="docutils literal notranslate"><span class="pre">d.u</span></code> as a shorter version of <code class="docutils literal notranslate"><span class="pre">d.loc[:,</span> <span class="pre">&quot;u&quot;]</span></code>.
This improves the readability in contexts such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">d</span><span class="o">.</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">u</span> <span class="o">&lt;=</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]</span>
<span class="c1">##       u     w</span>
<span class="c1">## a  0.70  spam</span>
<span class="c1">## d  0.55  eggs</span>
</pre></div>
</div>
<p>However, this accessor is not universal: we can check this out by
considering a data frame featuring a column named, e.g., <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p>
</div>
<div class="proof proof-type-exercise" id="id11">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.6</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.drop</strong>
to select all columns but <code class="docutils literal notranslate"><span class="pre">v</span></code> in <code class="docutils literal notranslate"><span class="pre">d</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.7</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.Series.isin</strong> (amongst others)
to select all rows with <code class="docutils literal notranslate"><span class="pre">spam</span></code> and <code class="docutils literal notranslate"><span class="pre">bacon</span></code> on the <code class="docutils literal notranslate"><span class="pre">d</span></code>’s menu.</p>
</div></div><div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.8</span>
        
    </div><div class="proof-content">
<p>In the <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/other/tips.csv"><code class="docutils literal notranslate"><span class="pre">tips</span></code></a> dataset,
select data on male customers where total bill
was in the <em>[10, 20]</em> interval.
Also, select data from Saturday and Sunday with tip greater than
$5 from <code class="docutils literal notranslate"><span class="pre">tips</span></code>.</p>
</div></div></div>
<div class="section" id="adding-rows-and-columns">
<h3><span class="section-number">10.5.2. </span>Adding Rows and Columns<a class="headerlink" href="#adding-rows-and-columns" title="Permalink to this headline"></a></h3>
<p><strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> can also used to add new columns to an existing
data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># or d.loc[:, &quot;y&quot;] = d.u**2</span>
<span class="n">d</span>
<span class="c1">##       u     v        w      x       y</span>
<span class="c1">## a  0.70  0.32     spam   True  0.4900</span>
<span class="c1">## b  0.29 -0.05    bacon  False  0.0841</span>
<span class="c1">## c  0.23 -0.20     spam   True  0.0529</span>
<span class="c1">## d  0.55  1.98     eggs  False  0.3025</span>
<span class="c1">## e  0.72 -1.62  sausage   True  0.5184</span>
</pre></div>
</div>
<p>Note that notation like
“<code class="docutils literal notranslate"><span class="pre">d.new_column</span> <span class="pre">=</span> <span class="pre">...</span></code>” will not work.
As we have said, <code class="docutils literal notranslate"><span class="pre">loc</span></code> and <code class="docutils literal notranslate"><span class="pre">iloc</span></code> are universal, other
accessors – not so much.</p>
<div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.9</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.insert</strong>
to add a new column not necessarily at the end of <code class="docutils literal notranslate"><span class="pre">d</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id15">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.10</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">pandas.DataFrame.append</strong>
to add a few more rows to <code class="docutils literal notranslate"><span class="pre">d</span></code>.</p>
</div></div></div>
<div class="section" id="random-sampling">
<h3><span class="section-number">10.5.3. </span>Random Sampling<a class="headerlink" href="#random-sampling" title="Permalink to this headline"></a></h3>
<p>As a simple application of what we have covered so far,
let us consider the case of randomly sampling a number of rows
from an existing data frame.</p>
<p>For the most basic use cases, we can use the
<strong class="command">pandas.DataFrame.sample</strong> method. It includes scenarios
such as:</p>
<ul class="simple">
<li><p>randomly select 5 rows, without replacement,</p></li>
<li><p>randomly select 20% rows, with replacement,</p></li>
<li><p>randomly rearrange all the rows.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/nhanes_adult_female_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">body</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># 5 random rows without replacement</span>
<span class="c1">##       BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 4214   58.4  156.2     35.2    34.7     27.2    99.5      77.5</span>
<span class="c1">## 3361   73.7  161.0     36.5    34.5     29.0   107.6      98.2</span>
<span class="c1">## 3759   61.4  164.6     37.5    40.4     26.9    93.5      84.4</span>
<span class="c1">## 3733  120.4  158.8     33.5    34.6     40.5   147.2     129.3</span>
<span class="c1">## 1121  123.5  157.5     35.5    29.0     50.5   143.0     136.4</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> argument which controls the seed
of the random number generator so that we get
reproducible results.
Alternatively, we could call <strong class="command">numpy.random.seed</strong>.</p>
<div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.11</span>
        
    </div><div class="proof-content">
<p>Show how the 3 aforementioned scenarios
can be implemented manually using <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
and <strong class="command">numpy.random.permutation</strong>
or <strong class="command">numpy.random.choice</strong>.</p>
</div></div><p>In machine learning practice, as we shall
see later, we are used to
training and evaluating machine learning models
on different (mutually disjoint) subsets of the whole data frame.</p>
<p>For instance, we might be interested in performing the
so-called <em>train/test split</em>, where 80% (or 60% or 70%) of the
randomly selected rows would constitute the first
new data frame and the remaining 20% (or 40% or 30%)
would go to the second one.</p>
<p>Given a data frame like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># this is just an example</span>
<span class="n">x</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 0   97.1  160.2     34.7    40.8     35.8   126.1     117.9</span>
<span class="c1">## 1   91.1  152.7     33.5    33.0     38.5   125.5     103.1</span>
<span class="c1">## 2   73.0  161.2     37.4    38.0     31.8   106.2      92.0</span>
<span class="c1">## 3   61.7  157.4     38.0    34.7     29.0   101.0      90.5</span>
<span class="c1">## 4   55.4  154.6     34.6    34.0     28.3    92.5      73.2</span>
<span class="c1">## 5   62.0  144.7     32.5    34.2     29.8   106.7      84.8</span>
<span class="c1">## 6   66.2  166.5     37.5    37.6     32.0    96.3      95.7</span>
<span class="c1">## 7   75.9  154.5     35.4    37.6     32.7   107.7      98.7</span>
<span class="c1">## 8   77.2  159.2     38.5    40.5     35.7   102.0      97.5</span>
<span class="c1">## 9   91.6  174.5     36.1    45.9     35.2   121.3     100.3</span>
</pre></div>
</div>
<p>one way to perform the aforementioned split is to
generate a random permutation
of the set of row indices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># reproducibility matters</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">idx</span>
<span class="c1">## array([4, 0, 7, 5, 8, 3, 1, 6, 9, 2])</span>
</pre></div>
</div>
<p>And then to pick the first 80% of these indices to construct
the data frame number one:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="p">:]</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 4   55.4  154.6     34.6    34.0     28.3    92.5      73.2</span>
<span class="c1">## 0   97.1  160.2     34.7    40.8     35.8   126.1     117.9</span>
<span class="c1">## 7   75.9  154.5     35.4    37.6     32.7   107.7      98.7</span>
<span class="c1">## 5   62.0  144.7     32.5    34.2     29.8   106.7      84.8</span>
<span class="c1">## 8   77.2  159.2     38.5    40.5     35.7   102.0      97.5</span>
<span class="c1">## 3   61.7  157.4     38.0    34.7     29.0   101.0      90.5</span>
<span class="c1">## 1   91.1  152.7     33.5    33.0     38.5   125.5     103.1</span>
<span class="c1">## 6   66.2  166.5     37.5    37.6     32.0    96.3      95.7</span>
</pre></div>
</div>
<p>and the remaining ones to generate the second dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">k</span><span class="p">:],</span> <span class="p">:]</span>
<span class="c1">##    BMXWT  BMXHT  BMXARML  BMXLEG  BMXARMC  BMXHIP  BMXWAIST</span>
<span class="c1">## 9   91.6  174.5     36.1    45.9     35.2   121.3     100.3</span>
<span class="c1">## 2   73.0  161.2     37.4    38.0     31.8   106.2      92.0</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id17">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.12</span>
        
    </div><div class="proof-content">
<p>In the <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/other/wine_quality_all.csv"><code class="docutils literal notranslate"><span class="pre">wine_quality_all</span></code></a> dataset,
leave out all but the white wines.
Partition the resulting data frame randomly into three data frames:
<code class="docutils literal notranslate"><span class="pre">wines_train</span></code> (60% of the rows),
<code class="docutils literal notranslate"><span class="pre">wines_validate</span></code> (another 20% of the rows),
and <code class="docutils literal notranslate"><span class="pre">wines_test</span></code> (the remaining 20%).</p>
</div></div><div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.13</span>
        
    </div><div class="proof-content">
<p>Consider the white wines dataset again.
Write a function <strong class="command">kfold</strong> which takes
a data frame <code class="docutils literal notranslate"><span class="pre">x</span></code> and an integer <em>k&gt;1</em> on input.
Return a list of data frames resulting
in randomly splitting <code class="docutils literal notranslate"><span class="pre">x</span></code> into <em>k</em> disjoint chunks of
equal (or almost equal if that is not possible) sizes.</p>
</div></div></div>
<div class="section" id="hierarchical-indices">
<h3><span class="section-number">10.5.4. </span>Hierarchical Indices (*)<a class="headerlink" href="#hierarchical-indices" title="Permalink to this headline"></a></h3>
<p>Consider the following <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object
with a hierarchical index:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2024</span><span class="p">,</span> <span class="mi">2025</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">quarter</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">,</span> <span class="s2">&quot;Q4&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">))</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;quarter&quot;</span><span class="p">])</span>
<span class="n">d</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">##      Q2       0.29</span>
<span class="c1">##      Q3       0.23</span>
<span class="c1">##      Q4       0.55</span>
<span class="c1">## 2024 Q1       0.72</span>
<span class="c1">##      Q2       0.42</span>
<span class="c1">##      Q3       0.98</span>
<span class="c1">##      Q4       0.68</span>
<span class="c1">## 2025 Q1       0.48</span>
<span class="c1">##      Q2       0.39</span>
<span class="c1">##      Q3       0.34</span>
<span class="c1">##      Q4       0.73</span>
</pre></div>
</div>
<p>The index has both levels named, but this is
purely for aesthetic reasons.</p>
<p>Indexing using <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> by default relates to the
first level of the hierarchy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2023</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">##          data</span>
<span class="c1">## quarter      </span>
<span class="c1">## Q1       0.70</span>
<span class="c1">## Q2       0.29</span>
<span class="c1">## Q3       0.23</span>
<span class="c1">## Q4       0.55</span>
<span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2025</span><span class="p">],</span> <span class="p">:]</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">##      Q2       0.29</span>
<span class="c1">##      Q3       0.23</span>
<span class="c1">##      Q4       0.55</span>
<span class="c1">## 2025 Q1       0.48</span>
<span class="c1">##      Q2       0.39</span>
<span class="c1">##      Q3       0.34</span>
<span class="c1">##      Q4       0.73</span>
</pre></div>
</div>
<p>To access deeper levels, we can use tuples as indexers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mi">2023</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">),</span> <span class="p">:]</span>
<span class="c1">## data    0.7</span>
<span class="c1">## Name: (2023, Q1), dtype: float64</span>
<span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[[(</span><span class="mi">2023</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">)],</span> <span class="p">:]</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">## 2024 Q3       0.98</span>
</pre></div>
</div>
<p>In certain scenarios, though, it will probably be much easier
to subset a hierarchical index
by using <strong class="command">reset_index</strong> and <strong class="command">set_index</strong> creatively
(together with <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">pandas.Series.isin</strong>, etc.).</p>
<p>Also, we should note that the `<strong class="command">:</strong>` operator
for slicing can be used only <em>directly</em> within square brackets,
but we can always use the <strong class="command">slice</strong> constructor to create them
from within any context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">]),</span> <span class="p">:]</span>  <span class="c1"># `:`, [&quot;Q1&quot;, &quot;Q3&quot;]</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2023 Q1       0.70</span>
<span class="c1">##      Q3       0.23</span>
<span class="c1">## 2024 Q1       0.72</span>
<span class="c1">##      Q3       0.98</span>
<span class="c1">## 2025 Q1       0.48</span>
<span class="c1">##      Q3       0.34</span>
<span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;Q2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q3&quot;</span><span class="p">)),</span> <span class="p">:]</span>  <span class="c1"># ::-1, &quot;Q2&quot;:&quot;Q3&quot;</span>
<span class="c1">##               data</span>
<span class="c1">## year quarter      </span>
<span class="c1">## 2025 Q3       0.34</span>
<span class="c1">##      Q2       0.39</span>
<span class="c1">## 2024 Q3       0.98</span>
<span class="c1">##      Q2       0.42</span>
<span class="c1">## 2023 Q3       0.23</span>
<span class="c1">##      Q2       0.29</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="further-operations-on-data-frames">
<h2><span class="section-number">10.6. </span>Further Operations on Data Frames<a class="headerlink" href="#further-operations-on-data-frames" title="Permalink to this headline"></a></h2>
<div class="section" id="sorting">
<h3><span class="section-number">10.6.1. </span>Sorting<a class="headerlink" href="#sorting" title="Permalink to this headline"></a></h3>
<p>Let us consider another example dataset.
Here are the yearly (for 2018) average
<a class="reference external" href="https://discover.data.vic.gov.au/dataset/epa-air-watch-all-sites-air-quality-hourly-averages-yearly">air quality data</a>
in the Australian state of Victoria.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/air_quality_2018_means.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">air</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">air</span><span class="o">.</span>
    <span class="n">loc</span><span class="p">[</span><span class="n">air</span><span class="o">.</span><span class="n">param_id</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;BPM2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">]),</span> <span class="p">:]</span><span class="o">.</span>
    <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">air</span>
<span class="c1">##           sp_name param_id      value</span>
<span class="c1">## 0      Alphington   BPM2.5   7.848758</span>
<span class="c1">## 1      Alphington      NO2   9.558120</span>
<span class="c1">## 2    Altona North      NO2   9.467912</span>
<span class="c1">## 3       Churchill   BPM2.5   6.391230</span>
<span class="c1">## 4       Dandenong      NO2   9.800705</span>
<span class="c1">## 5       Footscray   BPM2.5   7.640948</span>
<span class="c1">## 6       Footscray      NO2  10.274531</span>
<span class="c1">## 7   Geelong South   BPM2.5   6.502762</span>
<span class="c1">## 8   Geelong South      NO2   5.681722</span>
<span class="c1">## 9   Melbourne CBD   BPM2.5   8.072998</span>
<span class="c1">## 10            Moe   BPM2.5   6.427079</span>
<span class="c1">## 11   Morwell East   BPM2.5   6.784596</span>
<span class="c1">## 12  Morwell South   BPM2.5   6.512849</span>
<span class="c1">## 13  Morwell South      NO2   5.124430</span>
<span class="c1">## 14      Traralgon   BPM2.5   8.024735</span>
<span class="c1">## 15      Traralgon      NO2   5.776333</span>
</pre></div>
</div>
<p><strong class="command">sort_values</strong> is a convenient means to order the rows
with respect to one criterion:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">##           sp_name param_id      value</span>
<span class="c1">## 6       Footscray      NO2  10.274531</span>
<span class="c1">## 4       Dandenong      NO2   9.800705</span>
<span class="c1">## 1      Alphington      NO2   9.558120</span>
<span class="c1">## 2    Altona North      NO2   9.467912</span>
<span class="c1">## 9   Melbourne CBD   BPM2.5   8.072998</span>
<span class="c1">## 14      Traralgon   BPM2.5   8.024735</span>
<span class="c1">## 0      Alphington   BPM2.5   7.848758</span>
<span class="c1">## 5       Footscray   BPM2.5   7.640948</span>
<span class="c1">## 11   Morwell East   BPM2.5   6.784596</span>
<span class="c1">## 12  Morwell South   BPM2.5   6.512849</span>
<span class="c1">## 7   Geelong South   BPM2.5   6.502762</span>
<span class="c1">## 10            Moe   BPM2.5   6.427079</span>
<span class="c1">## 3       Churchill   BPM2.5   6.391230</span>
<span class="c1">## 15      Traralgon      NO2   5.776333</span>
<span class="c1">## 8   Geelong South      NO2   5.681722</span>
<span class="c1">## 13  Morwell South      NO2   5.124430</span>
</pre></div>
</div>
<p>Sorting with respect to more criteria is also possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;param_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="c1">##           sp_name param_id      value</span>
<span class="c1">## 9   Melbourne CBD   BPM2.5   8.072998</span>
<span class="c1">## 14      Traralgon   BPM2.5   8.024735</span>
<span class="c1">## 0      Alphington   BPM2.5   7.848758</span>
<span class="c1">## 5       Footscray   BPM2.5   7.640948</span>
<span class="c1">## 11   Morwell East   BPM2.5   6.784596</span>
<span class="c1">## 12  Morwell South   BPM2.5   6.512849</span>
<span class="c1">## 7   Geelong South   BPM2.5   6.502762</span>
<span class="c1">## 10            Moe   BPM2.5   6.427079</span>
<span class="c1">## 3       Churchill   BPM2.5   6.391230</span>
<span class="c1">## 6       Footscray      NO2  10.274531</span>
<span class="c1">## 4       Dandenong      NO2   9.800705</span>
<span class="c1">## 1      Alphington      NO2   9.558120</span>
<span class="c1">## 2    Altona North      NO2   9.467912</span>
<span class="c1">## 15      Traralgon      NO2   5.776333</span>
<span class="c1">## 8   Geelong South      NO2   5.681722</span>
<span class="c1">## 13  Morwell South      NO2   5.124430</span>
</pre></div>
</div>
<p>Note that here, in each group of identical parameters,
we get a decreasing order with respect to the value.</p>
<div class="proof proof-type-exercise" id="id19">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.14</span>
        
    </div><div class="proof-content">
<p>(*)
Compare the ordering with respect to <code class="docutils literal notranslate"><span class="pre">param_id</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code>
vs <code class="docutils literal notranslate"><span class="pre">value</span></code> and then <code class="docutils literal notranslate"><span class="pre">param_id</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.15</span>
        
    </div><div class="proof-content">
<p>(**) Perform identical reorderings but using only
<strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>, <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>, and <strong class="command">numpy.argsort</strong>.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
<strong class="command">DataFrame.sort_values</strong> unfortunately uses a non-stable algorithm
by default (a modified quicksort).
If a data frame is sorted with respect to one criterion,
and then we reorder it with respect to another one, tied observations
are not guaranteed to be listed in the original order:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/air_quality_2018_means.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;sp_name&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;BPM2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">],</span> <span class="p">:]</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="c1">##    param_id        sp_name      value</span>
<span class="c1">## 0    BPM2.5  Melbourne CBD   8.072998</span>
<span class="c1">## 1    BPM2.5            Moe   6.427079</span>
<span class="c1">## 2    BPM2.5      Footscray   7.640948</span>
<span class="c1">## 3    BPM2.5   Morwell East   6.784596</span>
<span class="c1">## 4    BPM2.5      Churchill   6.391230</span>
<span class="c1">## 5    BPM2.5  Morwell South   6.512849</span>
<span class="c1">## 6    BPM2.5      Traralgon   8.024735</span>
<span class="c1">## 7    BPM2.5     Alphington   7.848758</span>
<span class="c1">## 8    BPM2.5  Geelong South   6.502762</span>
<span class="c1">## 9       NO2  Morwell South   5.124430</span>
<span class="c1">## 10      NO2      Traralgon   5.776333</span>
<span class="c1">## 11      NO2  Geelong South   5.681722</span>
<span class="c1">## 12      NO2   Altona North   9.467912</span>
<span class="c1">## 13      NO2     Alphington   9.558120</span>
<span class="c1">## 14      NO2      Dandenong   9.800705</span>
<span class="c1">## 15      NO2      Footscray  10.274531</span>
</pre></div>
</div>
<p>We have lost the ordering based on station names in the two subgroups.
To switch to a mergesort-like method (timsort), we should pass
<code class="docutils literal notranslate"><span class="pre">kind=&quot;stable&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/air_quality_2018_means.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;sp_name&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">)</span>  <span class="c1"># !</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;param_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;BPM2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">],</span> <span class="p">:]</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="c1">##    param_id        sp_name      value</span>
<span class="c1">## 0    BPM2.5     Alphington   7.848758</span>
<span class="c1">## 1    BPM2.5      Churchill   6.391230</span>
<span class="c1">## 2    BPM2.5      Footscray   7.640948</span>
<span class="c1">## 3    BPM2.5  Geelong South   6.502762</span>
<span class="c1">## 4    BPM2.5  Melbourne CBD   8.072998</span>
<span class="c1">## 5    BPM2.5            Moe   6.427079</span>
<span class="c1">## 6    BPM2.5   Morwell East   6.784596</span>
<span class="c1">## 7    BPM2.5  Morwell South   6.512849</span>
<span class="c1">## 8    BPM2.5      Traralgon   8.024735</span>
<span class="c1">## 9       NO2     Alphington   9.558120</span>
<span class="c1">## 10      NO2   Altona North   9.467912</span>
<span class="c1">## 11      NO2      Dandenong   9.800705</span>
<span class="c1">## 12      NO2      Footscray  10.274531</span>
<span class="c1">## 13      NO2  Geelong South   5.681722</span>
<span class="c1">## 14      NO2  Morwell South   5.124430</span>
<span class="c1">## 15      NO2      Traralgon   5.776333</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stacking-and-unstacking-long-and-wide-forms">
<span id="sec-stack"></span><h3><span class="section-number">10.6.2. </span>Stacking and Unstacking (Long and Wide Forms)<a class="headerlink" href="#stacking-and-unstacking-long-and-wide-forms" title="Permalink to this headline"></a></h3>
<p>Let us discuss some further ways to transform
data frames, that benefit from, make sense because of,
or are possible due to their being able to store
data of different types.</p>
<p>Note that the above <code class="docutils literal notranslate"><span class="pre">air</span></code> dataset is in the so-called <em>long</em> format,
where all measurements are <em>stacked</em> one after/below another.
Such a form is quite convenient for the purpose of storing data,
but not necessarily for all processing tasks, compare <span id="id3">[<a class="reference internal" href="999-bibliography.html#id35">Wic14</a>]</span>.
Recall from the matrix part that a more natural way
would be to have a single <em>observation</em> (e.g.,
data for a measurement station) in each row.</p>
<p>We can <em>unstack</em> the <code class="docutils literal notranslate"><span class="pre">air</span></code> data frame
(convert to the <em>wide</em> format) quite easily:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;sp_name&quot;</span><span class="p">,</span> <span class="s2">&quot;param_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span>
<span class="c1">## param_id         BPM2.5        NO2</span>
<span class="c1">## sp_name                           </span>
<span class="c1">## Alphington     7.848758   9.558120</span>
<span class="c1">## Altona North        NaN   9.467912</span>
<span class="c1">## Churchill      6.391230        NaN</span>
<span class="c1">## Dandenong           NaN   9.800705</span>
<span class="c1">## Footscray      7.640948  10.274531</span>
<span class="c1">## Geelong South  6.502762   5.681722</span>
<span class="c1">## Melbourne CBD  8.072998        NaN</span>
<span class="c1">## Moe            6.427079        NaN</span>
<span class="c1">## Morwell East   6.784596        NaN</span>
<span class="c1">## Morwell South  6.512849   5.124430</span>
<span class="c1">## Traralgon      8.024735   5.776333</span>
</pre></div>
</div>
<p>Note that the missing values are denoted with <code class="docutils literal notranslate"><span class="pre">NaN</span></code>s (not-a-number) –
we have a separate section devoted to their processing given a bit later.
Interestingly, we got a hierarchical index in the columns,
hence the <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> part.</p>
<p>Equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air_wide</span> <span class="o">=</span> <span class="n">air</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;sp_name&quot;</span><span class="p">,</span> <span class="s2">&quot;param_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">air_wide</span>
<span class="c1">##                  BPM2.5        NO2</span>
<span class="c1">## Alphington     7.848758   9.558120</span>
<span class="c1">## Altona North        NaN   9.467912</span>
<span class="c1">## Churchill      6.391230        NaN</span>
<span class="c1">## Dandenong           NaN   9.800705</span>
<span class="c1">## Footscray      7.640948  10.274531</span>
<span class="c1">## Geelong South  6.502762   5.681722</span>
<span class="c1">## Melbourne CBD  8.072998        NaN</span>
<span class="c1">## Moe            6.427079        NaN</span>
<span class="c1">## Morwell East   6.784596        NaN</span>
<span class="c1">## Morwell South  6.512849   5.124430</span>
<span class="c1">## Traralgon      8.024735   5.776333</span>
</pre></div>
</div>
<p>The <strong class="command">rename_axis</strong> part is there so as to get rid of the <code class="docutils literal notranslate"><span class="pre">name</span></code> parts
of the <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> slots.</p>
<p>The other way around, we can use the <code class="docutils literal notranslate"><span class="pre">stack</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">air_wide</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;param&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1">##    location          param      value</span>
<span class="c1">## 0    BPM2.5     Alphington   7.848758</span>
<span class="c1">## 1    BPM2.5      Churchill   6.391230</span>
<span class="c1">## 2    BPM2.5      Footscray   7.640948</span>
<span class="c1">## 3    BPM2.5  Geelong South   6.502762</span>
<span class="c1">## 4    BPM2.5  Melbourne CBD   8.072998</span>
<span class="c1">## 5    BPM2.5            Moe   6.427079</span>
<span class="c1">## 6    BPM2.5   Morwell East   6.784596</span>
<span class="c1">## 7    BPM2.5  Morwell South   6.512849</span>
<span class="c1">## 8    BPM2.5      Traralgon   8.024735</span>
<span class="c1">## 9       NO2     Alphington   9.558120</span>
<span class="c1">## 10      NO2   Altona North   9.467912</span>
<span class="c1">## 11      NO2      Dandenong   9.800705</span>
<span class="c1">## 12      NO2      Footscray  10.274531</span>
<span class="c1">## 13      NO2  Geelong South   5.681722</span>
<span class="c1">## 14      NO2  Morwell South   5.124430</span>
<span class="c1">## 15      NO2      Traralgon   5.776333</span>
</pre></div>
</div>
<p>We used the data frame transpose (<strong class="command">T</strong>) to
get a location-major order (less boring an outcome in this context).</p>
</div>
<div class="section" id="set-theoretic-operations">
<h3><span class="section-number">10.6.3. </span>Set-Theoretic Operations<a class="headerlink" href="#set-theoretic-operations" title="Permalink to this headline"></a></h3>
<p>Here are two not at all disjoint sets of imaginary persons:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/some_birth_dates1.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">A</span>
<span class="c1">##                   Name   BirthDate</span>
<span class="c1">## 0     Paitoon Ornwimol  26.06.1958</span>
<span class="c1">## 1         Antónia Lata  20.05.1935</span>
<span class="c1">## 2    Bertoldo Mallozzi  17.08.1972</span>
<span class="c1">## 3        Nedeljko Bukv  19.12.1921</span>
<span class="c1">## 4        Micha Kitchen  17.09.1930</span>
<span class="c1">## 5      Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 6         Paul Meckler  29.09.1968</span>
<span class="c1">## 7      Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 8         Åge Trelstad  07.03.1935</span>
<span class="c1">## 9  Duchanee Panomyaong  19.06.1952</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/some_birth_dates2.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">B</span>
<span class="c1">##                    Name   BirthDate</span>
<span class="c1">## 0    Hushang Naigamwala  25.08.1991</span>
<span class="c1">## 1              Zhen Wei  16.11.1975</span>
<span class="c1">## 2         Micha Kitchen  17.09.1930</span>
<span class="c1">## 3           Jodoc Alwin  16.11.1969</span>
<span class="c1">## 4            Igor Mazał  14.05.2004</span>
<span class="c1">## 5       Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 6   Duchanee Panomyaong  19.06.1952</span>
<span class="c1">## 7       Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 8          Paul Meckler  29.09.1968</span>
<span class="c1">## 9         Noe Tae-Woong  11.07.1970</span>
<span class="c1">## 10         Åge Trelstad  07.03.1935</span>
</pre></div>
</div>
<p>In both datasets, there is a single column whose
elements uniquely identify each record (i.e., <code class="docutils literal notranslate"><span class="pre">Name</span></code>).
In the language of relational databases, we would call it
a <em>primary key</em>.
In such a case, implementing the set-theoretic operations
is relatively easy:</p>
<p><span class="math notranslate nohighlight">\(A\cap B\)</span> (intersection) – the rows that are both in <em>A</em> and in <em>B</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="p">:]</span>
<span class="c1">##                   Name   BirthDate</span>
<span class="c1">## 4        Micha Kitchen  17.09.1930</span>
<span class="c1">## 5      Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 6         Paul Meckler  29.09.1968</span>
<span class="c1">## 7      Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 8         Åge Trelstad  07.03.1935</span>
<span class="c1">## 9  Duchanee Panomyaong  19.06.1952</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(A\setminus B\)</span> (difference) – the rows that are in <em>A</em> but not in <em>B</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">A</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="p">:]</span>
<span class="c1">##                 Name   BirthDate</span>
<span class="c1">## 0   Paitoon Ornwimol  26.06.1958</span>
<span class="c1">## 1       Antónia Lata  20.05.1935</span>
<span class="c1">## 2  Bertoldo Mallozzi  17.08.1972</span>
<span class="c1">## 3      Nedeljko Bukv  19.12.1921</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(A\cup B\)</span> (union) – the rows that exist in <em>A</em> or are in <em>B</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">B</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span> <span class="p">:]))</span>
<span class="c1">##                   Name   BirthDate</span>
<span class="c1">## 0     Paitoon Ornwimol  26.06.1958</span>
<span class="c1">## 1         Antónia Lata  20.05.1935</span>
<span class="c1">## 2    Bertoldo Mallozzi  17.08.1972</span>
<span class="c1">## 3        Nedeljko Bukv  19.12.1921</span>
<span class="c1">## 4        Micha Kitchen  17.09.1930</span>
<span class="c1">## 5      Mefodiy Shachar  01.10.1914</span>
<span class="c1">## 6         Paul Meckler  29.09.1968</span>
<span class="c1">## 7      Katarzyna Lasko  20.10.1971</span>
<span class="c1">## 8         Åge Trelstad  07.03.1935</span>
<span class="c1">## 9  Duchanee Panomyaong  19.06.1952</span>
<span class="c1">## 0   Hushang Naigamwala  25.08.1991</span>
<span class="c1">## 1             Zhen Wei  16.11.1975</span>
<span class="c1">## 3          Jodoc Alwin  16.11.1969</span>
<span class="c1">## 4           Igor Mazał  14.05.2004</span>
<span class="c1">## 9        Noe Tae-Woong  11.07.1970</span>
</pre></div>
</div>
<p>Note that there are no duplicate rows in the output.</p>
<div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.16</span>
        
    </div><div class="proof-content">
<p>Determine
<span class="math notranslate nohighlight">\((A\cup B) \setminus (A\cap B) = (A\setminus B)\cup(B\setminus A)\)</span>
(symmetric difference).</p>
</div></div><div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.17</span>
        
    </div><div class="proof-content">
<p>(*)
Determine the union, intersection, and difference of the
<a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/other/wine_sample1.csv"><code class="docutils literal notranslate"><span class="pre">wine_sample1</span></code></a>
and
<a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/other/wine_sample2.csv"><code class="docutils literal notranslate"><span class="pre">wine_sample2</span></code></a> datasets,
where there is no column uniquely identifying the observations.
Hint: consider using
<strong class="command">pandas.DataFrame.duplicated</strong> or
<strong class="command">pandas.DataFrame.drop_duplicates</strong>.</p>
</div></div></div>
<div class="section" id="joining-merging">
<h3><span class="section-number">10.6.4. </span>Joining (Merging)<a class="headerlink" href="#joining-merging" title="Permalink to this headline"></a></h3>
<p>In database design, it is common to normalise
the datasets in order to avoid the duplication of information
and pathologies stemming from them (e.g., <span id="id4">[<a class="reference internal" href="999-bibliography.html#id72">Dat03</a>]</span>).</p>
<div class="proof proof-type-example" id="id23">

    <div class="proof-title">
        <span class="proof-type">Example 10.18</span>
        
    </div><div class="proof-content">
<p>The above air quality parameters
are separately described in another data frame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/air_quality_2018_param.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">param</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">param_std_unit_of_measure</span><span class="o">=</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">##   param_id                   param_name   unit      param_short_name</span>
<span class="c1">## 0      API      Airborne particle index   none  Visibility Reduction</span>
<span class="c1">## 1   BPM2.5  BAM  Particles &lt; 2.5 micron  ug/m3                 PM2.5</span>
<span class="c1">## 2       CO              Carbon Monoxide    ppm                    CO</span>
<span class="c1">## 3    HPM10                   Hivol PM10  ug/m3                   NaN</span>
<span class="c1">## 4      NO2             Nitrogen Dioxide    ppb                   NO2</span>
<span class="c1">## 5       O3                        Ozone    ppb                    O3</span>
<span class="c1">## 6     PM10     TEOM Particles &lt;10micron  ug/m3                  PM10</span>
<span class="c1">## 7   PPM2.5               Partisol PM2.5  ug/m3                   NaN</span>
<span class="c1">## 8      SO2               Sulfur Dioxide    ppb                   SO2</span>
</pre></div>
</div>
<p>We could have stored them alongside the <code class="docutils literal notranslate"><span class="pre">air</span></code> data frame,
but that would be a waste of space.</p>
<p>Also, if we wanted to modify some datum
(note, e.g., the annoying double space in <code class="docutils literal notranslate"><span class="pre">param_name</span></code> for <code class="docutils literal notranslate"><span class="pre">BPM2.5</span></code>),
we would have to update all the relevant records.</p>
<p>Instead, we can always look the information up by <code class="docutils literal notranslate"><span class="pre">param_id</span></code>
and join (merge) the two data frames only if we need it.</p>
</div></div><div style="margin-top: 1em"></div><p>Let us discuss the possible join operations by studying
the two following data sets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;b0&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="s2">&quot;b3&quot;</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">A</span>
<span class="c1">##     x   y</span>
<span class="c1">## 0  a0  b0</span>
<span class="c1">## 1  a1  b1</span>
<span class="c1">## 2  a2  b2</span>
<span class="c1">## 3  a3  b3</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a4&quot;</span><span class="p">],</span>
    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">B</span>
<span class="c1">##     x   z</span>
<span class="c1">## 0  a0  c0</span>
<span class="c1">## 1  a2  c1</span>
<span class="c1">## 2  a2  c2</span>
<span class="c1">## 3  a4  c3</span>
</pre></div>
</div>
<p>They both have one column somewhat <em>in common</em>, <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>The <em>inner (natural) join</em> returns the records that have a match in
both datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x   y   z</span>
<span class="c1">## 0  a0  b0  c0</span>
<span class="c1">## 1  a2  b2  c1</span>
<span class="c1">## 2  a2  b2  c2</span>
</pre></div>
</div>
<p>The  <em>left join</em> of <em>A</em> with <em>B</em> guarantees to return all the records from <em>A</em>,
even those which are not matched by anything in <em>B</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x   y    z</span>
<span class="c1">## 0  a0  b0   c0</span>
<span class="c1">## 1  a1  b1  NaN</span>
<span class="c1">## 2  a2  b2   c1</span>
<span class="c1">## 3  a2  b2   c2</span>
<span class="c1">## 4  a3  b3  NaN</span>
</pre></div>
</div>
<p>The <em>right join</em> of <em>A</em> with <em>B</em> is the same as the left join of <em>B</em> with <em>A</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x    y   z</span>
<span class="c1">## 0  a0   b0  c0</span>
<span class="c1">## 1  a2   b2  c1</span>
<span class="c1">## 2  a2   b2  c2</span>
<span class="c1">## 3  a4  NaN  c3</span>
</pre></div>
</div>
<p>Finally, the <em>full outer join</em> is the set-theoretic
union of the left and the right join:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="c1">##     x    y    z</span>
<span class="c1">## 0  a0   b0   c0</span>
<span class="c1">## 1  a1   b1  NaN</span>
<span class="c1">## 2  a2   b2   c1</span>
<span class="c1">## 3  a2   b2   c2</span>
<span class="c1">## 4  a3   b3  NaN</span>
<span class="c1">## 5  a4  NaN   c3</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.19</span>
        
    </div><div class="proof-content">
<p>Join
<a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/air_quality_2018_value.csv.gz"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_value</span></code></a>
with <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/air_quality_2018_point.csv"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_point</span></code></a>
and <a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/air_quality_2018_param.csv"><code class="docutils literal notranslate"><span class="pre">air_quality_2018_param</span></code></a>.</p>
</div></div><div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.20</span>
        
    </div><div class="proof-content">
<p>Normalise
<a class="reference external" href="https://raw.githubusercontent.com/gagolews/teaching_data/master/marek/air_quality_2018.csv.gz"><code class="docutils literal notranslate"><span class="pre">air_quality_2018</span></code></a>
yourself so that you get the three data frames mentioned in the previous
exercise (<code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">point</span></code>, <code class="docutils literal notranslate"><span class="pre">param</span></code>).</p>
</div></div><div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.21</span>
        
    </div><div class="proof-content">
<p>(*)
In the National Health and Nutrition Examination Survey
(NHANES) by the US Centres for Disease Control and Prevention,
each participant is uniquely identified
by their sequence number (<code class="docutils literal notranslate"><span class="pre">SEQN</span></code>),
which is mentioned in numerous datasets, including:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/P_DEMO.htm">demographic variables</a>;</p></li>
<li><p><a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/P_BMX.htm">body measures</a>;</p></li>
<li><p><a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/AUX_J.htm">audiometry</a>;</p></li>
<li><p>and <a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/continuousnhanes/default.aspx?BeginYear=2017">many more</a>.</p></li>
</ul>
<p>Join a few chosen datasets that are to your liking.</p>
</div></div></div>
<div class="section" id="and-too-many-more">
<h3><span class="section-number">10.6.5. </span>…And (Too) Many More<a class="headerlink" href="#and-too-many-more" title="Permalink to this headline"></a></h3>
<p>Looking at the list of methods
for the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">Series</span></code> classes in the <strong class="program">pandas</strong> package’s
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">documentation</a>,
we can see that they are abundant.
Together with the object-oriented syntax, we will often find ourselves
appreciating the high readability of even quite complex operation
chains such as <code class="docutils literal notranslate"><span class="pre">data.drop_duplicates().groupby([&quot;year&quot;,</span> <span class="pre">&quot;month&quot;]).mean().reset_index()</span></code>.</p>
<p>Nevertheless, in fact, we should admit that the methods are too
plentiful – they make an impression that someone was too generous
by including a list of all the possible <em>verbs</em> related to data analysis,
even if they can be easily expressed as a combination of 2-3 simpler
operations.
Therefore, in order to prevent the reader from
being overloaded with too much new information, below we will be
discussing only the most noteworthy features
that often appear in data wrangling scenarios.</p>
<p>As strong advocates of minimalism
(which is more environmentally friendly and sustainable),
not rarely will we be more eager to fall back to the hand-crafted
combinations of the more basic (universal) building blocks from <strong class="program">numpy</strong>
and <strong class="program">scipy</strong> instead. This is also in line with our
putting emphasis on developing <em>transferable</em> skills –
as Python with <strong class="program">pandas</strong> is not the only combo
where we can work with data frames
(e.g., base R allows that too).</p>
</div>
</div>
<div class="section" id="exercises">
<h2><span class="section-number">10.7. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline"></a></h2>
<div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.22</span>
        
    </div><div class="proof-content">
<p>How are data frames different from matrices?</p>
</div></div><div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.23</span>
        
    </div><div class="proof-content">
<p>What are the use cases of the <code class="docutils literal notranslate"><span class="pre">name</span></code> slot
in <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">Index</span></code> objects?</p>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.24</span>
        
    </div><div class="proof-content">
<p>What is the purpose of <strong class="command">set_index</strong> and <strong class="command">reset_index</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.25</span>
        
    </div><div class="proof-content">
<p>Why learning <strong class="program">numpy</strong> is crucial when someone wants to become
a proficient user of <strong class="program">pandas</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.26</span>
        
    </div><div class="proof-content">
<p>What is the difference between <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> and <strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.27</span>
        
    </div><div class="proof-content">
<p>Why applying the index operator <code class="docutils literal notranslate"><span class="pre">[...]</span></code> directly on a
<code class="docutils literal notranslate"><span class="pre">Series</span></code> or <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object is not necessarily a good idea?</p>
</div></div><div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.28</span>
        
    </div><div class="proof-content">
<p>What is the difference between <code class="docutils literal notranslate"><span class="pre">.index</span></code>, <code class="docutils literal notranslate"><span class="pre">Index</span></code>, and <code class="docutils literal notranslate"><span class="pre">.columns</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.29</span>
        
    </div><div class="proof-content">
<p>How to compute the arithmetic mean and median
of all the numeric columns in a data frame, using
a single line of code?</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.30</span>
        
    </div><div class="proof-content">
<p>What is a train/test split and how to perform it using
<strong class="program">numpy</strong> and <strong class="program">pandas</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.31</span>
        
    </div><div class="proof-content">
<p>What is the difference between stacking and unstacking?
Which one yields a wide (as opposed to long) format?</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.32</span>
        
    </div><div class="proof-content">
<p>Name different data frame join (merge) operations and explain how
they work.</p>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.33</span>
        
    </div><div class="proof-content">
<p>How does sorting with respect to more than one criterion work?</p>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.34</span>
        
    </div><div class="proof-content">
<p>Name the basic set-theoretic operations on data frames.</p>
</div></div><hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="footdf"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Data frames were first introduced in the 1991 version
of the S language <span id="id5">[<a class="reference internal" href="999-bibliography.html#id34">CH91</a>]</span>.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="420-categorical.html" class="btn btn-neutral float-right" title="11. Handling Categorical Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="330-relationship.html" class="btn btn-neutral float-left" title="9. Exploring Relationships Between Variables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright &#169; 2022 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>. Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.
      <span class="lastupdated">
        Last updated on 2022-06-19T12:11:26+1000.
      </span>
    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a> theme.
    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>