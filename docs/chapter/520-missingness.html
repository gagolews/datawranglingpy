<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Minimalist Data Wrangling with Python" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2024" name="citation_date" />
<meta content="2024" name="citation_publication_date" />
<meta content="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf" name="citation_pdf_url" />
<meta content="https://datawranglingpy.gagolewski.com/" name="citation_public_url" />
<meta content="10.5281/zenodo.6451068" name="citation_doi" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Minimalist Data Wrangling with Python" name="twitter:title" />
<meta content="Minimalist Data Wrangling with Python" name="og:title" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="twitter:description" />
<meta content="Minimalist Data Wrangling with Python is envisaged as a student's first introduction to data science, providing a high-level overview as well as discussing key concepts in detail. We explore methods for cleaning data gathered from different sources, transforming, selecting, and extracting features, performing exploratory data analysis and dimensionality reduction, identifying naturally occurring data clusters, modelling patterns in data, comparing data between groups, and reporting the results. This textbook is a non-profit project. Its online and PDF versions are freely available at https://datawranglingpy.gagolewski.com/." name="og:description" />
<meta content="gagolews/datawranglingpy" name="og:site_name" />
<meta content="https://datawranglingpy.gagolewski.com/" name="og:url" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://datawranglingpy.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://datawranglingpy.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571912" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="16. Time series" href="530-time-series.html" /><link rel="prev" title="14. Text data" href="510-text.html" />
        <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/520-missingness.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/datawranglingpy.png"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>15. Missing, censored, and questionable data - Minimalist Data Wrangling with Python</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1e0fcfc0" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Minimalist Data Wrangling with Python</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/datawranglingpy.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Minimalist Data Wrangling with Python</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.3.9108
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/">Deep R programming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar types and control structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and other types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional numeric data and their empirical distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-transform-vector.html">5. Processing unidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-distribution.html">6. Continuous probability distributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">7. From uni- to multidimensional numeric data</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">8. Processing multidimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-relationship.html">9. Exploring relationships between variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="410-data-frame.html">10. Introducing data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">11. Handling categorical data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-group-by.html">12. Processing data in groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">13. Accessing databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other data types</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="510-text.html">14. Text data</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">15. Missing, censored, and questionable data</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-time-series.html">16. Time series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/datawranglingpy" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="missing-censored-and-questionable-data">
<span id="chap-missingness"></span><h1><span class="section-number">15. </span>Missing, censored, and questionable data<a class="headerlink" href="#missing-censored-and-questionable-data" title="Link to this heading">¶</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://deepr.gagolewski.com/"><em>Deep R Programming</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id2" title="Gagolewski, M. (2024).  Deep R Programming. URL: https://deepr.gagolewski.com/, DOI: 10.5281/zenodo.7490464.">36</a>]</span> too.</em></p>
</div></blockquote>
<p>Up to now, we have been mostly assuming that observations
are of decent quality, i.e., trustworthy. It would be nice if
that was always the case, but it is not.</p>
<p>In this chapter, we briefly address the most rudimentary
methods for dealing with <em>suspicious</em> observations:
outliers, missing, censored, imprecise, and incorrect data.</p>
<section id="missing-data">
<span id="sec-missing-data"></span><h2><span class="section-number">15.1. </span>Missing data<a class="headerlink" href="#missing-data" title="Link to this heading">¶</a></h2>
<p>Consider an excerpt from National Health and Nutrition Examination
Survey that we played with in <a class="reference internal" href="430-group-by.html#chap-group-by"><span class="std std-numref">Chapter 12</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/nhanes_p_demo_bmx_2020.csv&quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">nhanes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;BMXWT&quot;</span><span class="p">,</span> <span class="s2">&quot;BMXHT&quot;</span><span class="p">,</span> <span class="s2">&quot;RIDAGEYR&quot;</span><span class="p">,</span> <span class="s2">&quot;BMIHEAD&quot;</span><span class="p">,</span> <span class="s2">&quot;BMXHEAD&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1">##    BMXWT  BMXHT  RIDAGEYR  BMIHEAD  BMXHEAD</span>
<span class="c1">## 0    NaN    NaN         2      NaN      NaN</span>
<span class="c1">## 1   42.2  154.7        13      NaN      NaN</span>
<span class="c1">## 2   12.0   89.3         2      NaN      NaN</span>
<span class="c1">## 3   97.1  160.2        29      NaN      NaN</span>
<span class="c1">## 4   13.6    NaN         2      NaN      NaN</span>
</pre></div>
</div>
<p>Some of the columns bear <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (not-a-number) values.
They are used here to encode <em>missing</em> (not available) data.
Previously, we decided not to be bothered by them:
a shy call to <strong class="command">dropna</strong> resulted in their removal.
But we are curious now.</p>
<p>The reasons behind why some items are missing might be numerous,
in particular:</p>
<ul class="simple">
<li><p>a participant did not know the answer to a given question;</p></li>
<li><p>someone refused to answer a given question;</p></li>
<li><p>a person did not take part in the study anymore
(attrition, death, etc.);</p></li>
<li><p>an item was not applicable (e.g., number of minutes spent cycling weekly
when someone answered they did not learn to ride a bike yet);</p></li>
<li><p>a piece of information was not collected, e.g., due to the lack
of funding or a failure of a piece of equipment.</p></li>
</ul>
<section id="representing-and-detecting-missing-values">
<h3><span class="section-number">15.1.1. </span>Representing and detecting missing values<a class="headerlink" href="#representing-and-detecting-missing-values" title="Link to this heading">¶</a></h3>
<p>Sometimes missing values are specially encoded, especially
in CSV files, e.g., with <code class="docutils literal notranslate"><span class="pre">-1</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">9999</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy.inf</span></code>, <code class="docutils literal notranslate"><span class="pre">-numpy.inf</span></code>,
or <code class="docutils literal notranslate"><span class="pre">None</span></code>,  strings such as  <code class="docutils literal notranslate"><span class="pre">&quot;NA&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;N/A&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;Not</span> <span class="pre">Applicable&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;---&quot;</span></code>. This is why we must always inspect
our datasets carefully.
To assure consistent representation, we can convert
them to <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (as in: <code class="docutils literal notranslate"><span class="pre">numpy.nan</span></code>) in numeric (floating-point)
columns or to Python’s <code class="docutils literal notranslate"><span class="pre">None</span></code> otherwise.</p>
<p>Vectorised functions such as <strong class="command">numpy.isnan</strong> (or, more generally,
<strong class="command">numpy.isfinite</strong>) and <strong class="command">pandas.isnull</strong>
as well as <strong class="command">isna</strong> methods for the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">Series</span></code> classes
verify whether an item is missing or not.</p>
<p>For instance, here are the counts and proportions of missing
values in selected columns of <code class="docutils literal notranslate"><span class="pre">nhanes</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">)</span>  <span class="c1"># top 5 only</span>
<span class="c1">##               sum      mean</span>
<span class="c1">## BMIHEAD   14300.0  1.000000</span>
<span class="c1">## BMIRECUM  14257.0  0.996993</span>
<span class="c1">## BMIHT     14129.0  0.988042</span>
<span class="c1">## BMXHEAD   13990.0  0.978322</span>
<span class="c1">## BMIHIP    13924.0  0.973706</span>
</pre></div>
</div>
<p>Looking at the column descriptions on the data provider’s
<a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/P_BMX.htm">website</a>,
for example,
<code class="docutils literal notranslate"><span class="pre">BMIHEAD</span></code> stands for “Head Circumference Comment”,
whereas <code class="docutils literal notranslate"><span class="pre">BMXHEAD</span></code> is “Head Circumference (cm)”,
but these were only collected for infants.</p>
<div class="proof proof-type-exercise" id="id15">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.1</span>
        
    </div><div class="proof-content">
<p>Read the column descriptions
(refer to the comments in the CSV file for the relevant URLs)
to identify the possible reasons for some of the records
in <code class="docutils literal notranslate"><span class="pre">nhanes</span></code> being missing.</p>
</div></div><div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.2</span>
        
    </div><div class="proof-content">
<p>Learn about the difference between the
<strong class="command">pandas.DataFrameGroupBy.size</strong>
and <strong class="command">pandas.DataFrameGroupBy.count</strong> methods.</p>
</div></div></section>
<section id="computing-with-missing-values">
<h3><span class="section-number">15.1.2. </span>Computing with missing values<a class="headerlink" href="#computing-with-missing-values" title="Link to this heading">¶</a></h3>
<p>Our using <code class="docutils literal notranslate"><span class="pre">NaN</span></code> to denote a missing
piece of information is merely an ugly (but functional) hack<a class="footnote-reference brackets" href="#footrna" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
The original use case for not-a-number is to represent
the results of incorrect operations, e.g., logarithms of negative
numbers or subtracting two infinite entities.
We thus need extra care when handling them.</p>
<p>Generally, arithmetic operations on missing values yield a result
that is undefined as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># &quot;don&#39;t know&quot; + 2 == &quot;don&#39;t know&quot;</span>
<span class="c1">## nan</span>
<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1">## nan</span>
</pre></div>
</div>
<p>There are versions of certain aggregation functions
that ignore missing values whatsoever:
<strong class="command">numpy.nanmean</strong>, <strong class="command">numpy.nanmin</strong>, <strong class="command">numpy.nanmax</strong>,
<strong class="command">numpy.nanpercentile</strong>, <strong class="command">numpy.nanstd</strong>, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1">## 2.0</span>
</pre></div>
</div>
<p>Regrettably, running these aggregation functions directly on <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects
ignores missing entities by default. Compare an application
of <strong class="command">numpy.mean</strong> on a <code class="docutils literal notranslate"><span class="pre">Series</span></code> instance vs on a vector:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">nhanes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;BMXHT&quot;</span><span class="p">]</span>  <span class="c1"># some example Series, whatever</span>
<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1">## (134.73333333333332, nan)</span>
</pre></div>
</div>
<p>This is unfortunate a  behaviour as this way we might
miss (sic!) the presence of missing values.
Therefore, it is crucial to have the dataset carefully
inspected in advance.</p>
<div style="margin-top: 1em"></div><p>Also, <code class="docutils literal notranslate"><span class="pre">NaN</span></code> is of the floating-point type.
As a consequence, it cannot be present in, amongst others, logical vectors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span>  <span class="c1"># preview</span>
<span class="c1">## 0      NaN</span>
<span class="c1">## 1    154.7</span>
<span class="c1">## 2     89.3</span>
<span class="c1">## 3    160.2</span>
<span class="c1">## 4      NaN</span>
<span class="c1">## Name: BMXHT, dtype: float64</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span>
<span class="c1">## 0    False</span>
<span class="c1">## 1     True</span>
<span class="c1">## 2    False</span>
<span class="c1">## 3     True</span>
<span class="c1">## 4    False</span>
<span class="c1">## Name: BMXHT, dtype: bool</span>
</pre></div>
</div>
<p>Unfortunately, comparisons against missing values yield <code class="docutils literal notranslate"><span class="pre">False</span></code>, instead of
the more semantically valid missing value.
Hence, if we want to retain the missingness information
(we do not know if a missing value is greater than 100),
we need to do it manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>  <span class="c1"># required for numpy vectors, not for pandas Series</span>
<span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">y</span>
<span class="c1">## 0     None</span>
<span class="c1">## 1     True</span>
<span class="c1">## 2    False</span>
<span class="c1">## 3     True</span>
<span class="c1">## 4     None</span>
<span class="c1">## Name: BMXHT, dtype: object</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id17">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.3</span>
        
    </div><div class="proof-content">
<p>Read the <strong class="program">pandas</strong> <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html">documentation</a> about missing value handling.</p>
</div></div></section>
<section id="missing-at-random-or-not">
<h3><span class="section-number">15.1.3. </span>Missing at random or not?<a class="headerlink" href="#missing-at-random-or-not" title="Link to this heading">¶</a></h3>
<p>At a general level (from the mathematical modelling perspective),
we may distinguish between a few missingness patterns <span id="id3">[<a class="reference internal" href="999-bibliography.html#id30" title="Rubin, D.B. (1976).  Inference and missing data. Biometrika, 63(3):581–590.">83</a>]</span>:</p>
<ul class="simple">
<li><p><em>missing completely at random</em>: reasons are unrelated to data
and probabilities of cases’ being missing are all the same;</p></li>
<li><p><em>missing at random</em>: there are different probabilities of being missing
within distinct groups (e.g., ethical data scientists might
tend to refuse to answer specific questions);</p></li>
<li><p><em>missing not at random</em>: due to reasons unknown to us
(e.g., data was collected at different times,
there might be significant differences within the groups
that we cannot easily identify, e.g., amongst
participants with a background in mathematics where we did not ask
about education or occupation).</p></li>
</ul>
<p>It is important to try to determine the reason for missingness.
This will usually imply the kinds of techniques that
are suitable in specific cases.</p>
</section>
<section id="discarding-missing-values">
<h3><span class="section-number">15.1.4. </span>Discarding missing values<a class="headerlink" href="#discarding-missing-values" title="Link to this heading">¶</a></h3>
<p>We may try removing (discarding) rows or columns
that carry at least one, some, or too many missing values.
Nonetheless, such a scheme will obviously not work for small datasets,
where each observation is precious<a class="footnote-reference brackets" href="#footsmallsample" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<p>Also, we ought <em>not</em> to exercise data removal in situations where missingness
is conditional (e.g., data only available for infants)
or otherwise group-dependent (not completely at random).
Otherwise, for example, it might result in an imbalanced dataset.</p>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.4</span>
        
    </div><div class="proof-content">
<p>With the <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/nhanes_p_demo_bmx_2020.csv"><code class="docutils literal notranslate"><span class="pre">nhanes_p_demo_bmx_2020</span></code></a> dataset, perform
what follows.</p>
<ol class="arabic simple">
<li><p>Remove all columns that are comprised of missing values only.</p></li>
<li><p>Remove all columns that are made of more than 20% missing values.</p></li>
<li><p>Remove all rows that only consist of missing values.</p></li>
<li><p>Remove all rows that bear at least one missing value.</p></li>
<li><p>Remove all columns that carry at least one missing value.</p></li>
</ol>
<p><em>Hint: <strong class="command">pandas.DataFrame.dropna</strong> might be useful in the simplest
cases, and <strong class="command">numpy.isnan</strong> or <strong class="command">pandas.DataFrame.isna</strong> with
<strong class="command">loc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code> or <strong class="command">iloc</strong><code class="code docutils literal notranslate"><span class="pre">[...]</span></code>
can be applied otherwise.</em></p>
</div></div></section>
<section id="mean-imputation">
<h3><span class="section-number">15.1.5. </span>Mean imputation<a class="headerlink" href="#mean-imputation" title="Link to this heading">¶</a></h3>
<p>When we cannot afford or it is inappropriate/inconvenient to proceed with
the removal of missing observations or columns,
we may try applying some missing value <em>imputation</em>
techniques. Let’s be clear, though: this is merely a
replacement thereof by some <em>hopefully</em> adequate guesstimates.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In all kinds of reports from data analysis,
we need to be explicit about the way we handle the missing values.
Sometimes they might strongly affect the results.</p>
</div>
<p>Consider an example vector with missing values,
comprised of heights of the adult participants of the NHANES study.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">nhanes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nhanes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;RIDAGEYR&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;BMXHT&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The simplest approach is to replace
each missing value with the corresponding column’s mean.
This does not change the overall average but decreases the variance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xi</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly, we could consider replacing missing values
with the median, or – in the case of categorical data – the mode.</p>
<div style="margin-top: 1em"></div><p>Furthermore, we expect heights to differ, on average, between sexes.
Consequently, another imputation option is to replace
the missing values with the corresponding within-group averages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xg</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">nhanes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nhanes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;RIDAGEYR&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;RIAGENDR&quot;</span><span class="p">]</span>
<span class="n">xg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xg</span><span class="p">[</span><span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># male</span>
<span class="n">xg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xg</span><span class="p">[</span><span class="n">g</span> <span class="o">==</span> <span class="mi">2</span><span class="p">])</span>  <span class="c1"># female</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Unfortunately, whichever imputation method we choose,
will artificially distort the data distribution
and introduce some kind of bias; see <a class="reference internal" href="#fig-mean-imputation"><span class="std std-numref">Figure 15.1</span></a>
for the histograms of <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">xi</span></code>, and <code class="docutils literal notranslate"><span class="pre">xg</span></code>.
These effects can be obscured if we increase the histogram bins’
widths, but they will still be present in the data.
No surprise here: we added to the sample many identical values.</p>
<figure class="align-default" id="id19">
<span id="fig-mean-imputation"></span><img alt="../_images/mean-imputation-1.png" src="../_images/mean-imputation-1.png" />
<figcaption>
<p><span class="caption-number">Figure 15.1 </span><span class="caption-text">The mean imputation distorts the data distribution.</span><a class="headerlink" href="#id19" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.5</span>
        
    </div><div class="proof-content">
<p>With the <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/nhanes_p_demo_bmx_2020.csv"><code class="docutils literal notranslate"><span class="pre">nhanes_p_demo_bmx_2020</span></code></a> dataset, perform what follows.</p>
<ol class="arabic simple">
<li><p>For each numerical column, replace all missing values with the column
averages.</p></li>
<li><p>For each categorical column, replace all missing values with the column
modes.</p></li>
<li><p>For each numerical column, replace all missing values with the
averages corresponding to a patient’s sex
(as given by the <code class="docutils literal notranslate"><span class="pre">RIAGENDR</span></code> column).</p></li>
</ol>
</div></div></section>
<section id="imputation-by-classification-and-regression">
<h3><span class="section-number">15.1.6. </span>Imputation by classification and regression (*)<a class="headerlink" href="#imputation-by-classification-and-regression" title="Link to this heading">¶</a></h3>
<p>We can easily compose a missing value imputer
based on averaging data from an observation’s
non-missing nearest neighbours; compare <a class="reference internal" href="330-relationship.html#sec-knn-regression"><span class="std std-numref">Section 9.2.1</span></a>
and <a class="reference internal" href="430-group-by.html#sec-knn-classification"><span class="std std-numref">Section 12.3.1</span></a>.
This is an extension of the simple idea of finding
the most <em>similar</em> observation (with respect to chosen criteria)
to a given one and then borrowing non-missing measurements from it.</p>
<p>More generally, different regression or classification
models can be built on non-missing data (training sample) and then
the missing observations can be replaced by the values
predicted by those models.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**) Rubin (e.g., in <span id="id5">[<a class="reference internal" href="999-bibliography.html#id29" title="Little, R.J.A. and Rubin, D.B. (2002).  Statistical Analysis with Missing Data. John Wiley &amp; Sons.">62</a>]</span>) suggests the use of a procedure
called <em>multiple imputation</em> (see also <span id="id6">[<a class="reference internal" href="999-bibliography.html#id31" title="van Buuren, S. (2018).  Flexible Imputation of Missing Data. CRC Press. URL: https://stefvanbuuren.name/fimd.">92</a>]</span>),
where copies of the original datasets are created,
missing values are imputed by sampling from some estimated distributions,
the inference is made, and then the results are aggregated.
An example implementation  of such an algorithm is available
in <strong class="command">sklearn.impute.IterativeImputer</strong>.</p>
</div>
</section>
</section>
<section id="censored-and-interval-data">
<h2><span class="section-number">15.2. </span>Censored and interval data (*)<a class="headerlink" href="#censored-and-interval-data" title="Link to this heading">¶</a></h2>
<p>Censored data frequently appear in the context of reliability, risk analysis,
and biostatistics, where the observed objects might <em>fail</em>
(e.g., break down, die, withdraw; compare, e.g., <span id="id7">[<a class="reference internal" href="999-bibliography.html#id32" title="Modarres, M., Kaminskiy, M.P., and Krivtsov, V. (2016).  Reliability Engineering and Risk Analysis: A Practical Guide. CRC Press.">66</a>]</span>).
Our introductory course cannot obviously cover everything.
However, a beginner analyst needs to be at least aware of
the existence of:</p>
<ul class="simple">
<li><p><em>right-censored</em> data: we only know that the actual value
is greater than the recorded one (e.g., we stopped the experiment
on the reliability of light bulbs after 1000 hours,
so those which still work will not have their time-of-failure
precisely known);</p></li>
<li><p><em>left-censored</em> data: the true observation is less than
the recorded one, e.g., we observe a component’s failure, but
we do not know for how long it has been in operation before
the study has started.</p></li>
</ul>
<p>In such cases, the recorded datum of, say, 1000,
can essentially mean <span class="math">\([1000, \infty)\)</span>, <span class="math">\([0, 1000]\)</span>, or <span class="math">\((-\infty, 1000]\)</span>.</p>
<p>There might also be  instances where we know that a value
is in some interval <span class="math">\([a, b]\)</span>. There are numerical libraries
that deal with <em>interval computations</em>, and some data analysis
methods exist for dealing with such a scenario.</p>
</section>
<section id="incorrect-data">
<span id="sec-data-validation-exercises"></span><h2><span class="section-number">15.3. </span>Incorrect data<a class="headerlink" href="#incorrect-data" title="Link to this heading">¶</a></h2>
<p><em>Missing data</em> can already be marked in a given sample.
But we also might be willing to mark some existing values
as missing, e.g., when they are incorrect.
For example:</p>
<ul class="simple">
<li><p>for text data, misspelled words;</p></li>
<li><p>for spatial data, GPS coordinates of places out of this world,
nonexistent zip codes, or invalid addresses;</p></li>
<li><p>for date-time data, misformatted date-time strings,
incorrect dates such as “29 February 2011”,
an event’s start date being after the end date;</p></li>
<li><p>for physical measurements, observations that do not meet specific
constraints, e.g., negative ages, or heights of people over
300 centimetres;</p></li>
<li><p>IDs of entities that simply do not exist (e.g., unregistered
or deleted clients’ accounts);</p></li>
</ul>
<p>and so forth.</p>
<p>To be able to identify and handle incorrect data, we need specific
knowledge of a particular domain. Optimally, data validation
techniques should already be employed on the data collection stage.
For instance, when a user submits an online form.</p>
<p>There can be many tools that can assist us with identifying erroneous
observations, e.g., spell checkers such as
<a class="reference external" href="https://hunspell.github.io/"><strong class="program">hunspell</strong></a>.</p>
<p>For smaller datasets, observations can also be inspected manually.
In other cases, we might have to develop custom algorithms for detecting
such bugs in data.</p>
<div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.6</span>
        
    </div><div class="proof-content">
<p>Given some data frame with numeric columns only,
perform what follows.</p>
<ol class="arabic simple">
<li><p>Check if all numeric values in each column are between 0 and 1000.</p></li>
<li><p>Check if all values in each column are unique.</p></li>
<li><p>Verify that all the rowwise sums add up to 1.0 (up to a small
numeric error).</p></li>
<li><p>Check if the data frame consists of 0s and 1s only.
Provided that this is the case, verify that for each row,
if there is a 1 in some column, then all the columns to the right
are filled with 1s too.</p></li>
</ol>
</div></div><p>Many data validation methods can be reduced to operations on strings;
see <a class="reference internal" href="510-text.html#chap-text"><span class="std std-numref">Chapter 14</span></a>.
They may be as simple as writing a single regular expression
or checking if a label is in a dictionary of possible values
but also as difficult as writing your own parser for a
custom context-sensitive grammar.</p>
<div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.7</span>
        
    </div><div class="proof-content">
<p>Once we import the data fetched from dirty sources, relevant information
will have to be extracted from raw text,
e.g., strings like <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code> should be converted to floating-point
numbers. In the sequel, we suggest several tasks
that can aid in developing data validation skills involving
some operations on text.</p>
<p>Given an example data frame with text columns
(manually invented, please be creative), perform what follows.</p>
<ol class="arabic simple">
<li><p>Remove trailing and leading whitespaces from each string.</p></li>
<li><p>Check if all strings can be interpreted as numbers, e.g., <code class="docutils literal notranslate"><span class="pre">&quot;23.43&quot;</span></code>.</p></li>
<li><p>Verify if a date string in the <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> format is correct.</p></li>
<li><p>Determine if a date-time string in the <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span> <span class="pre">hh:mm:ss</span></code> format is
correct.</p></li>
<li><p>Check if all strings are of the form <code class="docutils literal notranslate"><span class="pre">(+NN)</span> <span class="pre">NNN-NNN-NNN</span></code>
or <code class="docutils literal notranslate"><span class="pre">(+NN)</span> <span class="pre">NNNN-NNN-NNN</span></code>, where <code class="docutils literal notranslate"><span class="pre">N</span></code> denotes any digit
(valid telephone numbers).</p></li>
<li><p>Inspect whether all strings are valid country names.</p></li>
<li><p>(*) Given a person’s date of birth, sex,
and Polish ID number <a class="reference external" href="https://en.wikipedia.org/wiki/PESEL">PESEL</a>,
check if that ID is correct.</p></li>
<li><p>(*) Determine if a string represents a correct International Bank Account
Number (<a class="reference external" href="https://en.wikipedia.org/wiki/International_Bank_Account_Number">IBAN</a>)
(note that IBANs have two check digits).</p></li>
<li><p>(*) Transliterate text to ASCII, e.g., <code class="docutils literal notranslate"><span class="pre">&quot;żółty</span> <span class="pre">©&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;zolty</span> <span class="pre">(C)&quot;</span></code>.</p></li>
<li><p>(**) Using an external spell checker, determine if every string
is a valid English word.</p></li>
<li><p>(**) Using an external spell checker, ascertain that every string
is a valid English noun in the singular form.</p></li>
<li><p>(**) Resolve all abbreviations by means of a custom dictionary,
e.g., <code class="docutils literal notranslate"><span class="pre">&quot;Kat.&quot;</span></code> → <code class="docutils literal notranslate"><span class="pre">&quot;Katherine&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;Gr.&quot;</span></code> → <code class="docutils literal notranslate"><span class="pre">&quot;Grzegorz&quot;</span></code>.</p></li>
</ol>
</div></div></section>
<section id="outliers">
<span id="sec-outliers"></span><h2><span class="section-number">15.4. </span>Outliers<a class="headerlink" href="#outliers" title="Link to this heading">¶</a></h2>
<p>Another group of inspectionworthy observations consists of
<em>outliers</em>. We can define them as the samples that reside
in the areas of substantially lower density than their neighbours.</p>
<p>Outliers might be present due to an error, or their being
otherwise anomalous,
but they may also simply be interesting, original, or novel.
After all, statistics does not give any meaning to data items; humans do.</p>
<p>What we do with outliers is a separate decision.
We can get rid of them, correct them, replace them
with a missing value (and then possibly impute), or analyse them
separately.
In particular, there is a separate subfield in statistics
called extreme value theory that is interested in predicting
the distribution of very large observations (e.g., for modelling
floods, extreme rainfall, or temperatures); see, e.g., <span id="id8">[<a class="reference internal" href="999-bibliography.html#id5" title="Beirlant, J., Goegebeur, Y., Teugels, J., and Segers, J. (2004).  Statistics of Extremes: Theory and Applications. Wiley. DOI: 10.1002/0470012382.">6</a>]</span>.
But this is a topic for a more advanced course;
see, e.g., <span id="id9">[<a class="reference internal" href="999-bibliography.html#id162" title="Huber, P.J. and Ronchetti, E.M. (2009).  Robust Statistics. Wiley.">52</a>]</span>. By then, let’s stick with some simpler settings.</p>
<section id="the-3-2-iqr-rule-for-normally-distributed-data">
<span id="sec-32iqr"></span><h3><span class="section-number">15.4.1. </span>The 3/2 IQR rule for normally-distributed data<a class="headerlink" href="#the-3-2-iqr-rule-for-normally-distributed-data" title="Link to this heading">¶</a></h3>
<p>For unidimensional data (or individual columns in matrices
and data frames), the first few smallest and largest
observations should usually be inspected manually.
For instance, it might happen that someone accidentally
entered a patient’s height in metres instead of centimetres: such
cases are easily detectable. A data scientist is like a detective.</p>
<p>Let’s recall the rule of thumb discussed in the section on box-and-whisker
plots (<a class="reference internal" href="220-transform-vector.html#sec-boxplot"><span class="std std-numref">Section 5.1.4</span></a>).
For data that are expected to come from a normal distribution,
everything that does not fall into the interval
<span class="math">\([Q_1-1.5\mathrm{IQR}, Q_3+1.5\mathrm{IQR}]\)</span> can be considered
suspicious. This definition is based on quartiles only,
so it is not affected by potential outliers
(they are robust aggregates; compare <span id="id10">[<a class="reference internal" href="999-bibliography.html#id162" title="Huber, P.J. and Ronchetti, E.M. (2009).  Robust Statistics. Wiley.">52</a>]</span>).
Plus, the magic constant 1.5 is nicely round and thus easy to memorise
(an attractive feature). It is not too small and not too large;
for the normal distribution <span class="math">\(\mathrm{N}(\mu, \sigma)\)</span>,
the aforementioned interval corresponds to roughly
<span class="math">\([\mu-2.698\sigma, \mu+2.698\sigma]\)</span>,
and the probability of obtaining a value outside of it
is c. 0.7%. In other words, for a sample of size 1000 that is <em>truly</em>
normally distributed (not contaminated by anything), only
seven observations will be flagged.
It is not a problem to inspect them by hand.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) We can choose a different threshold.
For instance, for the normal distribution <span class="math">\(\mathrm{N}(10, 1)\)</span>,
even though the probability of observing a value greater than 15
is <em>theoretically</em> non-zero, it is smaller 0.000029%, so it is sensible to
treat this observation as suspicious.
On the other hand, we do not want to mark too many observations
as outliers: inspecting them manually might be too labour-intense.</p>
</div>
<div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.8</span>
        
    </div><div class="proof-content">
<p>For each column in <a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/nhanes_p_demo_bmx_2020.csv"><code class="docutils literal notranslate"><span class="pre">nhanes_p_demo_bmx_2020</span></code></a>,
inspect a few smallest and largest observations
and see if they make sense.</p>
</div></div><div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.9</span>
        
    </div><div class="proof-content">
<p>Perform the foregoing separately for data in each group
as defined by the <code class="docutils literal notranslate"><span class="pre">RIAGENDR</span></code> column.</p>
</div></div></section>
<section id="unidimensional-density-estimation">
<span id="sec-kde-1d"></span><h3><span class="section-number">15.4.2. </span>Unidimensional density estimation (*)<a class="headerlink" href="#unidimensional-density-estimation" title="Link to this heading">¶</a></h3>
<p>For skewed distributions such as the ones
representing incomes, there might be nothing wrong, at least statistically
speaking, with very large isolated observations.</p>
<p>For well-separated multimodal distributions on the real line,
outliers may sometimes also fall in between the areas of high density.</p>
<div class="proof proof-type-example" id="id25">

    <div class="proof-title">
        <span class="proof-type">Example 15.10</span>
        
    </div><div class="proof-content">
<p>That neither box plots themselves,
nor the <span class="math">\(1.5\mathrm{IQR}\)</span> rule might not be ideal tools for multimodal
data is exemplified in <a class="reference internal" href="#fig-blobs2"><span class="std std-numref">Figure 15.2</span></a>. Here, we have
a mixture of <span class="math">\(\mathrm{N}(10, 1)\)</span> and <span class="math">\(\mathrm{N}(25, 1)\)</span>
samples and four potential outliers at <span class="math">\(0\)</span>, <span class="math">\(15\)</span>, <span class="math">\(45\)</span>, and <span class="math">\(50\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/blobs2.txt&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id26">
<span id="fig-blobs2"></span><img alt="../_images/blobs2-3.png" src="../_images/blobs2-3.png" />
<figcaption>
<p><span class="caption-number">Figure 15.2 </span><span class="caption-text">With box plots, we may fail to detect some outliers.</span><a class="headerlink" href="#id26" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></div><p>Fixed-radius search techniques discussed in <a class="reference internal" href="320-transform-matrix.html#sec-distances"><span class="std std-numref">Section 8.4</span></a>
can be used for estimating the underlying
probability density function.
Given a data sample <span class="math">\(\boldsymbol{x}=(x_1,\dots,x_n)\)</span>,
consider<a class="footnote-reference brackets" href="#footkde" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>:</p>
<div class="math-wrapper docutils container">
<div class="math">
\[
\hat{f}_r(z) = \frac{1}{2 r n} \sum_{i=1}^n |B_r(z)|,
\]</div>
</div>
<p>where <span class="math">\(|B_r(z)|\)</span> denotes the number of observations from
<span class="math">\(\boldsymbol{x}\)</span> whose distance to <span class="math">\(z\)</span> is not greater than <span class="math">\(r\)</span>,
i.e., fall into the interval <span class="math">\([z-r, z+r]\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># radius – feel free to play with different values</span>
<span class="kn">import</span> <span class="nn">scipy.spatial</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">dx</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># preview</span>
<span class="c1">## 0    0.000250</span>
<span class="c1">## 1    0.116267</span>
<span class="c1">## 2    0.116766</span>
<span class="c1">## 3    0.166667</span>
<span class="c1">## 4    0.076098</span>
<span class="c1">## 5    0.156188</span>
<span class="c1">## dtype: float64</span>
</pre></div>
</div>
<p>Then, points in the sample lying in low-density regions
(i.e., all <span class="math">\(x_i\)</span> such that <span class="math">\(\hat{f}_r(x_i)\)</span> is small)
can be flagged for further inspection:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">]</span>
<span class="c1">## array([ 0.        , 13.57157922, 15.        , 45.        , 50.        ])</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#fig-kde-1d"><span class="std std-numref">Figure 15.3</span></a> for an illustration of <span class="math">\(\hat{f}_r\)</span>.
Of course, <span class="math">\(r\)</span> must be chosen with care, just like the number
of bins in a histogram.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">dz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;density estimator ($r=</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id27">
<span id="fig-kde-1d"></span><img alt="../_images/kde-1d-5.png" src="../_images/kde-1d-5.png" />
<figcaption>
<p><span class="caption-number">Figure 15.3 </span><span class="caption-text">Density estimation based on fixed-radius search.</span><a class="headerlink" href="#id27" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="multidimensional-density-estimation">
<span id="sec-kde-2d"></span><h3><span class="section-number">15.4.3. </span>Multidimensional density estimation (*)<a class="headerlink" href="#multidimensional-density-estimation" title="Link to this heading">¶</a></h3>
<p>By far we should have become used to the fact that unidimensional data
projections might lead to our losing too much information.
Some values can seem perfectly fine when they are considered
in isolation, but already plotting them in 2D reveals that
the reality is more complex than that.</p>
<p><a class="reference internal" href="#fig-blobs1-uni"><span class="std std-numref">Figure 15.4</span></a> depicts the distributions of two natural
projections of an example dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching-data/master/marek/blobs1.txt&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># width=height</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;X[:, 0]&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;X[:, 0]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;X[:, 1]&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;X[:, 1]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id28">
<span id="fig-blobs1-uni"></span><img alt="../_images/blobs1-uni-7.png" src="../_images/blobs1-uni-7.png" />
<figcaption>
<p><span class="caption-number">Figure 15.4 </span><span class="caption-text">One-dimensional projections of the <code class="docutils literal notranslate"><span class="pre">blobs1</span></code> dataset.</span><a class="headerlink" href="#id28" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>There is nothing suspicious here. Or is there?</p>
<div style="margin-top: 1em"></div><p>The scatter plot in <a class="reference internal" href="#fig-blobs1-multi"><span class="std std-numref">Figure 15.5</span></a>
reveals that the data consist of two well-separable blobs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id29">
<span id="fig-blobs1-multi"></span><img alt="../_images/blobs1-multi-9.png" src="../_images/blobs1-multi-9.png" />
<figcaption>
<p><span class="caption-number">Figure 15.5 </span><span class="caption-text">Scatter plot of the <code class="docutils literal notranslate"><span class="pre">blobs1</span></code> dataset.</span><a class="headerlink" href="#id29" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>There are a few observations that we might mark as outliers.
The truth is that yours truly injected eight junk points at the
very end of the dataset. Ha.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:,</span> <span class="p">:]</span>
<span class="c1">## array([[-3. ,  3. ],</span>
<span class="c1">##        [ 3. ,  3. ],</span>
<span class="c1">##        [ 3. , -3. ],</span>
<span class="c1">##        [-3. , -3. ],</span>
<span class="c1">##        [-3.5,  3.5],</span>
<span class="c1">##        [-2.5,  2.5],</span>
<span class="c1">##        [-2. ,  2. ],</span>
<span class="c1">##        [-1.5,  1.5]])</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Handling multidimensional data requires slightly more sophisticated
methods; see, e.g., <span id="id12">[<a class="reference internal" href="999-bibliography.html#id157" title="Aggarwal, C.C. (2015).  Data Mining: The Textbook. Springer.">2</a>]</span>.
A straightforward approach is to check if there are any points
within an observation’s radius of some assumed size <span class="math">\(r&gt;0\)</span>. If that is not the
case, we may consider it an outlier. This is a variation on the
aforementioned unidimensional density estimation approach<a class="footnote-reference brackets" href="#footnorm2kde" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p>
<div class="proof proof-type-example" id="id30">

    <div class="proof-title">
        <span class="proof-type">Example 15.11</span>
        
    </div><div class="proof-content">
<p>Consider the following code chunk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># r=0.2 (radius) – play with it yourself</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">())</span>
<span class="n">c</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># preview</span>
<span class="c1">## array([42, 30,  1,  1])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">c[i]</span></code> gives the number of points within <code class="docutils literal notranslate"><span class="pre">X[i,</span> <span class="pre">:]</span></code>’s
<span class="math">\(r\)</span>-radius (with respect to the Euclidean distance),
including the point itself. Consequently, <code class="docutils literal notranslate"><span class="pre">c[i]==1</span></code> denotes a
potential outlier; see <a class="reference internal" href="#fig-blobs1-eps"><span class="std std-numref">Figure 15.6</span></a> for an illustration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;normal point&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;outlier&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id31">
<span id="fig-blobs1-eps"></span><img alt="../_images/blobs1-eps-11.png" src="../_images/blobs1-eps-11.png" />
<figcaption>
<p><span class="caption-number">Figure 15.6 </span><span class="caption-text">Outlier detection based on a fixed-radius search for the <code class="docutils literal notranslate"><span class="pre">blobs1</span></code> dataset.</span><a class="headerlink" href="#id31" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></div></section>
</section>
<section id="exercises">
<h2><span class="section-number">15.5. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.12</span>
        
    </div><div class="proof-content">
<p>How can missing values be represented in <strong class="program">numpy</strong> and <strong class="program">pandas</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.13</span>
        
    </div><div class="proof-content">
<p>Explain some basic strategies for dealing
with missing values in numeric vectors.</p>
</div></div><div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.14</span>
        
    </div><div class="proof-content">
<p>Why we ought to be very explicit about the way we handle missing
and other suspicious data? Is it advisable to mark as missing
(or remove completely) the observations
that we <em>dislike</em> or otherwise deem <em>inappropriate</em>, <em>controversial</em>,
<em>dangerous</em>, <em>incompatible with our political views</em>, etc.?</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.15</span>
        
    </div><div class="proof-content">
<p>Is replacing missing values with the sample arithmetic mean
for income data (as in, e.g., the
<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/uk_income_simulated_2020.txt"><code class="docutils literal notranslate"><span class="pre">uk_income_simulated_2020</span></code></a>
dataset) a sensible strategy?</p>
</div></div><div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.16</span>
        
    </div><div class="proof-content">
<p>What are the differences between data missing completely at random,
missing at random, and missing not at random?</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 15.17</span>
        
    </div><div class="proof-content">
<p>List some strategies for dealing
with data that might contain outliers.</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footrna" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>(*) The R environment, on the other hand, supports
missing values out-of-the-box.</p>
</aside>
<aside class="footnote brackets" id="footsmallsample" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">2</a><span class="fn-bracket">]</span></span>
<p>On the other hand, if we want to infer from
small datasets, we should ask ourselves whether this
is a good idea at all… It might be better to refrain
from any data analysis than to come up with conclusions
that are likely to be unjustified.</p>
</aside>
<aside class="footnote brackets" id="footkde" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">3</a><span class="fn-bracket">]</span></span>
<p>This is an instance of a kernel density estimator,
with the simplest kernel: a rectangular one.</p>
</aside>
<aside class="footnote brackets" id="footnorm2kde" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">4</a><span class="fn-bracket">]</span></span>
<p>(**) We can easily normalise the outputs to get
a true 2D kernel density estimator, but multivariate statistics
is beyond the scope of this course.
In particular, that data might have fixed marginal distributions
(projections onto 1D) but their multidimensional images might be very
different is beautifully described by the copula theory <span id="id14">[<a class="reference internal" href="999-bibliography.html#id81" title="Nelsen, R.B. (1999).  An Introduction to Copulas. Springer-Verlag.">69</a>]</span>.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="530-time-series.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">16. </span>Time series</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="510-text.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">14. </span>Text data</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2025 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2025-01-09T15:21:57+0100.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">15. Missing, censored, and questionable data</a><ul>
<li><a class="reference internal" href="#missing-data">15.1. Missing data</a><ul>
<li><a class="reference internal" href="#representing-and-detecting-missing-values">15.1.1. Representing and detecting missing values</a></li>
<li><a class="reference internal" href="#computing-with-missing-values">15.1.2. Computing with missing values</a></li>
<li><a class="reference internal" href="#missing-at-random-or-not">15.1.3. Missing at random or not?</a></li>
<li><a class="reference internal" href="#discarding-missing-values">15.1.4. Discarding missing values</a></li>
<li><a class="reference internal" href="#mean-imputation">15.1.5. Mean imputation</a></li>
<li><a class="reference internal" href="#imputation-by-classification-and-regression">15.1.6. Imputation by classification and regression (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#censored-and-interval-data">15.2. Censored and interval data (*)</a></li>
<li><a class="reference internal" href="#incorrect-data">15.3. Incorrect data</a></li>
<li><a class="reference internal" href="#outliers">15.4. Outliers</a><ul>
<li><a class="reference internal" href="#the-3-2-iqr-rule-for-normally-distributed-data">15.4.1. The 3/2 IQR rule for normally-distributed data</a></li>
<li><a class="reference internal" href="#unidimensional-density-estimation">15.4.2. Unidimensional density estimation (*)</a></li>
<li><a class="reference internal" href="#multidimensional-density-estimation">15.4.3. Multidimensional density estimation (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">15.5. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=38fca34a"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>