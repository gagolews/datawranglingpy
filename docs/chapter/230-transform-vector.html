<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>6. Transforming and Filtering Numeric Data &mdash; Minimalist Data Wrangling with Python by Marek Gagolewski</title>
  

  
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/230-transform-vector.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Continuous Probability Distributions (*)" href="240-distribution-uni.html" />
    <link rel="prev" title="5. Aggregating Numeric Data" href="220-aggregate.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Minimalist Data Wrangling with Python [DRAFTv0.3.1]
          

          
          </a>

          <div class="version">
          by <a style="color: inherit" href="https://www.gagolewski.com">Marek Gagolewski</a>
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-setup.html">1. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar Types and Control Structures in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and Other Types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Unidimensional Numeric Data and Their Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-aggregate.html">5. Aggregating Numeric Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Transforming and Filtering Numeric Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vectorised-mathematical-functions">6.1. Vectorised Mathematical Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arithmetic-operators">6.2. Arithmetic Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vector-scalar-case">6.2.1. Vector-Scalar Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-feature-scaling">6.2.2. Application: Feature Scaling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#standardisation-and-z-scores">6.2.2.1. Standardisation and Z-scores</a></li>
<li class="toctree-l4"><a class="reference internal" href="#min-max-scaling-and-clipping">6.2.2.2. Min-Max Scaling and Clipping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#normalisation-l-2-dividing-by-length">6.2.2.3. Normalisation (<span class="math notranslate nohighlight">\(l_2\)</span>; Dividing by Length) (*)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#normalisation-l-1-dividing-by-sum">6.2.2.4. Normalisation (<span class="math notranslate nohighlight">\(l_1\)</span>; Dividing by Sum) (*)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vector-vector-case">6.2.3. Vector-Vector Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vector-indexing">6.3. Vector Indexing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#integer-indexing">6.3.1. Integer Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logical-indexing">6.3.2. Logical Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slicing">6.3.3. Slicing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-operations">6.4. Other Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sorting-and-ranking">6.4.1. Sorting and Ranking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#searching-for-certain-indexes-argmin-argmax">6.4.2. Searching for Certain Indexes (Argmin, Argmax)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cumulative-sums-and-iterated-differences">6.4.3. Cumulative Sums and Iterated Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vectorising-scalar-operations-with-list-comprehensions">6.4.4. Vectorising Scalar Operations with List Comprehensions (*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">6.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="240-distribution-uni.html">7. Continuous Probability Distributions (*)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">8. Multidimensional Numeric Data at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-matrix.html">9. Transforming and Filtering Multidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-corelation.html">10. 🚧 Exploring Relationships Between Variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="410-dataframe.html">11. Introducing Data Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="420-categorical.html">12. Handling Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-groupby.html">13. 🚧 Processing Data in Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-sql.html">14. Accessing Databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text and Other Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">15. Working with Text Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-regex.html">16. Regular Expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-missingness.html">17. Outliers, Missing, Censored, and Incorrect Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="540-time.html">18. Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">Report Bugs or Typos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching_data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com">Author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minimalist Data Wrangling with Python [DRAFTv0.3.1]</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">6. </span>Transforming and Filtering Numeric Data</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="240-distribution-uni.html" class="btn btn-neutral float-right" title="7. Continuous Probability Distributions (*)" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="220-aggregate.html" class="btn btn-neutral float-left" title="5. Aggregating Numeric Data" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="transforming-and-filtering-numeric-data">
<span id="chap-transform-vector"></span><h1><span class="section-number">6. </span>Transforming and Filtering Numeric Data<a class="headerlink" href="#transforming-and-filtering-numeric-data" title="Permalink to this headline"></a></h1>
<blockquote>
<div><p><em>This is an early draft of</em> Minimalist Data Wrangling with Python <em>by
<a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>. It’s distributed
in the hope that it’ll be useful. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">bug/typos reports/fixes</a>
are appreciated. Although available online, this is a whole course,
and should be read from the beginning to the end. In particular,
refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em></p>
</div></blockquote>
<p>It is extremely rare for our datasets to bring interesting
and valid insights out of the box. The ones we are using
for illustrational purposes in the first part of our series have
already been curated. After all, this is an introductory course,
and we need to build up the necessary skills and not overwhelm
the kind reader with too much information at the same time.
We learn simple things first, learn them well, so that then we can move to
more complex matters with a healthy level of confidence.</p>
<p>In real life, various <em>data cleansing</em> and <em>feature engineering</em>
techniques will need to be performed on data.
Generally, most of them can be reduced to
simple operations on vectors:</p>
<ul class="simple">
<li><p>summarising data (for example, computing the median or sum),</p></li>
<li><p>transforming values (applying mathematical operations on each element,
such as subtracting a scalar or taking the natural logarithm),</p></li>
<li><p>filtering (selecting or removing observations
that meet specific criteria,
e.g., those that are larger than the arithmetic mean ± 5 standard
deviations).</p></li>
</ul>
<p>The first topic has already been covered in <a class="reference internal" href="220-aggregate.html#chap-aggregate"><span class="std std-numref">Chapter 5</span></a>,
it is thus time for the two remaining ones.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The same operations we are going to be applying on individual
data frame columns in <a class="reference internal" href="410-dataframe.html#chap-dataframe"><span class="std std-numref">Chapter 11</span></a>.</p>
</div>
<div class="section" id="vectorised-mathematical-functions">
<span id="sec-vecfun"></span><h2><span class="section-number">6.1. </span>Vectorised Mathematical Functions<a class="headerlink" href="#vectorised-mathematical-functions" title="Permalink to this headline"></a></h2>
<p><em>Numpy</em>, just like any other comprehensive numerical computing
package, library, or environment (e.g., R and Julia),
defines many basic mathematical functions:</p>
<ul class="simple">
<li><p>absolute value: <strong class="command">numpy.abs</strong>,</p></li>
<li><p>square and square root: <strong class="command">numpy.square</strong> and <strong class="command">numpy.sqrt</strong>,</p></li>
<li><p>(natural) exponential function: <strong class="command">numpy.exp</strong>,</p></li>
<li><p>logarithms: <strong class="command">numpy.log</strong> (the natural logarithm, i.e., base <em>e</em>),
<strong class="command">numpy.log10</strong> (base 10), etc.,</p></li>
<li><p>trigonometric functions: <strong class="command">numpy.cos</strong>, <strong class="command">numpy.sin</strong>,
<strong class="command">numpy.tan</strong>, etc.,
and their inverses: <strong class="command">numpy.arccos</strong>, etc.</p></li>
<li><p>rounding and truncating: <strong class="command">numpy.round</strong>, <strong class="command">numpy.floor</strong>,
<strong class="command">numpy.ceil</strong>, <strong class="command">numpy.trunc</strong>.</p></li>
</ul>
<p>Each of these functions is <em>vectorised</em>: if we apply, say, <span class="math notranslate nohighlight">\(f\)</span>,
on a vector like <span class="math notranslate nohighlight">\(\boldsymbol{x}=(x_1,\dots,x_n)\)</span>, we
obtain a sequence of the same size
with all elements appropriately transformed:</p>
<div class="math notranslate nohighlight">
\[
f(\boldsymbol{x}) = (f(x_1), f(x_2), \dots, f(x_n)).
\]</div>
<p>We will frequently be using such operations for adjusting the data,
e.g., as in <a class="reference internal" href="240-distribution-uni.html#fig-heights-lognormal"><span class="std std-numref">Figure 7.4</span></a> where
we note that the <em>logarithm</em> of the UK incomes
has a bell-shaped distribution.</p>
<p>For example, the absolute value of a single <span class="math notranslate nohighlight">\(x\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
|x| = \left\{
\begin{array}{ll}
x &amp; \text{if } x \ge 0, \\
-x &amp; \text{otherwise}.
\end{array}
\right.
\end{split}\]</div>
<p>and its vectorised version yields</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1">## array([2, 1, 0, 1, 2, 3])</span>
</pre></div>
</div>
<p>Note that the input list has automatically been converted
to a <strong class="program">numpy</strong> vector.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Thanks to the vectorised functions, our code is not only more
readable, but also it runs faster – as otherwise we would have to employ
a <strong class="command">while</strong> or <strong class="command">for</strong> loop
to traverse through each element in a given sequence.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here are some noteworthy properties of the exponential function
and its inverse, the natural logarithm, that we should know.
By convention, the Euler’s number <span class="math notranslate nohighlight">\(e = \exp(1)\simeq 2.718\)</span>,
<span class="math notranslate nohighlight">\(\exp(x)=e^x\)</span>, and <span class="math notranslate nohighlight">\(\log x = \log_e x\)</span>.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(e^{\log x} = x\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\log e^x = x\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\log (xy) = \log x + \log y\)</span>, <span class="math notranslate nohighlight">\(\log (x/y) = \log x - \log y\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(e^{x+y} = e^x e^y\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\log 1 = 0\)</span>, <span class="math notranslate nohighlight">\(\log e = 1\)</span></p></li>
</ul>
<p>Note that both functions are strictly increasing.
For <span class="math notranslate nohighlight">\(x\ge 1\)</span>, the logarithm grows very slowly whereas the exponential
function increases very rapidly, see Figure <a class="reference internal" href="#fig-log-exp"><span class="std std-numref">Figure 6.1</span></a>.</p>
<p>Further, logarithms are only defined for <span class="math notranslate nohighlight">\(x &gt; 0\)</span>.
In the limit as <span class="math notranslate nohighlight">\(x \to 0\)</span>, we have that <span class="math notranslate nohighlight">\(\log x \to -\infty\)</span>.</p>
<div class="figure align-default" id="id3">
<span id="fig-log-exp"></span><img alt="../_images/log-exp-1.png" src="../_images/log-exp-1.png" />
<p class="caption"><span class="caption-number">Figure 6.1 </span><span class="caption-text">The natural logarithm (left) and the exponential function (right)</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Logarithms of different bases and non-natural exponential function are
also possible. In particular, when drawing plots, we have already used
base-10 logarithmic scales on the axes.
It holds <span class="math notranslate nohighlight">\(\log_{10} x = \frac{\log x}{\log 10}\)</span>
and its inverse is <span class="math notranslate nohighlight">\(10^x\)</span>.</p>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span>
<span class="c1">## array([     nan, -2.     , -1.     ,  0.     ,  0.30103,  0.69897,</span>
<span class="c1">##         1.     ,  2.     ,  3.     ,  4.     ])</span>
<span class="c1">## </span>
<span class="c1">## &lt;string&gt;:1: RuntimeWarning: invalid value encountered in log10</span>
</pre></div>
</div>
<p>Note the warning  and the not-a-number (<code class="docutils literal notranslate"><span class="pre">NaN</span></code>) generated.</p>
<div class="proof proof-type-exercise" id="id4">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.1</span>
        
    </div><div class="proof-content">
<p>Check that when using the log-scale on the OX axis
(<strong class="command">plt.xscale</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;log&quot;)</span></code>), the plot of the logarithm
(of any base) is a straight line. Similarly, the log-scale on the OY axis
(<strong class="command">plt.yscale</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;log&quot;)</span></code>) makes the exponential function
linear.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Trigonometric functions in <strong class="program">numpy</strong> accept angles in radians;
if <span class="math notranslate nohighlight">\(x\)</span> is the degree in angles, then to compute its
cosine we will be thus writing <span class="math notranslate nohighlight">\(\cos (x \pi /180)\)</span> instead;
see <a class="reference internal" href="#fig-cos"><span class="std std-numref">Figure 6.2</span></a>.</p>
<div class="figure align-default" id="id5">
<span id="fig-cos"></span><img alt="../_images/cos-3.png" src="../_images/cos-3.png" />
<p class="caption"><span class="caption-number">Figure 6.2 </span><span class="caption-text">The cosine</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</div>
<p>Some identities worth memorising:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\sin x = \cos(\pi/2 - x)\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\cos(-x) = \cos x\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\cos^2 x + \sin^2 x = 1\)</span>, where <span class="math notranslate nohighlight">\(\cos^2 x = (\cos x)^2\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\cos(x+y) = \cos x \cos y - \sin x \sin y\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\cos(x-y) = \cos x \cos y + \sin x \sin y\)</span>.</p></li>
</ul>
<p>we will refer to them later.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The classical handbook of mathematical functions
and the (in)equalities related to them is <span id="id1">[<a class="reference internal" href="999-bibliography.html#id119">AS72</a>]</span>,
see <span id="id2">[<a class="reference internal" href="999-bibliography.html#id120">O+22</a>]</span> for its updated version.</p>
</div>
</div>
<div class="section" id="arithmetic-operators">
<h2><span class="section-number">6.2. </span>Arithmetic Operators<a class="headerlink" href="#arithmetic-operators" title="Permalink to this headline"></a></h2>
<p>We can apply the standard binary (two-argument) arithmetic operators
`<strong class="command">+</strong>`, `<strong class="command">-</strong>`, `<strong class="command">*</strong>`,
`<strong class="command">/</strong>`, `<strong class="command">**</strong>`, `<strong class="command">%</strong>`,
`<strong class="command">//</strong>` on vectors too.
Below we discuss the possible cases of the operands’ lengths.</p>
<div class="section" id="vector-scalar-case">
<h3><span class="section-number">6.2.1. </span>Vector-Scalar Case<a class="headerlink" href="#vector-scalar-case" title="Permalink to this headline"></a></h3>
<p>Often we will be referring to the binary operators
in contexts where one operand is a vector and the other one is a single
value, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
<span class="c1">## array([4, 1, 0, 1, 4, 9])</span>
<span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
<span class="c1">## array([0. , 0.2, 0.4, 0.6, 0.8, 1. ])</span>
</pre></div>
</div>
<p>In such a case, each element in the vector is being
operated upon (e.g., squared, divided by 5)
and we get a vector of the same length in return.
Hence, in this case the operators behave just like the vectorised
mathematical functions discussed above.</p>
<p>Mathematically, it is common to assume that
scalar multiplication and, less commonly, addition
is performed in this way.</p>
<div class="math notranslate nohighlight">
\[
c \boldsymbol{x} + t = (cx_1+t, cx_2+t, \dots, cx_n+t).
\]</div>
<p>We will also become used to writing, <span class="math notranslate nohighlight">\((\boldsymbol{x}-t)/c\)</span>
which is of course equivalent to <span class="math notranslate nohighlight">\((1/c) \boldsymbol{x} + (-t/c)\)</span>.</p>
</div>
<div class="section" id="application-feature-scaling">
<h3><span class="section-number">6.2.2. </span>Application: Feature Scaling<a class="headerlink" href="#application-feature-scaling" title="Permalink to this headline"></a></h3>
<p>Such vector-scalar operations and aggregation functions are the basis
for the most commonly applied <em>feature scalers</em>,
which can increase the interpretability of data points:</p>
<ul class="simple">
<li><p>standardisation,</p></li>
<li><p>normalisation,</p></li>
<li><p>min-max scaling and clipping,</p></li>
</ul>
<p>bringing them onto a common, unitless scale.
All of them are linear transforms of the form
<span class="math notranslate nohighlight">\(\boldsymbol{y}=c \boldsymbol{x}+t\)</span>,
which geometrically we can interpret as scaling
(stretching or shrinking) and shifting (translating),
see <a class="reference internal" href="#fig-scale-shift"><span class="std std-numref">Figure 6.3</span></a> for an illustration.</p>
<div class="figure align-default" id="id6">
<span id="fig-scale-shift"></span><img alt="../_images/scale-shift-5.png" src="../_images/scale-shift-5.png" />
<p class="caption"><span class="caption-number">Figure 6.3 </span><span class="caption-text">Scaled and shifted versions of a given vector</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Let <span class="math notranslate nohighlight">\(\boldsymbol{y}=c \boldsymbol{x}+t\)</span>
and let <span class="math notranslate nohighlight">\(\bar{x}, \bar{y}, s_x, s_y\)</span> denote the vectors’
arithmetic means and standard deviations.
The following properties hold.</p>
<ul class="simple">
<li><p>the arithmetic mean and all the quantiles (including, of course,
the median), are equivariant with respect to translation and scaling;
it holds, for instance, <span class="math notranslate nohighlight">\(\bar{y} = c \bar{x} + t\)</span>;</p></li>
<li><p>the standard deviation, the interquartile range, and the
range are invariant to translations and equivariant to scaling;
e.g., <span class="math notranslate nohighlight">\(s_y = c s_x\)</span></p></li>
</ul>
<p>As a by-product, for variance we  get of course…
<span class="math notranslate nohighlight">\(s_y^2 = c^2 s_x^2\)</span>.</p>
</div>
<div class="section" id="standardisation-and-z-scores">
<h4><span class="section-number">6.2.2.1. </span>Standardisation and Z-scores<a class="headerlink" href="#standardisation-and-z-scores" title="Permalink to this headline"></a></h4>
<p>Consider the female heights dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/nhanes_adult_female_height_2020.txt&quot;</span><span class="p">)</span>
<span class="n">heights</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="c1"># preview</span>
<span class="c1">## array([157. , 167.4, 159.6, 168.5, 147.8])</span>
</pre></div>
</div>
<p>whose mean <span class="math notranslate nohighlight">\(\bar{x}\)</span> and standard deviation <span class="math notranslate nohighlight">\(s\)</span> are as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">heights</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span>
<span class="c1">## (160.13679222932953, 7.062021850008261)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A <em>standardised</em> version of a vector <span class="math notranslate nohighlight">\(\boldsymbol{x}=(x_1,\dots,x_n)\)</span>
consists in subtracting, from each element, the sample arithmetic mean
(which we call <em>centring</em>) and then dividing it by the standard deviation,
i.e., <span class="math notranslate nohighlight">\(\boldsymbol{z}=(\boldsymbol{x}-\bar{x})/s\)</span>.</p>
</div>
<p>Thus, we transform each <span class="math notranslate nohighlight">\(x_i\)</span> so as to obtain:</p>
<div class="math notranslate nohighlight">
\[
z_i = \frac{x_i-\bar{x}}{s}.
\]</div>
<p>With <strong class="program">numpy</strong>, we simply apply 2 aggregation functions
and 2 arithmetic operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">heights_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">heights</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">heights</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span>
<span class="n">heights_std</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="c1"># preview</span>
<span class="c1">## array([-0.44417764,  1.02848843, -0.07601113,  1.18425119, -1.74692071])</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>What we obtain in result is sometimes referred to as the <em>z-scores</em>.</p>
</div>
<p>Z-scores are nicely interpretable:</p>
<ul class="simple">
<li><p>z-score of 0 corresponds to an observation equal to the sample mean
(perfectly average);</p></li>
<li><p>z-score of 1 is obtained for a datum 1 standard deviation
above the mean;</p></li>
<li><p>z-score of -2 means that it is a value 2 standard deviations
below the mean;</p></li>
</ul>
<p>and so forth.</p>
<p>We should also note that because of the way they emerge,
the mean of z-scores is always 0 and standard deviation is 1
(up to a tiny numerical error, as usual):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">heights_std</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">heights_std</span><span class="p">)</span>
<span class="c1">## (1.8920872660373198e-15, 1.0)</span>
</pre></div>
</div>
<p>Moreover, z-scores are unitless (e.g., the original <code class="docutils literal notranslate"><span class="pre">heights</span></code> were measured
in centimetres).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Standardisation
enables the comparison of measurements on different scales
(think: height in cm vs weight in kg or apples vs oranges).</p>
</div>
<div class="proof proof-type-exercise" id="id7">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.2</span>
        
    </div><div class="proof-content">
<p>We have a patient whose height z-score is 1 and
weight z-score is -1. How to interpret this information?</p>
</div></div><div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.3</span>
        
    </div><div class="proof-content">
<p>How about a patient whose weight z-score is 0
but BMI z-score is 2?</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Standardisation makes most sense for bell-shaped distributions,
in particular normally-distributed ones.
Recalling the 2σ rule for the normal family,
it is <em>expected</em> that 95% of observations should
have z-scores between -2 and 2.
Further, z-scores less than -3 and greater than 3 are highly unlikely.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Sometimes we might be interested in performing some form
of <em>robust</em> standardisation (e.g., for skewed data or
those that feature some outliers). In such a case,
we can replace the mean with the median
and the standard deviation with the IQR.</p>
</div>
</div>
<div class="section" id="min-max-scaling-and-clipping">
<h4><span class="section-number">6.2.2.2. </span>Min-Max Scaling and Clipping<a class="headerlink" href="#min-max-scaling-and-clipping" title="Permalink to this headline"></a></h4>
<p>A less frequently but still noteworthy transformation
is called <em>min-max scaling</em> and
involves subtracting the minimum
and then dividing by the range.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.33</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1">## array([0.   , 0.4  , 1.   , 0.034, 0.35 , 0.46 ])</span>
</pre></div>
</div>
<p>Here, the smallest value is mapped to 0 and the
largest one is equal to 1.
Note that 0.5 does not mean that the value is equal to the mean
(unless we are very lucky!).</p>
<div style="margin-top: 1em"></div><p>Also, <em>clipping</em> can be used to replace all values less than
0 with 0 and those greater than 1 with 1.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">## array([0.  , 0.5 , 1.  , 0.  , 0.25, 0.8 ])</span>
</pre></div>
</div>
<p>The function is of course flexible; another popular choice is
clipping to <em>[-1, 1]</em>.
This can also be implemented manually by means of the vectorised pairwise
minimum and maximum functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="c1">## array([0.  , 0.5 , 1.  , 0.  , 0.25, 0.8 ])</span>
</pre></div>
</div>
</div>
<div class="section" id="normalisation-l-2-dividing-by-length">
<h4><span class="section-number">6.2.2.3. </span>Normalisation (<span class="math notranslate nohighlight">\(l_2\)</span>; Dividing by Length) (*)<a class="headerlink" href="#normalisation-l-2-dividing-by-length" title="Permalink to this headline"></a></h4>
<p><em>Normalisation</em> is the scaling of a given vector so that it is of
<em>unit length</em>. Usually, by <em>length</em> we mean the square root of the sum of
squares, i.e., the Euclidean (<span class="math notranslate nohighlight">\(l^2\)</span>) norm:</p>
<div class="math notranslate nohighlight">
\[
\| (x_1,\dots,x_n) \| = \sqrt{
x_1^2 + x_2^2 + \dots + x_n^2
} = \sqrt{
\sum_{i=1}^n x_i^2
},
\]</div>
<p>Its special case for <em>n=2</em> we know well from high school:
the length of a vector <span class="math notranslate nohighlight">\((a,b)\)</span>
is <span class="math notranslate nohighlight">\(\sqrt{a^2+b^2}\)</span>, e.g., <span class="math notranslate nohighlight">\(\|(1, 2)\| = \sqrt{5} \simeq 2.236\)</span>.
Also, it’s good to program our brains so that when
next time we see <span class="math notranslate nohighlight">\(\| \boldsymbol{x} \|^2\)</span>, we immediately
think of the <em>sum of squares</em>.</p>
<p>We can thus write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
<span class="n">x</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># x divided by the Euclidean norm of x</span>
<span class="c1">## array([ 0.13834289,  0.69171446, -0.55337157,  0.27668579,  0.34585723])</span>
</pre></div>
</div>
<p>to mean the normalised vector</p>
<div class="math notranslate nohighlight">
\[
\frac{\boldsymbol{x}}{\| \boldsymbol{x} \|} =
\left(
\frac{x_1}{\| \boldsymbol{x} \|},
\frac{x_2}{\| \boldsymbol{x} \|},
\dots,
\frac{x_n}{\| \boldsymbol{x} \|}
\right).
\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that normalisation is very similar to standardisation if data are
already centred (when mean was subtracted). Actually, we can obtain one
from the other via scaling by <span class="math notranslate nohighlight">\(\sqrt{n}\)</span>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A common confusion is that normalisation is supposed to make
data more “normally” distributed. This is not the case, as we only
scale (stretch or shrink) the observations here.</p>
</div>
</div>
<div class="section" id="normalisation-l-1-dividing-by-sum">
<h4><span class="section-number">6.2.2.4. </span>Normalisation (<span class="math notranslate nohighlight">\(l_1\)</span>; Dividing by Sum) (*)<a class="headerlink" href="#normalisation-l-1-dividing-by-sum" title="Permalink to this headline"></a></h4>
<p>At other times, by <em>length</em> we can also mean the Manhattan (<span class="math notranslate nohighlight">\(l^1\)</span>) norm,</p>
<div class="math notranslate nohighlight">
\[
\| (x_1,\dots,x_n) \|_1 = |x_1| + |x_2| + \dots + |x_n| = \sum_{i=1}^n |x_i|,
\]</div>
<p>being the sum of absolute values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1">## array([ 0.06896552,  0.34482759, -0.27586207,  0.13793103,  0.17241379])</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(l_1\)</span> normalisation is frequently applied on vectors of nonnegative values,
whose normalised versions can be interpreted as <em>probabilities</em>
or <em>proportions</em>: values between 0 and 1 which sum to 1 (or, equivalently,
100%). In particular, on binned data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">heights</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># counts</span>
<span class="c1">## [ 306 1776 1773  366]</span>
</pre></div>
</div>
<p>And now, converting the counts to
empirical probabilities:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="c1">## [0.07249467 0.42075338 0.42004264 0.08670931]</span>
</pre></div>
</div>
<p>We did not apply <strong class="program">numpy.abs</strong>, because the values were already nonnegative.</p>
</div>
</div>
<div class="section" id="vector-vector-case">
<h3><span class="section-number">6.2.3. </span>Vector-Vector Case<a class="headerlink" href="#vector-vector-case" title="Permalink to this headline"></a></h3>
<p>The arithmetic operators can also be applied
on two vectors of equal lengths.
In such a case, they will act <em>elementwisely</em>:
taking each element from the first operand
and combining it with the <em>corresponding</em> element from the second argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span>
<span class="c1">## array([   20,   300,  4000, 50000])</span>
</pre></div>
</div>
<p>We see that the first element in the left operand (2)
was multiplied by the first element in the right operand (10).
Then, we computed 3*100 (the second elements), and so forth.</p>
<p>Such a behaviour of the binary operators
is inspired by the usual convention in vector algebra
where applying <span class="math notranslate nohighlight">\(+\)</span> (or <span class="math notranslate nohighlight">\(-\)</span>) on <span class="math notranslate nohighlight">\(\boldsymbol{x}=(x_1,\dots,x_n)\)</span>
and <span class="math notranslate nohighlight">\(\boldsymbol{y}=(y_1,\dots,y_n)\)</span> means exactly:</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{x}+\boldsymbol{y} = (x_1+y_1, x_2+y_2, \dots, x_n+y_n).
\]</div>
<p>Using other operators this way (elementwisely)
is less standard in mathematics (for instance multiplication
might denote the dot product), but in <strong class="program">numpy</strong>
it is really convenient.</p>
<div class="proof proof-type-example" id="id9">

    <div class="proof-title">
        <span class="proof-type">Example 6.4</span>
        
    </div><div class="proof-content">
<p>Another example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">])</span>  <span class="c1"># example vector</span>
<span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="c1">## 1.6790818544987114</span>
</pre></div>
</div>
<p>computes the value of the expression
<span class="math notranslate nohighlight">\(h = - (p_1\, \log p_1 + \dots + p_n\, \log p_n)\)</span>,
i.e., <span class="math notranslate nohighlight">\(h=-\sum_{i=1}^n p_i\, \log p_i\)</span>.
Note that it involves the use of a unary vectorised
minus (change sign), an aggregation function (sum),
a vectorised mathematical function (log),
and an elementwise multiplication.</p>
</div></div><div class="proof proof-type-example" id="id10">

    <div class="proof-title">
        <span class="proof-type">Example 6.5</span>
        
    </div><div class="proof-content">
<p>Let us assume that – for whatever the reason – we would like to
plot two mathematical functions, the sine, <span class="math notranslate nohighlight">\(f(x)= \sin x\)</span>
and a polynomial of degree 7, <span class="math notranslate nohighlight">\(g(x) = x - x^3/6 + x^5/120 - x^7/5040\)</span>
for <span class="math notranslate nohighlight">\(x\)</span> in the interval <span class="math notranslate nohighlight">\([-\pi, 3\pi/2]\)</span>.</p>
<p>To do this, we can probe the values of <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> at sufficiently many points
using the vectorised operations discussed so far
and then use the <strong class="command">matplotlib.pyplot.plot</strong> function
to draw what we see in <a class="reference internal" href="#fig-vectorised-easy"><span class="std std-numref">Figure 6.4</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>  <span class="c1"># many points in the said interval</span>
<span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">yg</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="mi">120</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">7</span><span class="o">/</span><span class="mi">5040</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f(x)&quot;</span><span class="p">)</span>  <span class="c1"># red solid line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yg</span><span class="p">,</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;g(x)&quot;</span><span class="p">)</span>  <span class="c1"># blue dotted line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id11">
<span id="fig-vectorised-easy"></span><img alt="../_images/vectorised-easy-7.png" src="../_images/vectorised-easy-7.png" />
<p class="caption"><span class="caption-number">Figure 6.4 </span><span class="caption-text">With vectorised functions, it is easy to generate plots such as this one</span><a class="headerlink" href="#id11" title="Permalink to this image"></a></p>
</div>
<p>Note that decreasing the number of points in <code class="docutils literal notranslate"><span class="pre">x</span></code> will reveal that the
plotting function merely draws a series of straight line segments.</p>
</div></div><div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.6</span>
        
    </div><div class="proof-content">
<p>Based on the
<a class="reference external" href="https://github.com/gagolews/teaching_data/blob/master/marek/nhanes_adult_female_height_2020.txt"><code class="docutils literal notranslate"><span class="pre">nhanes_adult_female_height_2020</span></code></a>
and
<a class="reference external" href="https://github.com/gagolews/teaching_data/blob/master/marek/nhanes_adult_female_weight_2020.txt"><code class="docutils literal notranslate"><span class="pre">nhanes_adult_female_weight_2020</span></code></a>
datasets (discussed in the
part on histograms), using a single line of code,
compute the vector of BMIs of all persons.</p>
</div></div></div>
</div>
<div class="section" id="vector-indexing">
<span id="sec-vector-indexing"></span><h2><span class="section-number">6.3. </span>Vector Indexing<a class="headerlink" href="#vector-indexing" title="Permalink to this headline"></a></h2>
<p>Recall that sequential objects in Python
(lists, tuples, strings, ranges) support indexing
using scalars and slices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># scalar index - extract</span>
<span class="c1">## 20</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># slice index - subset</span>
<span class="c1">## [20]</span>
</pre></div>
</div>
<p><strong class="program">numpy</strong> vectors additionally support  two other indexing schemes:
using integer and boolean sequences.</p>
<div class="section" id="integer-indexing">
<h3><span class="section-number">6.3.1. </span>Integer Indexing<a class="headerlink" href="#integer-indexing" title="Permalink to this headline"></a></h3>
<p>Indexing with a single integer <em>extracts</em>
a particular element:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># first, second, last</span>
<span class="c1">## (10, 20, 50)</span>
</pre></div>
</div>
<p>We can also use lists of vector of integer indexes,
which return a subvector with elements at the specified indices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span> <span class="n">x</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span> <span class="n">x</span><span class="p">[</span> <span class="p">[]</span> <span class="p">],</span> <span class="n">x</span><span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## (array([10]), array([10, 20, 50]), array([], dtype=int64), array([10, 20, 10, 10]))</span>
</pre></div>
</div>
<p>Note that we added some spaces between the square brackets,
because, for example, <code class="docutils literal notranslate"><span class="pre">x[[0,</span> <span class="pre">1,</span> <span class="pre">-1]]</span></code> might look slightly more
enigmatic (What are these double square brackets?
Nah, it is a list inside the index operator).</p>
</div>
<div class="section" id="logical-indexing">
<h3><span class="section-number">6.3.2. </span>Logical Indexing<a class="headerlink" href="#logical-indexing" title="Permalink to this headline"></a></h3>
<p>Subsetting using a vector of the same length as the indexed
vector is possible too:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="p">]</span>
<span class="c1">## array([10, 30, 40])</span>
</pre></div>
</div>
<p>Returned the 1st, 3rd, and 4th element
(select 1st, don’t select 2nd, select 3rd, select 4th, don’t select 5th).</p>
<p>This is particularly useful as a <em>data filtering</em> technique.
Knowing that the relational operators `<strong class="command">&lt;</strong>`, `<strong class="command">&lt;=</strong>`,
`<strong class="command">==</strong>`, `<strong class="command">!=</strong>`,
`<strong class="command">&gt;=</strong>`, and `<strong class="command">&gt;</strong>` on vectors are also performed elementwisely
(just like `<strong class="command">+</strong>`, `<strong class="command">*</strong>`, etc.), for instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">30</span>
<span class="c1">## array([False, False,  True,  True,  True])</span>
</pre></div>
</div>
<p>we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">30</span> <span class="p">]</span>
<span class="c1">## array([30, 40, 50])</span>
</pre></div>
</div>
<p>to mean “select those elements in <code class="docutils literal notranslate"><span class="pre">x</span></code> which are not less than 30”.</p>
<div style="margin-top: 1em"></div><p>Of course, the indexed vector and the vector
used in comparisons do not have to be the same:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
<span class="n">y</span>  <span class="c1"># 0 if a number is a multiply of 10 times an even number</span>
<span class="c1">## array([1., 0., 1., 0., 1.])</span>
<span class="n">x</span><span class="p">[</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">]</span>
<span class="c1">## array([20, 40])</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If we would like to combine many logical vectors, unfortunately we cannot
use the <strong class="command">and</strong>, <strong class="command">or</strong>, and <strong class="command">not</strong> operators,
because they are not vectorised (this is a limitation of our language
per se).</p>
<p><strong class="program">numpy</strong> uses the `<strong class="command">&amp;</strong>`, `<strong class="command">|</strong>`,
and `<strong class="command">~</strong>` operators,
which unfortunately have lower order of precedence than
`<strong class="command">&lt;</strong>`, `<strong class="command">&lt;=</strong>`, `<strong class="command">==</strong>`, etc.
Therefore, the bracketing of the comparisons is obligatory.</p>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span> <span class="p">(</span><span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">)</span> <span class="p">]</span>  <span class="c1"># check what happens if we skip the brackets</span>
<span class="c1">## array([20, 30, 40])</span>
</pre></div>
</div>
<p>means “elements in <code class="docutils literal notranslate"><span class="pre">x</span></code> between 20 and 40”
(greater than or equal to 20 and less than or equal to 40).</p>
<div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.7</span>
        
    </div><div class="proof-content">
<p>Compute the BMIs only of the persons whose
height is between 150 and 170 cm.</p>
</div></div></div>
<div class="section" id="slicing">
<h3><span class="section-number">6.3.3. </span>Slicing<a class="headerlink" href="#slicing" title="Permalink to this headline"></a></h3>
<p>Just as with ordinary lists,
slicing with “<code class="docutils literal notranslate"><span class="pre">:</span></code>” can be used to fetch the elements
at indexes in a given range <code class="docutils literal notranslate"><span class="pre">from:to</span></code> or <code class="docutils literal notranslate"><span class="pre">from:to:by</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">## (array([50, 40, 30, 20, 10]), array([40, 50]), array([20, 30, 40]))</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>(*)
For efficiency reasons, slicing returns a
<em>view</em> on existing data – it does not make an independent
copy of the subsetted elements.</p>
</div>
<p>In other words, both <code class="docutils literal notranslate"><span class="pre">x</span></code> and its sliced version share the same memory.
This is important when we apply operations which modify a
given vector in place, such as the <code class="docutils literal notranslate"><span class="pre">sort</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">y</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">y</span>
<span class="c1">## array([1, 4, 2, 5, 6, 3, 7, 9, 8])</span>
</pre></div>
</div>
<p>This sorted every second element in <code class="docutils literal notranslate"><span class="pre">y</span></code>
(i.e., <code class="docutils literal notranslate"><span class="pre">[6,</span> <span class="pre">8,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">7]</span></code> was rearranged so as to obtain
<code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">6,</span> <span class="pre">7,</span> <span class="pre">8]</span></code>).</p>
<p>Indexing with an integer or logical vector always returns a copy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">y</span>
<span class="c1">## array([1, 4, 2, 5, 6, 3, 7, 9, 8])</span>
</pre></div>
</div>
<p>This <em>did not</em> modify the original vector.</p>
</div>
</div>
<div class="section" id="other-operations">
<h2><span class="section-number">6.4. </span>Other Operations<a class="headerlink" href="#other-operations" title="Permalink to this headline"></a></h2>
<div class="section" id="sorting-and-ranking">
<h3><span class="section-number">6.4.1. </span>Sorting and Ranking<a class="headerlink" href="#sorting-and-ranking" title="Permalink to this headline"></a></h3>
<p>The <strong class="command">numpy.sort</strong> function returns a sorted copy of the given vector,
i.e., determines the order statistics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## array([10, 20, 30, 40, 50, 50])</span>
</pre></div>
</div>
<p>Recall that <code class="docutils literal notranslate"><span class="pre">x.sort()</span></code> sorts the vector in-place.</p>
<div style="margin-top: 1em"></div><p>Next, <strong class="command">scipy.stats.rankdata</strong> returns a vector of <em>ranks</em>,
which is the inverse of <strong class="command">numpy.argsort</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## array([1. , 3. , 5.5, 4. , 2. , 5.5])</span>
</pre></div>
</div>
<p>Element 10 is the smallest (“the winner”, say, the quickest racer),
hence it has rank 1.
Next is element 30, which is the 3rd on the podium, hence its rank is 3.</p>
<div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.8</span>
        
    </div><div class="proof-content">
<p>Consult the manual page of
<strong class="program">scipy.stats.rankdata</strong> and test various methods for dealing
with <em>tied</em> elements, e.g., a situation where some values
are nonunique (for instance, when two racers finished in exactly
the same time).</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
There are many methods in nonparametric statistics
(those that do not make any too particular assumptions
about the underlying data distribution) that are based on ranks,
e.g., the Spearman correlation coefficient which we cover later.</p>
</div>
<p><strong class="command">numpy.argsort</strong> returns a sequence of indexes that
lead to an ordered version of a given vector
(i.e., an ordering permutation).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## array([0, 4, 1, 3, 2, 5])</span>
</pre></div>
</div>
<p>Which means that the smallest element is at index 0,
then the 2nd smallest is at index 4, 3rd smallest at index 1, etc.
Therefore:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
<span class="c1">## array([10, 20, 30, 40, 50, 50])</span>
</pre></div>
</div>
<p>is equivalent to <strong class="command">numpy.sort</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>.</p>
<div style="margin-top: 1em"></div><p>On a side note, <strong class="command">numpy.random.permutation</strong> rearranges
the elements in a given vector.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**)
If there are tied observations in a vector <code class="docutils literal notranslate"><span class="pre">x</span></code>,
<strong class="command">numpy.argsort</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">kind=&quot;stable&quot;)</span></code> will use
a <em>stable</em> sorting algorithm
(<a class="reference external" href="https://github.com/python/cpython/blob/3.7/Objects/listsort.txt">timsort</a>,
a variant of mergesort), which guarantees that the ordering
permutation is unique: tied elements are placed in order of appearance</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**)
Readers with some background in discrete mathematics
will be interested in the fact that
calling <strong class="command">numpy.argsort</strong> on a vector representing a permutation of elements
in fact generates its inverse.
In particular, <strong class="command">np.argsort</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">np.argsort</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">kind=&quot;stable&quot;))+1</span></code>
is equivalent to <strong class="command">scipy.stats.rankdata</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">method=&quot;ordinal&quot;)</span></code>.</p>
</div>
</div>
<div class="section" id="searching-for-certain-indexes-argmin-argmax">
<h3><span class="section-number">6.4.2. </span>Searching for Certain Indexes (Argmin, Argmax)<a class="headerlink" href="#searching-for-certain-indexes-argmin-argmax" title="Permalink to this headline"></a></h3>
<p><strong class="command">numpy.argmin</strong> and <strong class="command">numpy.argmax</strong> return the index at
which we can find the smallest and the largest observation
in a given vector.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## (0, 2)</span>
</pre></div>
</div>
<p>Note that if there are tied observations,
the smallest index is returned.</p>
<p>Mathematically, for example, we write</p>
<div class="math notranslate nohighlight">
\[
i = \mathrm{arg}\min_j x_j
\]</div>
<p>(read: <span class="math notranslate nohighlight">\(i\)</span> is the index of the smallest element in the sequence;
it is the <em>argument of the minimum</em>),
whenever</p>
<div class="math notranslate nohighlight">
\[
x_i = \min_j x_j
\]</div>
<p>(read: the <span class="math notranslate nohighlight">\(i\)</span>-th element is the smallest).</p>
<div style="margin-top: 1em"></div><p>We can use <strong class="command">numpy.flatnonzero</strong> to fetch the indexes
where a logical vector has elements equal to <code class="docutils literal notranslate"><span class="pre">True</span></code>
(in <a class="reference internal" href="420-categorical.html#sec-binary-logical"><span class="std std-numref">Section 12.1.3</span></a> we note the a value equal
to zero is treated as the logical <code class="docutils literal notranslate"><span class="pre">False</span></code>, and as <code class="docutils literal notranslate"><span class="pre">True</span></code> in all
other cases).
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1">## array([2, 5])</span>
</pre></div>
</div>
<p>This is a version of <strong class="command">numpy.argmax</strong> that lets us decide
what we would like to do with the tied maxima.</p>
<div class="proof proof-type-exercise" id="id15">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.9</span>
        
    </div><div class="proof-content">
<p>Let <code class="docutils literal notranslate"><span class="pre">x</span></code> be a vector with possible ties.
Write an expression that returns a randomly chosen index
pinpointing one of the sample maximums.</p>
</div></div></div>
<div class="section" id="cumulative-sums-and-iterated-differences">
<h3><span class="section-number">6.4.3. </span>Cumulative Sums and Iterated Differences<a class="headerlink" href="#cumulative-sums-and-iterated-differences" title="Permalink to this headline"></a></h3>
<p>Recall that the `<strong class="command">+</strong>` operator acts elementwisely on two vectors
and that the <strong class="command">numpy.sum</strong> function aggregates all values into
a single one. We have one more similar function, but vectorised
in a slightly different fashion. Namely, <strong class="command">numpy.cumsum</strong>
returns the vector of <em>cumulative sums</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1">## array([5, 8, 4, 5, 6, 9])</span>
</pre></div>
</div>
<p>gave, in this order: the first element, the sum of first two elements,
the sum of first three elements, …, the sum of all elements.</p>
<div style="margin-top: 1em"></div><p>Further, <em>iterative differences</em> are a somewhat inverse operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="c1">## array([ 3, -4,  1,  1,  3])</span>
</pre></div>
</div>
<p>returned the difference between the 2nd and 1st element,
then the difference between the 3rd and the 2nd, and so forth.
The resulting vector is 1 element shorter than the input one.</p>
<div style="margin-top: 1em"></div><p>We often make use of cumulative sums and iterated differences when
processing time series, e.g., stock exchange data
(e.g., by how much the price changed since the previous day?;
<a class="reference internal" href="540-time.html#sec-diff-ts"><span class="std std-numref">Section 18.3.1</span></a>)
or cumulative distribution functions (<a class="reference internal" href="210-vector.html#sec-ecdf"><span class="std std-numref">Section 4.4</span></a>).</p>
</div>
<div class="section" id="vectorising-scalar-operations-with-list-comprehensions">
<span id="sec-list-comprehension"></span><h3><span class="section-number">6.4.4. </span>Vectorising Scalar Operations with List Comprehensions (*)<a class="headerlink" href="#vectorising-scalar-operations-with-list-comprehensions" title="Permalink to this headline"></a></h3>
<p><em>List comprehensions</em> of the form
<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">expression</span> </code><strong class="command">for</strong><code class="code docutils literal notranslate"> <span class="pre">name</span> </code><strong class="command">in</strong><code class="code docutils literal notranslate"> <span class="pre">iterable</span> <span class="pre">]</span></code>
are part of base Python.
They allow us to create lists based on transformed versions
of individual elements in a given iterable object.
Hence, they might work in cases where a task at hand
cannot be solved by means of vectorised <strong class="program">numpy</strong> functions.</p>
<p>For example, here is a way to generate squares of 10 first natural numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="p">]</span>
<span class="c1">## [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span>
</pre></div>
</div>
<p>The result can be passed to <strong class="command">numpy.array</strong> to convert it to a vector.</p>
<p>And if we wish to filter our all elements that are not greater
than 0, we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># make pseudorandom number generation reproducible</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">[</span> <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">]</span>
<span class="c1">## [0.39, 0.1, 0.44, 0.96, 0.37]</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Further, we can use the ternary operator of the form
<code class="docutils literal notranslate"><span class="pre">x_true</span> </code><strong class="command">if</strong><code class="code docutils literal notranslate"> <span class="pre">cond</span> </code><strong class="command">else</strong><code class="code docutils literal notranslate"> <span class="pre">x_false</span></code>
to return either <code class="docutils literal notranslate"><span class="pre">x_true</span></code> or
<code class="docutils literal notranslate"><span class="pre">x_false</span></code> depending on the truth value of <code class="docutils literal notranslate"><span class="pre">cond</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">e</span><span class="o">**</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="c1">## 1.4142135623730951</span>
</pre></div>
</div>
<p>Combined with a list comprehension, we can write, for instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="nb">round</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">]</span>
<span class="c1">## [0.62, 0.66, 0.74, 0.32, 0.66, 0.39, 0.98, 0.61, 0.2, 0.47]</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.10</span>
        
    </div><div class="proof-content">
<p>Write equivalent versions of the above expressions
using vectorised <strong class="program">numpy</strong> functions.</p>
</div></div><div class="proof proof-type-exercise" id="id17">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.11</span>
        
    </div><div class="proof-content">
<p>Write equivalent versions of the above expressions
using base Python lists,
the <strong class="command">for</strong> loop and the <strong class="command">list.append</strong> method (start from
an empty list which will store the result).</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is also a tool which vectorises a scalar function
so that it can be used on <strong class="program">numpy</strong> vectors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clip1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>    <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>        <span class="k">return</span> <span class="n">x</span>

<span class="n">clip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">clip1</span><span class="p">)</span>  <span class="c1"># returns a function object</span>
<span class="n">clip</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="c1">## array([0.3, 0. , 0.7, 1. , 1. ])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercises">
<h2><span class="section-number">6.5. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline"></a></h2>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.12</span>
        
    </div><div class="proof-content">
<p>Give the mathematical definitions, use cases, and interpretations
of standardisation, normalisation, and min-max scaling.</p>
</div></div><div class="proof proof-type-exercise" id="id19">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.13</span>
        
    </div><div class="proof-content">
<p>How are <strong class="command">numpy.log</strong> and <strong class="command">numpy.exp</strong> related to each other?
How about <strong class="command">numpy.log</strong> vs <strong class="command">numpy.log10</strong>,
<strong class="command">numpy.cumsum</strong> vs <strong class="command">numpy.diff</strong>,
<strong class="command">numpy.min</strong> vs <strong class="command">numpy.argmin</strong>,
<strong class="command">numpy.sort</strong> vs <strong class="command">numpy.argsort</strong>,  and
<strong class="command">scipy.stats.rankdata</strong> vs <strong class="command">numpy.argsort</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.14</span>
        
    </div><div class="proof-content">
<p>What is the difference between
<strong class="command">numpy.trunc</strong>, <strong class="command">numpy.floor</strong>, <strong class="command">numpy.ceil</strong>,
and <strong class="command">numpy.round</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.15</span>
        
    </div><div class="proof-content">
<p>What happens when we apply `<strong class="command">+</strong>` on two vectors of different
lengths?</p>
</div></div><div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.16</span>
        
    </div><div class="proof-content">
<p>List the four ways to index a vector.</p>
</div></div><div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.17</span>
        
    </div><div class="proof-content">
<p>What is wrong with the expression
<code class="docutils literal notranslate"><span class="pre">x[</span> <span class="pre">x</span> <span class="pre">&gt;=</span> <span class="pre">0</span> <span class="pre">and</span> <span class="pre">x</span> <span class="pre">&lt;=</span> <span class="pre">1</span> <span class="pre">]</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> is a numeric vector?
How about <code class="docutils literal notranslate"><span class="pre">x[</span> <span class="pre">x</span> <span class="pre">&gt;=</span> <span class="pre">0</span> <span class="pre">&amp;</span> <span class="pre">x</span> <span class="pre">&lt;=</span> <span class="pre">1</span> <span class="pre">]</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 6.18</span>
        
    </div><div class="proof-content">
<p>(*) What does it mean that slicing returns a view on existing data?</p>
</div></div></div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="240-distribution-uni.html" class="btn btn-neutral float-right" title="7. Continuous Probability Distributions (*)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="220-aggregate.html" class="btn btn-neutral float-left" title="5. Aggregating Numeric Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Marek Gagolewski. Licensed under CC BY-NC-ND 4.0.
      <span class="lastupdated">
        Last updated on 2022-05-23T17:58:17+1000.
      </span>
    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a> theme.
    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>