<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2021, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>13. ðŸš§ Multivariate Categorical and Relational Data &mdash; Minimalist Data Wrangling with Python by Marek Gagolewski</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://datawranglingpy.gagolewski.com/chapter/340-categorical-multi.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="14. ðŸš§ Introduction to Data Frames in pandas" href="410-dataframe.html" />
    <link rel="prev" title="12. ðŸš§ Visualising Multidimensional Data and Measuring Correlation" href="330-visualise-multi.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Minimalist Data Wrangling with Python [DRAFTv0.1.1]
          

          
          </a>

          <div class="version">
          by <a style="color: inherit" href="https://www.gagolewski.com">Marek Gagolewski</a>
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-jupyter.html">1. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-scalar.html">2. Scalar Types in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-sequential.html">3. Sequential and Other Types in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unidimensional Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-vector.html">4. Introduction to Vectors in <strong class="program">numpy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="220-histogram.html">5. Inspecting the Distribution of Numeric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-aggregate.html">6. Descriptive Statistics for Numeric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-transform-uni.html">7. Transforming and Filtering Numeric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-distribution-uni.html">8. ðŸš§ Continuous Probability Distributions (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="260-categorical-uni.html">9. ðŸš§ Handling Categorical Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multidimensional Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="310-matrix.html">10. Introduction to Matrices in <strong class="program">numpy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="320-transform-multi.html">11. ðŸš§ Transforming, Aggregating, and Filtering Multidimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-visualise-multi.html">12. ðŸš§ Visualising Multidimensional Data and Measuring Correlation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">13. ðŸš§ Multivariate Categorical and Relational Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#two-way-contingency-tables">13.1. Two-Way Contingency Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualising">13.2. Visualising</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#heat-map">13.2.1. Heat Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bar-plot">13.2.2. Bar Plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#higher-order-contingency-tables">13.3. Higher-Order Contingency Tables (*)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#measuring-association">13.4. Measuring Association (*)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#questions">13.5. Questions</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Heterogeneous Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="410-dataframe.html">14. ðŸš§ Introduction to Data Frames in <strong class="program">pandas</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="420-transform-hetero.html">15. ðŸš§ Basic Operations on Data Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="430-reshape.html">16. ðŸš§ Reshaping and Fusing Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="440-groupby.html">17. ðŸš§ Observation Grouping</a></li>
<li class="toctree-l1"><a class="reference internal" href="450-sql.html">18. Database Access</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text and Other Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="510-text.html">19. Working with Text Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="520-regex.html">20. Regular Expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="530-missingness.html">21. Outliers, Missing, Censored, and Incorrect Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="540-time.html">22. Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/datawranglingpy.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">Report Bugs or Typos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching_data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com">Author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minimalist Data Wrangling with Python [DRAFTv0.1.1]</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">13. </span>ðŸš§ Multivariate Categorical and Relational Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="410-dataframe.html" class="btn btn-neutral float-right" title="14. ðŸš§ Introduction to Data Frames in pandas" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="330-visualise-multi.html" class="btn btn-neutral float-left" title="12. ðŸš§ Visualising Multidimensional Data and Measuring Correlation" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="multivariate-categorical-and-relational-data">
<span id="chap-categorical-multi"></span><h1><span class="section-number">13. </span>ðŸš§ Multivariate Categorical and Relational Data<a class="headerlink" href="#multivariate-categorical-and-relational-data" title="Permalink to this headline">Â¶</a></h1>
<blockquote>
<div><p><em>This is an early draft of</em> Minimalist Data Wrangling with Python <em>by
<a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>. It is distributed
in the hope that it will be useful. Any
<a class="reference external" href="https://github.com/gagolews/datawranglingpy/blob/master/CODE_OF_CONDUCT.md">bug/typos reports/fixes</a>
are appreciated. Although available online, this is a whole course,
and should be read from the beginning to the end. In particular,
refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em></p>
</div></blockquote>
<p>Some datasets may feature many categorical columns,
each having possibly different levels.</p>
<p>Let us consider the data on the top 1000 marathoners
(held in Warsaw in 2015):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">marathon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/gagolews/&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;teaching_data/master/marek/37_pzu_warsaw_marathon_3groups_top1000.txt&quot;</span><span class="p">,</span>
    <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">marathon</span><span class="p">[:</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># preview</span>
<span class="c1">## array([[&#39;M&#39;, &#39;20&#39;, &#39;KE&#39;],</span>
<span class="c1">##        [&#39;M&#39;, &#39;20&#39;, &#39;KE&#39;],</span>
<span class="c1">##        [&#39;M&#39;, &#39;20&#39;, &#39;KE&#39;],</span>
<span class="c1">##        [&#39;M&#39;, &#39;20&#39;, &#39;ET&#39;],</span>
<span class="c1">##        [&#39;M&#39;, &#39;30&#39;, &#39;KE&#39;],</span>
<span class="c1">##        [&#39;M&#39;, &#39;30&#39;, &#39;KE&#39;]], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>The three columns are: sex, age category (in 10-year brackets),
and country.
We can of course analyse the data distribution
in each column individually (based on the tools
discussed in the section on the processing of unidimensional categorical data),
however, some interesting patterns might also arise when we study the
<em>combinations</em> of levels of different variables.</p>
<div class="section" id="two-way-contingency-tables">
<h2><span class="section-number">13.1. </span>Two-Way Contingency Tables<a class="headerlink" href="#two-way-contingency-tables" title="Permalink to this headline">Â¶</a></h2>
<p>Here are the levels of the first two variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">marathon</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1">## array([&#39;F&#39;, &#39;M&#39;], dtype=&#39;&lt;U2&#39;)</span>
<span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">marathon</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1">## array([&#39;20&#39;, &#39;30&#39;, &#39;40&#39;, &#39;50&#39;, &#39;60&#39;], dtype=&#39;&lt;U2&#39;)</span>
</pre></div>
</div>
<p>We thus have 10 different possible combinations thereof.</p>
<p>A two-way <em>contingency table</em> is a matrix which gives
the number of occurrences of each pair of values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="n">l</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">contingency</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">marathon</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">marathon</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">l</span><span class="p">,</span> <span class="n">v</span>
<span class="c1">## ((array([&#39;F&#39;, &#39;M&#39;], dtype=&#39;&lt;U2&#39;), array([&#39;20&#39;, &#39;30&#39;, &#39;40&#39;, &#39;50&#39;, &#39;60&#39;], dtype=&#39;&lt;U2&#39;)), array([[ 17,  23,   8,   1,   0],</span>
<span class="c1">##        [158, 433, 278,  73,   9]]))</span>
</pre></div>
</div>
<p>This is not quite readable, hence we have written
our own function to print it out much more nicely:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">marek</span>
<span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="c1">##       20  30  40  50  60</span>
<span class="c1">##    F  17  23   8   1   0</span>
<span class="c1">##    M 158 433 278  73   9</span>
</pre></div>
</div>
<p>Hence, for example, there were 9 men aged 60-69 amongst the top 1000 runners.
Nice.</p>
<p>Note that the <em>marginal</em> (one dimensional) frequency distributions
can be recreated by computing the rowwise and columnwise sums.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">##    F   M</span>
<span class="c1">##   49 951</span>
<span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="c1">##   20  30  40  50  60</span>
<span class="c1">##  175 456 286  74   9</span>
</pre></div>
</div>
</div>
<div class="section" id="visualising">
<h2><span class="section-number">13.2. </span>Visualising<a class="headerlink" href="#visualising" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="heat-map">
<h3><span class="section-number">13.2.1. </span>Heat Map<a class="headerlink" href="#heat-map" title="Permalink to this headline">Â¶</a></h3>
<p>Two-way contingency tables can be depicted by means of a heatmap,
where the element value affects the corresponding cellâ€™s colour intensity.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;copper&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id1">
<span id="fig-340-categorical-multi-8"></span><img alt="../_images/340-categorical-multi-8-1.png" src="../_images/340-categorical-multi-8-1.png" />
<p class="caption"><span class="caption-number">Figure 13.1 </span><span class="caption-text">plot of chunk 340-categorical-multi-8</span><a class="headerlink" href="#id1" title="Permalink to this image">Â¶</a></p>
</div>
</div>
<div class="section" id="bar-plot">
<h3><span class="section-number">13.2.2. </span>Bar Plot<a class="headerlink" href="#bar-plot" title="Permalink to this headline">Â¶</a></h3>
<p>A good old bar plot is a versatile tool for visualising
counts also in the two-variable case:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">## &lt;BarContainer object of 5 artists&gt;</span>
<span class="c1">## &lt;BarContainer object of 5 artists&gt;</span>
<span class="c1">## ([&lt;matplotlib.axis.XTick object at 0x7f283f1c32b0&gt;, &lt;matplotlib.axis.XTick object at 0x7f283f1c35b0&gt;, &lt;matplotlib.axis.XTick object at 0x7f283f0f3040&gt;, &lt;matplotlib.axis.XTick object at 0x7f283f100ee0&gt;, &lt;matplotlib.axis.XTick object at 0x7f283f1c3190&gt;], [Text(0, 0, &#39;20&#39;), Text(1, 0, &#39;30&#39;), Text(2, 0, &#39;40&#39;), Text(3, 0, &#39;50&#39;), Text(4, 0, &#39;60&#39;)])</span>
</pre></div>
</div>
<div class="figure align-default" id="id2">
<span id="fig-340-categorical-multi-9"></span><img alt="../_images/340-categorical-multi-9-3.png" src="../_images/340-categorical-multi-9-3.png" />
<p class="caption"><span class="caption-number">Figure 13.2 </span><span class="caption-text">plot of chunk 340-categorical-multi-9</span><a class="headerlink" href="#id2" title="Permalink to this image">Â¶</a></p>
</div>
<p>We can also create stacked bar plots.
Here, we are drawing horizontal bars for
data that have been normalised so that for each sex they sum to 100%.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">p_sex</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">100.0</span>  <span class="c1"># normalise each row (100%)</span>
<span class="n">c_sex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">p_sex</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># prepend column [0]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p_sex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">c_sex</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">p_sex</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">## &lt;BarContainer object of 2 artists&gt;</span>
<span class="c1">## &lt;BarContainer object of 2 artists&gt;</span>
<span class="c1">## &lt;BarContainer object of 2 artists&gt;</span>
<span class="c1">## &lt;BarContainer object of 2 artists&gt;</span>
<span class="c1">## &lt;BarContainer object of 2 artists&gt;</span>
<span class="c1">## ([&lt;matplotlib.axis.YTick object at 0x7f283f12f5b0&gt;, &lt;matplotlib.axis.YTick object at 0x7f283f189610&gt;], [Text(0, 0, &#39;F&#39;), Text(0, 1, &#39;M&#39;)])</span>
</pre></div>
</div>
<div class="figure align-default" id="id3">
<span id="fig-340-categorical-multi-10"></span><img alt="../_images/340-categorical-multi-10-5.png" src="../_images/340-categorical-multi-10-5.png" />
<p class="caption"><span class="caption-number">Figure 13.3 </span><span class="caption-text">plot of chunk 340-categorical-multi-10</span><a class="headerlink" href="#id3" title="Permalink to this image">Â¶</a></p>
</div>
</div>
</div>
<div class="section" id="higher-order-contingency-tables">
<h2><span class="section-number">13.3. </span>Higher-Order Contingency Tables (*)<a class="headerlink" href="#higher-order-contingency-tables" title="Permalink to this headline">Â¶</a></h2>
<p><strong class="program">numpy</strong> also supports higher-dimensional arrays.
They often arise when we create contingency tables for more than 2 variables.</p>
<p>For example, letâ€™s introduce another variable based on the <em>country</em>
column: Poland, Kenya, and Other (because there are too many countries
in the database).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marathon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
    <span class="n">marathon</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">marathon</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PL&quot;</span><span class="p">,</span> <span class="s2">&quot;PL&quot;</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">marathon</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;KE&quot;</span><span class="p">,</span> <span class="s2">&quot;KE&quot;</span><span class="p">,</span> <span class="s2">&quot;XX&quot;</span><span class="p">))</span>
<span class="p">))</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">contingency</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">marathon</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">marathon</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">marathon</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">l</span><span class="p">,</span> <span class="n">v</span>
<span class="c1">## ((array([&#39;KE&#39;, &#39;PL&#39;, &#39;XX&#39;], dtype=&#39;&lt;U2&#39;), array([&#39;F&#39;, &#39;M&#39;], dtype=&#39;&lt;U2&#39;), array([&#39;20&#39;, &#39;30&#39;, &#39;40&#39;, &#39;50&#39;, &#39;60&#39;], dtype=&#39;&lt;U2&#39;)), array([[[  0,   2,   0,   0,   0],</span>
<span class="c1">##         [  4,   2,   0,   0,   0]],</span>
<span class="c1">## </span>
<span class="c1">##        [[ 13,  17,   6,   1,   0],</span>
<span class="c1">##         [142, 391, 251,  65,   9]],</span>
<span class="c1">## </span>
<span class="c1">##        [[  4,   4,   2,   0,   0],</span>
<span class="c1">##         [ 12,  40,  27,   8,   0]]]))</span>
</pre></div>
</div>
<p>This gave us a 3-dimensional array (which in our case
can be thought of as three matrices stacked together).
The same in a slightly more readable form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="c1">## KE, :, :</span>
<span class="c1">##       20  30  40  50  60</span>
<span class="c1">##    F   0   2   0   0   0</span>
<span class="c1">##    M   4   2   0   0   0</span>
<span class="c1">## PL, :, :</span>
<span class="c1">##       20  30  40  50  60</span>
<span class="c1">##    F  13  17   6   1   0</span>
<span class="c1">##    M 142 391 251  65   9</span>
<span class="c1">## XX, :, :</span>
<span class="c1">##       20  30  40  50  60</span>
<span class="c1">##    F   4   4   2   0   0</span>
<span class="c1">##    M  12  40  27   8   0</span>
</pre></div>
</div>
<p>It is worth noting that most vectorisation schemes that we have covered
for matrix data naturally translate to
higher dimensions. For instance, indexing: <code class="docutils literal notranslate"><span class="pre">v[1,</span> <span class="pre">0,</span> <span class="pre">2]</span></code> denotes the number
of Polish females aged 40-49 (i.e., 6 persons).
Also, we can aggregate data along different axes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">##        F   M</span>
<span class="c1">##   KE   2   6</span>
<span class="c1">##   PL  37 858</span>
<span class="c1">##   XX  10  87</span>
<span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="c1">##   KE  PL  XX</span>
<span class="c1">##    8 895  97</span>
</pre></div>
</div>
</div>
<div class="section" id="measuring-association">
<h2><span class="section-number">13.4. </span>Measuring Association (*)<a class="headerlink" href="#measuring-association" title="Permalink to this headline">Â¶</a></h2>
<p>Let us consider Australian Bureau of Statisticsâ€™
<a class="reference external" href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey-first-results/2017-18">National Health Survey 2018</a>
data on the prevalence of certain conditions
as a function of age. Here is the extracted contingency table:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Arthritis&quot;</span><span class="p">,</span> <span class="s2">&quot;Asthma&quot;</span><span class="p">,</span> <span class="s2">&quot;Back problems&quot;</span><span class="p">,</span> <span class="s2">&quot;Cancer (malignant neoplasms)&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Chronic obstructive pulmonary disease&quot;</span><span class="p">,</span> <span class="s2">&quot;Diabetes mellitus&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Heart, stroke and vascular disease&quot;</span><span class="p">,</span> <span class="s2">&quot;Kidney disease&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Mental and behavioural conditions&quot;</span><span class="p">,</span> <span class="s2">&quot;Osteoporosis&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;15-44&quot;</span><span class="p">,</span> <span class="s2">&quot;45-64&quot;</span><span class="p">,</span> <span class="s2">&quot;65+&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span> <span class="mf">360.2</span><span class="p">,</span>     <span class="mf">1489.0</span><span class="p">,</span>      <span class="mf">1772.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1069.7</span><span class="p">,</span>      <span class="mf">741.9</span><span class="p">,</span>       <span class="mf">433.7</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1469.6</span><span class="p">,</span>     <span class="mf">1513.3</span><span class="p">,</span>       <span class="mf">955.3</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">28.1</span><span class="p">,</span>      <span class="mf">162.7</span><span class="p">,</span>       <span class="mf">237.5</span><span class="p">],</span>
    <span class="p">[</span> <span class="mf">103.8</span><span class="p">,</span>      <span class="mf">207.0</span><span class="p">,</span>       <span class="mf">251.9</span><span class="p">],</span>
    <span class="p">[</span> <span class="mf">135.4</span><span class="p">,</span>      <span class="mf">427.3</span><span class="p">,</span>       <span class="mf">607.7</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">94.0</span><span class="p">,</span>      <span class="mf">344.4</span><span class="p">,</span>       <span class="mf">716.0</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">29.6</span><span class="p">,</span>       <span class="mf">67.7</span><span class="p">,</span>       <span class="mf">123.3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2218.9</span><span class="p">,</span>     <span class="mf">1390.6</span><span class="p">,</span>       <span class="mf">725.0</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mf">36.1</span><span class="p">,</span>      <span class="mf">312.3</span><span class="p">,</span>       <span class="mf">564.7</span><span class="p">],</span>
<span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">marek</span><span class="o">.</span><span class="n">print_labelled_array</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="c1">##                                        15-44                 45-64                   65+</span>
<span class="c1">##              Arthritis                360000               1489000               1772000</span>
<span class="c1">##                 Asthma               1069000                741000                433000</span>
<span class="c1">##          Back problems               1469000               1513000                955000</span>
<span class="c1">##  Cancer (malignant neo                 28000                162000                237000</span>
<span class="c1">##  Chronic obstructive p                103000                207000                251000</span>
<span class="c1">##      Diabetes mellitus                135000                427000                607000</span>
<span class="c1">##  Heart, stroke and vas                 94000                344000                716000</span>
<span class="c1">##         Kidney disease                 29000                 67000                123000</span>
<span class="c1">##  Mental and behavioura               2218000               1390000                725000</span>
<span class="c1">##           Osteoporosis                 36000                312000                564000</span>
</pre></div>
</div>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Cramer%27s_V">Cramerâ€™s <em>V</em></a> is one of a few ways
to measure the degree of association between two categorical variables.
It is equal to 0 (lowest possible value) if the two variables are independent
(there is no association between them)
and 1 (highest possible value) if they are tied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">contingency</span><span class="o">.</span><span class="n">association</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="c1">## 0.316237999724298</span>
</pre></div>
</div>
<p>The above means that there is small association between
age and the prevalence of certain conditions
(in other words, it might be the case that some conditions
are more prevalent in different age groups than others).</p>
<p>It is defined via:</p>
<div class="math notranslate nohighlight">
\[
\chi^2 = \sum_{i=1}^n \sum_{j=1}^m \frac{(v_{i,j} - v_{i,\cdot} v_{\cdot, j}/c)^2}{v_{i,\cdot} v_{\cdot, j}/c},
\]</div>
<p>where <span class="math notranslate nohighlight">\(c = \sum_{i=1}^n \sum_{j=1}^m v_{i,j}\)</span>,
<span class="math notranslate nohighlight">\(v_{i,\cdot} = \sum_{j=1}^m v_{i,j}\)</span>,
<span class="math notranslate nohighlight">\(v_{\cdot, j} = \sum_{i=1}^n v_{i,j}\)</span>,
and then</p>
<div class="math notranslate nohighlight">
\[
V = \sqrt{
\frac{\chi^2/c}{\min\{n-1, m-1\}}
}.
\]</div>
<p>Note that <span class="math notranslate nohighlight">\(v_{i,j}\)</span> is what we observe
and <span class="math notranslate nohighlight">\(v_{i,\cdot} v_{\cdot, j}/c\)</span> denotes what we would expect
if the two variables were independent.</p>
<p>Here is how to compute it manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">chisq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">e</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">chisq</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">## 0.316237999724298</span>
</pre></div>
</div>
<blockquote>
<div><p>(*) <strong>Exercise.</strong>
Take a look at
<em>Table 19: Comorbidity of selected chronic conditions</em>
of the  <a class="reference external" href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey-first-results/2017-18">National Health Survey 2018</a>,
where we clearly see that many disorders co-occur.
Visualise them on some heatmaps and bar plots (including
data grouped by sex and age).</p>
</div></blockquote>
</div>
<div class="section" id="questions">
<h2><span class="section-number">13.5. </span>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">Â¶</a></h2>
<div class="proof proof-type-exercise" id="id4">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.1</span>
        
    </div><div class="proof-content">
<p>List some ways to visualise multidimensional categorical data.</p>
</div></div><div class="proof proof-type-exercise" id="id5">

    <div class="proof-title">
        <span class="proof-type">Exercise 13.2</span>
        
    </div><div class="proof-content">
<p>(*) How is Cramerâ€™s <em>V</em> defined and what values does it take?</p>
</div></div></div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="410-dataframe.html" class="btn btn-neutral float-right" title="14. ðŸš§ Introduction to Data Frames in pandas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="330-visualise-multi.html" class="btn btn-neutral float-left" title="12. ðŸš§ Visualising Multidimensional Data and Measuring Correlation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Marek Gagolewski. Licensed under CC BY-NC-ND 4.0.
      <span class="lastupdated">
        Last updated on 2022-03-30T18:08:41+1100.
      </span>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a> theme.
    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>